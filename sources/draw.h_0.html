
<html>
<head>
  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.2.1.min.js"></script>
</head>
<body>
<pre><code class = "cpp">
<a name="ln1">/*</a>
<a name="ln2">    This file is part of darktable,</a>
<a name="ln3">    copyright (c) 2009--2010 johannes hanika.</a>
<a name="ln4"> </a>
<a name="ln5">    darktable is free software: you can redistribute it and/or modify</a>
<a name="ln6">    it under the terms of the GNU General Public License as published by</a>
<a name="ln7">    the Free Software Foundation, either version 3 of the License, or</a>
<a name="ln8">    (at your option) any later version.</a>
<a name="ln9"> </a>
<a name="ln10">    darktable is distributed in the hope that it will be useful,</a>
<a name="ln11">    but WITHOUT ANY WARRANTY; without even the implied warranty of</a>
<a name="ln12">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</a>
<a name="ln13">    GNU General Public License for more details.</a>
<a name="ln14"> </a>
<a name="ln15">    You should have received a copy of the GNU General Public License</a>
<a name="ln16">    along with darktable.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</a>
<a name="ln17">*/</a>
<a name="ln18"> </a>
<a name="ln19">#pragma once</a>
<a name="ln20"> </a>
<a name="ln21">/** some common drawing routines. */</a>
<a name="ln22"> </a>
<a name="ln23">#ifdef HAVE_CONFIG_H</a>
<a name="ln24">#include &quot;config.h&quot;</a>
<a name="ln25">#endif</a>
<a name="ln26"> </a>
<a name="ln27">#include &quot;common/curve_tools.h&quot;</a>
<a name="ln28">#include &lt;cairo.h&gt;</a>
<a name="ln29">#include &lt;glib.h&gt;</a>
<a name="ln30">#include &lt;math.h&gt;</a>
<a name="ln31">#include &lt;stdint.h&gt;</a>
<a name="ln32">#include &lt;stdlib.h&gt;</a>
<a name="ln33"> </a>
<a name="ln34">#ifndef M_PI</a>
<a name="ln35">#define M_PI 3.141592654</a>
<a name="ln36">#endif</a>
<a name="ln37"> </a>
<a name="ln38">/** wrapper around nikon curve. */</a>
<a name="ln39">typedef struct dt_draw_curve_t</a>
<a name="ln40">{</a>
<a name="ln41">  CurveData c;</a>
<a name="ln42">  CurveSample csample;</a>
<a name="ln43">} dt_draw_curve_t;</a>
<a name="ln44"> </a>
<a name="ln45">/** draws a rating star</a>
<a name="ln46">   TODO: Use this instead of views/view.c dt_view_star in lightable expose.</a>
<a name="ln47">*/</a>
<a name="ln48">static inline void dt_draw_star(cairo_t *cr, float x, float y, float r1, float r2)</a>
<a name="ln49">{</a>
<a name="ln50">  const float d = 2.0 * M_PI * 0.1f;</a>
<a name="ln51">  const float dx[10] = { sinf(0.0),   sinf(d),     sinf(2 * d), sinf(3 * d), sinf(4 * d),</a>
<a name="ln52">                         sinf(5 * d), sinf(6 * d), sinf(7 * d), sinf(8 * d), sinf(9 * d) };</a>
<a name="ln53">  const float dy[10] = { cosf(0.0),   cosf(d),     cosf(2 * d), cosf(3 * d), cosf(4 * d),</a>
<a name="ln54">                         cosf(5 * d), cosf(6 * d), cosf(7 * d), cosf(8 * d), cosf(9 * d) };</a>
<a name="ln55">  cairo_move_to(cr, x + r1 * dx[0], y - r1 * dy[0]);</a>
<a name="ln56">  for(int k = 1; k &lt; 10; k++)</a>
<a name="ln57">    if(k &amp; 1)</a>
<a name="ln58">      cairo_line_to(cr, x + r2 * dx[k], y - r2 * dy[k]);</a>
<a name="ln59">    else</a>
<a name="ln60">      cairo_line_to(cr, x + r1 * dx[k], y - r1 * dy[k]);</a>
<a name="ln61">  cairo_close_path(cr);</a>
<a name="ln62">}</a>
<a name="ln63"> </a>
<a name="ln64">static inline void dt_draw_line(cairo_t *cr, float left, float top, float right, float bottom)</a>
<a name="ln65">{</a>
<a name="ln66">  cairo_move_to(cr, left, top);</a>
<a name="ln67">  cairo_line_to(cr, right, bottom);</a>
<a name="ln68">}</a>
<a name="ln69"> </a>
<a name="ln70">static inline void dt_draw_grid(cairo_t *cr, const int num, const int left, const int top, const int right,</a>
<a name="ln71">                                const int bottom)</a>
<a name="ln72">{</a>
<a name="ln73">  float width = right - left;</a>
<a name="ln74">  float height = bottom - top;</a>
<a name="ln75"> </a>
<a name="ln76">  for(int k = 1; k &lt; num; k++)</a>
<a name="ln77">  {</a>
<a name="ln78">    dt_draw_line(cr, left + k / (float)num * width, top, left + k / (float)num * width, bottom);</a>
<a name="ln79">    cairo_stroke(cr);</a>
<a name="ln80">    dt_draw_line(cr, left, top + k / (float)num * height, right, top + k / (float)num * height);</a>
<a name="ln81">    cairo_stroke(cr);</a>
<a name="ln82">  }</a>
<a name="ln83">}</a>
<a name="ln84"> </a>
<a name="ln85">static inline float dt_curve_to_mouse(const float x, const float zoom_factor, const float offset)</a>
<a name="ln86">{</a>
<a name="ln87">  return (x - offset) * zoom_factor;</a>
<a name="ln88">}</a>
<a name="ln89"> </a>
<a name="ln90">/* left, right, top, bottom are in curve coordinates [0..1] */</a>
<a name="ln91">static inline void dt_draw_grid_zoomed(cairo_t *cr, const int num, const float left, const float top,</a>
<a name="ln92">                                       const float right, const float bottom, const float width,</a>
<a name="ln93">                                       const float height, const float zoom_factor, const float zoom_offset_x,</a>
<a name="ln94">                                       const float zoom_offset_y)</a>
<a name="ln95">{</a>
<a name="ln96">  for(int k = 1; k &lt; num; k++)</a>
<a name="ln97">  {</a>
<a name="ln98">    dt_draw_line(cr, dt_curve_to_mouse(left + k / (float)num, zoom_factor, zoom_offset_x) * width,</a>
<a name="ln99">                 dt_curve_to_mouse(top, zoom_factor, zoom_offset_y) * -height,</a>
<a name="ln100">                 dt_curve_to_mouse(left + k / (float)num, zoom_factor, zoom_offset_x) * width,</a>
<a name="ln101">                 dt_curve_to_mouse(bottom, zoom_factor, zoom_offset_y) * -height);</a>
<a name="ln102">    cairo_stroke(cr);</a>
<a name="ln103"> </a>
<a name="ln104">    dt_draw_line(cr, dt_curve_to_mouse(left, zoom_factor, zoom_offset_x) * width,</a>
<a name="ln105">                 dt_curve_to_mouse(top + k / (float)num, zoom_factor, zoom_offset_y) * -height,</a>
<a name="ln106">                 dt_curve_to_mouse(right, zoom_factor, zoom_offset_x) * width,</a>
<a name="ln107">                 dt_curve_to_mouse(top + k / (float)num, zoom_factor, zoom_offset_y) * -height);</a>
<a name="ln108">    cairo_stroke(cr);</a>
<a name="ln109">  }</a>
<a name="ln110">}</a>
<a name="ln111"> </a>
<a name="ln112">static inline void dt_draw_loglog_grid(cairo_t *cr, const int num, const int left, const int top,</a>
<a name="ln113">                                       const int right, const int bottom, const float base)</a>
<a name="ln114">{</a>
<a name="ln115">  float width = right - left;</a>
<a name="ln116">  float height = bottom - top;</a>
<a name="ln117"> </a>
<a name="ln118">  for(int k = 1; k &lt; num; k++)</a>
<a name="ln119">  {</a>
<a name="ln120">    const float x = logf(k / (float)num * (base - 1.0f) + 1) / logf(base);</a>
<a name="ln121">    dt_draw_line(cr, left + x * width, top, left + x * width, bottom);</a>
<a name="ln122">    cairo_stroke(cr);</a>
<a name="ln123">    dt_draw_line(cr, left, top + x * height, right, top + x * height);</a>
<a name="ln124">    cairo_stroke(cr);</a>
<a name="ln125">  }</a>
<a name="ln126">}</a>
<a name="ln127"> </a>
<a name="ln128">static inline void dt_draw_semilog_x_grid(cairo_t *cr, const int num, const int left, const int top,</a>
<a name="ln129">                                       const int right, const int bottom, const float base)</a>
<a name="ln130">{</a>
<a name="ln131">  float width = right - left;</a>
<a name="ln132">  float height = bottom - top;</a>
<a name="ln133"> </a>
<a name="ln134">  for(int k = 1; k &lt; num; k++)</a>
<a name="ln135">  {</a>
<a name="ln136">    const float x = logf(k / (float)num * (base - 1.0f) + 1) / logf(base);</a>
<a name="ln137">    dt_draw_line(cr, left + x * width, top, left + x * width, bottom);</a>
<a name="ln138">    cairo_stroke(cr);</a>
<a name="ln139">    dt_draw_line(cr, left, top + k / (float)num * height, right, top + k / (float)num * height);</a>
<a name="ln140">    cairo_stroke(cr);</a>
<a name="ln141">  }</a>
<a name="ln142">}</a>
<a name="ln143"> </a>
<a name="ln144">static inline void dt_draw_semilog_y_grid(cairo_t *cr, const int num, const int left, const int top,</a>
<a name="ln145">                                       const int right, const int bottom, const float base)</a>
<a name="ln146">{</a>
<a name="ln147">  float width = right - left;</a>
<a name="ln148">  float height = bottom - top;</a>
<a name="ln149"> </a>
<a name="ln150">  for(int k = 1; k &lt; num; k++)</a>
<a name="ln151">  {</a>
<a name="ln152">    const float x = logf(k / (float)num * (base - 1.0f) + 1) / logf(base);</a>
<a name="ln153">    dt_draw_line(cr, left + k / (float)num * width, top, left + k / (float)num * width, bottom);</a>
<a name="ln154">    cairo_stroke(cr);</a>
<a name="ln155">    dt_draw_line(cr, left, top + x * height, right, top + x * height);</a>
<a name="ln156">    cairo_stroke(cr);</a>
<a name="ln157">  }</a>
<a name="ln158">}</a>
<a name="ln159"> </a>
<a name="ln160"> </a>
<a name="ln161">static inline void dt_draw_waveform_lines(cairo_t *cr, const int left, const int top, const int right,</a>
<a name="ln162">                                          const int bottom)</a>
<a name="ln163">{</a>
<a name="ln164">  //   float width = right - left;</a>
<a name="ln165">  float height = bottom - top;</a>
<a name="ln166"> </a>
<a name="ln167">  int num = 9, middle = 5;</a>
<a name="ln168"> </a>
<a name="ln169">  cairo_save(cr);</a>
<a name="ln170"> </a>
<a name="ln171">  for(int k = 1; k &lt; num; k++)</a>
<a name="ln172">  {</a>
<a name="ln173">    if(k == middle) continue;</a>
<a name="ln174">    dt_draw_line(cr, left, top + k / (float)num * height, right, top + k / (float)num * height);</a>
<a name="ln175">    cairo_stroke(cr);</a>
<a name="ln176">  }</a>
<a name="ln177"> </a>
<a name="ln178">  double dashes = 4.0;</a>
<a name="ln179">  cairo_set_dash(cr, &amp;dashes, 1, 0);</a>
<a name="ln180"> </a>
<a name="ln181">  dt_draw_line(cr, left, top + middle / (float)num * height, right, top + middle / (float)num * height);</a>
<a name="ln182">  cairo_stroke(cr);</a>
<a name="ln183"> </a>
<a name="ln184">  cairo_restore(cr);</a>
<a name="ln185">}</a>
<a name="ln186"> </a>
<a name="ln187">static inline void dt_draw_vertical_lines(cairo_t *cr, const int num, const int left, const int top,</a>
<a name="ln188">                                          const int right, const int bottom)</a>
<a name="ln189">{</a>
<a name="ln190">  float width = right - left;</a>
<a name="ln191"> </a>
<a name="ln192">  for(int k = 1; k &lt; num; k++)</a>
<a name="ln193">  {</a>
<a name="ln194">    cairo_move_to(cr, left + k / (float)num * width, top);</a>
<a name="ln195">    cairo_line_to(cr, left + k / (float)num * width, bottom);</a>
<a name="ln196">    cairo_stroke(cr);</a>
<a name="ln197">  }</a>
<a name="ln198">}</a>
<a name="ln199"> </a>
<a name="ln200">static inline void dt_draw_endmarker(cairo_t *cr, const int width, const int height, const int left)</a>
<a name="ln201">{</a>
<a name="ln202">  // fibonacci spiral:</a>
<a name="ln203">  float v[14] = { -8., 3., -8., 0., -13., 0., -13, 3., -13., 8., -8., 8., 0., 0. };</a>
<a name="ln204">  for(int k = 0; k &lt; 14; k += 2) v[k] = v[k] * 0.01 + 0.5;</a>
<a name="ln205">  for(int k = 1; k &lt; 14; k += 2) v[k] = v[k] * 0.03 + 0.5;</a>
<a name="ln206">  for(int k = 0; k &lt; 14; k += 2) v[k] *= width;</a>
<a name="ln207">  for(int k = 1; k &lt; 14; k += 2) v[k] *= height;</a>
<a name="ln208">  if(left)</a>
<a name="ln209">    for(int k = 0; k &lt; 14; k += 2) v[k] = width - v[k];</a>
<a name="ln210">  cairo_set_line_width(cr, 2.);</a>
<a name="ln211">  cairo_set_source_rgb(cr, 0.3, 0.3, 0.3);</a>
<a name="ln212">  cairo_move_to(cr, v[0], v[1]);</a>
<a name="ln213">  cairo_curve_to(cr, v[2], v[3], v[4], v[5], v[6], v[7]);</a>
<a name="ln214">  cairo_curve_to(cr, v[8], v[9], v[10], v[11], v[12], v[13]);</a>
<a name="ln215">  for(int k = 0; k &lt; 14; k += 2) v[k] = width - v[k];</a>
<a name="ln216">  for(int k = 1; k &lt; 14; k += 2) v[k] = height - v[k];</a>
<a name="ln217">  cairo_curve_to(cr, v[10], v[11], v[8], v[9], v[6], v[7]);</a>
<a name="ln218">  cairo_curve_to(cr, v[4], v[5], v[2], v[3], v[0], v[1]);</a>
<a name="ln219">  cairo_stroke(cr);</a>
<a name="ln220">}</a>
<a name="ln221"> </a>
<a name="ln222">static inline dt_draw_curve_t *dt_draw_curve_new(const float min, const float max, unsigned int type)</a>
<a name="ln223">{</a>
<a name="ln224">  dt_draw_curve_t *c = (dt_draw_curve_t *)malloc(sizeof(dt_draw_curve_t));</a>
<a name="ln225">  c-&gt;csample.m_samplingRes = 0x10000;</a>
<a name="ln226">  c-&gt;csample.m_outputRes = 0x10000;</a>
<a name="ln227">  c-&gt;csample.m_Samples = (uint16_t *)malloc(sizeof(uint16_t) * 0x10000);</a>
<a name="ln228"> </a>
<a name="ln229">  c-&gt;c.m_spline_type = type;</a>
<a name="ln230">  c-&gt;c.m_numAnchors = 0;</a>
<a name="ln231">  c-&gt;c.m_min_x = 0.0;</a>
<a name="ln232">  c-&gt;c.m_max_x = 1.0;</a>
<a name="ln233">  c-&gt;c.m_min_y = 0.0;</a>
<a name="ln234">  c-&gt;c.m_max_y = 1.0;</a>
<a name="ln235">  return c;</a>
<a name="ln236">}</a>
<a name="ln237"> </a>
<a name="ln238">static inline void dt_draw_curve_destroy(dt_draw_curve_t *c)</a>
<a name="ln239">{</a>
<a name="ln240">  free(c-&gt;csample.m_Samples);</a>
<a name="ln241">  free(c);</a>
<a name="ln242">}</a>
<a name="ln243"> </a>
<a name="ln244">static inline void dt_draw_curve_set_point(dt_draw_curve_t *c, const int num, const float x, const float y)</a>
<a name="ln245">{</a>
<a name="ln246">  c-&gt;c.m_anchors[num].x = x;</a>
<a name="ln247">  c-&gt;c.m_anchors[num].y = y;</a>
<a name="ln248">}</a>
<a name="ln249"> </a>
<a name="ln250">static inline void dt_draw_curve_calc_values(dt_draw_curve_t *c, const float min, const float max,</a>
<a name="ln251">                                             const int res, float *x, float *y)</a>
<a name="ln252">{</a>
<a name="ln253">  c-&gt;csample.m_samplingRes = res;</a>
<a name="ln254">  c-&gt;csample.m_outputRes = 0x10000;</a>
<a name="ln255">  CurveDataSample(&amp;c-&gt;c, &amp;c-&gt;csample);</a>
<a name="ln256">  if(x)</a>
<a name="ln257">  {</a>
<a name="ln258">#ifdef _OPENMP</a>
<a name="ln259">#pragma omp parallel for SIMD() default(none) shared(x) schedule(static)</a>
<a name="ln260">#endif</a>
<a name="ln261">    for(int k = 0; k &lt; res; k++) x[k] = k * (1.0f / res);</a>
<a name="ln262">  }</a>
<a name="ln263">  if(y)</a>
<a name="ln264">  {</a>
<a name="ln265">#ifdef _OPENMP</a>
<a name="ln266">#pragma omp parallel for SIMD() default(none) shared(y, c) schedule(static)</a>
<a name="ln267">#endif</a>
<a name="ln268">    for(int k = 0; k &lt; res; k++) y[k] = min + (max - min) * c-&gt;csample.m_Samples[k] * (1.0f / 0x10000);</a>
<a name="ln269">  }</a>
<a name="ln270">}</a>
<a name="ln271"> </a>
<a name="ln272">static inline float dt_draw_curve_calc_value(dt_draw_curve_t *c, const float x)</a>
<a name="ln273">{</a>
<a name="ln274">  float xa[20], ya[20];</a>
<a name="ln275">  float val = 0.f;</a>
<a name="ln276">  float *ypp = NULL;</a>
<a name="ln277">  for(int i = 0; i &lt; c-&gt;c.m_numAnchors; i++)</a>
<a name="ln278">  {</a>
<a name="ln279">    xa[i] = c-&gt;c.m_anchors[i].x;</a>
<a name="ln280">    ya[i] = c-&gt;c.m_anchors[i].y;</a>
<a name="ln281">  }</a>
<a name="ln282">  ypp = interpolate_set(c-&gt;c.m_numAnchors, xa, ya, c-&gt;c.m_spline_type);</a>
<a name="ln283">  if(ypp)</a>
<a name="ln284">  {</a>
<a name="ln285">    val = interpolate_val(c-&gt;c.m_numAnchors, xa, x, ya, ypp, c-&gt;c.m_spline_type);</a>
<a name="ln286">    free(ypp);</a>
<a name="ln287">  }</a>
<a name="ln288">  return MIN(MAX(val, c-&gt;c.m_min_y), c-&gt;c.m_max_y);</a>
<a name="ln289">}</a>
<a name="ln290"> </a>
<a name="ln291">static inline int dt_draw_curve_add_point(dt_draw_curve_t *c, const float x, const float y)</a>
<a name="ln292">{</a>
<a name="ln293">  c-&gt;c.m_anchors[c-&gt;c.m_numAnchors].x = x;</a>
<a name="ln294">  c-&gt;c.m_anchors[c-&gt;c.m_numAnchors].y = y;</a>
<a name="ln295">  c-&gt;c.m_numAnchors++;</a>
<a name="ln296">  return 0;</a>
<a name="ln297">}</a>
<a name="ln298"> </a>
<a name="ln299">static inline void dt_draw_histogram_8_linear(cairo_t *cr, const uint32_t *hist, int32_t channels, int32_t channel)</a>
<a name="ln300">{</a>
<a name="ln301">  cairo_move_to(cr, 0, 0);</a>
<a name="ln302">  for(int k = 0; k &lt; 256; k++) cairo_line_to(cr, k, hist[channels * k + channel]);</a>
<a name="ln303">  cairo_line_to(cr, 255, 0);</a>
<a name="ln304">  cairo_close_path(cr);</a>
<a name="ln305">  cairo_fill(cr);</a>
<a name="ln306">}</a>
<a name="ln307"> </a>
<a name="ln308">static inline void dt_draw_histogram_8_zoomed(cairo_t *cr, const uint32_t *hist, int32_t channels, int32_t channel,</a>
<a name="ln309">                                              const float zoom_factor, const float zoom_offset_x,</a>
<a name="ln310">                                              const float zoom_offset_y, gboolean linear)</a>
<a name="ln311">{</a>
<a name="ln312">  cairo_move_to(cr, -zoom_offset_x, -zoom_offset_y);</a>
<a name="ln313">  for(int k = 0; k &lt; 256; k++)</a>
<a name="ln314">  {</a>
<a name="ln315">    const float value = ((float)hist[channels * k + channel] - zoom_offset_y) * zoom_factor;</a>
<a name="ln316">    const float hist_value = value&lt;0 ? 0.f : value;</a>
<a name="ln317">    cairo_line_to(cr, ((float)k - zoom_offset_x) * zoom_factor, linear ? hist_value : log(1.0f + hist_value));</a>
<a name="ln318">  }</a>
<a name="ln319">  cairo_line_to(cr, (255.f - zoom_offset_x), -zoom_offset_y * zoom_factor);</a>
<a name="ln320">  cairo_close_path(cr);</a>
<a name="ln321">  cairo_fill(cr);</a>
<a name="ln322">}</a>
<a name="ln323"> </a>
<a name="ln324">static inline void dt_draw_histogram_8_log(cairo_t *cr, const uint32_t *hist, int32_t channels, int32_t channel)</a>
<a name="ln325">{</a>
<a name="ln326">  cairo_move_to(cr, 0, 0);</a>
<a name="ln327">  for(int k = 0; k &lt; 256; k++) cairo_line_to(cr, k, logf(1.0 + hist[channels * k + channel]));</a>
<a name="ln328">  cairo_line_to(cr, 255, 0);</a>
<a name="ln329">  cairo_close_path(cr);</a>
<a name="ln330">  cairo_fill(cr);</a>
<a name="ln331">}</a>
<a name="ln332"> </a>
<a name="ln333">static inline void dt_draw_histogram_8_log_base(cairo_t *cr, const uint32_t *hist, int32_t channels, int32_t channel, float base_log)</a>
<a name="ln334">{</a>
<a name="ln335">  cairo_move_to(cr, 0, 0);</a>
<a name="ln336">  for(int k = 0; k &lt; 256; k++)</a>
<a name="ln337">  {</a>
<a name="ln338">    const float x = (float)k / 255.0f;</a>
<a name="ln339">    cairo_line_to(cr, logf(x * (base_log - 1.0f) + 1.0f) / logf(base_log), logf(1.0 + hist[channels * k + channel]));</a>
<a name="ln340">  }</a>
<a name="ln341"> </a>
<a name="ln342">  cairo_line_to(cr, 255, 0);</a>
<a name="ln343">  cairo_close_path(cr);</a>
<a name="ln344">  cairo_fill(cr);</a>
<a name="ln345">}</a>
<a name="ln346"> </a>
<a name="ln347">static inline void dt_draw_histogram_8(cairo_t *cr, const uint32_t *hist, int32_t channels, int32_t channel, const gboolean linear)</a>
<a name="ln348">{</a>
<a name="ln349">  if(linear)</a>
<a name="ln350">    dt_draw_histogram_8_linear(cr, hist, channels, channel);</a>
<a name="ln351">  else</a>
<a name="ln352">    dt_draw_histogram_8_log(cr, hist, channels, channel);</a>
<a name="ln353">}</a>
<a name="ln354"> </a>
<a name="ln355">/** transform a data blob from cairo's premultiplied rgba/bgra to GdkPixbuf's un-premultiplied bgra/rgba */</a>
<a name="ln356">static inline void dt_draw_cairo_to_gdk_pixbuf(uint8_t *data, unsigned int width, unsigned int height)</a>
<a name="ln357">{</a>
<a name="ln358">  for(uint32_t y = 0; y &lt; height; y++)</a>
<a name="ln359">    for(uint32_t x = 0; x &lt; width; x++)</a>
<a name="ln360">    {</a>
<a name="ln361">      uint8_t *r, *g, *b, *a, tmp;</a>
<a name="ln362">      r = &amp;data[(y * width + x) * 4 + 0];</a>
<a name="ln363">      g = &amp;data[(y * width + x) * 4 + 1];</a>
<a name="ln364">      b = &amp;data[(y * width + x) * 4 + 2];</a>
<a name="ln365">      a = &amp;data[(y * width + x) * 4 + 3];</a>
<a name="ln366"> </a>
<a name="ln367">      // switch r and b</a>
<a name="ln368">      tmp = *r;</a>
<a name="ln369">      *r = *b;</a>
<a name="ln370">      *b = tmp;</a>
<a name="ln371"> </a>
<a name="ln372">      // cairo uses premultiplied alpha, reverse that</a>
<a name="ln373">      if(*a != 0)</a>
<a name="ln374">      {</a>
<a name="ln375">        float inv_a = 255.0 / *a;</a>
<a name="ln376">        *r *= inv_a;</a>
<a name="ln377">        *g *= inv_a;</a>
<a name="ln378">        *b *= inv_a;</a>
<a name="ln379">      }</a>
<a name="ln380">    }</a>
<a name="ln381">}</a>
<a name="ln382"> </a>
<a name="ln383">// modelines: These editor modelines have been set for all relevant files by tools/update_modelines.sh</a>
<a name="ln384">// vim: shiftwidth=2 expandtab tabstop=2 cindent</a>
<a name="ln385">// kate: tab-indents: off; indent-width 2; replace-tabs on; indent-mode cstyle; remove-trailing-spaces modified;</a>

</code></pre>
<div class="balloon" rel="225"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v522/" target="_blank">V522</a> There might be dereferencing of a potential null pointer 'c'. Check lines: 225, 224.</p></div>
<div class="balloon" rel="293"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v522/" target="_blank">V522</a> Dereferencing of the null pointer 'c' might take place. The potential null pointer is passed into 'dt_draw_curve_add_point' function. Inspect the first argument. Check lines: 'draw.h:293', 'equalizer.c:247'.</p></div>
<div class="balloon" rel="293"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v522/" target="_blank">V522</a> Dereferencing of the null pointer 'c' might take place. The potential null pointer is passed into 'dt_draw_curve_add_point' function. Inspect the first argument. Check lines: 'draw.h:293', 'rawdenoise.c:589'.</p></div>
<div class="balloon" rel="293"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v522/" target="_blank">V522</a> Dereferencing of the null pointer 'c' might take place. The potential null pointer is passed into 'dt_draw_curve_add_point' function. Inspect the first argument. Check lines: 'draw.h:293', 'rawdenoise.c:970'.</p></div>
<div class="balloon" rel="293"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v522/" target="_blank">V522</a> Dereferencing of the null pointer 'c' might take place. The potential null pointer is passed into 'dt_draw_curve_add_point' function. Inspect the first argument. Check lines: 'draw.h:293', 'tonecurve.c:574'.</p></div>
<div class="balloon" rel="293"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v522/" target="_blank">V522</a> Dereferencing of the null pointer 'c' might take place. The potential null pointer is passed into 'dt_draw_curve_add_point' function. Inspect the first argument. Check lines: 'draw.h:293', 'tonecurve.c:684'.</p></div>
<div class="balloon" rel="293"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v522/" target="_blank">V522</a> Dereferencing of the null pointer 'c' might take place. The potential null pointer is passed into 'dt_draw_curve_add_point' function. Inspect the first argument. Check lines: 'draw.h:293', 'tonecurve.c:1192'.</p></div>
<div class="balloon" rel="293"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v522/" target="_blank">V522</a> Dereferencing of the null pointer 'c' might take place. The potential null pointer is passed into 'dt_draw_curve_add_point' function. Inspect the first argument. Check lines: 'draw.h:293', 'tonecurve.c:1375'.</p></div>
<div class="balloon" rel="293"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v522/" target="_blank">V522</a> Dereferencing of the null pointer 'c' might take place. The potential null pointer is passed into 'dt_draw_curve_add_point' function. Inspect the first argument. Check lines: 'draw.h:293', 'denoiseprofile.c:2525'.</p></div>
<div class="balloon" rel="293"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v522/" target="_blank">V522</a> Dereferencing of the null pointer 'c' might take place. The potential null pointer is passed into 'dt_draw_curve_add_point' function. Inspect the first argument. Check lines: 'draw.h:293', 'denoiseprofile.c:3030'.</p></div>
<div class="balloon" rel="293"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v522/" target="_blank">V522</a> Dereferencing of the null pointer 'c' might take place. The potential null pointer is passed into 'dt_draw_curve_add_point' function. Inspect the first argument. Check lines: 'draw.h:293', 'atrous.c:1013'.</p></div>
<div class="balloon" rel="293"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v522/" target="_blank">V522</a> Dereferencing of the null pointer 'c' might take place. The potential null pointer is passed into 'dt_draw_curve_add_point' function. Inspect the first argument. Check lines: 'draw.h:293', 'atrous.c:1809'.</p></div>
<div class="balloon" rel="293"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v522/" target="_blank">V522</a> Dereferencing of the null pointer 'c' might take place. The potential null pointer is passed into 'dt_draw_curve_add_point' function. Inspect the first argument. Check lines: 'draw.h:293', 'rgbcurve.c:827'.</p></div>
<div class="balloon" rel="293"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v522/" target="_blank">V522</a> Dereferencing of the null pointer 'c' might take place. The potential null pointer is passed into 'dt_draw_curve_add_point' function. Inspect the first argument. Check lines: 'draw.h:293', 'rgbcurve.c:1454'.</p></div>
<div class="balloon" rel="293"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v522/" target="_blank">V522</a> Dereferencing of the null pointer 'c' might take place. The potential null pointer is passed into 'dt_draw_curve_add_point' function. Inspect the first argument. Check lines: 'draw.h:293', 'rgbcurve.c:1626'.</p></div>
<div class="balloon" rel="293"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v522/" target="_blank">V522</a> Dereferencing of the null pointer 'c' might take place. The potential null pointer is passed into 'dt_draw_curve_add_point' function. Inspect the first argument. Check lines: 'draw.h:293', 'rgbcurve.c:1740'.</p></div>
<div class="balloon" rel="293"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v522/" target="_blank">V522</a> Dereferencing of the null pointer 'c' might take place. The potential null pointer is passed into 'dt_draw_curve_add_point' function. Inspect the first argument. Check lines: 'draw.h:293', 'colorzones.c:802'.</p></div>
<div class="balloon" rel="293"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v522/" target="_blank">V522</a> Dereferencing of the null pointer 'c' might take place. The potential null pointer is passed into 'dt_draw_curve_add_point' function. Inspect the first argument. Check lines: 'draw.h:293', 'colorzones.c:2018'.</p></div>
<div class="balloon" rel="293"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v522/" target="_blank">V522</a> Dereferencing of the null pointer 'c' might take place. The potential null pointer is passed into 'dt_draw_curve_add_point' function. Inspect the first argument. Check lines: 'draw.h:293', 'colorzones.c:2244'.</p></div>
<div class="balloon" rel="293"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v522/" target="_blank">V522</a> Dereferencing of the null pointer 'c' might take place. The potential null pointer is passed into 'dt_draw_curve_add_point' function. Inspect the first argument. Check lines: 'draw.h:293', 'colorzones.c:2291'.</p></div>
<div class="balloon" rel="293"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v522/" target="_blank">V522</a> Dereferencing of the null pointer 'c' might take place. The potential null pointer is passed into 'dt_draw_curve_add_point' function. Inspect the first argument. Check lines: 'draw.h:293', 'filmic.c:1328'.</p></div>
<div class="balloon" rel="293"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v522/" target="_blank">V522</a> Dereferencing of the null pointer 'c' might take place. The potential null pointer is passed into 'dt_draw_curve_add_point' function. Inspect the first argument. Check lines: 'draw.h:293', 'basecurve.c:1198'.</p></div>
<div class="balloon" rel="293"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v522/" target="_blank">V522</a> Dereferencing of the null pointer 'c' might take place. The potential null pointer is passed into 'dt_draw_curve_add_point' function. Inspect the first argument. Check lines: 'draw.h:293', 'basecurve.c:1371'.</p></div>
<div class="balloon" rel="293"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v522/" target="_blank">V522</a> Dereferencing of the null pointer 'c' might take place. The potential null pointer is passed into 'dt_draw_curve_add_point' function. Inspect the first argument. Check lines: 'draw.h:293', 'basecurve.c:1929'.</p></div>
<div class="balloon" rel="293"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v522/" target="_blank">V522</a> Dereferencing of the null pointer 'c' might take place. The potential null pointer is passed into 'dt_draw_curve_add_point' function. Inspect the first argument. Check lines: 'draw.h:293', 'lowlight.c:266'.</p></div>
<div class="balloon" rel="293"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v522/" target="_blank">V522</a> Dereferencing of the null pointer 'c' might take place. The potential null pointer is passed into 'dt_draw_curve_add_point' function. Inspect the first argument. Check lines: 'draw.h:293', 'lowlight.c:828'.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
