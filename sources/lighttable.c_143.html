
<html>
<head>
  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.2.1.min.js"></script>
</head>
<body>
<pre><code class = "cpp">
<a name="ln1">/*</a>
<a name="ln2">    This file is part of darktable,</a>
<a name="ln3">    copyright (c) 2011 Henrik Andersson.</a>
<a name="ln4"> </a>
<a name="ln5">    darktable is free software: you can redistribute it and/or modify</a>
<a name="ln6">    it under the terms of the GNU General Public License as published by</a>
<a name="ln7">    the Free Software Foundation, either version 3 of the License, or</a>
<a name="ln8">    (at your option) any later version.</a>
<a name="ln9"> </a>
<a name="ln10">    darktable is distributed in the hope that it will be useful,</a>
<a name="ln11">    but WITHOUT ANY WARRANTY; without even the implied warranty of</a>
<a name="ln12">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</a>
<a name="ln13">    GNU General Public License for more details.</a>
<a name="ln14"> </a>
<a name="ln15">    You should have received a copy of the GNU General Public License</a>
<a name="ln16">    along with darktable.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</a>
<a name="ln17">*/</a>
<a name="ln18"> </a>
<a name="ln19">#include &lt;gdk/gdkkeysyms.h&gt;</a>
<a name="ln20"> </a>
<a name="ln21">#include &quot;common/collection.h&quot;</a>
<a name="ln22">#include &quot;common/selection.h&quot;</a>
<a name="ln23">#include &quot;control/conf.h&quot;</a>
<a name="ln24">#include &quot;control/control.h&quot;</a>
<a name="ln25">#include &quot;gui/accelerators.h&quot;</a>
<a name="ln26">#include &quot;gui/gtk.h&quot;</a>
<a name="ln27">#include &quot;libs/lib.h&quot;</a>
<a name="ln28">#include &quot;libs/lib_api.h&quot;</a>
<a name="ln29"> </a>
<a name="ln30">DT_MODULE(1)</a>
<a name="ln31"> </a>
<a name="ln32">typedef struct dt_lib_tool_lighttable_t</a>
<a name="ln33">{</a>
<a name="ln34">  GtkWidget *zoom;</a>
<a name="ln35">  GtkWidget *zoom_entry;</a>
<a name="ln36">  GtkWidget *layout_combo;</a>
<a name="ln37">  GtkWidget *zoom_mode_cb;</a>
<a name="ln38">  dt_lighttable_layout_t layout, base_layout;</a>
<a name="ln39">  int current_zoom;</a>
<a name="ln40">  dt_lighttable_culling_zoom_mode_t zoom_mode;</a>
<a name="ln41">  gboolean combo_evt_reset;</a>
<a name="ln42">} dt_lib_tool_lighttable_t;</a>
<a name="ln43"> </a>
<a name="ln44">/* set zoom proxy function */</a>
<a name="ln45">static void _lib_lighttable_set_zoom(dt_lib_module_t *self, gint zoom);</a>
<a name="ln46">static gint _lib_lighttable_get_zoom(dt_lib_module_t *self);</a>
<a name="ln47">static dt_lighttable_culling_zoom_mode_t _lib_lighttable_get_zoom_mode(dt_lib_module_t *self);</a>
<a name="ln48"> </a>
<a name="ln49">/* get/set layout proxy function */</a>
<a name="ln50">static dt_lighttable_layout_t _lib_lighttable_get_layout(dt_lib_module_t *self);</a>
<a name="ln51">static void _lib_lighttable_set_layout(dt_lib_module_t *self, dt_lighttable_layout_t layout);</a>
<a name="ln52"> </a>
<a name="ln53">/* lightable layout changed */</a>
<a name="ln54">static void _lib_lighttable_layout_changed(GtkComboBox *widget, gpointer user_data);</a>
<a name="ln55">/* lightable culling zoom mode changed */</a>
<a name="ln56">static void _lib_lighttable_zoom_mode_changed(GtkComboBox *widget, gpointer user_data);</a>
<a name="ln57">/* zoom slider change callback */</a>
<a name="ln58">static void _lib_lighttable_zoom_slider_changed(GtkRange *range, gpointer user_data);</a>
<a name="ln59">/* zoom entry change callback */</a>
<a name="ln60">static gboolean _lib_lighttable_zoom_entry_changed(GtkWidget *entry, GdkEventKey *event,</a>
<a name="ln61">                                                   dt_lib_module_t *self);</a>
<a name="ln62"> </a>
<a name="ln63">/* zoom key accel callback */</a>
<a name="ln64">static gboolean _lib_lighttable_key_accel_zoom_max_callback(GtkAccelGroup *accel_group,</a>
<a name="ln65">                                                            GObject *acceleratable, guint keyval,</a>
<a name="ln66">                                                            GdkModifierType modifier, gpointer data);</a>
<a name="ln67">static gboolean _lib_lighttable_key_accel_zoom_min_callback(GtkAccelGroup *accel_group,</a>
<a name="ln68">                                                            GObject *acceleratable, guint keyval,</a>
<a name="ln69">                                                            GdkModifierType modifier, gpointer data);</a>
<a name="ln70">static gboolean _lib_lighttable_key_accel_zoom_in_callback(GtkAccelGroup *accel_group, GObject *acceleratable,</a>
<a name="ln71">                                                           guint keyval, GdkModifierType modifier,</a>
<a name="ln72">                                                           gpointer data);</a>
<a name="ln73">static gboolean _lib_lighttable_key_accel_zoom_out_callback(GtkAccelGroup *accel_group,</a>
<a name="ln74">                                                            GObject *acceleratable, guint keyval,</a>
<a name="ln75">                                                            GdkModifierType modifier, gpointer data);</a>
<a name="ln76">static gboolean _lib_lighttable_key_accel_toggle_culling_dynamic_mode(GtkAccelGroup *accel_group,</a>
<a name="ln77">                                                                      GObject *acceleratable, guint keyval,</a>
<a name="ln78">                                                                      GdkModifierType modifier, gpointer data);</a>
<a name="ln79">static gboolean _lib_lighttable_key_accel_toggle_culling_mode(GtkAccelGroup *accel_group, GObject *acceleratable,</a>
<a name="ln80">                                                              guint keyval, GdkModifierType modifier,</a>
<a name="ln81">                                                              gpointer data);</a>
<a name="ln82">static gboolean _lib_lighttable_key_accel_toggle_culling_zoom_mode(GtkAccelGroup *accel_group,</a>
<a name="ln83">                                                                   GObject *acceleratable, guint keyval,</a>
<a name="ln84">                                                                   GdkModifierType modifier, gpointer data);</a>
<a name="ln85">static void _set_zoom(dt_lib_module_t *self, int zoom);</a>
<a name="ln86"> </a>
<a name="ln87">const char *name(dt_lib_module_t *self)</a>
<a name="ln88">{</a>
<a name="ln89">  return _(&quot;lighttable&quot;);</a>
<a name="ln90">}</a>
<a name="ln91"> </a>
<a name="ln92">const char **views(dt_lib_module_t *self)</a>
<a name="ln93">{</a>
<a name="ln94">  static const char *v[] = {&quot;lighttable&quot;, NULL};</a>
<a name="ln95">  return v;</a>
<a name="ln96">}</a>
<a name="ln97"> </a>
<a name="ln98">uint32_t container(dt_lib_module_t *self)</a>
<a name="ln99">{</a>
<a name="ln100">  return DT_UI_CONTAINER_PANEL_CENTER_BOTTOM_CENTER;</a>
<a name="ln101">}</a>
<a name="ln102"> </a>
<a name="ln103">int expandable(dt_lib_module_t *self)</a>
<a name="ln104">{</a>
<a name="ln105">  return 0;</a>
<a name="ln106">}</a>
<a name="ln107"> </a>
<a name="ln108">int position()</a>
<a name="ln109">{</a>
<a name="ln110">  return 1001;</a>
<a name="ln111">}</a>
<a name="ln112"> </a>
<a name="ln113">void gui_init(dt_lib_module_t *self)</a>
<a name="ln114">{</a>
<a name="ln115">  /* initialize ui widgets */</a>
<a name="ln116">  dt_lib_tool_lighttable_t *d = (dt_lib_tool_lighttable_t *)g_malloc0(sizeof(dt_lib_tool_lighttable_t));</a>
<a name="ln117">  self-&gt;data = (void *)d;</a>
<a name="ln118"> </a>
<a name="ln119">  self-&gt;widget = gtk_box_new(GTK_ORIENTATION_HORIZONTAL, 0);</a>
<a name="ln120">  d-&gt;layout = MIN(DT_LIGHTTABLE_LAYOUT_LAST - 1, dt_conf_get_int(&quot;plugins/lighttable/layout&quot;));</a>
<a name="ln121">  d-&gt;base_layout = MIN(DT_LIGHTTABLE_LAYOUT_LAST - 1, dt_conf_get_int(&quot;plugins/lighttable/base_layout&quot;));</a>
<a name="ln122">  if(d-&gt;layout == DT_LIGHTTABLE_LAYOUT_CULLING)</a>
<a name="ln123">  {</a>
<a name="ln124">    d-&gt;zoom_mode = dt_conf_get_int(&quot;plugins/lighttable/culling_zoom_mode&quot;);</a>
<a name="ln125">    if(d-&gt;zoom_mode == DT_LIGHTTABLE_ZOOM_DYNAMIC &amp;&amp; darktable.collection)</a>
<a name="ln126">    {</a>
<a name="ln127">      d-&gt;current_zoom = MAX(1, MIN(30, dt_collection_get_selected_count(darktable.collection)));</a>
<a name="ln128">      if(d-&gt;current_zoom == 1) d-&gt;current_zoom = dt_conf_get_int(&quot;plugins/lighttable/culling_num_images&quot;);</a>
<a name="ln129">    }</a>
<a name="ln130">    else</a>
<a name="ln131">    {</a>
<a name="ln132">      d-&gt;current_zoom = dt_conf_get_int(&quot;plugins/lighttable/culling_num_images&quot;);</a>
<a name="ln133">    }</a>
<a name="ln134">  }</a>
<a name="ln135">  else</a>
<a name="ln136">    d-&gt;current_zoom = dt_conf_get_int(&quot;plugins/lighttable/images_in_row&quot;);</a>
<a name="ln137"> </a>
<a name="ln138">  /* create layout selection combobox */</a>
<a name="ln139">  d-&gt;layout_combo = gtk_combo_box_text_new();</a>
<a name="ln140">  gtk_combo_box_text_append_text(GTK_COMBO_BOX_TEXT(d-&gt;layout_combo), _(&quot;zoomable light table&quot;));</a>
<a name="ln141">  gtk_combo_box_text_append_text(GTK_COMBO_BOX_TEXT(d-&gt;layout_combo), _(&quot;file manager&quot;));</a>
<a name="ln142">  gtk_combo_box_text_append_text(GTK_COMBO_BOX_TEXT(d-&gt;layout_combo), _(&quot;culling&quot;));</a>
<a name="ln143"> </a>
<a name="ln144">  gtk_combo_box_set_active(GTK_COMBO_BOX(d-&gt;layout_combo), d-&gt;layout);</a>
<a name="ln145"> </a>
<a name="ln146">  g_signal_connect(G_OBJECT(d-&gt;layout_combo), &quot;changed&quot;, G_CALLBACK(_lib_lighttable_layout_changed), (gpointer)self);</a>
<a name="ln147"> </a>
<a name="ln148">  gtk_box_pack_start(GTK_BOX(self-&gt;widget), d-&gt;layout_combo, TRUE, TRUE, 0);</a>
<a name="ln149"> </a>
<a name="ln150"> </a>
<a name="ln151">  /* create horizontal zoom slider */</a>
<a name="ln152">  d-&gt;zoom = gtk_scale_new_with_range(GTK_ORIENTATION_HORIZONTAL, 1, 21, 1);</a>
<a name="ln153">  gtk_widget_set_size_request(GTK_WIDGET(d-&gt;zoom), DT_PIXEL_APPLY_DPI(140), -1);</a>
<a name="ln154">  gtk_scale_set_draw_value(GTK_SCALE(d-&gt;zoom), FALSE);</a>
<a name="ln155">  gtk_range_set_increments(GTK_RANGE(d-&gt;zoom), 1, 1);</a>
<a name="ln156">  gtk_box_pack_start(GTK_BOX(self-&gt;widget), d-&gt;zoom, TRUE, TRUE, 0);</a>
<a name="ln157"> </a>
<a name="ln158">  /* manual entry of the zoom level */</a>
<a name="ln159">  d-&gt;zoom_entry = gtk_entry_new();</a>
<a name="ln160">  gtk_entry_set_alignment(GTK_ENTRY(d-&gt;zoom_entry), 1.0);</a>
<a name="ln161">  gtk_entry_set_max_length(GTK_ENTRY(d-&gt;zoom_entry), 2);</a>
<a name="ln162">  gtk_entry_set_width_chars(GTK_ENTRY(d-&gt;zoom_entry), 3);</a>
<a name="ln163">  gtk_entry_set_max_width_chars(GTK_ENTRY(d-&gt;zoom_entry), 3);</a>
<a name="ln164">  dt_gui_key_accel_block_on_focus_connect(d-&gt;zoom_entry);</a>
<a name="ln165">  gtk_box_pack_start(GTK_BOX(self-&gt;widget), d-&gt;zoom_entry, TRUE, TRUE, 0);</a>
<a name="ln166"> </a>
<a name="ln167">  g_signal_connect(G_OBJECT(d-&gt;zoom), &quot;value-changed&quot;, G_CALLBACK(_lib_lighttable_zoom_slider_changed),</a>
<a name="ln168">                   (gpointer)self);</a>
<a name="ln169">  g_signal_connect(d-&gt;zoom_entry, &quot;key-press-event&quot;, G_CALLBACK(_lib_lighttable_zoom_entry_changed), self);</a>
<a name="ln170">  gtk_range_set_value(GTK_RANGE(d-&gt;zoom), d-&gt;current_zoom);</a>
<a name="ln171"> </a>
<a name="ln172">  d-&gt;zoom_mode_cb = gtk_combo_box_text_new();</a>
<a name="ln173">  gtk_combo_box_text_append_text(GTK_COMBO_BOX_TEXT(d-&gt;zoom_mode_cb), _(&quot;fixed zoom&quot;));</a>
<a name="ln174">  gtk_combo_box_text_append_text(GTK_COMBO_BOX_TEXT(d-&gt;zoom_mode_cb), _(&quot;dynamic zoom&quot;));</a>
<a name="ln175">  g_signal_connect(G_OBJECT(d-&gt;zoom_mode_cb), &quot;changed&quot;, G_CALLBACK(_lib_lighttable_zoom_mode_changed),</a>
<a name="ln176">                   (gpointer)self);</a>
<a name="ln177">  gtk_box_pack_start(GTK_BOX(self-&gt;widget), d-&gt;zoom_mode_cb, TRUE, TRUE, 0);</a>
<a name="ln178">  if(d-&gt;layout == DT_LIGHTTABLE_LAYOUT_CULLING)</a>
<a name="ln179">  {</a>
<a name="ln180">    gtk_widget_show(d-&gt;zoom_mode_cb);</a>
<a name="ln181">    gtk_combo_box_set_active(GTK_COMBO_BOX(d-&gt;zoom_mode_cb), d-&gt;zoom_mode == DT_LIGHTTABLE_ZOOM_DYNAMIC);</a>
<a name="ln182">  }</a>
<a name="ln183">  else</a>
<a name="ln184">  {</a>
<a name="ln185">    gtk_widget_hide(d-&gt;zoom_mode_cb);</a>
<a name="ln186">  }</a>
<a name="ln187">  gtk_widget_set_no_show_all(d-&gt;zoom_mode_cb, TRUE);</a>
<a name="ln188"> </a>
<a name="ln189">  _lib_lighttable_zoom_slider_changed(GTK_RANGE(d-&gt;zoom), self); // the slider defaults to 1 and GTK doesn't</a>
<a name="ln190">                                                                 // fire a value-changed signal when setting</a>
<a name="ln191">                                                                 // it to 1 =&gt; empty text box</a>
<a name="ln192"> </a>
<a name="ln193">  _lib_lighttable_layout_changed(GTK_COMBO_BOX(d-&gt;layout_combo), self);</a>
<a name="ln194"> </a>
<a name="ln195">  gtk_widget_set_sensitive(</a>
<a name="ln196">      d-&gt;zoom_entry, (d-&gt;layout != DT_LIGHTTABLE_LAYOUT_CULLING || d-&gt;zoom_mode != DT_LIGHTTABLE_ZOOM_DYNAMIC));</a>
<a name="ln197">  gtk_widget_set_sensitive(</a>
<a name="ln198">      d-&gt;zoom, (d-&gt;layout != DT_LIGHTTABLE_LAYOUT_CULLING || d-&gt;zoom_mode != DT_LIGHTTABLE_ZOOM_DYNAMIC));</a>
<a name="ln199"> </a>
<a name="ln200">  darktable.view_manager-&gt;proxy.lighttable.module = self;</a>
<a name="ln201">  darktable.view_manager-&gt;proxy.lighttable.set_zoom = _lib_lighttable_set_zoom;</a>
<a name="ln202">  darktable.view_manager-&gt;proxy.lighttable.get_zoom = _lib_lighttable_get_zoom;</a>
<a name="ln203">  darktable.view_manager-&gt;proxy.lighttable.get_zoom_mode = _lib_lighttable_get_zoom_mode;</a>
<a name="ln204">  darktable.view_manager-&gt;proxy.lighttable.get_layout = _lib_lighttable_get_layout;</a>
<a name="ln205">  darktable.view_manager-&gt;proxy.lighttable.set_layout = _lib_lighttable_set_layout;</a>
<a name="ln206">  darktable.view_manager-&gt;proxy.lighttable.set_layout = _lib_lighttable_set_layout;</a>
<a name="ln207">}</a>
<a name="ln208"> </a>
<a name="ln209">void init_key_accels(dt_lib_module_t *self)</a>
<a name="ln210">{</a>
<a name="ln211">  // view accels</a>
<a name="ln212">  dt_accel_register_lib(self, NC_(&quot;accel&quot;, &quot;zoom max&quot;), GDK_KEY_1, GDK_MOD1_MASK);</a>
<a name="ln213">  dt_accel_register_lib(self, NC_(&quot;accel&quot;, &quot;zoom in&quot;), GDK_KEY_2, GDK_MOD1_MASK);</a>
<a name="ln214">  dt_accel_register_lib(self, NC_(&quot;accel&quot;, &quot;zoom out&quot;), GDK_KEY_3, GDK_MOD1_MASK);</a>
<a name="ln215">  dt_accel_register_lib(self, NC_(&quot;accel&quot;, &quot;zoom min&quot;), GDK_KEY_4, GDK_MOD1_MASK);</a>
<a name="ln216"> </a>
<a name="ln217">  dt_accel_register_lib(self, NC_(&quot;accel&quot;, &quot;toggle culling mode&quot;), GDK_KEY_x, 0);</a>
<a name="ln218">  dt_accel_register_lib(self, NC_(&quot;accel&quot;, &quot;toggle culling dynamic mode&quot;), GDK_KEY_x, GDK_CONTROL_MASK);</a>
<a name="ln219">  dt_accel_register_lib(self, NC_(&quot;accel&quot;, &quot;toggle culling zoom mode&quot;), GDK_KEY_less, 0);</a>
<a name="ln220">}</a>
<a name="ln221"> </a>
<a name="ln222">void connect_key_accels(dt_lib_module_t *self)</a>
<a name="ln223">{</a>
<a name="ln224">  /* setup key accelerators */</a>
<a name="ln225"> </a>
<a name="ln226">  // view accels</a>
<a name="ln227">  dt_accel_connect_lib(self, &quot;zoom max&quot;,</a>
<a name="ln228">                       g_cclosure_new(G_CALLBACK(_lib_lighttable_key_accel_zoom_max_callback), self, NULL));</a>
<a name="ln229">  dt_accel_connect_lib(self, &quot;zoom in&quot;,</a>
<a name="ln230">                       g_cclosure_new(G_CALLBACK(_lib_lighttable_key_accel_zoom_in_callback), self, NULL));</a>
<a name="ln231">  dt_accel_connect_lib(self, &quot;zoom out&quot;,</a>
<a name="ln232">                       g_cclosure_new(G_CALLBACK(_lib_lighttable_key_accel_zoom_out_callback), self, NULL));</a>
<a name="ln233">  dt_accel_connect_lib(self, &quot;zoom min&quot;,</a>
<a name="ln234">                       g_cclosure_new(G_CALLBACK(_lib_lighttable_key_accel_zoom_min_callback), self, NULL));</a>
<a name="ln235">  dt_accel_connect_lib(</a>
<a name="ln236">      self, &quot;toggle culling dynamic mode&quot;,</a>
<a name="ln237">      g_cclosure_new(G_CALLBACK(_lib_lighttable_key_accel_toggle_culling_dynamic_mode), self, NULL));</a>
<a name="ln238">  dt_accel_connect_lib(self, &quot;toggle culling mode&quot;,</a>
<a name="ln239">                       g_cclosure_new(G_CALLBACK(_lib_lighttable_key_accel_toggle_culling_mode), self, NULL));</a>
<a name="ln240">  dt_accel_connect_lib(self, &quot;toggle culling zoom mode&quot;,</a>
<a name="ln241">                       g_cclosure_new(G_CALLBACK(_lib_lighttable_key_accel_toggle_culling_zoom_mode), self, NULL));</a>
<a name="ln242">}</a>
<a name="ln243"> </a>
<a name="ln244">void gui_cleanup(dt_lib_module_t *self)</a>
<a name="ln245">{</a>
<a name="ln246">  dt_lib_tool_lighttable_t *d = (dt_lib_tool_lighttable_t *)self-&gt;data;</a>
<a name="ln247">  dt_gui_key_accel_block_on_focus_disconnect(d-&gt;zoom_entry);</a>
<a name="ln248">  g_free(self-&gt;data);</a>
<a name="ln249">  self-&gt;data = NULL;</a>
<a name="ln250">}</a>
<a name="ln251"> </a>
<a name="ln252">static void _set_zoom(dt_lib_module_t *self, int zoom)</a>
<a name="ln253">{</a>
<a name="ln254">  dt_lib_tool_lighttable_t *d = (dt_lib_tool_lighttable_t *)self-&gt;data;</a>
<a name="ln255">  if(d-&gt;layout == DT_LIGHTTABLE_LAYOUT_CULLING)</a>
<a name="ln256">  {</a>
<a name="ln257">    if(d-&gt;zoom_mode == DT_LIGHTTABLE_ZOOM_FIXED) dt_conf_set_int(&quot;plugins/lighttable/culling_num_images&quot;, zoom);</a>
<a name="ln258">  }</a>
<a name="ln259">  else</a>
<a name="ln260">    dt_conf_set_int(&quot;plugins/lighttable/images_in_row&quot;, zoom);</a>
<a name="ln261">}</a>
<a name="ln262"> </a>
<a name="ln263">static void _lib_lighttable_zoom_slider_changed(GtkRange *range, gpointer user_data)</a>
<a name="ln264">{</a>
<a name="ln265">  dt_lib_module_t *self = (dt_lib_module_t *)user_data;</a>
<a name="ln266">  dt_lib_tool_lighttable_t *d = (dt_lib_tool_lighttable_t *)self-&gt;data;</a>
<a name="ln267"> </a>
<a name="ln268">  const int i = gtk_range_get_value(range);</a>
<a name="ln269">  _set_zoom(self, i);</a>
<a name="ln270">  gchar *i_as_str = g_strdup_printf(&quot;%d&quot;, i);</a>
<a name="ln271">  gtk_entry_set_text(GTK_ENTRY(d-&gt;zoom_entry), i_as_str);</a>
<a name="ln272">  d-&gt;current_zoom = i;</a>
<a name="ln273">  g_free(i_as_str);</a>
<a name="ln274">  dt_control_queue_redraw_center();</a>
<a name="ln275">}</a>
<a name="ln276"> </a>
<a name="ln277">static gboolean _lib_lighttable_zoom_entry_changed(GtkWidget *entry, GdkEventKey *event, dt_lib_module_t *self)</a>
<a name="ln278">{</a>
<a name="ln279">  dt_lib_tool_lighttable_t *d = (dt_lib_tool_lighttable_t *)self-&gt;data;</a>
<a name="ln280">  switch(event-&gt;keyval)</a>
<a name="ln281">  {</a>
<a name="ln282">    case GDK_KEY_Escape:</a>
<a name="ln283">    case GDK_KEY_Tab:</a>
<a name="ln284">    {</a>
<a name="ln285">      // reset</a>
<a name="ln286">      int i = 0;</a>
<a name="ln287">      if(d-&gt;layout == DT_LIGHTTABLE_LAYOUT_CULLING)</a>
<a name="ln288">        i = dt_conf_get_int(&quot;plugins/lighttable/culling_num_images&quot;);</a>
<a name="ln289">      else</a>
<a name="ln290">        i = dt_conf_get_int(&quot;plugins/lighttable/images_in_row&quot;);</a>
<a name="ln291">      gchar *i_as_str = g_strdup_printf(&quot;%d&quot;, i);</a>
<a name="ln292">      gtk_entry_set_text(GTK_ENTRY(d-&gt;zoom_entry), i_as_str);</a>
<a name="ln293">      g_free(i_as_str);</a>
<a name="ln294">      gtk_window_set_focus(GTK_WINDOW(dt_ui_main_window(darktable.gui-&gt;ui)), NULL);</a>
<a name="ln295">      return FALSE;</a>
<a name="ln296">    }</a>
<a name="ln297"> </a>
<a name="ln298">    case GDK_KEY_Return:</a>
<a name="ln299">    case GDK_KEY_KP_Enter:</a>
<a name="ln300">    {</a>
<a name="ln301">      // apply zoom level</a>
<a name="ln302">      const gchar *value = gtk_entry_get_text(GTK_ENTRY(d-&gt;zoom_entry));</a>
<a name="ln303">      int i = atoi(value);</a>
<a name="ln304">      gtk_range_set_value(GTK_RANGE(d-&gt;zoom), i);</a>
<a name="ln305">      gtk_window_set_focus(GTK_WINDOW(dt_ui_main_window(darktable.gui-&gt;ui)), NULL);</a>
<a name="ln306">      return FALSE;</a>
<a name="ln307">    }</a>
<a name="ln308"> </a>
<a name="ln309">    // allow 0 .. 9, left/right movement using arrow keys and del/backspace</a>
<a name="ln310">    case GDK_KEY_0:</a>
<a name="ln311">    case GDK_KEY_KP_0:</a>
<a name="ln312">    case GDK_KEY_1:</a>
<a name="ln313">    case GDK_KEY_KP_1:</a>
<a name="ln314">    case GDK_KEY_2:</a>
<a name="ln315">    case GDK_KEY_KP_2:</a>
<a name="ln316">    case GDK_KEY_3:</a>
<a name="ln317">    case GDK_KEY_KP_3:</a>
<a name="ln318">    case GDK_KEY_4:</a>
<a name="ln319">    case GDK_KEY_KP_4:</a>
<a name="ln320">    case GDK_KEY_5:</a>
<a name="ln321">    case GDK_KEY_KP_5:</a>
<a name="ln322">    case GDK_KEY_6:</a>
<a name="ln323">    case GDK_KEY_KP_6:</a>
<a name="ln324">    case GDK_KEY_7:</a>
<a name="ln325">    case GDK_KEY_KP_7:</a>
<a name="ln326">    case GDK_KEY_8:</a>
<a name="ln327">    case GDK_KEY_KP_8:</a>
<a name="ln328">    case GDK_KEY_9:</a>
<a name="ln329">    case GDK_KEY_KP_9:</a>
<a name="ln330"> </a>
<a name="ln331">    case GDK_KEY_Left:</a>
<a name="ln332">    case GDK_KEY_Right:</a>
<a name="ln333">    case GDK_KEY_Delete:</a>
<a name="ln334">    case GDK_KEY_BackSpace:</a>
<a name="ln335">      return FALSE;</a>
<a name="ln336"> </a>
<a name="ln337">    default: // block everything else</a>
<a name="ln338">      return TRUE;</a>
<a name="ln339">  }</a>
<a name="ln340">}</a>
<a name="ln341"> </a>
<a name="ln342">static void _lib_lighttable_change_layout(dt_lib_module_t *self, dt_lighttable_layout_t layout)</a>
<a name="ln343">{</a>
<a name="ln344">  dt_lib_tool_lighttable_t *d = (dt_lib_tool_lighttable_t *)self-&gt;data;</a>
<a name="ln345"> </a>
<a name="ln346">  const int current_layout = dt_conf_get_int(&quot;plugins/lighttable/layout&quot;);</a>
<a name="ln347">  d-&gt;layout = layout;</a>
<a name="ln348"> </a>
<a name="ln349">  if(current_layout != layout)</a>
<a name="ln350">  {</a>
<a name="ln351">    if(d-&gt;layout == DT_LIGHTTABLE_LAYOUT_CULLING)</a>
<a name="ln352">    {</a>
<a name="ln353">      gtk_widget_show(d-&gt;zoom_mode_cb);</a>
<a name="ln354">      if(d-&gt;zoom_mode == DT_LIGHTTABLE_ZOOM_DYNAMIC)</a>
<a name="ln355">      {</a>
<a name="ln356">        d-&gt;current_zoom = MAX(1, MIN(30, dt_collection_get_selected_count(darktable.collection)));</a>
<a name="ln357">        if(d-&gt;current_zoom == 1) d-&gt;current_zoom = dt_conf_get_int(&quot;plugins/lighttable/culling_num_images&quot;);</a>
<a name="ln358">      }</a>
<a name="ln359">      else</a>
<a name="ln360">      {</a>
<a name="ln361">        d-&gt;current_zoom = dt_conf_get_int(&quot;plugins/lighttable/culling_num_images&quot;);</a>
<a name="ln362">      }</a>
<a name="ln363">      gtk_combo_box_set_active(GTK_COMBO_BOX(d-&gt;zoom_mode_cb), d-&gt;zoom_mode == DT_LIGHTTABLE_ZOOM_DYNAMIC);</a>
<a name="ln364">    }</a>
<a name="ln365">    else</a>
<a name="ln366">    {</a>
<a name="ln367">      gtk_widget_hide(d-&gt;zoom_mode_cb);</a>
<a name="ln368">      d-&gt;zoom_mode = DT_LIGHTTABLE_ZOOM_FIXED;</a>
<a name="ln369">      d-&gt;current_zoom = dt_conf_get_int(&quot;plugins/lighttable/images_in_row&quot;);</a>
<a name="ln370">    }</a>
<a name="ln371">    gtk_widget_set_sensitive(</a>
<a name="ln372">        d-&gt;zoom_entry, (d-&gt;layout != DT_LIGHTTABLE_LAYOUT_CULLING || d-&gt;zoom_mode != DT_LIGHTTABLE_ZOOM_DYNAMIC));</a>
<a name="ln373">    gtk_widget_set_sensitive(</a>
<a name="ln374">        d-&gt;zoom, (d-&gt;layout != DT_LIGHTTABLE_LAYOUT_CULLING || d-&gt;zoom_mode != DT_LIGHTTABLE_ZOOM_DYNAMIC));</a>
<a name="ln375">    gtk_range_set_value(GTK_RANGE(d-&gt;zoom), d-&gt;current_zoom);</a>
<a name="ln376"> </a>
<a name="ln377">    dt_conf_set_int(&quot;plugins/lighttable/layout&quot;, layout);</a>
<a name="ln378">    if(layout == DT_LIGHTTABLE_LAYOUT_FILEMANAGER || layout == DT_LIGHTTABLE_LAYOUT_ZOOMABLE)</a>
<a name="ln379">    {</a>
<a name="ln380">      d-&gt;base_layout = layout;</a>
<a name="ln381">      dt_conf_set_int(&quot;plugins/lighttable/base_layout&quot;, layout);</a>
<a name="ln382">    }</a>
<a name="ln383">    d-&gt;combo_evt_reset = TRUE;</a>
<a name="ln384">    gtk_combo_box_set_active(GTK_COMBO_BOX(d-&gt;layout_combo), layout);</a>
<a name="ln385">    d-&gt;combo_evt_reset = FALSE;</a>
<a name="ln386">    dt_control_signal_raise(darktable.signals, DT_SIGNAL_COLLECTION_CHANGED);</a>
<a name="ln387">  }</a>
<a name="ln388">  else</a>
<a name="ln389">  {</a>
<a name="ln390">    dt_control_queue_redraw_center();</a>
<a name="ln391">  }</a>
<a name="ln392">}</a>
<a name="ln393"> </a>
<a name="ln394">static void _lib_lighttable_layout_changed(GtkComboBox *widget, gpointer user_data)</a>
<a name="ln395">{</a>
<a name="ln396">  dt_lib_module_t *self = (dt_lib_module_t *)user_data;</a>
<a name="ln397">  dt_lib_tool_lighttable_t *d = (dt_lib_tool_lighttable_t *)self-&gt;data;</a>
<a name="ln398">  if(d-&gt;combo_evt_reset) return;</a>
<a name="ln399">  const int new_layout = gtk_combo_box_get_active(widget);</a>
<a name="ln400">  _lib_lighttable_change_layout(self, new_layout);</a>
<a name="ln401">}</a>
<a name="ln402"> </a>
<a name="ln403">static void _lib_lighttable_zoom_mode_changed(GtkComboBox *widget, gpointer user_data)</a>
<a name="ln404">{</a>
<a name="ln405">  dt_lib_module_t *self = (dt_lib_module_t *)user_data;</a>
<a name="ln406">  dt_lib_tool_lighttable_t *d = (dt_lib_tool_lighttable_t *)self-&gt;data;</a>
<a name="ln407"> </a>
<a name="ln408">  dt_lighttable_culling_zoom_mode_t new_mode = DT_LIGHTTABLE_ZOOM_FIXED;</a>
<a name="ln409">  if(gtk_combo_box_get_active(GTK_COMBO_BOX(d-&gt;zoom_mode_cb)) == 1) new_mode = DT_LIGHTTABLE_ZOOM_DYNAMIC;</a>
<a name="ln410">  if(new_mode == d-&gt;zoom_mode) return;</a>
<a name="ln411"> </a>
<a name="ln412">  d-&gt;zoom_mode = new_mode;</a>
<a name="ln413">  if(new_mode == DT_LIGHTTABLE_ZOOM_FIXED)</a>
<a name="ln414">  {</a>
<a name="ln415">    _lib_lighttable_set_zoom(self, dt_conf_get_int(&quot;plugins/lighttable/culling_num_images&quot;));</a>
<a name="ln416">  }</a>
<a name="ln417">  else</a>
<a name="ln418">  {</a>
<a name="ln419">    int selnb = dt_collection_get_selected_count(darktable.collection);</a>
<a name="ln420">    if(selnb &lt;= 1) selnb = dt_conf_get_int(&quot;plugins/lighttable/culling_num_images&quot;);</a>
<a name="ln421">    _lib_lighttable_set_zoom(self, selnb);</a>
<a name="ln422">  }</a>
<a name="ln423">  gtk_widget_set_sensitive(</a>
<a name="ln424">      d-&gt;zoom_entry, (d-&gt;layout != DT_LIGHTTABLE_LAYOUT_CULLING || d-&gt;zoom_mode != DT_LIGHTTABLE_ZOOM_DYNAMIC));</a>
<a name="ln425">  gtk_widget_set_sensitive(</a>
<a name="ln426">      d-&gt;zoom, (d-&gt;layout != DT_LIGHTTABLE_LAYOUT_CULLING || d-&gt;zoom_mode != DT_LIGHTTABLE_ZOOM_DYNAMIC));</a>
<a name="ln427"> </a>
<a name="ln428">  if(d-&gt;layout == DT_LIGHTTABLE_LAYOUT_CULLING)</a>
<a name="ln429">  {</a>
<a name="ln430">    dt_conf_set_int(&quot;plugins/lighttable/culling_zoom_mode&quot;, d-&gt;zoom_mode);</a>
<a name="ln431">  }</a>
<a name="ln432">}</a>
<a name="ln433"> </a>
<a name="ln434">static void _lib_lighttable_set_layout(dt_lib_module_t *self, dt_lighttable_layout_t layout)</a>
<a name="ln435">{</a>
<a name="ln436">  _lib_lighttable_change_layout(self, layout);</a>
<a name="ln437">}</a>
<a name="ln438"> </a>
<a name="ln439">static dt_lighttable_layout_t _lib_lighttable_get_layout(dt_lib_module_t *self)</a>
<a name="ln440">{</a>
<a name="ln441">  dt_lib_tool_lighttable_t *d = (dt_lib_tool_lighttable_t *)self-&gt;data;</a>
<a name="ln442">  return d-&gt;layout;</a>
<a name="ln443">}</a>
<a name="ln444"> </a>
<a name="ln445">#define DT_LIBRARY_MAX_ZOOM 13</a>
<a name="ln446">static void _lib_lighttable_set_zoom(dt_lib_module_t *self, gint zoom)</a>
<a name="ln447">{</a>
<a name="ln448">  dt_lib_tool_lighttable_t *d = (dt_lib_tool_lighttable_t *)self-&gt;data;</a>
<a name="ln449">  gtk_range_set_value(GTK_RANGE(d-&gt;zoom), zoom);</a>
<a name="ln450">  d-&gt;current_zoom = zoom;</a>
<a name="ln451">}</a>
<a name="ln452"> </a>
<a name="ln453">static gint _lib_lighttable_get_zoom(dt_lib_module_t *self)</a>
<a name="ln454">{</a>
<a name="ln455">  dt_lib_tool_lighttable_t *d = (dt_lib_tool_lighttable_t *)self-&gt;data;</a>
<a name="ln456">  return d-&gt;current_zoom;</a>
<a name="ln457">}</a>
<a name="ln458"> </a>
<a name="ln459">static dt_lighttable_culling_zoom_mode_t _lib_lighttable_get_zoom_mode(dt_lib_module_t *self)</a>
<a name="ln460">{</a>
<a name="ln461">  dt_lib_tool_lighttable_t *d = (dt_lib_tool_lighttable_t *)self-&gt;data;</a>
<a name="ln462">  return d-&gt;zoom_mode;</a>
<a name="ln463">}</a>
<a name="ln464"> </a>
<a name="ln465">static gboolean _lib_lighttable_key_accel_zoom_max_callback(GtkAccelGroup *accel_group,</a>
<a name="ln466">                                                            GObject *acceleratable, guint keyval,</a>
<a name="ln467">                                                            GdkModifierType modifier, gpointer data)</a>
<a name="ln468">{</a>
<a name="ln469">  dt_lib_module_t *self = (dt_lib_module_t *)data;</a>
<a name="ln470">  dt_lib_tool_lighttable_t *d = (dt_lib_tool_lighttable_t *)self-&gt;data;</a>
<a name="ln471">  gtk_range_set_value(GTK_RANGE(d-&gt;zoom), 1);</a>
<a name="ln472">  // FIXME: scroll to active image</a>
<a name="ln473">  return TRUE;</a>
<a name="ln474">}</a>
<a name="ln475"> </a>
<a name="ln476">static gboolean _lib_lighttable_key_accel_zoom_min_callback(GtkAccelGroup *accel_group,</a>
<a name="ln477">                                                            GObject *acceleratable, guint keyval,</a>
<a name="ln478">                                                            GdkModifierType modifier, gpointer data)</a>
<a name="ln479">{</a>
<a name="ln480">  dt_lib_module_t *self = (dt_lib_module_t *)data;</a>
<a name="ln481">  dt_lib_tool_lighttable_t *d = (dt_lib_tool_lighttable_t *)self-&gt;data;</a>
<a name="ln482">  gtk_range_set_value(GTK_RANGE(d-&gt;zoom), DT_LIBRARY_MAX_ZOOM);</a>
<a name="ln483">  return TRUE;</a>
<a name="ln484">}</a>
<a name="ln485"> </a>
<a name="ln486">static gboolean _lib_lighttable_key_accel_zoom_in_callback(GtkAccelGroup *accel_group, GObject *acceleratable,</a>
<a name="ln487">                                                           guint keyval, GdkModifierType modifier,</a>
<a name="ln488">                                                           gpointer data)</a>
<a name="ln489">{</a>
<a name="ln490">  dt_lib_module_t *self = (dt_lib_module_t *)data;</a>
<a name="ln491">  dt_lib_tool_lighttable_t *d = (dt_lib_tool_lighttable_t *)self-&gt;data;</a>
<a name="ln492">  int zoom = d-&gt;current_zoom;</a>
<a name="ln493">  if(zoom &lt;= 1)</a>
<a name="ln494">    zoom = 1;</a>
<a name="ln495">  else</a>
<a name="ln496">    zoom--;</a>
<a name="ln497">  gtk_range_set_value(GTK_RANGE(d-&gt;zoom), zoom);</a>
<a name="ln498">  return TRUE;</a>
<a name="ln499">}</a>
<a name="ln500"> </a>
<a name="ln501">static gboolean _lib_lighttable_key_accel_zoom_out_callback(GtkAccelGroup *accel_group,</a>
<a name="ln502">                                                            GObject *acceleratable, guint keyval,</a>
<a name="ln503">                                                            GdkModifierType modifier, gpointer data)</a>
<a name="ln504">{</a>
<a name="ln505">  dt_lib_module_t *self = (dt_lib_module_t *)data;</a>
<a name="ln506">  dt_lib_tool_lighttable_t *d = (dt_lib_tool_lighttable_t *)self-&gt;data;</a>
<a name="ln507">  int zoom = d-&gt;current_zoom;</a>
<a name="ln508">  if(zoom &gt;= 2 * DT_LIBRARY_MAX_ZOOM)</a>
<a name="ln509">    zoom = 2 * DT_LIBRARY_MAX_ZOOM;</a>
<a name="ln510">  else</a>
<a name="ln511">    zoom++;</a>
<a name="ln512">  gtk_range_set_value(GTK_RANGE(d-&gt;zoom), zoom);</a>
<a name="ln513">  return TRUE;</a>
<a name="ln514">}</a>
<a name="ln515"> </a>
<a name="ln516">static gboolean _lib_lighttable_key_accel_toggle_culling_dynamic_mode(GtkAccelGroup *accel_group,</a>
<a name="ln517">                                                                      GObject *acceleratable, guint keyval,</a>
<a name="ln518">                                                                      GdkModifierType modifier, gpointer data)</a>
<a name="ln519">{</a>
<a name="ln520">  dt_lib_module_t *self = (dt_lib_module_t *)data;</a>
<a name="ln521">  dt_lib_tool_lighttable_t *d = (dt_lib_tool_lighttable_t *)self-&gt;data;</a>
<a name="ln522"> </a>
<a name="ln523">  if(d-&gt;layout != DT_LIGHTTABLE_LAYOUT_CULLING)</a>
<a name="ln524">  {</a>
<a name="ln525">    d-&gt;zoom_mode = DT_LIGHTTABLE_ZOOM_DYNAMIC;</a>
<a name="ln526">    dt_conf_set_int(&quot;plugins/lighttable/culling_zoom_mode&quot;, d-&gt;zoom_mode);</a>
<a name="ln527">    _lib_lighttable_set_layout(self, DT_LIGHTTABLE_LAYOUT_CULLING);</a>
<a name="ln528">  }</a>
<a name="ln529">  else</a>
<a name="ln530">  {</a>
<a name="ln531">    d-&gt;zoom_mode = DT_LIGHTTABLE_ZOOM_FIXED;</a>
<a name="ln532">    _lib_lighttable_set_layout(self, d-&gt;base_layout);</a>
<a name="ln533">  }</a>
<a name="ln534"> </a>
<a name="ln535">  dt_control_queue_redraw_center();</a>
<a name="ln536">  return TRUE;</a>
<a name="ln537">}</a>
<a name="ln538"> </a>
<a name="ln539">static gboolean _lib_lighttable_key_accel_toggle_culling_mode(GtkAccelGroup *accel_group, GObject *acceleratable,</a>
<a name="ln540">                                                              guint keyval, GdkModifierType modifier,</a>
<a name="ln541">                                                              gpointer data)</a>
<a name="ln542">{</a>
<a name="ln543">  dt_lib_module_t *self = (dt_lib_module_t *)data;</a>
<a name="ln544">  dt_lib_tool_lighttable_t *d = (dt_lib_tool_lighttable_t *)self-&gt;data;</a>
<a name="ln545"> </a>
<a name="ln546">  d-&gt;zoom_mode = DT_LIGHTTABLE_ZOOM_FIXED;</a>
<a name="ln547">  if(d-&gt;layout != DT_LIGHTTABLE_LAYOUT_CULLING)</a>
<a name="ln548">  {</a>
<a name="ln549">    dt_conf_set_int(&quot;plugins/lighttable/culling_zoom_mode&quot;, d-&gt;zoom_mode);</a>
<a name="ln550">    _lib_lighttable_set_layout(self, DT_LIGHTTABLE_LAYOUT_CULLING);</a>
<a name="ln551">  }</a>
<a name="ln552">  else</a>
<a name="ln553">    _lib_lighttable_set_layout(self, d-&gt;base_layout);</a>
<a name="ln554"> </a>
<a name="ln555">  dt_control_queue_redraw_center();</a>
<a name="ln556">  return TRUE;</a>
<a name="ln557">}</a>
<a name="ln558"> </a>
<a name="ln559">static gboolean _lib_lighttable_key_accel_toggle_culling_zoom_mode(GtkAccelGroup *accel_group,</a>
<a name="ln560">                                                                   GObject *acceleratable, guint keyval,</a>
<a name="ln561">                                                                   GdkModifierType modifier, gpointer data)</a>
<a name="ln562">{</a>
<a name="ln563">  dt_lib_module_t *self = (dt_lib_module_t *)data;</a>
<a name="ln564">  dt_lib_tool_lighttable_t *d = (dt_lib_tool_lighttable_t *)self-&gt;data;</a>
<a name="ln565"> </a>
<a name="ln566">  if(d-&gt;layout == DT_LIGHTTABLE_LAYOUT_CULLING)</a>
<a name="ln567">    gtk_combo_box_set_active(GTK_COMBO_BOX(d-&gt;zoom_mode_cb), d-&gt;zoom_mode == DT_LIGHTTABLE_ZOOM_FIXED);</a>
<a name="ln568">  return TRUE;</a>
<a name="ln569">}</a>
<a name="ln570"> </a>
<a name="ln571">#ifdef USE_LUA</a>
<a name="ln572">static int layout_cb(lua_State *L)</a>
<a name="ln573">{</a>
<a name="ln574">  dt_lib_module_t *self = lua_touserdata(L, lua_upvalueindex(1));</a>
<a name="ln575">  const dt_lighttable_layout_t tmp = _lib_lighttable_get_layout(self);</a>
<a name="ln576">  if(lua_gettop(L) &gt; 0){</a>
<a name="ln577">    dt_lighttable_layout_t value;</a>
<a name="ln578">    luaA_to(L,dt_lighttable_layout_t,&amp;value,1);</a>
<a name="ln579">    _lib_lighttable_set_layout(self, value);</a>
<a name="ln580">  }</a>
<a name="ln581">  luaA_push(L, dt_lighttable_layout_t, &amp;tmp);</a>
<a name="ln582">  return 1;</a>
<a name="ln583">}</a>
<a name="ln584">static int zoom_level_cb(lua_State *L)</a>
<a name="ln585">{</a>
<a name="ln586">  dt_lib_module_t *self = lua_touserdata(L, lua_upvalueindex(1));</a>
<a name="ln587">  const gint tmp = _lib_lighttable_get_zoom(self);</a>
<a name="ln588">  if(lua_gettop(L) &gt; 0){</a>
<a name="ln589">    int value;</a>
<a name="ln590">    luaA_to(L,int,&amp;value,1);</a>
<a name="ln591">    _lib_lighttable_set_zoom(self, value);</a>
<a name="ln592">  }</a>
<a name="ln593">  luaA_push(L, int, &amp;tmp);</a>
<a name="ln594">  return 1;</a>
<a name="ln595">}</a>
<a name="ln596"> </a>
<a name="ln597">void init(struct dt_lib_module_t *self)</a>
<a name="ln598">{</a>
<a name="ln599">  lua_State *L = darktable.lua_state.state;</a>
<a name="ln600">  int my_type = dt_lua_module_entry_get_type(L, &quot;lib&quot;, self-&gt;plugin_name);</a>
<a name="ln601">  lua_pushlightuserdata(L, self);</a>
<a name="ln602">  lua_pushcclosure(L, layout_cb, 1);</a>
<a name="ln603">  dt_lua_gtk_wrap(L);</a>
<a name="ln604">  lua_pushcclosure(L, dt_lua_type_member_common, 1);</a>
<a name="ln605">  dt_lua_type_register_const_type(L, my_type, &quot;layout&quot;);</a>
<a name="ln606">  lua_pushlightuserdata(L, self);</a>
<a name="ln607">  lua_pushcclosure(L, zoom_level_cb,1);</a>
<a name="ln608">  dt_lua_gtk_wrap(L);</a>
<a name="ln609">  lua_pushcclosure(L, dt_lua_type_member_common, 1);</a>
<a name="ln610">  dt_lua_type_register_const_type(L, my_type, &quot;zoom_level&quot;);</a>
<a name="ln611"> </a>
<a name="ln612">  luaA_enum(L,dt_lighttable_layout_t);</a>
<a name="ln613">  luaA_enum_value(L,dt_lighttable_layout_t,DT_LIGHTTABLE_LAYOUT_FIRST);</a>
<a name="ln614">  luaA_enum_value(L,dt_lighttable_layout_t,DT_LIGHTTABLE_LAYOUT_ZOOMABLE);</a>
<a name="ln615">  luaA_enum_value(L,dt_lighttable_layout_t,DT_LIGHTTABLE_LAYOUT_FILEMANAGER);</a>
<a name="ln616">  luaA_enum_value(L, dt_lighttable_layout_t, DT_LIGHTTABLE_LAYOUT_CULLING);</a>
<a name="ln617">  luaA_enum_value(L,dt_lighttable_layout_t,DT_LIGHTTABLE_LAYOUT_LAST);</a>
<a name="ln618">}</a>
<a name="ln619">#endif</a>
<a name="ln620">// modelines: These editor modelines have been set for all relevant files by tools/update_modelines.sh</a>
<a name="ln621">// vim: shiftwidth=2 expandtab tabstop=2 cindent</a>
<a name="ln622">// kate: tab-indents: off; indent-width 2; replace-tabs on; indent-mode cstyle; remove-trailing-spaces modified;</a>

</code></pre>
<div class="balloon" rel="206"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v519/" target="_blank">V519</a> The variable is assigned values twice successively. Perhaps this is a mistake. Check lines: 205, 206.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
