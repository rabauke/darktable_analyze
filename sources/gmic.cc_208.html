
<html>
<head>
  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.2.1.min.js"></script>
</head>
<body>
<pre><code class = "cpp">
<a name="ln1">/*</a>
<a name="ln2">    This file is part of darktable,</a>
<a name="ln3">    copyright (c) 2018 Heiko Bauke.</a>
<a name="ln4"> </a>
<a name="ln5">    darktable is free software: you can redistribute it and/or modify</a>
<a name="ln6">    it under the terms of the GNU General Public License as published by</a>
<a name="ln7">    the Free Software Foundation, either version 3 of the License, or</a>
<a name="ln8">    (at your option) any later version.</a>
<a name="ln9"> </a>
<a name="ln10">    darktable is distributed in the hope that it will be useful,</a>
<a name="ln11">    but WITHOUT ANY WARRANTY; without even the implied warranty of</a>
<a name="ln12">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</a>
<a name="ln13">    GNU General Public License for more details.</a>
<a name="ln14"> </a>
<a name="ln15">    You should have received a copy of the GNU General Public License</a>
<a name="ln16">    along with darktable.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</a>
<a name="ln17">*/</a>
<a name="ln18"> </a>
<a name="ln19"> </a>
<a name="ln20">extern &quot;C&quot;</a>
<a name="ln21">{</a>
<a name="ln22">#ifdef HAVE_CONFIG_H</a>
<a name="ln23">#include &quot;config.h&quot;</a>
<a name="ln24">#endif</a>
<a name="ln25">#include &quot;bauhaus/bauhaus.h&quot;</a>
<a name="ln26">#include &quot;common/darktable.h&quot;</a>
<a name="ln27">#include &quot;common/file_location.h&quot;</a>
<a name="ln28">#include &quot;develop/imageop.h&quot;</a>
<a name="ln29">#include &quot;develop/imageop_math.h&quot;</a>
<a name="ln30">#include &quot;gui/gtk.h&quot;</a>
<a name="ln31">#include &quot;iop/iop_api.h&quot;</a>
<a name="ln32">#include &lt;dirent.h&gt;</a>
<a name="ln33">#include &lt;gtk/gtk.h&gt;</a>
<a name="ln34">#include &lt;limits.h&gt;</a>
<a name="ln35">#include &lt;sys/types.h&gt;</a>
<a name="ln36">}</a>
<a name="ln37"> </a>
<a name="ln38">#include &lt;CImg.h&gt;</a>
<a name="ln39">#include &lt;algorithm&gt;</a>
<a name="ln40">#include &lt;cstddef&gt;</a>
<a name="ln41">#include &lt;cstdlib&gt;</a>
<a name="ln42">#include &lt;gmic.h&gt;</a>
<a name="ln43">#include &lt;iostream&gt;</a>
<a name="ln44">#include &lt;string&gt;</a>
<a name="ln45">#include &lt;vector&gt;</a>
<a name="ln46"> </a>
<a name="ln47">enum filter_type</a>
<a name="ln48">{</a>
<a name="ln49">  none,</a>
<a name="ln50">  expert_mode,</a>
<a name="ln51">  sepia,</a>
<a name="ln52">  film_emulation,</a>
<a name="ln53">  custom_film_emulation,</a>
<a name="ln54">  freaky_details,</a>
<a name="ln55">  sharpen_Richardson_Lucy,</a>
<a name="ln56">  sharpen_Gold_Meinel,</a>
<a name="ln57">  sharpen_inverse_diffusion,</a>
<a name="ln58">  magic_details,</a>
<a name="ln59">  basic_color_adjustments,</a>
<a name="ln60">  equalize_shadow,</a>
<a name="ln61">  add_grain,</a>
<a name="ln62">  pop_shadows,</a>
<a name="ln63">  smooth_bilateral,</a>
<a name="ln64">  smooth_guided,</a>
<a name="ln65">  light_glow,</a>
<a name="ln66">  lomo</a>
<a name="ln67">};</a>
<a name="ln68"> </a>
<a name="ln69">typedef struct dt_iop_gmic_params_t</a>
<a name="ln70">{</a>
<a name="ln71">  filter_type filter;</a>
<a name="ln72">  char parameters[1024] = { &quot;&quot; };</a>
<a name="ln73">} dt_iop_gmic_params_t;</a>
<a name="ln74"> </a>
<a name="ln75"> </a>
<a name="ln76">struct parameter_interface</a>
<a name="ln77">{</a>
<a name="ln78">  virtual dt_iop_gmic_params_t to_gmic_params() const = 0;</a>
<a name="ln79">  virtual filter_type get_filter() const = 0;</a>
<a name="ln80">  virtual void gui_init(dt_iop_module_t *self) const = 0;</a>
<a name="ln81">  virtual void gui_update(dt_iop_module_t *self) const = 0;</a>
<a name="ln82">  virtual void gui_reset(dt_iop_module_t *self) = 0;</a>
<a name="ln83">};</a>
<a name="ln84"> </a>
<a name="ln85">struct dt_iop_gmic_gui_data_t;</a>
<a name="ln86"> </a>
<a name="ln87">// --- none filter</a>
<a name="ln88"> </a>
<a name="ln89">struct dt_iop_gmic_none_params_t : public parameter_interface</a>
<a name="ln90">{</a>
<a name="ln91">  dt_iop_gmic_none_params_t() = default;</a>
<a name="ln92">  dt_iop_gmic_none_params_t(const dt_iop_gmic_params_t &amp;);</a>
<a name="ln93">  dt_iop_gmic_params_t to_gmic_params() const override;</a>
<a name="ln94">  static const char *get_custom_command();</a>
<a name="ln95">  filter_type get_filter() const override;</a>
<a name="ln96">  void gui_init(dt_iop_module_t *self) const override;</a>
<a name="ln97">  void gui_update(dt_iop_module_t *self) const override;</a>
<a name="ln98">  void gui_reset(dt_iop_module_t *self) override;</a>
<a name="ln99">};</a>
<a name="ln100"> </a>
<a name="ln101">struct dt_iop_gmic_none_gui_data_t</a>
<a name="ln102">{</a>
<a name="ln103">  dt_iop_gmic_none_params_t parameters;</a>
<a name="ln104">};</a>
<a name="ln105"> </a>
<a name="ln106">// --- expert mode</a>
<a name="ln107"> </a>
<a name="ln108">struct dt_iop_gmic_expert_mode_params_t : public parameter_interface</a>
<a name="ln109">{</a>
<a name="ln110">  char command[1024]{ &quot;&quot; };</a>
<a name="ln111">  dt_iop_gmic_expert_mode_params_t() = default;</a>
<a name="ln112">  dt_iop_gmic_expert_mode_params_t(const dt_iop_gmic_params_t &amp;other);</a>
<a name="ln113">  dt_iop_gmic_params_t to_gmic_params() const override;</a>
<a name="ln114">  static const char *get_custom_command();</a>
<a name="ln115">  filter_type get_filter() const override;</a>
<a name="ln116">  void gui_init(dt_iop_module_t *self) const override;</a>
<a name="ln117">  void gui_update(dt_iop_module_t *self) const override;</a>
<a name="ln118">  void gui_reset(dt_iop_module_t *self) override;</a>
<a name="ln119">  static void command_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln120">};</a>
<a name="ln121"> </a>
<a name="ln122">struct dt_iop_gmic_expert_mode_gui_data_t</a>
<a name="ln123">{</a>
<a name="ln124">  GtkWidget *box;</a>
<a name="ln125">  GtkWidget *command;</a>
<a name="ln126">  dt_iop_gmic_expert_mode_params_t parameters;</a>
<a name="ln127">};</a>
<a name="ln128"> </a>
<a name="ln129">// --- sepia</a>
<a name="ln130"> </a>
<a name="ln131">struct dt_iop_gmic_sepia_params_t : public parameter_interface</a>
<a name="ln132">{</a>
<a name="ln133">  float brightness{ 0.f }, contrast{ 0.f }, gamma{ 0.f };</a>
<a name="ln134">  dt_iop_gmic_sepia_params_t() = default;</a>
<a name="ln135">  dt_iop_gmic_sepia_params_t(const dt_iop_gmic_params_t &amp;other);</a>
<a name="ln136">  dt_iop_gmic_params_t to_gmic_params() const override;</a>
<a name="ln137">  static const char *get_custom_command();</a>
<a name="ln138">  filter_type get_filter() const override;</a>
<a name="ln139">  void gui_init(dt_iop_module_t *self) const override;</a>
<a name="ln140">  void gui_update(dt_iop_module_t *self) const override;</a>
<a name="ln141">  void gui_reset(dt_iop_module_t *self) override;</a>
<a name="ln142">  static void brightness_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln143">  static void contrast_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln144">  static void gamma_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln145">};</a>
<a name="ln146"> </a>
<a name="ln147">struct dt_iop_gmic_sepia_gui_data_t</a>
<a name="ln148">{</a>
<a name="ln149">  GtkWidget *box;</a>
<a name="ln150">  GtkWidget *brightness, *contrast, *gamma;</a>
<a name="ln151">  dt_iop_gmic_sepia_params_t parameters;</a>
<a name="ln152">};</a>
<a name="ln153"> </a>
<a name="ln154">// --- film emulation</a>
<a name="ln155"> </a>
<a name="ln156">struct film_map</a>
<a name="ln157">{</a>
<a name="ln158">  std::string film_type;</a>
<a name="ln159">  std::string printable;</a>
<a name="ln160">  film_map(const char *film_type_, const char *printable_) : film_type(film_type_), printable(printable_)</a>
<a name="ln161">  {</a>
<a name="ln162">  }</a>
<a name="ln163"> </a>
<a name="ln164">  film_map(const std::string &amp;film_type_, const std::string &amp;printable_)</a>
<a name="ln165">    : film_type(film_type_), printable(printable_)</a>
<a name="ln166">  {</a>
<a name="ln167">  }</a>
<a name="ln168">};</a>
<a name="ln169"> </a>
<a name="ln170">struct dt_iop_gmic_film_emulation_params_t : public parameter_interface</a>
<a name="ln171">{</a>
<a name="ln172">  char film[128]{ &quot;agfa_apx_25&quot; };</a>
<a name="ln173">  float strength{ 1.f }, brightness{ 0.f }, contrast{ 0.f }, gamma{ 0.f }, hue{ 0.f }, saturation{ 0.f };</a>
<a name="ln174">  int normalize_colors{ 0 };</a>
<a name="ln175">  static const std::vector&lt;film_map&gt; film_maps;</a>
<a name="ln176">  dt_iop_gmic_film_emulation_params_t() = default;</a>
<a name="ln177">  dt_iop_gmic_film_emulation_params_t(const dt_iop_gmic_params_t &amp;other);</a>
<a name="ln178">  dt_iop_gmic_params_t to_gmic_params() const override;</a>
<a name="ln179">  static const char *get_custom_command();</a>
<a name="ln180">  filter_type get_filter() const override;</a>
<a name="ln181">  void gui_init(dt_iop_module_t *self) const override;</a>
<a name="ln182">  void gui_update(dt_iop_module_t *self) const override;</a>
<a name="ln183">  void gui_reset(dt_iop_module_t *self) override;</a>
<a name="ln184">  static void film_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln185">  static void strength_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln186">  static void brightness_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln187">  static void contrast_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln188">  static void gamma_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln189">  static void hue_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln190">  static void saturation_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln191">  static void normalize_colors_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln192">};</a>
<a name="ln193"> </a>
<a name="ln194">struct dt_iop_gmic_film_emulation_gui_data_t</a>
<a name="ln195">{</a>
<a name="ln196">  GtkWidget *box;</a>
<a name="ln197">  GtkWidget *film, *strength, *brightness, *contrast, *gamma, *hue, *saturation, *normalize_colors;</a>
<a name="ln198">  std::vector&lt;std::string&gt; film_list;</a>
<a name="ln199">  dt_iop_gmic_film_emulation_params_t parameters;</a>
<a name="ln200">};</a>
<a name="ln201"> </a>
<a name="ln202">// --- custom film emulation</a>
<a name="ln203"> </a>
<a name="ln204">struct dt_iop_gmic_custom_film_emulation_params_t : public parameter_interface</a>
<a name="ln205">{</a>
<a name="ln206">  char film[1024]{ &quot;&quot; };</a>
<a name="ln207">  float strength{ 1.f }, brightness{ 0.f }, contrast{ 0.f }, gamma{ 0.f }, hue{ 0.f }, saturation{ 0.f };</a>
<a name="ln208">  int normalize_colors{ 0 };</a>
<a name="ln209">  static const std::vector&lt;film_map&gt; film_maps;</a>
<a name="ln210">  dt_iop_gmic_custom_film_emulation_params_t();</a>
<a name="ln211">  dt_iop_gmic_custom_film_emulation_params_t(const dt_iop_gmic_params_t &amp;other);</a>
<a name="ln212">  dt_iop_gmic_params_t to_gmic_params() const override;</a>
<a name="ln213">  static const char *get_custom_command();</a>
<a name="ln214">  filter_type get_filter() const override;</a>
<a name="ln215">  void gui_init(dt_iop_module_t *self) const override;</a>
<a name="ln216">  void gui_update(dt_iop_module_t *self) const override;</a>
<a name="ln217">  void gui_reset(dt_iop_module_t *self) override;</a>
<a name="ln218">  static void film_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln219">  static void strength_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln220">  static void brightness_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln221">  static void contrast_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln222">  static void gamma_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln223">  static void hue_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln224">  static void saturation_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln225">  static void normalize_colors_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln226">};</a>
<a name="ln227"> </a>
<a name="ln228">struct dt_iop_gmic_custom_film_emulation_gui_data_t</a>
<a name="ln229">{</a>
<a name="ln230">  GtkWidget *box;</a>
<a name="ln231">  GtkWidget *film, *strength, *brightness, *contrast, *gamma, *hue, *saturation, *normalize_colors;</a>
<a name="ln232">  std::vector&lt;std::string&gt; film_list;</a>
<a name="ln233">  dt_iop_gmic_custom_film_emulation_params_t parameters;</a>
<a name="ln234">};</a>
<a name="ln235"> </a>
<a name="ln236">// --- freaky details</a>
<a name="ln237"> </a>
<a name="ln238">struct dt_iop_gmic_freaky_details_params_t : public parameter_interface</a>
<a name="ln239">{</a>
<a name="ln240">  int amplitude{ 2 };</a>
<a name="ln241">  float scale{ 10.f };</a>
<a name="ln242">  int iterations{ 1 }, channel{ 11 };</a>
<a name="ln243">  dt_iop_gmic_freaky_details_params_t() = default;</a>
<a name="ln244">  dt_iop_gmic_freaky_details_params_t(const dt_iop_gmic_params_t &amp;other);</a>
<a name="ln245">  dt_iop_gmic_params_t to_gmic_params() const override;</a>
<a name="ln246">  static const char *get_custom_command();</a>
<a name="ln247">  filter_type get_filter() const override;</a>
<a name="ln248">  void gui_init(dt_iop_module_t *self) const override;</a>
<a name="ln249">  void gui_update(dt_iop_module_t *self) const override;</a>
<a name="ln250">  void gui_reset(dt_iop_module_t *self) override;</a>
<a name="ln251">  static void amplitude_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln252">  static void scale_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln253">  static void iterations_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln254">  static void channel_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln255">};</a>
<a name="ln256"> </a>
<a name="ln257">struct dt_iop_gmic_freaky_details_gui_data_t</a>
<a name="ln258">{</a>
<a name="ln259">  GtkWidget *box;</a>
<a name="ln260">  GtkWidget *ampltude, *scale, *iterations, *channel;</a>
<a name="ln261">  dt_iop_gmic_freaky_details_params_t parameters;</a>
<a name="ln262">};</a>
<a name="ln263"> </a>
<a name="ln264">// --- sharpen Richardson Lucy</a>
<a name="ln265"> </a>
<a name="ln266">struct dt_iop_gmic_sharpen_Richardson_Lucy_params_t : public parameter_interface</a>
<a name="ln267">{</a>
<a name="ln268">  float sigma{ 1.f };</a>
<a name="ln269">  int iterations{ 10 }, blur{ 1 }, channel{ 11 };</a>
<a name="ln270">  dt_iop_gmic_sharpen_Richardson_Lucy_params_t() = default;</a>
<a name="ln271">  dt_iop_gmic_sharpen_Richardson_Lucy_params_t(const dt_iop_gmic_params_t &amp;other);</a>
<a name="ln272">  dt_iop_gmic_params_t to_gmic_params() const override;</a>
<a name="ln273">  static const char *get_custom_command();</a>
<a name="ln274">  filter_type get_filter() const override;</a>
<a name="ln275">  void gui_init(dt_iop_module_t *self) const override;</a>
<a name="ln276">  void gui_update(dt_iop_module_t *self) const override;</a>
<a name="ln277">  void gui_reset(dt_iop_module_t *self) override;</a>
<a name="ln278">  static void sigma_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln279">  static void iterations_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln280">  static void blur_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln281">  static void channel_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln282">};</a>
<a name="ln283"> </a>
<a name="ln284">struct dt_iop_gmic_sharpen_Richardson_Lucy_gui_data_t</a>
<a name="ln285">{</a>
<a name="ln286">  GtkWidget *box;</a>
<a name="ln287">  GtkWidget *sigma, *iterations, *blur, *channel;</a>
<a name="ln288">  dt_iop_gmic_sharpen_Richardson_Lucy_params_t parameters;</a>
<a name="ln289">};</a>
<a name="ln290"> </a>
<a name="ln291">// --- sharpen Gold Meinel</a>
<a name="ln292"> </a>
<a name="ln293">struct dt_iop_gmic_sharpen_Gold_Meinel_params_t : public parameter_interface</a>
<a name="ln294">{</a>
<a name="ln295">  float sigma{ 1.f };</a>
<a name="ln296">  int iterations{ 5 };</a>
<a name="ln297">  float acceleration{ 1.f };</a>
<a name="ln298">  int blur{ 1 }, channel{ 11 };</a>
<a name="ln299">  dt_iop_gmic_sharpen_Gold_Meinel_params_t() = default;</a>
<a name="ln300">  dt_iop_gmic_sharpen_Gold_Meinel_params_t(const dt_iop_gmic_params_t &amp;other);</a>
<a name="ln301">  dt_iop_gmic_params_t to_gmic_params() const override;</a>
<a name="ln302">  static const char *get_custom_command();</a>
<a name="ln303">  filter_type get_filter() const override;</a>
<a name="ln304">  void gui_init(dt_iop_module_t *self) const override;</a>
<a name="ln305">  void gui_update(dt_iop_module_t *self) const override;</a>
<a name="ln306">  void gui_reset(dt_iop_module_t *self) override;</a>
<a name="ln307">  static void sigma_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln308">  static void iterations_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln309">  static void acceleration_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln310">  static void blur_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln311">  static void channel_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln312">};</a>
<a name="ln313"> </a>
<a name="ln314">struct dt_iop_gmic_sharpen_Gold_Meinel_gui_data_t</a>
<a name="ln315">{</a>
<a name="ln316">  GtkWidget *box;</a>
<a name="ln317">  GtkWidget *sigma, *iterations, *acceleration, *blur, *channel;</a>
<a name="ln318">  dt_iop_gmic_sharpen_Gold_Meinel_params_t parameters;</a>
<a name="ln319">};</a>
<a name="ln320"> </a>
<a name="ln321">// --- sharpen inverse diffusion</a>
<a name="ln322"> </a>
<a name="ln323">struct dt_iop_gmic_sharpen_inverse_diffusion_params_t : public parameter_interface</a>
<a name="ln324">{</a>
<a name="ln325">  float amplitude{ 50.f };</a>
<a name="ln326">  int iterations{ 2 }, channel{ 11 };</a>
<a name="ln327">  dt_iop_gmic_sharpen_inverse_diffusion_params_t() = default;</a>
<a name="ln328">  dt_iop_gmic_sharpen_inverse_diffusion_params_t(const dt_iop_gmic_params_t &amp;other);</a>
<a name="ln329">  dt_iop_gmic_params_t to_gmic_params() const override;</a>
<a name="ln330">  static const char *get_custom_command();</a>
<a name="ln331">  filter_type get_filter() const override;</a>
<a name="ln332">  void gui_init(dt_iop_module_t *self) const override;</a>
<a name="ln333">  void gui_update(dt_iop_module_t *self) const override;</a>
<a name="ln334">  void gui_reset(dt_iop_module_t *self) override;</a>
<a name="ln335">  static void amplitude_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln336">  static void iterations_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln337">  static void channel_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln338">};</a>
<a name="ln339"> </a>
<a name="ln340">struct dt_iop_gmic_sharpen_inverse_diffusion_gui_data_t</a>
<a name="ln341">{</a>
<a name="ln342">  GtkWidget *box;</a>
<a name="ln343">  GtkWidget *ampltude, *iterations, *channel;</a>
<a name="ln344">  dt_iop_gmic_sharpen_inverse_diffusion_params_t parameters;</a>
<a name="ln345">};</a>
<a name="ln346"> </a>
<a name="ln347">// --- magic details</a>
<a name="ln348"> </a>
<a name="ln349">struct dt_iop_gmic_magic_details_params_t : public parameter_interface</a>
<a name="ln350">{</a>
<a name="ln351">  float amplitude{ 6.f };</a>
<a name="ln352">  float spatial_scale{ 3.f };</a>
<a name="ln353">  float value_scale{ 15.f };</a>
<a name="ln354">  float edges{ -0.5f };</a>
<a name="ln355">  float smoothness{ 2.f };</a>
<a name="ln356">  int channel{ 27 };</a>
<a name="ln357">  dt_iop_gmic_magic_details_params_t() = default;</a>
<a name="ln358">  dt_iop_gmic_magic_details_params_t(const dt_iop_gmic_params_t &amp;other);</a>
<a name="ln359">  dt_iop_gmic_params_t to_gmic_params() const override;</a>
<a name="ln360">  static const char *get_custom_command();</a>
<a name="ln361">  filter_type get_filter() const override;</a>
<a name="ln362">  void gui_init(dt_iop_module_t *self) const override;</a>
<a name="ln363">  void gui_update(dt_iop_module_t *self) const override;</a>
<a name="ln364">  void gui_reset(dt_iop_module_t *self) override;</a>
<a name="ln365">  static void amplitude_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln366">  static void spatial_scale_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln367">  static void value_scale_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln368">  static void edges_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln369">  static void smoothness_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln370">  static void channel_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln371">};</a>
<a name="ln372"> </a>
<a name="ln373">struct dt_iop_gmic_magic_details_gui_data_t</a>
<a name="ln374">{</a>
<a name="ln375">  GtkWidget *box;</a>
<a name="ln376">  GtkWidget *ampltude, *spatial_scale, *value_scale, *edges, *smoothness, *channel;</a>
<a name="ln377">  dt_iop_gmic_magic_details_params_t parameters;</a>
<a name="ln378">};</a>
<a name="ln379"> </a>
<a name="ln380">// --- basic color adjustments</a>
<a name="ln381"> </a>
<a name="ln382">struct dt_iop_gmic_basic_color_adjustments_params_t : public parameter_interface</a>
<a name="ln383">{</a>
<a name="ln384">  float brightness{ 0.f }, contrast{ 0.f }, gamma{ 0.f }, hue{ 0.f }, saturation{ 0.f };</a>
<a name="ln385">  dt_iop_gmic_basic_color_adjustments_params_t() = default;</a>
<a name="ln386">  dt_iop_gmic_basic_color_adjustments_params_t(const dt_iop_gmic_params_t &amp;other);</a>
<a name="ln387">  dt_iop_gmic_params_t to_gmic_params() const override;</a>
<a name="ln388">  static const char *get_custom_command();</a>
<a name="ln389">  filter_type get_filter() const override;</a>
<a name="ln390">  void gui_init(dt_iop_module_t *self) const override;</a>
<a name="ln391">  void gui_update(dt_iop_module_t *self) const override;</a>
<a name="ln392">  void gui_reset(dt_iop_module_t *self) override;</a>
<a name="ln393">  static void strength_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln394">  static void brightness_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln395">  static void contrast_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln396">  static void gamma_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln397">  static void hue_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln398">  static void saturation_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln399">};</a>
<a name="ln400"> </a>
<a name="ln401">struct dt_iop_gmic_basic_color_adjustments_gui_data_t</a>
<a name="ln402">{</a>
<a name="ln403">  GtkWidget *box;</a>
<a name="ln404">  GtkWidget *brightness, *contrast, *gamma, *hue, *saturation;</a>
<a name="ln405">  dt_iop_gmic_basic_color_adjustments_params_t parameters;</a>
<a name="ln406">};</a>
<a name="ln407"> </a>
<a name="ln408">// --- equalize shadow</a>
<a name="ln409"> </a>
<a name="ln410">struct dt_iop_gmic_equalize_shadow_params_t : public parameter_interface</a>
<a name="ln411">{</a>
<a name="ln412">  float amplitude{ 1.f };</a>
<a name="ln413">  dt_iop_gmic_equalize_shadow_params_t() = default;</a>
<a name="ln414">  dt_iop_gmic_equalize_shadow_params_t(const dt_iop_gmic_params_t &amp;other);</a>
<a name="ln415">  dt_iop_gmic_params_t to_gmic_params() const override;</a>
<a name="ln416">  static const char *get_custom_command();</a>
<a name="ln417">  filter_type get_filter() const override;</a>
<a name="ln418">  void gui_init(dt_iop_module_t *self) const override;</a>
<a name="ln419">  void gui_update(dt_iop_module_t *self) const override;</a>
<a name="ln420">  void gui_reset(dt_iop_module_t *self) override;</a>
<a name="ln421">  static void amplitude_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln422">};</a>
<a name="ln423"> </a>
<a name="ln424">struct dt_iop_gmic_equalize_shadow_gui_data_t</a>
<a name="ln425">{</a>
<a name="ln426">  GtkWidget *box;</a>
<a name="ln427">  GtkWidget *amplitude;</a>
<a name="ln428">  dt_iop_gmic_equalize_shadow_params_t parameters;</a>
<a name="ln429">};</a>
<a name="ln430"> </a>
<a name="ln431">// --- add grain</a>
<a name="ln432"> </a>
<a name="ln433">struct dt_iop_gmic_add_grain_params_t : public parameter_interface</a>
<a name="ln434">{</a>
<a name="ln435">  int preset{ 0 }, blend_mode{ 1 };</a>
<a name="ln436">  float opacity{ 0.2f }, scale{ 100.f };</a>
<a name="ln437">  int color_grain{ 0 };</a>
<a name="ln438">  float brightness{ 0.f }, contrast{ 0.f }, gamma{ 0.f }, hue{ 0.f }, saturation{ 0.f };</a>
<a name="ln439">  dt_iop_gmic_add_grain_params_t() = default;</a>
<a name="ln440">  dt_iop_gmic_add_grain_params_t(const dt_iop_gmic_params_t &amp;other);</a>
<a name="ln441">  dt_iop_gmic_params_t to_gmic_params() const override;</a>
<a name="ln442">  static const char *get_custom_command();</a>
<a name="ln443">  filter_type get_filter() const override;</a>
<a name="ln444">  void gui_init(dt_iop_module_t *self) const override;</a>
<a name="ln445">  void gui_update(dt_iop_module_t *self) const override;</a>
<a name="ln446">  void gui_reset(dt_iop_module_t *self) override;</a>
<a name="ln447">  static void preset_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln448">  static void blend_mode_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln449">  static void opacity_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln450">  static void scale_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln451">  static void color_grain_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln452">  static void brightness_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln453">  static void contrast_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln454">  static void gamma_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln455">  static void hue_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln456">  static void saturation_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln457">};</a>
<a name="ln458"> </a>
<a name="ln459">struct dt_iop_gmic_add_grain_gui_data_t</a>
<a name="ln460">{</a>
<a name="ln461">  GtkWidget *box;</a>
<a name="ln462">  GtkWidget *preset, *blend_mode, *opacity, *scale, *color_grain, *brightness, *contrast, *gamma, *hue,</a>
<a name="ln463">      *saturation;</a>
<a name="ln464">  dt_iop_gmic_add_grain_params_t parameters;</a>
<a name="ln465">};</a>
<a name="ln466"> </a>
<a name="ln467">// --- pop shadows</a>
<a name="ln468"> </a>
<a name="ln469">struct dt_iop_gmic_pop_shadows_params_t : public parameter_interface</a>
<a name="ln470">{</a>
<a name="ln471">  float strength{ 0.75f };</a>
<a name="ln472">  float scale{ 5.f };</a>
<a name="ln473">  dt_iop_gmic_pop_shadows_params_t() = default;</a>
<a name="ln474">  dt_iop_gmic_pop_shadows_params_t(const dt_iop_gmic_params_t &amp;other);</a>
<a name="ln475">  dt_iop_gmic_params_t to_gmic_params() const override;</a>
<a name="ln476">  static const char *get_custom_command();</a>
<a name="ln477">  filter_type get_filter() const override;</a>
<a name="ln478">  void gui_init(dt_iop_module_t *self) const override;</a>
<a name="ln479">  void gui_update(dt_iop_module_t *self) const override;</a>
<a name="ln480">  void gui_reset(dt_iop_module_t *self) override;</a>
<a name="ln481">  static void strength_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln482">  static void scale_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln483">};</a>
<a name="ln484"> </a>
<a name="ln485">struct dt_iop_gmic_pop_shadows_gui_data_t</a>
<a name="ln486">{</a>
<a name="ln487">  GtkWidget *box;</a>
<a name="ln488">  GtkWidget *strength, *scale;</a>
<a name="ln489">  dt_iop_gmic_pop_shadows_params_t parameters;</a>
<a name="ln490">};</a>
<a name="ln491"> </a>
<a name="ln492">// --- smooth bilateral</a>
<a name="ln493"> </a>
<a name="ln494">struct dt_iop_gmic_smooth_bilateral_params_t : public parameter_interface</a>
<a name="ln495">{</a>
<a name="ln496">  float spatial_scale{ 5.f };</a>
<a name="ln497">  float value_scale{ 0.02f };</a>
<a name="ln498">  int iterations{ 2 };</a>
<a name="ln499">  int channel{ 0 };</a>
<a name="ln500">  dt_iop_gmic_smooth_bilateral_params_t() = default;</a>
<a name="ln501">  dt_iop_gmic_smooth_bilateral_params_t(const dt_iop_gmic_params_t &amp;other);</a>
<a name="ln502">  dt_iop_gmic_params_t to_gmic_params() const override;</a>
<a name="ln503">  static const char *get_custom_command();</a>
<a name="ln504">  filter_type get_filter() const override;</a>
<a name="ln505">  void gui_init(dt_iop_module_t *self) const override;</a>
<a name="ln506">  void gui_update(dt_iop_module_t *self) const override;</a>
<a name="ln507">  void gui_reset(dt_iop_module_t *self) override;</a>
<a name="ln508">  static void spatial_scale_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln509">  static void value_scale_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln510">  static void iterations_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln511">  static void channel_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln512">};</a>
<a name="ln513"> </a>
<a name="ln514">struct dt_iop_gmic_smooth_bilateral_gui_data_t</a>
<a name="ln515">{</a>
<a name="ln516">  GtkWidget *box;</a>
<a name="ln517">  GtkWidget *spatial_scale, *value_scale, *iterations, *channel;</a>
<a name="ln518">  dt_iop_gmic_smooth_bilateral_params_t parameters;</a>
<a name="ln519">};</a>
<a name="ln520"> </a>
<a name="ln521">// --- smooth guided</a>
<a name="ln522"> </a>
<a name="ln523">struct dt_iop_gmic_smooth_guided_params_t : public parameter_interface</a>
<a name="ln524">{</a>
<a name="ln525">  float radius{ 5.f };</a>
<a name="ln526">  float smoothness{ 0.05f };</a>
<a name="ln527">  int iterations{ 1 };</a>
<a name="ln528">  int channel{ 0 };</a>
<a name="ln529">  dt_iop_gmic_smooth_guided_params_t() = default;</a>
<a name="ln530">  dt_iop_gmic_smooth_guided_params_t(const dt_iop_gmic_params_t &amp;other);</a>
<a name="ln531">  dt_iop_gmic_params_t to_gmic_params() const override;</a>
<a name="ln532">  static const char *get_custom_command();</a>
<a name="ln533">  filter_type get_filter() const override;</a>
<a name="ln534">  void gui_init(dt_iop_module_t *self) const override;</a>
<a name="ln535">  void gui_update(dt_iop_module_t *self) const override;</a>
<a name="ln536">  void gui_reset(dt_iop_module_t *self) override;</a>
<a name="ln537">  static void radius_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln538">  static void smoothness_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln539">  static void iterations_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln540">  static void channel_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln541">};</a>
<a name="ln542"> </a>
<a name="ln543">struct dt_iop_gmic_smooth_guided_gui_data_t</a>
<a name="ln544">{</a>
<a name="ln545">  GtkWidget *box;</a>
<a name="ln546">  GtkWidget *radius, *smoothness, *iterations, *channel;</a>
<a name="ln547">  dt_iop_gmic_smooth_guided_params_t parameters;</a>
<a name="ln548">};</a>
<a name="ln549"> </a>
<a name="ln550">// --- light glow</a>
<a name="ln551"> </a>
<a name="ln552">struct dt_iop_gmic_light_glow_params_t : public parameter_interface</a>
<a name="ln553">{</a>
<a name="ln554">  float density{ 0.3f };</a>
<a name="ln555">  float amplitude{ 0.5f };</a>
<a name="ln556">  int blend_mode{ 8 };</a>
<a name="ln557">  float opacity{ 0.8f };</a>
<a name="ln558">  int channel{ 0 };</a>
<a name="ln559">  dt_iop_gmic_light_glow_params_t() = default;</a>
<a name="ln560">  dt_iop_gmic_light_glow_params_t(const dt_iop_gmic_params_t &amp;other);</a>
<a name="ln561">  dt_iop_gmic_params_t to_gmic_params() const override;</a>
<a name="ln562">  static const char *get_custom_command();</a>
<a name="ln563">  filter_type get_filter() const override;</a>
<a name="ln564">  void gui_init(dt_iop_module_t *self) const override;</a>
<a name="ln565">  void gui_update(dt_iop_module_t *self) const override;</a>
<a name="ln566">  void gui_reset(dt_iop_module_t *self) override;</a>
<a name="ln567">  static void density_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln568">  static void amplitude_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln569">  static void blend_mode_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln570">  static void opacity_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln571">  static void channel_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln572">};</a>
<a name="ln573"> </a>
<a name="ln574">struct dt_iop_gmic_light_glow_gui_data_t</a>
<a name="ln575">{</a>
<a name="ln576">  GtkWidget *box;</a>
<a name="ln577">  GtkWidget *density, *amplitude, *blend_mode, *opacity, *channel;</a>
<a name="ln578">  dt_iop_gmic_light_glow_params_t parameters;</a>
<a name="ln579">};</a>
<a name="ln580"> </a>
<a name="ln581">// --- lomo</a>
<a name="ln582"> </a>
<a name="ln583">struct dt_iop_gmic_lomo_params_t : public parameter_interface</a>
<a name="ln584">{</a>
<a name="ln585">  float vignette_size{ 0.2f };</a>
<a name="ln586">  dt_iop_gmic_lomo_params_t() = default;</a>
<a name="ln587">  dt_iop_gmic_lomo_params_t(const dt_iop_gmic_params_t &amp;other);</a>
<a name="ln588">  dt_iop_gmic_params_t to_gmic_params() const override;</a>
<a name="ln589">  static const char *get_custom_command();</a>
<a name="ln590">  filter_type get_filter() const override;</a>
<a name="ln591">  void gui_init(dt_iop_module_t *self) const override;</a>
<a name="ln592">  void gui_update(dt_iop_module_t *self) const override;</a>
<a name="ln593">  void gui_reset(dt_iop_module_t *self) override;</a>
<a name="ln594">  static void vignette_size_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln595">};</a>
<a name="ln596"> </a>
<a name="ln597">struct dt_iop_gmic_lomo_gui_data_t</a>
<a name="ln598">{</a>
<a name="ln599">  GtkWidget *box;</a>
<a name="ln600">  GtkWidget *vignette_size;</a>
<a name="ln601">  dt_iop_gmic_lomo_params_t parameters;</a>
<a name="ln602">};</a>
<a name="ln603"> </a>
<a name="ln604">//----------------------------------------------------------------------</a>
<a name="ln605">// implement the module api</a>
<a name="ln606">//----------------------------------------------------------------------</a>
<a name="ln607"> </a>
<a name="ln608">DT_MODULE_INTROSPECTION(1, dt_iop_gmic_params_t)</a>
<a name="ln609"> </a>
<a name="ln610">// types  dt_iop_gmic_params_t and dt_iop_gmic_data_t are</a>
<a name="ln611">// equal, thus no commit_params function needs to be implemented</a>
<a name="ln612">typedef dt_iop_gmic_params_t dt_iop_gmic_data_t;</a>
<a name="ln613"> </a>
<a name="ln614">struct dt_iop_gmic_gui_data_t</a>
<a name="ln615">{</a>
<a name="ln616">  GtkWidget *gmic_filter;</a>
<a name="ln617">  dt_iop_gmic_none_gui_data_t none;</a>
<a name="ln618">  dt_iop_gmic_expert_mode_gui_data_t expert_mode;</a>
<a name="ln619">  dt_iop_gmic_sepia_gui_data_t sepia;</a>
<a name="ln620">  dt_iop_gmic_film_emulation_gui_data_t film_emulation;</a>
<a name="ln621">  dt_iop_gmic_custom_film_emulation_gui_data_t custom_film_emulation;</a>
<a name="ln622">  dt_iop_gmic_freaky_details_gui_data_t freaky_details;</a>
<a name="ln623">  dt_iop_gmic_sharpen_Richardson_Lucy_gui_data_t sharpen_Richardson_Lucy;</a>
<a name="ln624">  dt_iop_gmic_sharpen_Gold_Meinel_gui_data_t sharpen_Gold_Meinel;</a>
<a name="ln625">  dt_iop_gmic_sharpen_inverse_diffusion_gui_data_t sharpen_inverse_diffusion;</a>
<a name="ln626">  dt_iop_gmic_magic_details_gui_data_t magic_details;</a>
<a name="ln627">  dt_iop_gmic_basic_color_adjustments_gui_data_t basic_color_adjustments;</a>
<a name="ln628">  dt_iop_gmic_equalize_shadow_gui_data_t equalize_shadow;</a>
<a name="ln629">  dt_iop_gmic_add_grain_gui_data_t add_grain;</a>
<a name="ln630">  dt_iop_gmic_pop_shadows_gui_data_t pop_shadows;</a>
<a name="ln631">  dt_iop_gmic_smooth_bilateral_gui_data_t smooth_bilateral;</a>
<a name="ln632">  dt_iop_gmic_smooth_guided_gui_data_t smooth_guided;</a>
<a name="ln633">  dt_iop_gmic_light_glow_gui_data_t light_glow;</a>
<a name="ln634">  dt_iop_gmic_lomo_gui_data_t lomo;</a>
<a name="ln635">  const std::vector&lt;parameter_interface *&gt; filter_list{ &amp;none.parameters,</a>
<a name="ln636">                                                        &amp;basic_color_adjustments.parameters,</a>
<a name="ln637">                                                        &amp;sharpen_Richardson_Lucy.parameters,</a>
<a name="ln638">                                                        &amp;sharpen_Gold_Meinel.parameters,</a>
<a name="ln639">                                                        &amp;sharpen_inverse_diffusion.parameters,</a>
<a name="ln640">                                                        &amp;smooth_bilateral.parameters,</a>
<a name="ln641">                                                        &amp;smooth_guided.parameters,</a>
<a name="ln642">                                                        &amp;freaky_details.parameters,</a>
<a name="ln643">                                                        &amp;magic_details.parameters,</a>
<a name="ln644">                                                        &amp;equalize_shadow.parameters,</a>
<a name="ln645">                                                        &amp;pop_shadows.parameters,</a>
<a name="ln646">                                                        &amp;light_glow.parameters,</a>
<a name="ln647">                                                        &amp;sepia.parameters,</a>
<a name="ln648">                                                        &amp;film_emulation.parameters,</a>
<a name="ln649">                                                        &amp;custom_film_emulation.parameters,</a>
<a name="ln650">                                                        &amp;add_grain.parameters,</a>
<a name="ln651">                                                        &amp;lomo.parameters,</a>
<a name="ln652">                                                        &amp;expert_mode.parameters };</a>
<a name="ln653">  dt_pthread_mutex_t lock;</a>
<a name="ln654">  dt_iop_gmic_gui_data_t() = default;</a>
<a name="ln655">  dt_iop_gmic_gui_data_t(const dt_iop_gmic_gui_data_t &amp;) = delete;</a>
<a name="ln656">  void operator=(const dt_iop_gmic_gui_data_t &amp;) = delete;</a>
<a name="ln657">};</a>
<a name="ln658"> </a>
<a name="ln659">struct dt_iop_gmic_global_data_t</a>
<a name="ln660">{</a>
<a name="ln661">};</a>
<a name="ln662"> </a>
<a name="ln663">extern &quot;C&quot; const char *name()</a>
<a name="ln664">{</a>
<a name="ln665">  return _(&quot;G'MIC&quot;);</a>
<a name="ln666">}</a>
<a name="ln667"> </a>
<a name="ln668">extern &quot;C&quot; int flags()</a>
<a name="ln669">{</a>
<a name="ln670">  return IOP_FLAGS_INCLUDE_IN_STYLES | IOP_FLAGS_SUPPORTS_BLENDING;</a>
<a name="ln671">}</a>
<a name="ln672"> </a>
<a name="ln673">extern &quot;C&quot; int default_group()</a>
<a name="ln674">{</a>
<a name="ln675">  return IOP_GROUP_EFFECT;</a>
<a name="ln676">}</a>
<a name="ln677"> </a>
<a name="ln678">extern &quot;C&quot; void init_pipe(dt_iop_module_t *self, dt_dev_pixelpipe_t *pipe, dt_dev_pixelpipe_iop_t *piece)</a>
<a name="ln679">{</a>
<a name="ln680">  piece-&gt;data = std::calloc(1, sizeof(dt_iop_gmic_data_t));</a>
<a name="ln681">  self-&gt;commit_params(self, self-&gt;default_params, pipe, piece);</a>
<a name="ln682">}</a>
<a name="ln683"> </a>
<a name="ln684">extern &quot;C&quot; void cleanup_pipe(dt_iop_module_t *self, dt_dev_pixelpipe_t *pipe, dt_dev_pixelpipe_iop_t *piece)</a>
<a name="ln685">{</a>
<a name="ln686">  std::free(piece-&gt;data);</a>
<a name="ln687">  piece-&gt;data = nullptr;</a>
<a name="ln688">}</a>
<a name="ln689"> </a>
<a name="ln690">extern &quot;C&quot; void init_global(dt_iop_module_so_t *self)</a>
<a name="ln691">{</a>
<a name="ln692">  self-&gt;data = nullptr;</a>
<a name="ln693">}</a>
<a name="ln694"> </a>
<a name="ln695">extern &quot;C&quot; void cleanup_global(dt_iop_module_so_t *self)</a>
<a name="ln696">{</a>
<a name="ln697">}</a>
<a name="ln698"> </a>
<a name="ln699">extern &quot;C&quot; void init(dt_iop_module_t *self)</a>
<a name="ln700">{</a>
<a name="ln701">  self-&gt;params = std::calloc(1, sizeof(dt_iop_gmic_params_t));</a>
<a name="ln702">  self-&gt;default_params = std::calloc(1, sizeof(dt_iop_gmic_params_t));</a>
<a name="ln703">  self-&gt;default_enabled = 0;</a>
<a name="ln704">  self-&gt;priority = 998; // module order created by iop_dependencies.py, do not edit!</a>
<a name="ln705">  self-&gt;params_size = sizeof(dt_iop_gmic_params_t);</a>
<a name="ln706">  self-&gt;gui_data = nullptr;</a>
<a name="ln707">  dt_iop_gmic_params_t tmp{ none, &quot;&quot; };</a>
<a name="ln708">  std::memcpy(self-&gt;params, &amp;tmp, sizeof(dt_iop_gmic_params_t));</a>
<a name="ln709">  std::memcpy(self-&gt;default_params, &amp;tmp, sizeof(dt_iop_gmic_params_t));</a>
<a name="ln710">}</a>
<a name="ln711"> </a>
<a name="ln712">extern &quot;C&quot; void cleanup(dt_iop_module_t *self)</a>
<a name="ln713">{</a>
<a name="ln714">  std::free(self-&gt;params);</a>
<a name="ln715">  self-&gt;params = nullptr;</a>
<a name="ln716">}</a>
<a name="ln717"> </a>
<a name="ln718">static void filter_callback(GtkWidget *w, dt_iop_module_t *self);</a>
<a name="ln719"> </a>
<a name="ln720">extern &quot;C&quot; void gui_init(dt_iop_module_t *self)</a>
<a name="ln721">{</a>
<a name="ln722">  self-&gt;gui_data = new dt_iop_gmic_gui_data_t;</a>
<a name="ln723">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln724">  self-&gt;widget = gtk_box_new(GTK_ORIENTATION_VERTICAL, DT_BAUHAUS_SPACE);</a>
<a name="ln725">  g-&gt;gmic_filter = dt_bauhaus_combobox_new(self);</a>
<a name="ln726">  dt_bauhaus_widget_set_label(g-&gt;gmic_filter, NULL, _(&quot;G'MIC filter&quot;));</a>
<a name="ln727">  gtk_widget_set_tooltip_text(g-&gt;gmic_filter, _(&quot;choose an image processing filter&quot;));</a>
<a name="ln728">  gtk_box_pack_start(GTK_BOX(self-&gt;widget), g-&gt;gmic_filter, TRUE, TRUE, 0);</a>
<a name="ln729">  g_signal_connect(G_OBJECT(g-&gt;gmic_filter), &quot;value-changed&quot;, G_CALLBACK(filter_callback), self);</a>
<a name="ln730">  for(const auto f : g-&gt;filter_list) f-&gt;gui_init(self);</a>
<a name="ln731">  dt_pthread_mutex_init(&amp;g-&gt;lock, NULL);</a>
<a name="ln732">}</a>
<a name="ln733"> </a>
<a name="ln734">extern &quot;C&quot; void gui_update(dt_iop_module_t *self)</a>
<a name="ln735">{</a>
<a name="ln736">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln737">  dt_iop_gmic_params_t *p = reinterpret_cast&lt;dt_iop_gmic_params_t *&gt;(self-&gt;params);</a>
<a name="ln738">  auto i_filter = std::find_if(g-&gt;filter_list.begin(), g-&gt;filter_list.end(),</a>
<a name="ln739">                               [p](parameter_interface *i) { return p-&gt;filter == i-&gt;get_filter(); });</a>
<a name="ln740">  if(i_filter != g-&gt;filter_list.end()) dt_bauhaus_combobox_set(g-&gt;gmic_filter, i_filter - g-&gt;filter_list.begin());</a>
<a name="ln741">  for(const auto f : g-&gt;filter_list) f-&gt;gui_update(self);</a>
<a name="ln742">}</a>
<a name="ln743"> </a>
<a name="ln744">extern &quot;C&quot; void gui_reset(dt_iop_module_t *self)</a>
<a name="ln745">{</a>
<a name="ln746">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln747">  for(const auto f : g-&gt;filter_list) f-&gt;gui_reset(self);</a>
<a name="ln748">}</a>
<a name="ln749"> </a>
<a name="ln750">extern &quot;C&quot; void gui_cleanup(dt_iop_module_t *self)</a>
<a name="ln751">{</a>
<a name="ln752">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln753">  dt_pthread_mutex_destroy(&amp;g-&gt;lock);</a>
<a name="ln754">  delete g;</a>
<a name="ln755">  self-&gt;gui_data = nullptr;</a>
<a name="ln756">}</a>
<a name="ln757"> </a>
<a name="ln758">extern &quot;C&quot; void process(dt_iop_module_t *self, dt_dev_pixelpipe_iop_t *piece, const void *const ivoid,</a>
<a name="ln759">                        void *const ovoid, const dt_iop_roi_t *const roi_in, const dt_iop_roi_t *const roi_out)</a>
<a name="ln760">{</a>
<a name="ln761">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln762">  static const std::string gmic_custom_commands = [g] {</a>
<a name="ln763">    std::string res;</a>
<a name="ln764">    res += dt_iop_gmic_none_params_t::get_custom_command();</a>
<a name="ln765">    res += dt_iop_gmic_expert_mode_params_t::get_custom_command();</a>
<a name="ln766">    res += dt_iop_gmic_sepia_params_t::get_custom_command();</a>
<a name="ln767">    res += dt_iop_gmic_film_emulation_params_t::get_custom_command();</a>
<a name="ln768">    res += dt_iop_gmic_custom_film_emulation_params_t::get_custom_command();</a>
<a name="ln769">    res += dt_iop_gmic_freaky_details_params_t::get_custom_command();</a>
<a name="ln770">    res += dt_iop_gmic_sharpen_Richardson_Lucy_params_t::get_custom_command();</a>
<a name="ln771">    res += dt_iop_gmic_sharpen_Gold_Meinel_params_t::get_custom_command();</a>
<a name="ln772">    res += dt_iop_gmic_sharpen_inverse_diffusion_params_t::get_custom_command();</a>
<a name="ln773">    res += dt_iop_gmic_magic_details_params_t::get_custom_command();</a>
<a name="ln774">    res += dt_iop_gmic_basic_color_adjustments_params_t::get_custom_command();</a>
<a name="ln775">    res += dt_iop_gmic_equalize_shadow_params_t::get_custom_command();</a>
<a name="ln776">    res += dt_iop_gmic_add_grain_params_t::get_custom_command();</a>
<a name="ln777">    res += dt_iop_gmic_pop_shadows_params_t::get_custom_command();</a>
<a name="ln778">    res += dt_iop_gmic_smooth_bilateral_params_t::get_custom_command();</a>
<a name="ln779">    res += dt_iop_gmic_smooth_guided_params_t::get_custom_command();</a>
<a name="ln780">    res += dt_iop_gmic_light_glow_params_t::get_custom_command();</a>
<a name="ln781">    res += dt_iop_gmic_lomo_params_t::get_custom_command();</a>
<a name="ln782">    return res;</a>
<a name="ln783">  }();</a>
<a name="ln784"> </a>
<a name="ln785">  const std::size_t ch = piece-&gt;colors;</a>
<a name="ln786">  const std::size_t width = roi_in-&gt;width;</a>
<a name="ln787">  const std::size_t height = roi_in-&gt;height;</a>
<a name="ln788"> </a>
<a name="ln789">  cimg_library::CImg&lt;float&gt; in_img(width, height, 1, 3);</a>
<a name="ln790">  for(std::size_t j = 0; j &lt; height; ++j)</a>
<a name="ln791">    for(std::size_t i = 0; i &lt; width; ++i)</a>
<a name="ln792">    {</a>
<a name="ln793">      const float *pixel_in = reinterpret_cast&lt;const float *&gt;(ivoid) + (j * width + i) * ch;</a>
<a name="ln794">      in_img(i, j, 0, 0) = pixel_in[0] * 255;</a>
<a name="ln795">      in_img(i, j, 0, 1) = pixel_in[1] * 255;</a>
<a name="ln796">      in_img(i, j, 0, 2) = pixel_in[2] * 255;</a>
<a name="ln797">    }</a>
<a name="ln798">  cimg_library::CImgList&lt;float&gt; image_list;</a>
<a name="ln799">  in_img.move_to(image_list);</a>
<a name="ln800">  cimg_library::CImgList&lt;char&gt; image_names;</a>
<a name="ln801">  cimg_library::CImg&lt;char&gt;::string(&quot;input image&quot;).move_to(image_names);</a>
<a name="ln802">  dt_iop_gmic_params_t *p = reinterpret_cast&lt;dt_iop_gmic_params_t *&gt;(piece-&gt;data);</a>
<a name="ln803">  if(g != nullptr and p-&gt;filter == custom_film_emulation) dt_pthread_mutex_lock(&amp;g-&gt;lock);</a>
<a name="ln804">  try</a>
<a name="ln805">  {</a>
<a name="ln806">    std::cerr &lt;&lt; &quot;### G'MIC : &quot; &lt;&lt; p-&gt;parameters &lt;&lt; std::endl;</a>
<a name="ln807">    gmic(p-&gt;parameters, image_list, image_names, gmic_custom_commands.c_str());</a>
<a name="ln808">  }</a>
<a name="ln809">  catch(gmic_exception &amp;e)</a>
<a name="ln810">  {</a>
<a name="ln811">    if(piece-&gt;pipe-&gt;type == DT_DEV_PIXELPIPE_FULL || piece-&gt;pipe-&gt;type == DT_DEV_PIXELPIPE_PREVIEW)</a>
<a name="ln812">      dt_control_log(&quot;G'MIC error: %s&quot;, e.what());</a>
<a name="ln813">  }</a>
<a name="ln814">  if(g != nullptr and p-&gt;filter == custom_film_emulation) dt_pthread_mutex_unlock(&amp;g-&gt;lock);</a>
<a name="ln815">  const cimg_library::CImg&lt;float&gt; &amp;out_img(image_list[0]);</a>
<a name="ln816">  auto ch_out_img = out_img._spectrum;</a>
<a name="ln817">  for(std::size_t j = 0; j &lt; std::min(height, static_cast&lt;std::size_t&gt;(out_img._height)); ++j)</a>
<a name="ln818">  {</a>
<a name="ln819">    for(std::size_t i = 0; i &lt; std::min(width, static_cast&lt;std::size_t&gt;(out_img._width)); ++i)</a>
<a name="ln820">    {</a>
<a name="ln821">      float *pixel_out = reinterpret_cast&lt;float *&gt;(ovoid) + (j * width + i) * ch;</a>
<a name="ln822">      pixel_out[0] = ch_out_img &gt; 0 ? out_img(i, j, 0, 0) / 255 : 0.f;</a>
<a name="ln823">      pixel_out[1] = ch_out_img &gt; 1 ? out_img(i, j, 0, 1) / 255 : 0.f;</a>
<a name="ln824">      pixel_out[2] = ch_out_img &gt; 2 ? out_img(i, j, 0, 2) / 255 : 0.f;</a>
<a name="ln825">    }</a>
<a name="ln826">    for(std::size_t i = std::min(width, static_cast&lt;std::size_t&gt;(out_img._width)); i &lt; width; ++i)</a>
<a name="ln827">    {</a>
<a name="ln828">      float *pixel_out = reinterpret_cast&lt;float *&gt;(ovoid) + (j * width + i) * ch;</a>
<a name="ln829">      pixel_out[0] = 0;</a>
<a name="ln830">      pixel_out[1] = 0;</a>
<a name="ln831">      pixel_out[2] = 0;</a>
<a name="ln832">    }</a>
<a name="ln833">  }</a>
<a name="ln834">  for(std::size_t j = std::min(height, static_cast&lt;std::size_t&gt;(out_img._height)); j &lt; height; ++j)</a>
<a name="ln835">    for(std::size_t i = 0; i &lt; width; ++i)</a>
<a name="ln836">    {</a>
<a name="ln837">      float *pixel_out = reinterpret_cast&lt;float *&gt;(ovoid) + (j * width + i) * ch;</a>
<a name="ln838">      pixel_out[0] = 0;</a>
<a name="ln839">      pixel_out[1] = 0;</a>
<a name="ln840">      pixel_out[2] = 0;</a>
<a name="ln841">    }</a>
<a name="ln842"> </a>
<a name="ln843">  if(piece-&gt;pipe-&gt;mask_display &amp; DT_DEV_PIXELPIPE_DISPLAY_MASK)</a>
<a name="ln844">    dt_iop_alpha_copy(ivoid, ovoid, roi_out-&gt;width, roi_out-&gt;height);</a>
<a name="ln845">}</a>
<a name="ln846"> </a>
<a name="ln847">// --- helper funcions</a>
<a name="ln848"> </a>
<a name="ln849">template &lt;typename T&gt; T clamp(const T a, const T b, const T x)</a>
<a name="ln850">{</a>
<a name="ln851">  return std::min(b, std::max(a, x));</a>
<a name="ln852">}</a>
<a name="ln853"> </a>
<a name="ln854"> </a>
<a name="ln855">template &lt;typename F&gt; void callback(GtkWidget *w, dt_iop_module_t *self, F f)</a>
<a name="ln856">{</a>
<a name="ln857">  if(self-&gt;dt-&gt;gui-&gt;reset) return;</a>
<a name="ln858">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln859">  dt_iop_gmic_params_t *p = reinterpret_cast&lt;dt_iop_gmic_params_t *&gt;(self-&gt;params);</a>
<a name="ln860">  *p = f(g, w);</a>
<a name="ln861">  dt_dev_add_history_item(darktable.develop, self, TRUE);</a>
<a name="ln862">}</a>
<a name="ln863"> </a>
<a name="ln864"> </a>
<a name="ln865">static const std::vector&lt;const char *&gt; color_channels{ _(&quot;all&quot;),</a>
<a name="ln866">                                                       _(&quot;RGBA (all)&quot;),</a>
<a name="ln867">                                                       _(&quot;RGB (all)&quot;),</a>
<a name="ln868">                                                       _(&quot;RGB (red)&quot;),</a>
<a name="ln869">                                                       _(&quot;RGB (green)&quot;),</a>
<a name="ln870">                                                       _(&quot;RGB (blue)&quot;),</a>
<a name="ln871">                                                       _(&quot;RGBA (alpha)&quot;),</a>
<a name="ln872">                                                       _(&quot;linear RGB (all)&quot;),</a>
<a name="ln873">                                                       _(&quot;linear RGB (red)&quot;),</a>
<a name="ln874">                                                       _(&quot;linear RGB (green)&quot;),</a>
<a name="ln875">                                                       _(&quot;linear RGB (blue)&quot;),</a>
<a name="ln876">                                                       _(&quot;YCbCr (luminance)&quot;),</a>
<a name="ln877">                                                       _(&quot;YCbCr (blue-red chrominances)&quot;),</a>
<a name="ln878">                                                       _(&quot;YCbCr (blue chrominance)&quot;),</a>
<a name="ln879">                                                       _(&quot;YCbCr (red chrominance)&quot;),</a>
<a name="ln880">                                                       _(&quot;YCbCr (green chrominance)&quot;),</a>
<a name="ln881">                                                       _(&quot;Lab (lightness)&quot;),</a>
<a name="ln882">                                                       _(&quot;Lab (ab-chrominances)&quot;),</a>
<a name="ln883">                                                       _(&quot;Lab (a-chrominance)&quot;),</a>
<a name="ln884">                                                       _(&quot;Lab (b-chrominance)&quot;),</a>
<a name="ln885">                                                       _(&quot;Lch (ch-chrominances)&quot;),</a>
<a name="ln886">                                                       _(&quot;Lch (c-chrominance)&quot;),</a>
<a name="ln887">                                                       _(&quot;Lch (h-chrominance)&quot;),</a>
<a name="ln888">                                                       _(&quot;HSV (hue)&quot;),</a>
<a name="ln889">                                                       _(&quot;HSV (saturation)&quot;),</a>
<a name="ln890">                                                       _(&quot;HSV (value)&quot;),</a>
<a name="ln891">                                                       _(&quot;HSI (intensity)&quot;),</a>
<a name="ln892">                                                       _(&quot;HSL (lightness)&quot;),</a>
<a name="ln893">                                                       _(&quot;CMYK (cyan)&quot;),</a>
<a name="ln894">                                                       _(&quot;CMYK (magenta)&quot;),</a>
<a name="ln895">                                                       _(&quot;CMYK (yellow)&quot;),</a>
<a name="ln896">                                                       _(&quot;CMYK (key)&quot;),</a>
<a name="ln897">                                                       _(&quot;YIQ (luma)&quot;),</a>
<a name="ln898">                                                       _(&quot;YIQ (chromas)&quot;) };</a>
<a name="ln899"> </a>
<a name="ln900"> </a>
<a name="ln901">void filter_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln902">{</a>
<a name="ln903">  dt_iop_gmic_params_t *p = reinterpret_cast&lt;dt_iop_gmic_params_t *&gt;(self-&gt;params);</a>
<a name="ln904">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln905">  *p = g-&gt;filter_list[dt_bauhaus_combobox_get(w)]-&gt;to_gmic_params();</a>
<a name="ln906">  for(const auto f : g-&gt;filter_list) f-&gt;gui_update(self);</a>
<a name="ln907">  dt_dev_add_history_item(darktable.develop, self, TRUE);</a>
<a name="ln908">}</a>
<a name="ln909"> </a>
<a name="ln910">// --- none filter</a>
<a name="ln911"> </a>
<a name="ln912">dt_iop_gmic_none_params_t::dt_iop_gmic_none_params_t(const dt_iop_gmic_params_t &amp;) : dt_iop_gmic_none_params_t()</a>
<a name="ln913">{</a>
<a name="ln914">}</a>
<a name="ln915"> </a>
<a name="ln916">dt_iop_gmic_params_t dt_iop_gmic_none_params_t::to_gmic_params() const</a>
<a name="ln917">{</a>
<a name="ln918">  dt_iop_gmic_params_t ret;</a>
<a name="ln919">  ret.filter = none;</a>
<a name="ln920">  std::snprintf(ret.parameters, sizeof(ret.parameters), &quot;%s&quot;, &quot;&quot;);</a>
<a name="ln921">  return ret;</a>
<a name="ln922">}</a>
<a name="ln923"> </a>
<a name="ln924">const char *dt_iop_gmic_none_params_t::get_custom_command()</a>
<a name="ln925">{</a>
<a name="ln926">  return &quot;&quot;;</a>
<a name="ln927">}</a>
<a name="ln928"> </a>
<a name="ln929">filter_type dt_iop_gmic_none_params_t::get_filter() const</a>
<a name="ln930">{</a>
<a name="ln931">  return none;</a>
<a name="ln932">}</a>
<a name="ln933"> </a>
<a name="ln934">void dt_iop_gmic_none_params_t::gui_init(dt_iop_module_t *self) const</a>
<a name="ln935">{</a>
<a name="ln936">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln937">  dt_bauhaus_combobox_add(g-&gt;gmic_filter, _(&quot;none&quot;));</a>
<a name="ln938">  g-&gt;none.parameters = dt_iop_gmic_none_params_t();</a>
<a name="ln939">}</a>
<a name="ln940"> </a>
<a name="ln941">void dt_iop_gmic_none_params_t::gui_update(dt_iop_module_t *self) const</a>
<a name="ln942">{</a>
<a name="ln943">}</a>
<a name="ln944"> </a>
<a name="ln945">void dt_iop_gmic_none_params_t::gui_reset(dt_iop_module_t *self)</a>
<a name="ln946">{</a>
<a name="ln947">}</a>
<a name="ln948"> </a>
<a name="ln949">// --- expert mode filter</a>
<a name="ln950"> </a>
<a name="ln951">dt_iop_gmic_expert_mode_params_t::dt_iop_gmic_expert_mode_params_t(const dt_iop_gmic_params_t &amp;other)</a>
<a name="ln952">  : dt_iop_gmic_expert_mode_params_t()</a>
<a name="ln953">{</a>
<a name="ln954">  if(other.filter == expert_mode)</a>
<a name="ln955">    std::strncpy(command, other.parameters, std::min(sizeof(command), sizeof(other.parameters)));</a>
<a name="ln956">}</a>
<a name="ln957"> </a>
<a name="ln958">dt_iop_gmic_params_t dt_iop_gmic_expert_mode_params_t::to_gmic_params() const</a>
<a name="ln959">{</a>
<a name="ln960">  dt_iop_gmic_params_t ret;</a>
<a name="ln961">  ret.filter = expert_mode;</a>
<a name="ln962">  std::snprintf(ret.parameters, sizeof(ret.parameters), &quot;%s&quot;, command);</a>
<a name="ln963">  return ret;</a>
<a name="ln964">}</a>
<a name="ln965"> </a>
<a name="ln966">const char *dt_iop_gmic_expert_mode_params_t::get_custom_command()</a>
<a name="ln967">{</a>
<a name="ln968">  return &quot;&quot;;</a>
<a name="ln969">}</a>
<a name="ln970"> </a>
<a name="ln971">filter_type dt_iop_gmic_expert_mode_params_t::get_filter() const</a>
<a name="ln972">{</a>
<a name="ln973">  return expert_mode;</a>
<a name="ln974">}</a>
<a name="ln975"> </a>
<a name="ln976">void dt_iop_gmic_expert_mode_params_t::gui_init(dt_iop_module_t *self) const</a>
<a name="ln977">{</a>
<a name="ln978">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln979">  dt_iop_gmic_params_t *p = reinterpret_cast&lt;dt_iop_gmic_params_t *&gt;(self-&gt;params);</a>
<a name="ln980">  if(p-&gt;filter == expert_mode)</a>
<a name="ln981">    g-&gt;expert_mode.parameters = *p;</a>
<a name="ln982">  else</a>
<a name="ln983">    g-&gt;expert_mode.parameters = dt_iop_gmic_expert_mode_params_t();</a>
<a name="ln984">  dt_bauhaus_combobox_add(g-&gt;gmic_filter, _(&quot;expert mode&quot;));</a>
<a name="ln985">  g-&gt;expert_mode.box = gtk_box_new(GTK_ORIENTATION_VERTICAL, DT_BAUHAUS_SPACE);</a>
<a name="ln986">  gtk_box_pack_start(GTK_BOX(self-&gt;widget), g-&gt;expert_mode.box, TRUE, TRUE, 0);</a>
<a name="ln987"> </a>
<a name="ln988">  g-&gt;expert_mode.command = gtk_entry_new();</a>
<a name="ln989">  gtk_entry_set_text(GTK_ENTRY(g-&gt;expert_mode.command), g-&gt;expert_mode.parameters.command);</a>
<a name="ln990">  gtk_widget_set_tooltip_text(g-&gt;expert_mode.command, _(&quot;G'MIC script, confirm with enter&quot;));</a>
<a name="ln991">  gtk_entry_set_max_length(GTK_ENTRY(g-&gt;expert_mode.command), sizeof(command) - 1);</a>
<a name="ln992">  dt_gui_key_accel_block_on_focus_connect(g-&gt;expert_mode.command);</a>
<a name="ln993">  gtk_box_pack_start(GTK_BOX(g-&gt;expert_mode.box), GTK_WIDGET(g-&gt;expert_mode.command), TRUE, TRUE, 0);</a>
<a name="ln994">  g_signal_connect(G_OBJECT(g-&gt;expert_mode.command), &quot;activate&quot;,</a>
<a name="ln995">                   G_CALLBACK(dt_iop_gmic_expert_mode_params_t::command_callback), self);</a>
<a name="ln996"> </a>
<a name="ln997">  gtk_widget_show_all(g-&gt;expert_mode.box);</a>
<a name="ln998">  gtk_widget_set_no_show_all(g-&gt;expert_mode.box, TRUE);</a>
<a name="ln999">  gtk_widget_set_visible(g-&gt;expert_mode.box, p-&gt;filter == expert_mode ? TRUE : FALSE);</a>
<a name="ln1000">}</a>
<a name="ln1001"> </a>
<a name="ln1002">void dt_iop_gmic_expert_mode_params_t::gui_update(dt_iop_module_t *self) const</a>
<a name="ln1003">{</a>
<a name="ln1004">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln1005">  dt_iop_gmic_params_t *p = reinterpret_cast&lt;dt_iop_gmic_params_t *&gt;(self-&gt;params);</a>
<a name="ln1006">  gtk_widget_set_visible(g-&gt;expert_mode.box, p-&gt;filter == expert_mode ? TRUE : FALSE);</a>
<a name="ln1007">  if(p-&gt;filter == expert_mode)</a>
<a name="ln1008">  {</a>
<a name="ln1009">    g-&gt;expert_mode.parameters = *p;</a>
<a name="ln1010">    gtk_entry_set_text(GTK_ENTRY(g-&gt;expert_mode.command), g-&gt;expert_mode.parameters.command);</a>
<a name="ln1011">  }</a>
<a name="ln1012">}</a>
<a name="ln1013"> </a>
<a name="ln1014">void dt_iop_gmic_expert_mode_params_t::gui_reset(dt_iop_module_t *self)</a>
<a name="ln1015">{</a>
<a name="ln1016">  *this = dt_iop_gmic_expert_mode_params_t();</a>
<a name="ln1017">}</a>
<a name="ln1018"> </a>
<a name="ln1019">void dt_iop_gmic_expert_mode_params_t::command_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln1020">{</a>
<a name="ln1021">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln1022">    std::snprintf(G-&gt;expert_mode.parameters.command, sizeof(G-&gt;expert_mode.parameters.command), &quot;%s&quot;,</a>
<a name="ln1023">                  gtk_entry_get_text(GTK_ENTRY(W)));</a>
<a name="ln1024">    return G-&gt;expert_mode.parameters.to_gmic_params();</a>
<a name="ln1025">  });</a>
<a name="ln1026">}</a>
<a name="ln1027"> </a>
<a name="ln1028">// --- sepia filter</a>
<a name="ln1029"> </a>
<a name="ln1030">dt_iop_gmic_sepia_params_t::dt_iop_gmic_sepia_params_t(const dt_iop_gmic_params_t &amp;other)</a>
<a name="ln1031">  : dt_iop_gmic_sepia_params_t()</a>
<a name="ln1032">{</a>
<a name="ln1033">  dt_iop_gmic_sepia_params_t p;</a>
<a name="ln1034">  if(other.filter == sepia</a>
<a name="ln1035">     and std::sscanf(other.parameters, &quot;dt_sepia %g,%g,%g&quot;, &amp;p.brightness, &amp;p.contrast, &amp;p.gamma) == 3)</a>
<a name="ln1036">  {</a>
<a name="ln1037">    p.brightness = clamp(-1.f, 1.f, p.brightness);</a>
<a name="ln1038">    p.contrast = clamp(-1.f, 1.f, p.contrast);</a>
<a name="ln1039">    p.gamma = clamp(-1.f, 1.f, p.gamma);</a>
<a name="ln1040">    *this = p;</a>
<a name="ln1041">  }</a>
<a name="ln1042">}</a>
<a name="ln1043"> </a>
<a name="ln1044">dt_iop_gmic_params_t dt_iop_gmic_sepia_params_t::to_gmic_params() const</a>
<a name="ln1045">{</a>
<a name="ln1046">  dt_iop_gmic_params_t ret;</a>
<a name="ln1047">  ret.filter = sepia;</a>
<a name="ln1048">  std::snprintf(ret.parameters, sizeof(ret.parameters), &quot;dt_sepia %g,%g,%g&quot;, brightness, contrast, gamma);</a>
<a name="ln1049">  return ret;</a>
<a name="ln1050">}</a>
<a name="ln1051"> </a>
<a name="ln1052">const char *dt_iop_gmic_sepia_params_t::get_custom_command() {</a>
<a name="ln1053">  // clang-format off</a>
<a name="ln1054">  return R&quot;raw(</a>
<a name="ln1055">dt_sepia :</a>
<a name="ln1056">  sepia adjust_colors {100*$1},{100*$2},{100*$3},0,0,0,255</a>
<a name="ln1057">)raw&quot;;</a>
<a name="ln1058">  // clang-format on</a>
<a name="ln1059">}</a>
<a name="ln1060"> </a>
<a name="ln1061">filter_type dt_iop_gmic_sepia_params_t::get_filter() const</a>
<a name="ln1062">{</a>
<a name="ln1063">  return sepia;</a>
<a name="ln1064">}</a>
<a name="ln1065"> </a>
<a name="ln1066">void dt_iop_gmic_sepia_params_t::gui_init(dt_iop_module_t *self) const</a>
<a name="ln1067">{</a>
<a name="ln1068">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln1069">  dt_iop_gmic_params_t *p = reinterpret_cast&lt;dt_iop_gmic_params_t *&gt;(self-&gt;params);</a>
<a name="ln1070">  if(p-&gt;filter == sepia)</a>
<a name="ln1071">    g-&gt;sepia.parameters = *p;</a>
<a name="ln1072">  else</a>
<a name="ln1073">    g-&gt;sepia.parameters = dt_iop_gmic_sepia_params_t();</a>
<a name="ln1074">  dt_bauhaus_combobox_add(g-&gt;gmic_filter, _(&quot;sepia&quot;));</a>
<a name="ln1075">  g-&gt;sepia.box = gtk_box_new(GTK_ORIENTATION_VERTICAL, DT_BAUHAUS_SPACE);</a>
<a name="ln1076">  gtk_box_pack_start(GTK_BOX(self-&gt;widget), g-&gt;sepia.box, TRUE, TRUE, 0);</a>
<a name="ln1077"> </a>
<a name="ln1078">  g-&gt;sepia.brightness = dt_bauhaus_slider_new_with_range(self, -1, 1, 0.01, g-&gt;sepia.parameters.brightness, 3);</a>
<a name="ln1079">  dt_bauhaus_widget_set_label(g-&gt;sepia.brightness, NULL, _(&quot;brightness&quot;));</a>
<a name="ln1080">  gtk_widget_set_tooltip_text(g-&gt;sepia.brightness, _(&quot;brightness of the sepia effect&quot;));</a>
<a name="ln1081">  gtk_box_pack_start(GTK_BOX(g-&gt;sepia.box), GTK_WIDGET(g-&gt;sepia.brightness), TRUE, TRUE, 0);</a>
<a name="ln1082">  g_signal_connect(G_OBJECT(g-&gt;sepia.brightness), &quot;value-changed&quot;,</a>
<a name="ln1083">                   G_CALLBACK(dt_iop_gmic_sepia_params_t::brightness_callback), self);</a>
<a name="ln1084"> </a>
<a name="ln1085">  g-&gt;sepia.contrast = dt_bauhaus_slider_new_with_range(self, -1, 1, 0.01, g-&gt;sepia.parameters.contrast, 3);</a>
<a name="ln1086">  dt_bauhaus_widget_set_label(g-&gt;sepia.contrast, NULL, _(&quot;contrast&quot;));</a>
<a name="ln1087">  gtk_widget_set_tooltip_text(g-&gt;sepia.contrast, _(&quot;contrast of the sepia effect&quot;));</a>
<a name="ln1088">  gtk_box_pack_start(GTK_BOX(g-&gt;sepia.box), GTK_WIDGET(g-&gt;sepia.contrast), TRUE, TRUE, 0);</a>
<a name="ln1089">  g_signal_connect(G_OBJECT(g-&gt;sepia.contrast), &quot;value-changed&quot;,</a>
<a name="ln1090">                   G_CALLBACK(dt_iop_gmic_sepia_params_t::contrast_callback), self);</a>
<a name="ln1091"> </a>
<a name="ln1092">  g-&gt;sepia.gamma = dt_bauhaus_slider_new_with_range(self, -1, 1, 0.01, g-&gt;sepia.parameters.gamma, 3);</a>
<a name="ln1093">  dt_bauhaus_widget_set_label(g-&gt;sepia.gamma, NULL, _(&quot;gamma&quot;));</a>
<a name="ln1094">  gtk_widget_set_tooltip_text(g-&gt;sepia.gamma, _(&quot;gamma value of the sepia effect&quot;));</a>
<a name="ln1095">  gtk_box_pack_start(GTK_BOX(g-&gt;sepia.box), GTK_WIDGET(g-&gt;sepia.gamma), TRUE, TRUE, 0);</a>
<a name="ln1096">  g_signal_connect(G_OBJECT(g-&gt;sepia.gamma), &quot;value-changed&quot;,</a>
<a name="ln1097">                   G_CALLBACK(dt_iop_gmic_sepia_params_t::gamma_callback), self);</a>
<a name="ln1098"> </a>
<a name="ln1099">  gtk_widget_show_all(g-&gt;sepia.box);</a>
<a name="ln1100">  gtk_widget_set_no_show_all(g-&gt;sepia.box, TRUE);</a>
<a name="ln1101">  gtk_widget_set_visible(g-&gt;sepia.box, p-&gt;filter == sepia ? TRUE : FALSE);</a>
<a name="ln1102">}</a>
<a name="ln1103"> </a>
<a name="ln1104">void dt_iop_gmic_sepia_params_t::gui_update(dt_iop_module_t *self) const</a>
<a name="ln1105">{</a>
<a name="ln1106">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln1107">  dt_iop_gmic_params_t *p = reinterpret_cast&lt;dt_iop_gmic_params_t *&gt;(self-&gt;params);</a>
<a name="ln1108">  gtk_widget_set_visible(g-&gt;sepia.box, p-&gt;filter == sepia ? TRUE : FALSE);</a>
<a name="ln1109">  if(p-&gt;filter == sepia)</a>
<a name="ln1110">  {</a>
<a name="ln1111">    g-&gt;sepia.parameters = *p;</a>
<a name="ln1112">    dt_bauhaus_slider_set(g-&gt;sepia.brightness, g-&gt;sepia.parameters.brightness);</a>
<a name="ln1113">    dt_bauhaus_slider_set(g-&gt;sepia.contrast, g-&gt;sepia.parameters.contrast);</a>
<a name="ln1114">    dt_bauhaus_slider_set(g-&gt;sepia.gamma, g-&gt;sepia.parameters.gamma);</a>
<a name="ln1115">  }</a>
<a name="ln1116">}</a>
<a name="ln1117"> </a>
<a name="ln1118">void dt_iop_gmic_sepia_params_t::gui_reset(dt_iop_module_t *self)</a>
<a name="ln1119">{</a>
<a name="ln1120">  *this = dt_iop_gmic_sepia_params_t();</a>
<a name="ln1121">}</a>
<a name="ln1122"> </a>
<a name="ln1123">void dt_iop_gmic_sepia_params_t::brightness_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln1124">{</a>
<a name="ln1125">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln1126">    G-&gt;sepia.parameters.brightness = dt_bauhaus_slider_get(W);</a>
<a name="ln1127">    return G-&gt;sepia.parameters.to_gmic_params();</a>
<a name="ln1128">  });</a>
<a name="ln1129">}</a>
<a name="ln1130"> </a>
<a name="ln1131">void dt_iop_gmic_sepia_params_t::contrast_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln1132">{</a>
<a name="ln1133">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln1134">    G-&gt;sepia.parameters.contrast = dt_bauhaus_slider_get(W);</a>
<a name="ln1135">    return G-&gt;sepia.parameters.to_gmic_params();</a>
<a name="ln1136">  });</a>
<a name="ln1137">}</a>
<a name="ln1138"> </a>
<a name="ln1139">void dt_iop_gmic_sepia_params_t::gamma_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln1140">{</a>
<a name="ln1141">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln1142">    G-&gt;sepia.parameters.gamma = dt_bauhaus_slider_get(W);</a>
<a name="ln1143">    return G-&gt;sepia.parameters.to_gmic_params();</a>
<a name="ln1144">  });</a>
<a name="ln1145">}</a>
<a name="ln1146"> </a>
<a name="ln1147">// --- film emulation filter</a>
<a name="ln1148"> </a>
<a name="ln1149">dt_iop_gmic_film_emulation_params_t::dt_iop_gmic_film_emulation_params_t(const dt_iop_gmic_params_t &amp;other)</a>
<a name="ln1150">  : dt_iop_gmic_film_emulation_params_t()</a>
<a name="ln1151">{</a>
<a name="ln1152">  dt_iop_gmic_film_emulation_params_t p;</a>
<a name="ln1153">  if(other.filter == film_emulation</a>
<a name="ln1154">     and std::sscanf(other.parameters, &quot;dt_film_emulation \&quot;%127[^\&quot;]\&quot;,%g,%g,%g,%g,%g,%g,%i&quot;,</a>
<a name="ln1155">                     reinterpret_cast&lt;char *&gt;(&amp;p.film), &amp;p.strength, &amp;p.brightness, &amp;p.contrast, &amp;p.gamma, &amp;p.hue,</a>
<a name="ln1156">                     &amp;p.saturation, &amp;p.normalize_colors)</a>
<a name="ln1157">             == 8)</a>
<a name="ln1158">  {</a>
<a name="ln1159">    p.strength = clamp(0.f, 1.f, p.strength);</a>
<a name="ln1160">    p.brightness = clamp(-1.f, 1.f, p.brightness);</a>
<a name="ln1161">    p.contrast = clamp(-1.f, 1.f, p.contrast);</a>
<a name="ln1162">    p.gamma = clamp(-1.f, 1.f, p.gamma);</a>
<a name="ln1163">    p.hue = clamp(-1.f, 1.f, p.hue);</a>
<a name="ln1164">    p.saturation = clamp(-1.f, 1.f, p.saturation);</a>
<a name="ln1165">    p.normalize_colors = clamp(0, 1, p.normalize_colors);</a>
<a name="ln1166">    *this = p;</a>
<a name="ln1167">  }</a>
<a name="ln1168">}</a>
<a name="ln1169"> </a>
<a name="ln1170">dt_iop_gmic_params_t dt_iop_gmic_film_emulation_params_t::to_gmic_params() const</a>
<a name="ln1171">{</a>
<a name="ln1172">  dt_iop_gmic_params_t ret;</a>
<a name="ln1173">  ret.filter = film_emulation;</a>
<a name="ln1174">  std::snprintf(ret.parameters, sizeof(ret.parameters), &quot;dt_film_emulation \&quot;%s\&quot;,%g,%g,%g,%g,%g,%g,%i&quot;, film,</a>
<a name="ln1175">                strength, brightness, contrast, gamma, hue, saturation, normalize_colors);</a>
<a name="ln1176">  return ret;</a>
<a name="ln1177">}</a>
<a name="ln1178"> </a>
<a name="ln1179">const char *dt_iop_gmic_film_emulation_params_t::get_custom_command()</a>
<a name="ln1180">{</a>
<a name="ln1181">  // clang-format off</a>
<a name="ln1182">  return R&quot;raw(</a>
<a name="ln1183">dt_film_emulation :</a>
<a name="ln1184">  clut &quot;$1&quot;</a>
<a name="ln1185">  repeat {$!-1}</a>
<a name="ln1186">    if {$8%2} balance_gamma[$&gt;] , fi</a>
<a name="ln1187">    if {$2&lt;1} +map_clut[$&gt;] . j[$&gt;] .,0,0,0,0,{$2} rm.</a>
<a name="ln1188">    else map_clut[$&gt;] .</a>
<a name="ln1189">    fi</a>
<a name="ln1190">  done</a>
<a name="ln1191">  rm.</a>
<a name="ln1192">  adjust_colors {100*$3},{100*$4},{100*$5},{100*$6},{100*$7},0,255</a>
<a name="ln1193">  if {$8&gt;1} repeat $! l[$&gt;] split_opacity n[0] 0,255 a c endl done fi</a>
<a name="ln1194">)raw&quot;;</a>
<a name="ln1195">  // clang-format on</a>
<a name="ln1196">}</a>
<a name="ln1197"> </a>
<a name="ln1198">filter_type dt_iop_gmic_film_emulation_params_t::get_filter() const</a>
<a name="ln1199">{</a>
<a name="ln1200">  return film_emulation;</a>
<a name="ln1201">}</a>
<a name="ln1202"> </a>
<a name="ln1203">void dt_iop_gmic_film_emulation_params_t::gui_init(dt_iop_module_t *self) const</a>
<a name="ln1204">{</a>
<a name="ln1205">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln1206">  dt_iop_gmic_params_t *p = reinterpret_cast&lt;dt_iop_gmic_params_t *&gt;(self-&gt;params);</a>
<a name="ln1207">  if(p-&gt;filter == film_emulation)</a>
<a name="ln1208">    g-&gt;film_emulation.parameters = *p;</a>
<a name="ln1209">  else</a>
<a name="ln1210">    g-&gt;film_emulation.parameters = dt_iop_gmic_film_emulation_params_t();</a>
<a name="ln1211">  dt_bauhaus_combobox_add(g-&gt;gmic_filter, _(&quot;film emulation&quot;));</a>
<a name="ln1212">  g-&gt;film_emulation.box = gtk_box_new(GTK_ORIENTATION_VERTICAL, DT_BAUHAUS_SPACE);</a>
<a name="ln1213">  gtk_box_pack_start(GTK_BOX(self-&gt;widget), g-&gt;film_emulation.box, TRUE, TRUE, 0);</a>
<a name="ln1214"> </a>
<a name="ln1215">  g-&gt;film_emulation.film = dt_bauhaus_combobox_new(self);</a>
<a name="ln1216">  for(const auto &amp;film_map : film_maps)</a>
<a name="ln1217">  {</a>
<a name="ln1218">    dt_bauhaus_combobox_add_aligned(g-&gt;film_emulation.film, film_map.printable.c_str(),</a>
<a name="ln1219">                                    DT_BAUHAUS_COMBOBOX_ALIGN_LEFT);</a>
<a name="ln1220">    g-&gt;film_emulation.film_list.push_back(film_map.film_type);</a>
<a name="ln1221">  }</a>
<a name="ln1222">  // dt_bauhaus_widget_set_label(g-&gt;film_emulation.film, NULL, _(&quot;film type&quot;));</a>
<a name="ln1223">  gtk_widget_set_tooltip_text(g-&gt;film_emulation.film, _(&quot;choose emulated film type&quot;));</a>
<a name="ln1224">  gtk_box_pack_start(GTK_BOX(g-&gt;film_emulation.box), g-&gt;film_emulation.film, TRUE, TRUE, 0);</a>
<a name="ln1225">  g_signal_connect(G_OBJECT(g-&gt;film_emulation.film), &quot;value-changed&quot;,</a>
<a name="ln1226">                   G_CALLBACK(dt_iop_gmic_film_emulation_params_t::film_callback), self);</a>
<a name="ln1227"> </a>
<a name="ln1228">  g-&gt;film_emulation.strength</a>
<a name="ln1229">      = dt_bauhaus_slider_new_with_range(self, 0, 1, 0.01, g-&gt;film_emulation.parameters.strength, 3);</a>
<a name="ln1230">  dt_bauhaus_widget_set_label(g-&gt;film_emulation.strength, NULL, _(&quot;strength&quot;));</a>
<a name="ln1231">  gtk_widget_set_tooltip_text(g-&gt;film_emulation.strength, _(&quot;strength of the film emulation effect&quot;));</a>
<a name="ln1232">  gtk_box_pack_start(GTK_BOX(g-&gt;film_emulation.box), GTK_WIDGET(g-&gt;film_emulation.strength), TRUE, TRUE, 0);</a>
<a name="ln1233">  g_signal_connect(G_OBJECT(g-&gt;film_emulation.strength), &quot;value-changed&quot;,</a>
<a name="ln1234">                   G_CALLBACK(dt_iop_gmic_film_emulation_params_t::strength_callback), self);</a>
<a name="ln1235"> </a>
<a name="ln1236">  g-&gt;film_emulation.brightness</a>
<a name="ln1237">      = dt_bauhaus_slider_new_with_range(self, -1, 1, 0.01, g-&gt;film_emulation.parameters.brightness, 3);</a>
<a name="ln1238">  dt_bauhaus_widget_set_label(g-&gt;film_emulation.brightness, NULL, _(&quot;brightness&quot;));</a>
<a name="ln1239">  gtk_widget_set_tooltip_text(g-&gt;film_emulation.brightness, _(&quot;brightness of the film emulation effect&quot;));</a>
<a name="ln1240">  gtk_box_pack_start(GTK_BOX(g-&gt;film_emulation.box), GTK_WIDGET(g-&gt;film_emulation.brightness), TRUE, TRUE, 0);</a>
<a name="ln1241">  g_signal_connect(G_OBJECT(g-&gt;film_emulation.brightness), &quot;value-changed&quot;,</a>
<a name="ln1242">                   G_CALLBACK(dt_iop_gmic_film_emulation_params_t::brightness_callback), self);</a>
<a name="ln1243"> </a>
<a name="ln1244">  g-&gt;film_emulation.contrast</a>
<a name="ln1245">      = dt_bauhaus_slider_new_with_range(self, -1, 1, 0.01, g-&gt;film_emulation.parameters.contrast, 3);</a>
<a name="ln1246">  dt_bauhaus_widget_set_label(g-&gt;film_emulation.contrast, NULL, _(&quot;contrast&quot;));</a>
<a name="ln1247">  gtk_widget_set_tooltip_text(g-&gt;film_emulation.contrast, _(&quot;contrast of the film emulation effect&quot;));</a>
<a name="ln1248">  gtk_box_pack_start(GTK_BOX(g-&gt;film_emulation.box), GTK_WIDGET(g-&gt;film_emulation.contrast), TRUE, TRUE, 0);</a>
<a name="ln1249">  g_signal_connect(G_OBJECT(g-&gt;film_emulation.contrast), &quot;value-changed&quot;,</a>
<a name="ln1250">                   G_CALLBACK(dt_iop_gmic_film_emulation_params_t::contrast_callback), self);</a>
<a name="ln1251"> </a>
<a name="ln1252">  g-&gt;film_emulation.gamma</a>
<a name="ln1253">      = dt_bauhaus_slider_new_with_range(self, -1, 1, 0.01, g-&gt;film_emulation.parameters.gamma, 3);</a>
<a name="ln1254">  dt_bauhaus_widget_set_label(g-&gt;film_emulation.gamma, NULL, _(&quot;gamma&quot;));</a>
<a name="ln1255">  gtk_widget_set_tooltip_text(g-&gt;film_emulation.gamma, _(&quot;gamma value of the film emulation effect&quot;));</a>
<a name="ln1256">  gtk_box_pack_start(GTK_BOX(g-&gt;film_emulation.box), GTK_WIDGET(g-&gt;film_emulation.gamma), TRUE, TRUE, 0);</a>
<a name="ln1257">  g_signal_connect(G_OBJECT(g-&gt;film_emulation.gamma), &quot;value-changed&quot;,</a>
<a name="ln1258">                   G_CALLBACK(dt_iop_gmic_film_emulation_params_t::gamma_callback), self);</a>
<a name="ln1259"> </a>
<a name="ln1260">  g-&gt;film_emulation.hue = dt_bauhaus_slider_new_with_range(self, -1, 1, 0.01, g-&gt;film_emulation.parameters.hue, 3);</a>
<a name="ln1261">  dt_bauhaus_widget_set_label(g-&gt;film_emulation.hue, NULL, _(&quot;hue&quot;));</a>
<a name="ln1262">  gtk_widget_set_tooltip_text(g-&gt;film_emulation.hue, _(&quot;hue shift of the film emulation effect&quot;));</a>
<a name="ln1263">  gtk_box_pack_start(GTK_BOX(g-&gt;film_emulation.box), GTK_WIDGET(g-&gt;film_emulation.hue), TRUE, TRUE, 0);</a>
<a name="ln1264">  g_signal_connect(G_OBJECT(g-&gt;film_emulation.hue), &quot;value-changed&quot;,</a>
<a name="ln1265">                   G_CALLBACK(dt_iop_gmic_film_emulation_params_t::hue_callback), self);</a>
<a name="ln1266"> </a>
<a name="ln1267">  g-&gt;film_emulation.saturation</a>
<a name="ln1268">      = dt_bauhaus_slider_new_with_range(self, -1, 1, 0.01, g-&gt;film_emulation.parameters.saturation, 3);</a>
<a name="ln1269">  dt_bauhaus_widget_set_label(g-&gt;film_emulation.saturation, NULL, _(&quot;saturation&quot;));</a>
<a name="ln1270">  gtk_widget_set_tooltip_text(g-&gt;film_emulation.saturation, _(&quot;saturation of the film emulation effect&quot;));</a>
<a name="ln1271">  gtk_box_pack_start(GTK_BOX(g-&gt;film_emulation.box), GTK_WIDGET(g-&gt;film_emulation.saturation), TRUE, TRUE, 0);</a>
<a name="ln1272">  g_signal_connect(G_OBJECT(g-&gt;film_emulation.saturation), &quot;value-changed&quot;,</a>
<a name="ln1273">                   G_CALLBACK(dt_iop_gmic_film_emulation_params_t::saturation_callback), self);</a>
<a name="ln1274"> </a>
<a name="ln1275">  g-&gt;film_emulation.normalize_colors = dt_bauhaus_combobox_new(self);</a>
<a name="ln1276">  dt_bauhaus_combobox_add(g-&gt;film_emulation.normalize_colors, _(&quot;none&quot;));</a>
<a name="ln1277">  dt_bauhaus_combobox_add(g-&gt;film_emulation.normalize_colors, _(&quot;pre-process&quot;));</a>
<a name="ln1278">  dt_bauhaus_combobox_add(g-&gt;film_emulation.normalize_colors, _(&quot;post-process&quot;));</a>
<a name="ln1279">  dt_bauhaus_combobox_add(g-&gt;film_emulation.normalize_colors, _(&quot;both&quot;));</a>
<a name="ln1280">  dt_bauhaus_combobox_set(g-&gt;film_emulation.normalize_colors, g-&gt;film_emulation.parameters.normalize_colors);</a>
<a name="ln1281">  dt_bauhaus_widget_set_label(g-&gt;film_emulation.normalize_colors, NULL, _(&quot;normalize colors&quot;));</a>
<a name="ln1282">  gtk_widget_set_tooltip_text(g-&gt;film_emulation.normalize_colors, _(&quot;choose how to normalize colors&quot;));</a>
<a name="ln1283">  gtk_box_pack_start(GTK_BOX(g-&gt;film_emulation.box), g-&gt;film_emulation.normalize_colors, TRUE, TRUE, 0);</a>
<a name="ln1284">  g_signal_connect(G_OBJECT(g-&gt;film_emulation.normalize_colors), &quot;value-changed&quot;,</a>
<a name="ln1285">                   G_CALLBACK(dt_iop_gmic_film_emulation_params_t::normalize_colors_callback), self);</a>
<a name="ln1286"> </a>
<a name="ln1287">  gtk_widget_show_all(g-&gt;film_emulation.box);</a>
<a name="ln1288">  gtk_widget_set_no_show_all(g-&gt;film_emulation.box, TRUE);</a>
<a name="ln1289">  gtk_widget_set_visible(g-&gt;film_emulation.box, p-&gt;filter == film_emulation ? TRUE : FALSE);</a>
<a name="ln1290">}</a>
<a name="ln1291"> </a>
<a name="ln1292">void dt_iop_gmic_film_emulation_params_t::gui_update(dt_iop_module_t *self) const</a>
<a name="ln1293">{</a>
<a name="ln1294">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln1295">  dt_iop_gmic_params_t *p = reinterpret_cast&lt;dt_iop_gmic_params_t *&gt;(self-&gt;params);</a>
<a name="ln1296">  gtk_widget_set_visible(g-&gt;film_emulation.box, p-&gt;filter == film_emulation ? TRUE : FALSE);</a>
<a name="ln1297">  if(p-&gt;filter == film_emulation)</a>
<a name="ln1298">  {</a>
<a name="ln1299">    g-&gt;film_emulation.parameters = *p;</a>
<a name="ln1300">    auto i = std::find(g-&gt;film_emulation.film_list.begin(), g-&gt;film_emulation.film_list.end(),</a>
<a name="ln1301">                       g-&gt;film_emulation.parameters.film);</a>
<a name="ln1302">    if(i != g-&gt;film_emulation.film_list.end())</a>
<a name="ln1303">      dt_bauhaus_combobox_set(g-&gt;film_emulation.film, static_cast&lt;int&gt;(i - g-&gt;film_emulation.film_list.begin()));</a>
<a name="ln1304">    dt_bauhaus_slider_set(g-&gt;film_emulation.strength, g-&gt;film_emulation.parameters.strength);</a>
<a name="ln1305">    dt_bauhaus_slider_set(g-&gt;film_emulation.brightness, g-&gt;film_emulation.parameters.brightness);</a>
<a name="ln1306">    dt_bauhaus_slider_set(g-&gt;film_emulation.contrast, g-&gt;film_emulation.parameters.contrast);</a>
<a name="ln1307">    dt_bauhaus_slider_set(g-&gt;film_emulation.gamma, g-&gt;film_emulation.parameters.gamma);</a>
<a name="ln1308">    dt_bauhaus_slider_set(g-&gt;film_emulation.hue, g-&gt;film_emulation.parameters.hue);</a>
<a name="ln1309">    dt_bauhaus_slider_set(g-&gt;film_emulation.saturation, g-&gt;film_emulation.parameters.saturation);</a>
<a name="ln1310">    dt_bauhaus_combobox_set(g-&gt;film_emulation.normalize_colors, g-&gt;film_emulation.parameters.normalize_colors);</a>
<a name="ln1311">  }</a>
<a name="ln1312">}</a>
<a name="ln1313"> </a>
<a name="ln1314">void dt_iop_gmic_film_emulation_params_t::gui_reset(dt_iop_module_t *self)</a>
<a name="ln1315">{</a>
<a name="ln1316">  *this = dt_iop_gmic_film_emulation_params_t();</a>
<a name="ln1317">}</a>
<a name="ln1318"> </a>
<a name="ln1319">void dt_iop_gmic_film_emulation_params_t::film_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln1320">{</a>
<a name="ln1321">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln1322">    std::snprintf(G-&gt;film_emulation.parameters.film, sizeof(G-&gt;film_emulation.parameters.film), &quot;%s&quot;,</a>
<a name="ln1323">                  film_maps[dt_bauhaus_combobox_get(W)].film_type.c_str());</a>
<a name="ln1324">    return G-&gt;film_emulation.parameters.to_gmic_params();</a>
<a name="ln1325">  });</a>
<a name="ln1326">}</a>
<a name="ln1327"> </a>
<a name="ln1328">void dt_iop_gmic_film_emulation_params_t::strength_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln1329">{</a>
<a name="ln1330">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln1331">    G-&gt;film_emulation.parameters.strength = dt_bauhaus_slider_get(W);</a>
<a name="ln1332">    return G-&gt;film_emulation.parameters.to_gmic_params();</a>
<a name="ln1333">  });</a>
<a name="ln1334">}</a>
<a name="ln1335"> </a>
<a name="ln1336">void dt_iop_gmic_film_emulation_params_t::brightness_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln1337">{</a>
<a name="ln1338">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln1339">    G-&gt;film_emulation.parameters.brightness = dt_bauhaus_slider_get(W);</a>
<a name="ln1340">    return G-&gt;film_emulation.parameters.to_gmic_params();</a>
<a name="ln1341">  });</a>
<a name="ln1342">}</a>
<a name="ln1343"> </a>
<a name="ln1344">void dt_iop_gmic_film_emulation_params_t::contrast_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln1345">{</a>
<a name="ln1346">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln1347">    G-&gt;film_emulation.parameters.contrast = dt_bauhaus_slider_get(W);</a>
<a name="ln1348">    return G-&gt;film_emulation.parameters.to_gmic_params();</a>
<a name="ln1349">  });</a>
<a name="ln1350">}</a>
<a name="ln1351"> </a>
<a name="ln1352">void dt_iop_gmic_film_emulation_params_t::gamma_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln1353">{</a>
<a name="ln1354">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln1355">    G-&gt;film_emulation.parameters.gamma = dt_bauhaus_slider_get(W);</a>
<a name="ln1356">    return G-&gt;film_emulation.parameters.to_gmic_params();</a>
<a name="ln1357">  });</a>
<a name="ln1358">}</a>
<a name="ln1359"> </a>
<a name="ln1360">void dt_iop_gmic_film_emulation_params_t::hue_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln1361">{</a>
<a name="ln1362">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln1363">    G-&gt;film_emulation.parameters.hue = dt_bauhaus_slider_get(W);</a>
<a name="ln1364">    return G-&gt;film_emulation.parameters.to_gmic_params();</a>
<a name="ln1365">  });</a>
<a name="ln1366">}</a>
<a name="ln1367"> </a>
<a name="ln1368">void dt_iop_gmic_film_emulation_params_t::saturation_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln1369">{</a>
<a name="ln1370">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln1371">    G-&gt;film_emulation.parameters.saturation = dt_bauhaus_slider_get(W);</a>
<a name="ln1372">    return G-&gt;film_emulation.parameters.to_gmic_params();</a>
<a name="ln1373">  });</a>
<a name="ln1374">}</a>
<a name="ln1375"> </a>
<a name="ln1376">void dt_iop_gmic_film_emulation_params_t::normalize_colors_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln1377">{</a>
<a name="ln1378">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln1379">    G-&gt;film_emulation.parameters.normalize_colors = dt_bauhaus_combobox_get(W);</a>
<a name="ln1380">    return G-&gt;film_emulation.parameters.to_gmic_params();</a>
<a name="ln1381">  });</a>
<a name="ln1382">}</a>
<a name="ln1383"> </a>
<a name="ln1384">const std::vector&lt;film_map&gt; dt_iop_gmic_film_emulation_params_t::film_maps{</a>
<a name="ln1385">  // black and white</a>
<a name="ln1386">  { &quot;agfa_apx_25&quot;, _(&quot;Agfa APX 25&quot;) },</a>
<a name="ln1387">  { &quot;agfa_apx_100&quot;, _(&quot;Agfa APX 100&quot;) },</a>
<a name="ln1388">  { &quot;fuji_neopan_1600_-&quot;, _(&quot;Fuji Neopan 1600 -&quot;) },</a>
<a name="ln1389">  { &quot;fuji_neopan_1600&quot;, _(&quot;Fuji Neopan 1600&quot;) },</a>
<a name="ln1390">  { &quot;fuji_neopan_1600_+&quot;, _(&quot;Fuji Neopan 1600 +&quot;) },</a>
<a name="ln1391">  { &quot;fuji_neopan_1600_++&quot;, _(&quot;Fuji Neopan 1600 ++&quot;) },</a>
<a name="ln1392">  { &quot;fuji_neopan_acros_100&quot;, _(&quot;Fuji Neopan Acros 100&quot;) },</a>
<a name="ln1393">  { &quot;ilford_delta_100&quot;, _(&quot;Ilford Delta 100&quot;) },</a>
<a name="ln1394">  { &quot;ilford_delta_400&quot;, _(&quot;Ilford Delta 400&quot;) },</a>
<a name="ln1395">  { &quot;ilford_delta_3200&quot;, _(&quot;Ilford Delta 3200&quot;) },</a>
<a name="ln1396">  { &quot;ilford_fp4_plus_125&quot;, _(&quot;Ilford FP4 plus 125&quot;) },</a>
<a name="ln1397">  { &quot;ilford_hp5_plus_400&quot;, _(&quot;Ilford HP5 plus 400&quot;) },</a>
<a name="ln1398">  { &quot;ilford_hps_800&quot;, _(&quot;Ilford HPS 800&quot;) },</a>
<a name="ln1399">  { &quot;ilford_pan_f_plus_50&quot;, _(&quot;Ilford Pan F plus 50&quot;) },</a>
<a name="ln1400">  { &quot;ilford_xp2&quot;, _(&quot;Ilford XP2&quot;) },</a>
<a name="ln1401">  { &quot;kodak_bw_400_cn&quot;, _(&quot;Kodak BW 400 CN&quot;) },</a>
<a name="ln1402">  { &quot;kodak_hie_(hs_infra)&quot;, _(&quot;Kodak hie (hs infra)&quot;) },</a>
<a name="ln1403">  { &quot;kodak_t-max_100&quot;, _(&quot;Kodak T-Max 100&quot;) },</a>
<a name="ln1404">  { &quot;kodak_t-max_400&quot;, _(&quot;Kodak T-Max 400&quot;) },</a>
<a name="ln1405">  { &quot;kodak_t-max_3200&quot;, _(&quot;Kodak T-Max 3200&quot;) },</a>
<a name="ln1406">  { &quot;kodak_tri-x_400_-&quot;, _(&quot;Kodak Tri-X 400 -&quot;) },</a>
<a name="ln1407">  { &quot;kodak_tri-x_400&quot;, _(&quot;Kodak Tri-X 400&quot;) },</a>
<a name="ln1408">  { &quot;kodak_tri-x_400_+&quot;, _(&quot;Kodak Tri-X 400 +&quot;) },</a>
<a name="ln1409">  { &quot;kodak_tri-x_400_++&quot;, _(&quot;Kodak Tri-X 400 ++&quot;) },</a>
<a name="ln1410">  { &quot;polaroid_664&quot;, _(&quot;Polaroid 664&quot;) },</a>
<a name="ln1411">  { &quot;polaroid_667&quot;, _(&quot;Polaroid 667&quot;) },</a>
<a name="ln1412">  { &quot;polaroid_672&quot;, _(&quot;Polaroid 672&quot;) },</a>
<a name="ln1413">  { &quot;rollei_ir_400&quot;, _(&quot;Rollei IR 400&quot;) },</a>
<a name="ln1414">  { &quot;rollei_ortho_25&quot;, _(&quot;Rollei Ortho 25&quot;) },</a>
<a name="ln1415">  { &quot;rollei_retro_100_tonal&quot;, _(&quot;Rollei Retro 100 tonal&quot;) },</a>
<a name="ln1416">  { &quot;rollei_retro_80s&quot;, _(&quot;Rollei Retro 80s&quot;) },</a>
<a name="ln1417">  // Fuji X-Trans</a>
<a name="ln1418">  { &quot;fuji_xtrans_ii_astia_v2&quot;, _(&quot;Fuji X-Trans II Astia&quot;) },</a>
<a name="ln1419">  { &quot;fuji_xtrans_ii_classic_chrome_v1&quot;, _(&quot;Fuji X-Trans II Classic Chrome&quot;) },</a>
<a name="ln1420">  { &quot;fuji_xtrans_ii_pro_neg_hi_v2&quot;, _(&quot;Fuji X-Trans II Pro Neg hi&quot;) },</a>
<a name="ln1421">  { &quot;fuji_xtrans_ii_pro_neg_std_v2&quot;, _(&quot;Fuji X-Trans II Pro Neg std&quot;) },</a>
<a name="ln1422">  { &quot;fuji_xtrans_ii_provia_v2&quot;, _(&quot;Fuji X-Trans II Provia&quot;) },</a>
<a name="ln1423">  { &quot;fuji_xtrans_ii_velvia_v2&quot;, _(&quot;Fuji X-Trans II Velvia&quot;) },</a>
<a name="ln1424">  // instant consumer</a>
<a name="ln1425">  { &quot;polaroid_px-100uv+_cold_--&quot;, _(&quot;Polaroid PX-100uv+ cold --&quot;) },</a>
<a name="ln1426">  { &quot;polaroid_px-100uv+_cold_-&quot;, _(&quot;Polaroid PX-100uv+ cold -&quot;) },</a>
<a name="ln1427">  { &quot;polaroid_px-100uv+_cold&quot;, _(&quot;Polaroid PX-100uv+ cold&quot;) },</a>
<a name="ln1428">  { &quot;polaroid_px-100uv+_cold_+&quot;, _(&quot;Polaroid PX-100uv+ cold +&quot;) },</a>
<a name="ln1429">  { &quot;polaroid_px-100uv+_cold_++&quot;, _(&quot;Polaroid PX-100uv+ cold ++&quot;) },</a>
<a name="ln1430">  { &quot;polaroid_px-100uv+_cold_+++&quot;, _(&quot;Polaroid PX-100uv+ cold +++&quot;) },</a>
<a name="ln1431">  { &quot;polaroid_px-100uv+_warm_--&quot;, _(&quot;Polaroid PX-100uv+ warm --&quot;) },</a>
<a name="ln1432">  { &quot;polaroid_px-100uv+_warm_-&quot;, _(&quot;Polaroid PX-100uv+ warm -&quot;) },</a>
<a name="ln1433">  { &quot;polaroid_px-100uv+_warm&quot;, _(&quot;Polaroid PX-100uv+ warm&quot;) },</a>
<a name="ln1434">  { &quot;polaroid_px-100uv+_warm_+&quot;, _(&quot;Polaroid PX-100uv+ warm +&quot;) },</a>
<a name="ln1435">  { &quot;polaroid_px-100uv+_warm_++&quot;, _(&quot;Polaroid PX-100uv+ warm ++&quot;) },</a>
<a name="ln1436">  { &quot;polaroid_px-100uv+_warm_+++&quot;, _(&quot;Polaroid PX-100uv+ warm +++&quot;) },</a>
<a name="ln1437">  { &quot;polaroid_px-680_--&quot;, _(&quot;Polaroid PX-680 --&quot;) },</a>
<a name="ln1438">  { &quot;polaroid_px-680_-&quot;, _(&quot;Polaroid PX-680 -&quot;) },</a>
<a name="ln1439">  { &quot;polaroid_px-680&quot;, _(&quot;Polaroid PX-680&quot;) },</a>
<a name="ln1440">  { &quot;polaroid_px-680_+&quot;, _(&quot;Polaroid PX-680 +&quot;) },</a>
<a name="ln1441">  { &quot;polaroid_px-680_++&quot;, _(&quot;Polaroid PX-680 ++&quot;) },</a>
<a name="ln1442">  { &quot;polaroid_px-680_cold_--&quot;, _(&quot;Polaroid PX-680 cold --&quot;) },</a>
<a name="ln1443">  { &quot;polaroid_px-680_cold_-&quot;, _(&quot;Polaroid PX-680 cold -&quot;) },</a>
<a name="ln1444">  { &quot;polaroid_px-680_cold&quot;, _(&quot;Polaroid PX-680 cold&quot;) },</a>
<a name="ln1445">  { &quot;polaroid_px-680_cold_+&quot;, _(&quot;Polaroid PX-680 cold +&quot;) },</a>
<a name="ln1446">  { &quot;polaroid_px-680_cold_++&quot;, _(&quot;Polaroid PX-680 cold ++&quot;) },</a>
<a name="ln1447">  { &quot;polaroid_px-680_cold_++_alt&quot;, _(&quot;Polaroid PX-680 cold ++ alt&quot;) },</a>
<a name="ln1448">  { &quot;polaroid_px-680_warm_--&quot;, _(&quot;Polaroid PX-680 warm --&quot;) },</a>
<a name="ln1449">  { &quot;polaroid_px-680_warm_-&quot;, _(&quot;Polaroid PX-680 warm -&quot;) },</a>
<a name="ln1450">  { &quot;polaroid_px-680_warm&quot;, _(&quot;Polaroid PX-680 warm&quot;) },</a>
<a name="ln1451">  { &quot;polaroid_px-680_warm_+&quot;, _(&quot;Polaroid PX-680 warm +&quot;) },</a>
<a name="ln1452">  { &quot;polaroid_px-680_warm_++&quot;, _(&quot;Polaroid PX-680 warm ++&quot;) },</a>
<a name="ln1453">  { &quot;polaroid_px-70_--&quot;, _(&quot;Polaroid PX-70 --&quot;) },</a>
<a name="ln1454">  { &quot;polaroid_px-70_-&quot;, _(&quot;Polaroid PX-70 -&quot;) },</a>
<a name="ln1455">  { &quot;polaroid_px-70&quot;, _(&quot;Polaroid PX-70&quot;) },</a>
<a name="ln1456">  { &quot;polaroid_px-70_+&quot;, _(&quot;Polaroid PX-70 +&quot;) },</a>
<a name="ln1457">  { &quot;polaroid_px-70_++&quot;, _(&quot;Polaroid PX-70 ++&quot;) },</a>
<a name="ln1458">  { &quot;polaroid_px-70_+++&quot;, _(&quot;Polaroid PX-70 +++&quot;) },</a>
<a name="ln1459">  { &quot;polaroid_px-70_cold_--&quot;, _(&quot;Polaroid PX-70 cold --&quot;) },</a>
<a name="ln1460">  { &quot;polaroid_px-70_cold_-&quot;, _(&quot;Polaroid PX-70 cold -&quot;) },</a>
<a name="ln1461">  { &quot;polaroid_px-70_cold&quot;, _(&quot;Polaroid PX-70 cold&quot;) },</a>
<a name="ln1462">  { &quot;polaroid_px-70_cold_+&quot;, _(&quot;Polaroid PX-70 cold +&quot;) },</a>
<a name="ln1463">  { &quot;polaroid_px-70_cold_++&quot;, _(&quot;Polaroid PX-70 cold ++&quot;) },</a>
<a name="ln1464">  { &quot;polaroid_px-70_warm_--&quot;, _(&quot;Polaroid PX-70 warm --&quot;) },</a>
<a name="ln1465">  { &quot;polaroid_px-70_warm_-&quot;, _(&quot;Polaroid PX-70 warm -&quot;) },</a>
<a name="ln1466">  { &quot;polaroid_px-70_warm&quot;, _(&quot;Polaroid PX-70 warm&quot;) },</a>
<a name="ln1467">  { &quot;polaroid_px-70_warm_+&quot;, _(&quot;Polaroid PX-70 warm +&quot;) },</a>
<a name="ln1468">  { &quot;polaroid_px-70_warm_++&quot;, _(&quot;Polaroid PX-70 warm ++&quot;) },</a>
<a name="ln1469">  { &quot;polaroid_time_zero_(expired)_---&quot;, _(&quot;Polaroid time zero (expired) ---&quot;) },</a>
<a name="ln1470">  { &quot;polaroid_time_zero_(expired)_--&quot;, _(&quot;Polaroid time zero (expired) --&quot;) },</a>
<a name="ln1471">  { &quot;polaroid_time_zero_(expired)_-&quot;, _(&quot;Polaroid time zero (expired) -&quot;) },</a>
<a name="ln1472">  { &quot;polaroid_time_zero_(expired)&quot;, _(&quot;Polaroid time zero (expired)&quot;) },</a>
<a name="ln1473">  { &quot;polaroid_time_zero_(expired)_+&quot;, _(&quot;Polaroid time zero (expired) +&quot;) },</a>
<a name="ln1474">  { &quot;polaroid_time_zero_(expired)_++&quot;, _(&quot;Polaroid time zero (expired) ++&quot;) },</a>
<a name="ln1475">  { &quot;polaroid_time_zero_(expired)_cold_---&quot;, _(&quot;Polaroid time zero (expired) cold ---&quot;) },</a>
<a name="ln1476">  { &quot;polaroid_time_zero_(expired)_cold_--&quot;, _(&quot;Polaroid time zero (expired) cold --&quot;) },</a>
<a name="ln1477">  { &quot;polaroid_time_zero_(expired)_cold_-&quot;, _(&quot;Polaroid time zero (expired) cold -&quot;) },</a>
<a name="ln1478">  { &quot;polaroid_time_zero_(expired)_cold&quot;, _(&quot;Polaroid time zero (expired) cold&quot;) },</a>
<a name="ln1479">  // instant pro</a>
<a name="ln1480">  { &quot;fuji_fp-100c_--&quot;, _(&quot;Fuji FP-100c --&quot;) },</a>
<a name="ln1481">  { &quot;fuji_fp-100c_-&quot;, _(&quot;Fuji FP-100c -&quot;) },</a>
<a name="ln1482">  { &quot;fuji_fp-100c&quot;, _(&quot;Fuji FP-100c&quot;) },</a>
<a name="ln1483">  { &quot;fuji_fp-100c_+&quot;, _(&quot;Fuji FP-100c +&quot;) },</a>
<a name="ln1484">  { &quot;fuji_fp-100c_++&quot;, _(&quot;Fuji FP-100c ++&quot;) },</a>
<a name="ln1485">  { &quot;fuji_fp-100c_++_alt&quot;, _(&quot;Fuji FP-100c ++ alt&quot;) },</a>
<a name="ln1486">  { &quot;fuji_fp-100c_+++&quot;, _(&quot;Fuji FP-100c +++&quot;) },</a>
<a name="ln1487">  { &quot;fuji_fp-100c_cool_--&quot;, _(&quot;Fuji FP-100c cool --&quot;) },</a>
<a name="ln1488">  { &quot;fuji_fp-100c_cool_-&quot;, _(&quot;Fuji FP-100c cool -&quot;) },</a>
<a name="ln1489">  { &quot;fuji_fp-100c_cool&quot;, _(&quot;Fuji FP-100c cool&quot;) },</a>
<a name="ln1490">  { &quot;fuji_fp-100c_cool_+&quot;, _(&quot;Fuji FP-100c cool +&quot;) },</a>
<a name="ln1491">  { &quot;fuji_fp-100c_cool_++&quot;, _(&quot;Fuji FP-100c cool ++&quot;) },</a>
<a name="ln1492">  { &quot;fuji_fp-100c_negative_--&quot;, _(&quot;Fuji FP-100c negative --&quot;) },</a>
<a name="ln1493">  { &quot;fuji_fp-100c_negative_-&quot;, _(&quot;Fuji FP-100c negative -&quot;) },</a>
<a name="ln1494">  { &quot;fuji_fp-100c_negative&quot;, _(&quot;Fuji FP-100c negative&quot;) },</a>
<a name="ln1495">  { &quot;fuji_fp-100c_negative_+&quot;, _(&quot;Fuji FP-100c negative +&quot;) },</a>
<a name="ln1496">  { &quot;fuji_fp-100c_negative_++&quot;, _(&quot;Fuji FP-100c negative ++&quot;) },</a>
<a name="ln1497">  { &quot;fuji_fp-100c_negative_++_alt&quot;, _(&quot;Fuji FP-100c negative ++ alt&quot;) },</a>
<a name="ln1498">  { &quot;fuji_fp-100c_negative_+++&quot;, _(&quot;Fuji FP-100c negative +++&quot;) },</a>
<a name="ln1499">  { &quot;fuji_fp-3000b_--&quot;, _(&quot;Fuji FP-3000b --&quot;) },</a>
<a name="ln1500">  { &quot;fuji_fp-3000b_-&quot;, _(&quot;Fuji FP-3000b -&quot;) },</a>
<a name="ln1501">  { &quot;fuji_fp-3000b&quot;, _(&quot;Fuji FP-3000b&quot;) },</a>
<a name="ln1502">  { &quot;fuji_fp-3000b_+&quot;, _(&quot;Fuji FP-3000b +&quot;) },</a>
<a name="ln1503">  { &quot;fuji_fp-3000b_++&quot;, _(&quot;Fuji FP-3000b ++&quot;) },</a>
<a name="ln1504">  { &quot;fuji_fp-3000b_+++&quot;, _(&quot;Fuji FP-3000b +++&quot;) },</a>
<a name="ln1505">  { &quot;fuji_fp-3000b_hc&quot;, _(&quot;Fuji FP-3000b hc&quot;) },</a>
<a name="ln1506">  { &quot;fuji_fp-3000b_negative_--&quot;, _(&quot;Fuji FP-3000b negative --&quot;) },</a>
<a name="ln1507">  { &quot;fuji_fp-3000b_negative_-&quot;, _(&quot;Fuji FP-3000b negative -&quot;) },</a>
<a name="ln1508">  { &quot;fuji_fp-3000b_negative&quot;, _(&quot;Fuji FP-3000b negative&quot;) },</a>
<a name="ln1509">  { &quot;fuji_fp-3000b_negative_+&quot;, _(&quot;Fuji FP-3000b negative +&quot;) },</a>
<a name="ln1510">  { &quot;fuji_fp-3000b_negative_++&quot;, _(&quot;Fuji FP-3000b negative ++&quot;) },</a>
<a name="ln1511">  { &quot;fuji_fp-3000b_negative_+++&quot;, _(&quot;Fuji FP-3000b negative +++&quot;) },</a>
<a name="ln1512">  { &quot;fuji_fp-3000b_negative_early&quot;, _(&quot;Fuji FP-3000b negative early&quot;) },</a>
<a name="ln1513">  { &quot;polaroid_665_-&quot;, _(&quot;Polaroid 665 -&quot;) },</a>
<a name="ln1514">  { &quot;polaroid_665_--&quot;, _(&quot;Polaroid 665 --&quot;) },</a>
<a name="ln1515">  { &quot;polaroid_665&quot;, _(&quot;Polaroid 665&quot;) },</a>
<a name="ln1516">  { &quot;polaroid_665_+&quot;, _(&quot;Polaroid 665 +&quot;) },</a>
<a name="ln1517">  { &quot;polaroid_665_++&quot;, _(&quot;Polaroid 665 ++&quot;) },</a>
<a name="ln1518">  { &quot;polaroid_665_negative&quot;, _(&quot;Polaroid 665 negative&quot;) },</a>
<a name="ln1519">  { &quot;polaroid_665_negative_+&quot;, _(&quot;Polaroid 665 negative +&quot;) },</a>
<a name="ln1520">  { &quot;polaroid_665_negative_-&quot;, _(&quot;Polaroid 665 negative -&quot;) },</a>
<a name="ln1521">  { &quot;polaroid_665_negative_hc&quot;, _(&quot;Polaroid 665 negative hc&quot;) },</a>
<a name="ln1522">  { &quot;polaroid_669_--&quot;, _(&quot;Polaroid 669 --&quot;) },</a>
<a name="ln1523">  { &quot;polaroid_669_-&quot;, _(&quot;Polaroid 669 -&quot;) },</a>
<a name="ln1524">  { &quot;polaroid_669&quot;, _(&quot;Polaroid 669&quot;) },</a>
<a name="ln1525">  { &quot;polaroid_669_+&quot;, _(&quot;Polaroid 669 +&quot;) },</a>
<a name="ln1526">  { &quot;polaroid_669_++&quot;, _(&quot;Polaroid 669 ++&quot;) },</a>
<a name="ln1527">  { &quot;polaroid_669_+++&quot;, _(&quot;Polaroid 669 +++&quot;) },</a>
<a name="ln1528">  { &quot;polaroid_669_cold_--&quot;, _(&quot;Polaroid 669 cold --&quot;) },</a>
<a name="ln1529">  { &quot;polaroid_669_cold_-&quot;, _(&quot;Polaroid 669 cold -&quot;) },</a>
<a name="ln1530">  { &quot;polaroid_669_cold&quot;, _(&quot;Polaroid 669 cold&quot;) },</a>
<a name="ln1531">  { &quot;polaroid_669_cold_+&quot;, _(&quot;Polaroid 669 cold +&quot;) },</a>
<a name="ln1532">  { &quot;polaroid_690_--&quot;, _(&quot;Polaroid 690 --&quot;) },</a>
<a name="ln1533">  { &quot;polaroid_690_-&quot;, _(&quot;Polaroid 690 -&quot;) },</a>
<a name="ln1534">  { &quot;polaroid_690&quot;, _(&quot;Polaroid 690&quot;) },</a>
<a name="ln1535">  { &quot;polaroid_690_+&quot;, _(&quot;Polaroid 690 +&quot;) },</a>
<a name="ln1536">  { &quot;polaroid_690_++&quot;, _(&quot;Polaroid 690 ++&quot;) },</a>
<a name="ln1537">  { &quot;polaroid_690_cold_--&quot;, _(&quot;Polaroid 690 cold --&quot;) },</a>
<a name="ln1538">  { &quot;polaroid_690_cold_-&quot;, _(&quot;Polaroid 690 cold -&quot;) },</a>
<a name="ln1539">  { &quot;polaroid_690_cold&quot;, _(&quot;Polaroid 690 cold&quot;) },</a>
<a name="ln1540">  { &quot;polaroid_690_cold_+&quot;, _(&quot;Polaroid 690 cold +&quot;) },</a>
<a name="ln1541">  { &quot;polaroid_690_cold_++&quot;, _(&quot;Polaroid 690 cold ++&quot;) },</a>
<a name="ln1542">  { &quot;polaroid_690_warm_--&quot;, _(&quot;Polaroid 690 warm --&quot;) },</a>
<a name="ln1543">  { &quot;polaroid_690_warm_-&quot;, _(&quot;Polaroid 690 warm -&quot;) },</a>
<a name="ln1544">  { &quot;polaroid_690_warm&quot;, _(&quot;Polaroid 690 warm&quot;) },</a>
<a name="ln1545">  { &quot;polaroid_690_warm_+&quot;, _(&quot;Polaroid 690 warm +&quot;) },</a>
<a name="ln1546">  { &quot;polaroid_690_warm_++&quot;, _(&quot;Polaroid 690 warm ++&quot;) },</a>
<a name="ln1547">  // negative color</a>
<a name="ln1548">  { &quot;agfa_ultra_color_100&quot;, _(&quot;Agfa Ultra color 100&quot;) },</a>
<a name="ln1549">  { &quot;agfa_vista_200&quot;, _(&quot;Agfa Vista 200&quot;) },</a>
<a name="ln1550">  { &quot;fuji_superia_200&quot;, _(&quot;Fuji Superia 200&quot;) },</a>
<a name="ln1551">  { &quot;fuji_superia_hg_1600&quot;, _(&quot;Fuji Superia hg 1600&quot;) },</a>
<a name="ln1552">  { &quot;fuji_superia_reala_100&quot;, _(&quot;Fuji Superia Reala 100&quot;) },</a>
<a name="ln1553">  { &quot;fuji_superia_x-tra_800&quot;, _(&quot;Fuji Superia X-Tra 800&quot;) },</a>
<a name="ln1554">  { &quot;kodak_elite_100_xpro&quot;, _(&quot;Kodak Elite 100 XPRO&quot;) },</a>
<a name="ln1555">  { &quot;kodak_elite_color_200&quot;, _(&quot;Kodak Elite Color 200&quot;) },</a>
<a name="ln1556">  { &quot;kodak_elite_color_400&quot;, _(&quot;Kodak Elite Color 400&quot;) },</a>
<a name="ln1557">  { &quot;kodak_portra_160_nc_-&quot;, _(&quot;Kodak Portra 160 NC -&quot;) },</a>
<a name="ln1558">  { &quot;kodak_portra_160_nc&quot;, _(&quot;Kodak Portra 160 NC&quot;) },</a>
<a name="ln1559">  { &quot;kodak_portra_160_nc_+&quot;, _(&quot;Kodak Portra 160 NC +&quot;) },</a>
<a name="ln1560">  { &quot;kodak_portra_160_nc_++&quot;, _(&quot;Kodak Portra 160 NC ++&quot;) },</a>
<a name="ln1561">  { &quot;kodak_portra_160_vc_-&quot;, _(&quot;Kodak Portra 160 VC -&quot;) },</a>
<a name="ln1562">  { &quot;kodak_portra_160_vc&quot;, _(&quot;Kodak Portra 160 VC&quot;) },</a>
<a name="ln1563">  { &quot;kodak_portra_160_vc_+&quot;, _(&quot;Kodak Portra 160 VC +&quot;) },</a>
<a name="ln1564">  { &quot;kodak_portra_160_vc_++&quot;, _(&quot;Kodak Portra 160 VC ++&quot;) },</a>
<a name="ln1565">  { &quot;lomography_redscale_100&quot;, _(&quot;Lomography Redscale 100&quot;) },</a>
<a name="ln1566">  // negative new</a>
<a name="ln1567">  { &quot;fuji_160c_-&quot;, _(&quot;Fuji 160C -&quot;) },</a>
<a name="ln1568">  { &quot;fuji_160c&quot;, _(&quot;Fuji 160C&quot;) },</a>
<a name="ln1569">  { &quot;fuji_160c_+&quot;, _(&quot;Fuji 160C +&quot;) },</a>
<a name="ln1570">  { &quot;fuji_160c_++&quot;, _(&quot;Fuji 160C ++&quot;) },</a>
<a name="ln1571">  { &quot;fuji_400h_-&quot;, _(&quot;Fuji 400H -&quot;) },</a>
<a name="ln1572">  { &quot;fuji_400h&quot;, _(&quot;Fuji 400H&quot;) },</a>
<a name="ln1573">  { &quot;fuji_400h_+&quot;, _(&quot;Fuji 400H +&quot;) },</a>
<a name="ln1574">  { &quot;fuji_400h_++&quot;, _(&quot;Fuji 400H ++&quot;) },</a>
<a name="ln1575">  { &quot;fuji_800z_-&quot;, _(&quot;Fuji 800Z -&quot;) },</a>
<a name="ln1576">  { &quot;fuji_800z&quot;, _(&quot;Fuji 800Z&quot;) },</a>
<a name="ln1577">  { &quot;fuji_800z_+&quot;, _(&quot;Fuji 800Z +&quot;) },</a>
<a name="ln1578">  { &quot;fuji_800z_++&quot;, _(&quot;Fuji 800Z ++&quot;) },</a>
<a name="ln1579">  { &quot;fuji_800z_-&quot;, _(&quot;Fuji 800Z -&quot;) },</a>
<a name="ln1580">  { &quot;fuji_ilford_hp5_-&quot;, _(&quot;Fuji Ilford HP5 -&quot;) },</a>
<a name="ln1581">  { &quot;fuji_ilford_hp5&quot;, _(&quot;Fuji Ilford HP5&quot;) },</a>
<a name="ln1582">  { &quot;fuji_ilford_hp5_+&quot;, _(&quot;Fuji Ilford HP5 +&quot;) },</a>
<a name="ln1583">  { &quot;fuji_ilford_hp5_++&quot;, _(&quot;Fuji Ilford HP5 ++&quot;) },</a>
<a name="ln1584">  { &quot;kodak_portra_160_-&quot;, _(&quot;Kodak Portra 160 -&quot;) },</a>
<a name="ln1585">  { &quot;kodak_portra_160&quot;, _(&quot;Kodak Portra 160&quot;) },</a>
<a name="ln1586">  { &quot;kodak_portra_160_+&quot;, _(&quot;Kodak Portra 160 +&quot;) },</a>
<a name="ln1587">  { &quot;kodak_portra_160_++&quot;, _(&quot;Kodak Portra 160 ++&quot;) },</a>
<a name="ln1588">  { &quot;kodak_portra_400_-&quot;, _(&quot;Kodak Portra 400 -&quot;) },</a>
<a name="ln1589">  { &quot;kodak_portra_400&quot;, _(&quot;Kodak Portra 400&quot;) },</a>
<a name="ln1590">  { &quot;kodak_portra_400_+&quot;, _(&quot;Kodak Portra 400 +&quot;) },</a>
<a name="ln1591">  { &quot;kodak_portra_400_++&quot;, _(&quot;Kodak Portra 400 ++&quot;) },</a>
<a name="ln1592">  { &quot;kodak_portra_800_-&quot;, _(&quot;Kodak Portra 800 -&quot;) },</a>
<a name="ln1593">  { &quot;kodak_portra_800&quot;, _(&quot;Kodak Portra 800&quot;) },</a>
<a name="ln1594">  { &quot;kodak_portra_800_+&quot;, _(&quot;Kodak Portra 800 +&quot;) },</a>
<a name="ln1595">  { &quot;kodak_portra_800_++&quot;, _(&quot;Kodak Portra 800 ++&quot;) },</a>
<a name="ln1596">  { &quot;kodak_tmax_3200_-&quot;, _(&quot;Kodak T-Max 3200 -&quot;) },</a>
<a name="ln1597">  { &quot;kodak_tmax_3200&quot;, _(&quot;Kodak T-Max 3200&quot;) },</a>
<a name="ln1598">  { &quot;kodak_tmax_3200_+&quot;, _(&quot;Kodak T-Max 3200 +&quot;) },</a>
<a name="ln1599">  { &quot;kodak_tmax_3200_++&quot;, _(&quot;Kodak T-Max 3200 ++&quot;) },</a>
<a name="ln1600">  { &quot;kodak_tri-x_400_-&quot;, _(&quot;Kodak Tri-X 400 -&quot;) },</a>
<a name="ln1601">  { &quot;kodak_tri-x_400&quot;, _(&quot;Kodak Tri-X 400&quot;) },</a>
<a name="ln1602">  { &quot;kodak_tri-x_400_+&quot;, _(&quot;Kodak Tri-X 400 +&quot;) },</a>
<a name="ln1603">  { &quot;kodak_tri-x_400_++&quot;, _(&quot;Kodak Tri-X 400 ++&quot;) },</a>
<a name="ln1604">  // negative old</a>
<a name="ln1605">  { &quot;fuji_ilford_delta_3200_-&quot;, _(&quot;Fuji Ilford Delta 3200 -&quot;) },</a>
<a name="ln1606">  { &quot;fuji_ilford_delta_3200&quot;, _(&quot;Fuji Ilford Delta 3200&quot;) },</a>
<a name="ln1607">  { &quot;fuji_ilford_delta_3200_+&quot;, _(&quot;Fuji Ilford Delta 3200 +&quot;) },</a>
<a name="ln1608">  { &quot;fuji_ilford_delta_3200_++&quot;, _(&quot;Fuji Ilford Delta 3200 ++&quot;) },</a>
<a name="ln1609">  { &quot;fuji_superia_100_-&quot;, _(&quot;Fuji Superia 100 -&quot;) },</a>
<a name="ln1610">  { &quot;fuji_superia_100&quot;, _(&quot;Fuji Superia 100&quot;) },</a>
<a name="ln1611">  { &quot;fuji_superia_100_+&quot;, _(&quot;Fuji Superia 100 +&quot;) },</a>
<a name="ln1612">  { &quot;fuji_superia_100_++&quot;, _(&quot;Fuji Superia 100 ++&quot;) },</a>
<a name="ln1613">  { &quot;fuji_superia_400_-&quot;, _(&quot;Fuji Superia 400 -&quot;) },</a>
<a name="ln1614">  { &quot;fuji_superia_400&quot;, _(&quot;Fuji Superia 400&quot;) },</a>
<a name="ln1615">  { &quot;fuji_superia_400_+&quot;, _(&quot;Fuji Superia 400 +&quot;) },</a>
<a name="ln1616">  { &quot;fuji_superia_400_++&quot;, _(&quot;Fuji Superia 400 ++&quot;) },</a>
<a name="ln1617">  { &quot;fuji_superia_800_-&quot;, _(&quot;Fuji Superia 800 -&quot;) },</a>
<a name="ln1618">  { &quot;fuji_superia_800&quot;, _(&quot;Fuji Superia 800&quot;) },</a>
<a name="ln1619">  { &quot;fuji_superia_800_+&quot;, _(&quot;Fuji Superia 800 +&quot;) },</a>
<a name="ln1620">  { &quot;fuji_superia_800_++&quot;, _(&quot;Fuji Superia 800 ++&quot;) },</a>
<a name="ln1621">  { &quot;fuji_superia_1600_-&quot;, _(&quot;Fuji Superia 1600 -&quot;) },</a>
<a name="ln1622">  { &quot;fuji_superia_1600&quot;, _(&quot;Fuji Superia 1600&quot;) },</a>
<a name="ln1623">  { &quot;fuji_superia_1600_+&quot;, _(&quot;Fuji Superia 1600 +&quot;) },</a>
<a name="ln1624">  { &quot;fuji_superia_1600_++&quot;, _(&quot;Fuji Superia 1600 ++&quot;) },</a>
<a name="ln1625">  { &quot;kodak_portra_160_nc_-&quot;, _(&quot;Kodak Portra 160 NC -&quot;) },</a>
<a name="ln1626">  { &quot;kodak_portra_160_nc&quot;, _(&quot;Kodak Portra 160 NC&quot;) },</a>
<a name="ln1627">  { &quot;kodak_portra_160_nc_+&quot;, _(&quot;Kodak Portra 160 NC +&quot;) },</a>
<a name="ln1628">  { &quot;kodak_portra_160_nc_++&quot;, _(&quot;Kodak Portra 160 NC ++&quot;) },</a>
<a name="ln1629">  { &quot;kodak_portra_160_vc_-&quot;, _(&quot;Kodak Portra 160 VC -&quot;) },</a>
<a name="ln1630">  { &quot;kodak_portra_160_vc&quot;, _(&quot;Kodak Portra 160 VC&quot;) },</a>
<a name="ln1631">  { &quot;kodak_portra_160_vc_+&quot;, _(&quot;Kodak Portra 160 VC +&quot;) },</a>
<a name="ln1632">  { &quot;kodak_portra_160_vc_++&quot;, _(&quot;Kodak Portra 160 VC ++&quot;) },</a>
<a name="ln1633">  { &quot;kodak_portra_400_nc_-&quot;, _(&quot;Kodak Portra 400 NC -&quot;) },</a>
<a name="ln1634">  { &quot;kodak_portra_400_nc&quot;, _(&quot;Kodak Portra 400 NC&quot;) },</a>
<a name="ln1635">  { &quot;kodak_portra_400_nc_+&quot;, _(&quot;Kodak Portra 400 NC +&quot;) },</a>
<a name="ln1636">  { &quot;kodak_portra_400_nc_++&quot;, _(&quot;Kodak Portra 400 NC ++&quot;) },</a>
<a name="ln1637">  { &quot;kodak_portra_400_uc_-&quot;, _(&quot;Kodak Portra 400 UC -&quot;) },</a>
<a name="ln1638">  { &quot;kodak_portra_400_uc&quot;, _(&quot;Kodak Portra 400 UC&quot;) },</a>
<a name="ln1639">  { &quot;kodak_portra_400_uc_+&quot;, _(&quot;Kodak Portra 400 UC +&quot;) },</a>
<a name="ln1640">  { &quot;kodak_portra_400_uc_++&quot;, _(&quot;Kodak Portra 400 UC ++&quot;) },</a>
<a name="ln1641">  { &quot;kodak_portra_400_vc_-&quot;, _(&quot;Kodak Portra 400 VC -&quot;) },</a>
<a name="ln1642">  { &quot;kodak_portra_400_vc&quot;, _(&quot;Kodak Portra 400 VC&quot;) },</a>
<a name="ln1643">  { &quot;kodak_portra_400_vc_+&quot;, _(&quot;Kodak Portra 400 VC +&quot;) },</a>
<a name="ln1644">  { &quot;kodak_portra_400_vc_++&quot;, _(&quot;Kodak Portra 400 VC ++&quot;) },</a>
<a name="ln1645">  // Picture FX</a>
<a name="ln1646">  { &quot;analogfx_anno_1870_color&quot;, _(&quot;AnalogFX anno 1870 color&quot;) },</a>
<a name="ln1647">  { &quot;analogfx_old_style_i&quot;, _(&quot;AnalogFX old style I&quot;) },</a>
<a name="ln1648">  { &quot;analogfx_old_style_ii&quot;, _(&quot;AnalogFX old style II&quot;) },</a>
<a name="ln1649">  { &quot;analogfx_old_style_iii&quot;, _(&quot;AnalogFX old style III&quot;) },</a>
<a name="ln1650">  { &quot;analogfx_sepia_color&quot;, _(&quot;AnalogFX sepia color&quot;) },</a>
<a name="ln1651">  { &quot;analogfx_soft_sepia_i&quot;, _(&quot;AnalogFX soft sepia I&quot;) },</a>
<a name="ln1652">  { &quot;analogfx_soft_sepia_ii&quot;, _(&quot;AnalogFX soft sepia II&quot;) },</a>
<a name="ln1653">  { &quot;goldfx_bright_spring_breeze&quot;, _(&quot;GoldFX bright spring breeze&quot;) },</a>
<a name="ln1654">  { &quot;goldfx_bright_summer_heat&quot;, _(&quot;GoldFX bright summer heat&quot;) },</a>
<a name="ln1655">  { &quot;goldfx_hot_summer_heat&quot;, _(&quot;GoldFX hot summer heat&quot;) },</a>
<a name="ln1656">  { &quot;goldfx_perfect_sunset_01min&quot;, _(&quot;GoldFX perfect sunset 1min&quot;) },</a>
<a name="ln1657">  { &quot;goldfx_perfect_sunset_05min&quot;, _(&quot;GoldFX perfect sunset 5min&quot;) },</a>
<a name="ln1658">  { &quot;goldfx_perfect_sunset_10min&quot;, _(&quot;GoldFX perfect sunset 10min&quot;) },</a>
<a name="ln1659">  { &quot;goldfx_spring_breeze&quot;, _(&quot;GoldFX spring breeze&quot;) },</a>
<a name="ln1660">  { &quot;goldfx_summer_heat&quot;, _(&quot;GoldFX summer heat&quot;) },</a>
<a name="ln1661">  { &quot;technicalfx_backlight_filter&quot;, _(&quot;TechnicalFX backlight filter&quot;) },</a>
<a name="ln1662">  { &quot;zilverfx_b_w_solarization&quot;, _(&quot;ZiverFX bw solarization&quot;) },</a>
<a name="ln1663">  { &quot;zilverfx_infrared&quot;, _(&quot;ZiverFX infrared&quot;) },</a>
<a name="ln1664">  { &quot;zilverfx_vintage_b_w&quot;, _(&quot;ZiverFX vintage bw&quot;) },</a>
<a name="ln1665">  // film print</a>
<a name="ln1666">  { &quot;fuji3510_constlclip&quot;, _(&quot;Fuji 3510 constlclip&quot;) },</a>
<a name="ln1667">  { &quot;fuji3510_constlmap&quot;, _(&quot;Fuji 3510 constlmap&quot;) },</a>
<a name="ln1668">  { &quot;fuji3510_cuspclip&quot;, _(&quot;Fuji 3510 cuspclip&quot;) },</a>
<a name="ln1669">  { &quot;fuji3513_constlclip&quot;, _(&quot;Fuji 3513 constlclip&quot;) },</a>
<a name="ln1670">  { &quot;fuji3513_constlmap&quot;, _(&quot;Fuji 3513 constlmap&quot;) },</a>
<a name="ln1671">  { &quot;fuji3513_cuspclip&quot;, _(&quot;Fuji 3513 cuspclip&quot;) },</a>
<a name="ln1672">  { &quot;kodak2383_constlclip&quot;, _(&quot;Kodak 2383 constlclip&quot;) },</a>
<a name="ln1673">  { &quot;kodak2383_constlmap&quot;, _(&quot;Kodak 2383 constlmap&quot;) },</a>
<a name="ln1674">  { &quot;kodak2383_cuspclip&quot;, _(&quot;Kodak 2383 cuspclip&quot;) },</a>
<a name="ln1675">  { &quot;kodak2393_constlclip&quot;, _(&quot;Kodak 2393 constlclip&quot;) },</a>
<a name="ln1676">  { &quot;kodak2393_constlmap&quot;, _(&quot;Kodak 2393 constlmap&quot;) },</a>
<a name="ln1677">  { &quot;kodak2393_cuspclip&quot;, _(&quot;Kodak 2393 cuspclip&quot;) },</a>
<a name="ln1678">  // slide color</a>
<a name="ln1679">  { &quot;agfa_precisa_100&quot;, _(&quot;Agfa Precisa 100&quot;) },</a>
<a name="ln1680">  { &quot;fuji_astia_100f&quot;, _(&quot;Fuji Astia 100f&quot;) },</a>
<a name="ln1681">  { &quot;fuji_fp_100c&quot;, _(&quot;Fuji FP-100c&quot;) },</a>
<a name="ln1682">  { &quot;fuji_provia_100f&quot;, _(&quot;Fuji Provia 100F&quot;) },</a>
<a name="ln1683">  { &quot;fuji_provia_400f&quot;, _(&quot;Fuji Provia 400F&quot;) },</a>
<a name="ln1684">  { &quot;fuji_provia_400x&quot;, _(&quot;Fuji Provia 400X&quot;) },</a>
<a name="ln1685">  { &quot;fuji_sensia_100&quot;, _(&quot;Fuji Sensia 100&quot;) },</a>
<a name="ln1686">  { &quot;fuji_superia_200_xpro&quot;, _(&quot;Fuji Superia 200 XPRO&quot;) },</a>
<a name="ln1687">  { &quot;fuji_velvia_50&quot;, _(&quot;Fuji Velvia 50&quot;) },</a>
<a name="ln1688">  { &quot;generic_fuji_astia_100&quot;, _(&quot;generic Fuji Astia 100&quot;) },</a>
<a name="ln1689">  { &quot;generic_fuji_provia_100&quot;, _(&quot;generic Fuji Provia 100&quot;) },</a>
<a name="ln1690">  { &quot;generic_fuji_velvia_100&quot;, _(&quot;generic Fuji Aelvia 100&quot;) },</a>
<a name="ln1691">  { &quot;generic_kodachrome_64&quot;, _(&quot;generic Kodachrome 64&quot;) },</a>
<a name="ln1692">  { &quot;generic_kodak_ektachrome_100_vs&quot;, _(&quot;generic Kodak Ektachrome 100 VS&quot;) },</a>
<a name="ln1693">  { &quot;kodak_e-100_gx_ektachrome_100&quot;, _(&quot;Kodak E-100 GX Ektachrome 100&quot;) },</a>
<a name="ln1694">  { &quot;kodak_ektachrome_100_vs&quot;, _(&quot;Kodak Ektachrome 100 VS&quot;) },</a>
<a name="ln1695">  { &quot;kodak_elite_chrome_200&quot;, _(&quot;Kodak Elite Chrome 200&quot;) },</a>
<a name="ln1696">  { &quot;kodak_elite_chrome_400&quot;, _(&quot;Kodak Elite Chrome 400&quot;) },</a>
<a name="ln1697">  { &quot;kodak_elite_extracolor_100&quot;, _(&quot;Kodak Elite Extracolor 100&quot;) },</a>
<a name="ln1698">  { &quot;kodak_kodachrome_200&quot;, _(&quot;Kodak Kodachrome 200&quot;) },</a>
<a name="ln1699">  { &quot;kodak_kodachrome_25&quot;, _(&quot;Kodak Kodachrome 25&quot;) },</a>
<a name="ln1700">  { &quot;kodak_kodachrome_64&quot;, _(&quot;Kodak Kodachrome 64&quot;) },</a>
<a name="ln1701">  { &quot;lomography_x-pro_slide_200&quot;, _(&quot;Lomography X-Pro Slide 200&quot;) },</a>
<a name="ln1702">  { &quot;polaroid_polachrome&quot;, _(&quot;Polaroid Polachrome&quot;) },</a>
<a name="ln1703">  // various</a>
<a name="ln1704">  { &quot;60's&quot;, _(&quot;60's&quot;) },</a>
<a name="ln1705">  { &quot;60's_faded&quot;, _(&quot;60's faded&quot;) },</a>
<a name="ln1706">  { &quot;60's_faded_alt&quot;, _(&quot;60's faded alt&quot;) },</a>
<a name="ln1707">  { &quot;alien_green&quot;, _(&quot;alien green&quot;) },</a>
<a name="ln1708">  { &quot;black_and_white&quot;, _(&quot;black and white&quot;) },</a>
<a name="ln1709">  { &quot;bleach_bypass&quot;, _(&quot;bleach bypass&quot;) },</a>
<a name="ln1710">  { &quot;blue_mono&quot;, _(&quot;blue mono&quot;) },</a>
<a name="ln1711">  { &quot;color_rich&quot;, _(&quot;color rich&quot;) },</a>
<a name="ln1712">  { &quot;faded&quot;, _(&quot;faded&quot;) },</a>
<a name="ln1713">  { &quot;faded_alt&quot;, _(&quot;faded alt&quot;) },</a>
<a name="ln1714">  { &quot;faded_analog&quot;, _(&quot;faded analog&quot;) },</a>
<a name="ln1715">  { &quot;faded_extreme&quot;, _(&quot;faded extreme&quot;) },</a>
<a name="ln1716">  { &quot;faded_vivid&quot;, _(&quot;faded vivid&quot;) },</a>
<a name="ln1717">  { &quot;expired_fade&quot;, _(&quot;expired fade&quot;) },</a>
<a name="ln1718">  { &quot;expired_polaroid&quot;, _(&quot;expired Polaroid&quot;) },</a>
<a name="ln1719">  { &quot;extreme&quot;, _(&quot;extreme&quot;) },</a>
<a name="ln1720">  { &quot;fade&quot;, _(&quot;fade&quot;) },</a>
<a name="ln1721">  { &quot;faux_infrared&quot;, _(&quot;faux infrared&quot;) },</a>
<a name="ln1722">  { &quot;golden&quot;, _(&quot;golden&quot;) },</a>
<a name="ln1723">  { &quot;golden_bright&quot;, _(&quot;golden bright&quot;) },</a>
<a name="ln1724">  { &quot;golden_fade&quot;, _(&quot;golden fade&quot;) },</a>
<a name="ln1725">  { &quot;golden_mono&quot;, _(&quot;golden mono&quot;) },</a>
<a name="ln1726">  { &quot;golden_vibrant&quot;, _(&quot;golden vibrant&quot;) },</a>
<a name="ln1727">  { &quot;green_mono&quot;, _(&quot;green mono&quot;) },</a>
<a name="ln1728">  { &quot;hong_kong&quot;, _(&quot;hong kong&quot;) },</a>
<a name="ln1729">  { &quot;light_blown&quot;, _(&quot;light blown&quot;) },</a>
<a name="ln1730">  { &quot;lomo&quot;, _(&quot;lomo&quot;) },</a>
<a name="ln1731">  { &quot;mono_tinted&quot;, _(&quot;mono tinted&quot;) },</a>
<a name="ln1732">  { &quot;muted_fade&quot;, _(&quot;muted fade&quot;) },</a>
<a name="ln1733">  { &quot;mute_shift&quot;, _(&quot;mute shift&quot;) },</a>
<a name="ln1734">  { &quot;natural_vivid&quot;, _(&quot;natural vivid&quot;) },</a>
<a name="ln1735">  { &quot;nostalgic&quot;, _(&quot;nostalgic&quot;) },</a>
<a name="ln1736">  { &quot;orange_tone&quot;, _(&quot;orange tone&quot;) },</a>
<a name="ln1737">  { &quot;pink_fade&quot;, _(&quot;pink fade&quot;) },</a>
<a name="ln1738">  { &quot;purple&quot;, _(&quot;purple&quot;) },</a>
<a name="ln1739">  { &quot;retro&quot;, _(&quot;retro&quot;) },</a>
<a name="ln1740">  { &quot;rotate_muted&quot;, _(&quot;rotate muted&quot;) },</a>
<a name="ln1741">  { &quot;rotate_vibrant&quot;, _(&quot;rotate vibrant&quot;) },</a>
<a name="ln1742">  { &quot;rotated&quot;, _(&quot;rotated&quot;) },</a>
<a name="ln1743">  { &quot;rotated_crush&quot;, _(&quot;rotated crush&quot;) },</a>
<a name="ln1744">  { &quot;smooth_cromeish&quot;, _(&quot;smooth cromeish&quot;) },</a>
<a name="ln1745">  { &quot;smooth_fade&quot;, _(&quot;smooth fade&quot;) },</a>
<a name="ln1746">  { &quot;soft_fade&quot;, _(&quot;soft fade&quot;) },</a>
<a name="ln1747">  { &quot;solarized_color&quot;, _(&quot;solarized color&quot;) },</a>
<a name="ln1748">  { &quot;solarized_color2&quot;, _(&quot;solarized color2&quot;) },</a>
<a name="ln1749">  { &quot;summer&quot;, _(&quot;summer&quot;) },</a>
<a name="ln1750">  { &quot;summer_alt&quot;, _(&quot;summer alt&quot;) },</a>
<a name="ln1751">  { &quot;sunny&quot;, _(&quot;sunny&quot;) },</a>
<a name="ln1752">  { &quot;sunny_alt&quot;, _(&quot;sunny alt&quot;) },</a>
<a name="ln1753">  { &quot;sunny_rich&quot;, _(&quot;sunny rich&quot;) },</a>
<a name="ln1754">  { &quot;sunny_warm&quot;, _(&quot;sunny warm&quot;) },</a>
<a name="ln1755">  { &quot;super_warm&quot;, _(&quot;super warm&quot;) },</a>
<a name="ln1756">  { &quot;super_warm_rich&quot;, _(&quot;super warm rich&quot;) },</a>
<a name="ln1757">  { &quot;sutro_fx&quot;, _(&quot;Sutro FX&quot;) },</a>
<a name="ln1758">  { &quot;vibrant&quot;, _(&quot;vibrant&quot;) },</a>
<a name="ln1759">  { &quot;vibrant_alien&quot;, _(&quot;vibrant alien&quot;) },</a>
<a name="ln1760">  { &quot;vibrant_contrast&quot;, _(&quot;vibrant contrast&quot;) },</a>
<a name="ln1761">  { &quot;vibrant_cromeish&quot;, _(&quot;vibrant cromeish&quot;) },</a>
<a name="ln1762">  { &quot;vintage&quot;, _(&quot;vintage&quot;) },</a>
<a name="ln1763">  { &quot;vintage_alt&quot;, _(&quot;vintage alt&quot;) },</a>
<a name="ln1764">  { &quot;vintage_brighter&quot;, _(&quot;vintage brighter&quot;) },</a>
<a name="ln1765">  { &quot;warm&quot;, _(&quot;warm&quot;) },</a>
<a name="ln1766">  { &quot;warm_highlight&quot;, _(&quot;warm highlight&quot;) },</a>
<a name="ln1767">  { &quot;warm_yellow&quot;, _(&quot;warm yellow&quot;) }</a>
<a name="ln1768">};</a>
<a name="ln1769"> </a>
<a name="ln1770">// --- custom film emulation</a>
<a name="ln1771"> </a>
<a name="ln1772">dt_iop_gmic_custom_film_emulation_params_t::dt_iop_gmic_custom_film_emulation_params_t()</a>
<a name="ln1773">{</a>
<a name="ln1774">  if(not film_maps.empty()) std::snprintf(film, sizeof(film), &quot;%s&quot;, film_maps[0].film_type.c_str());</a>
<a name="ln1775">}</a>
<a name="ln1776"> </a>
<a name="ln1777">dt_iop_gmic_custom_film_emulation_params_t::dt_iop_gmic_custom_film_emulation_params_t(</a>
<a name="ln1778">    const dt_iop_gmic_params_t &amp;other)</a>
<a name="ln1779">  : dt_iop_gmic_custom_film_emulation_params_t()</a>
<a name="ln1780">{</a>
<a name="ln1781">  dt_iop_gmic_custom_film_emulation_params_t p;</a>
<a name="ln1782">  if(other.filter == custom_film_emulation</a>
<a name="ln1783">     and std::sscanf(other.parameters, &quot;dt_custom_film_emulation \&quot;%1023[^\&quot;]\&quot;,%g,%g,%g,%g,%g,%g,%i&quot;,</a>
<a name="ln1784">                     reinterpret_cast&lt;char *&gt;(&amp;p.film), &amp;p.strength, &amp;p.brightness, &amp;p.contrast, &amp;p.gamma, &amp;p.hue,</a>
<a name="ln1785">                     &amp;p.saturation, &amp;p.normalize_colors)</a>
<a name="ln1786">             == 8)</a>
<a name="ln1787">  {</a>
<a name="ln1788">    p.strength = clamp(0.f, 1.f, p.strength);</a>
<a name="ln1789">    p.brightness = clamp(-1.f, 1.f, p.brightness);</a>
<a name="ln1790">    p.contrast = clamp(-1.f, 1.f, p.contrast);</a>
<a name="ln1791">    p.gamma = clamp(-1.f, 1.f, p.gamma);</a>
<a name="ln1792">    p.hue = clamp(-1.f, 1.f, p.hue);</a>
<a name="ln1793">    p.saturation = clamp(-1.f, 1.f, p.saturation);</a>
<a name="ln1794">    p.normalize_colors = clamp(0, 1, p.normalize_colors);</a>
<a name="ln1795">    *this = p;</a>
<a name="ln1796">  }</a>
<a name="ln1797">}</a>
<a name="ln1798"> </a>
<a name="ln1799">dt_iop_gmic_params_t dt_iop_gmic_custom_film_emulation_params_t::to_gmic_params() const</a>
<a name="ln1800">{</a>
<a name="ln1801">  dt_iop_gmic_params_t ret;</a>
<a name="ln1802">  ret.filter = custom_film_emulation;</a>
<a name="ln1803">  if(std::strlen(film) &gt; 0 and (not film_maps.empty()))</a>
<a name="ln1804">    std::snprintf(ret.parameters, sizeof(ret.parameters), &quot;dt_custom_film_emulation \&quot;%s\&quot;,%g,%g,%g,%g,%g,%g,%i&quot;,</a>
<a name="ln1805">                  film, strength, brightness, contrast, gamma, hue, saturation, normalize_colors);</a>
<a name="ln1806">  return ret;</a>
<a name="ln1807">}</a>
<a name="ln1808"> </a>
<a name="ln1809">const char *dt_iop_gmic_custom_film_emulation_params_t::get_custom_command()</a>
<a name="ln1810">{</a>
<a name="ln1811">  // clang-format off</a>
<a name="ln1812">  return R&quot;raw(</a>
<a name="ln1813">dt_custom_film_emulation :</a>
<a name="ln1814">  input_cube &quot;$1&quot;</a>
<a name="ln1815">  repeat {$!-1}</a>
<a name="ln1816">    if {$8%2} balance_gamma[$&gt;] , fi</a>
<a name="ln1817">    if {$2&lt;1} +map_clut[$&gt;] . j[$&gt;] .,0,0,0,0,{$2} rm.</a>
<a name="ln1818">    else map_clut[$&gt;] .</a>
<a name="ln1819">    fi</a>
<a name="ln1820">  done</a>
<a name="ln1821">  rm.</a>
<a name="ln1822">  adjust_colors {100*$3},{100*$4},{100*$5},{100*$6},{100*$7},0,255</a>
<a name="ln1823">  if {$8&gt;1} repeat $! l[$&gt;] split_opacity n[0] 0,255 a c endl done fi</a>
<a name="ln1824">)raw&quot;;</a>
<a name="ln1825">  // clang-format on</a>
<a name="ln1826">}</a>
<a name="ln1827"> </a>
<a name="ln1828">filter_type dt_iop_gmic_custom_film_emulation_params_t::get_filter() const</a>
<a name="ln1829">{</a>
<a name="ln1830">  return custom_film_emulation;</a>
<a name="ln1831">}</a>
<a name="ln1832"> </a>
<a name="ln1833">void dt_iop_gmic_custom_film_emulation_params_t::gui_init(dt_iop_module_t *self) const</a>
<a name="ln1834">{</a>
<a name="ln1835">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln1836">  dt_iop_gmic_params_t *p = reinterpret_cast&lt;dt_iop_gmic_params_t *&gt;(self-&gt;params);</a>
<a name="ln1837">  if(p-&gt;filter == custom_film_emulation)</a>
<a name="ln1838">    g-&gt;custom_film_emulation.parameters = *p;</a>
<a name="ln1839">  else</a>
<a name="ln1840">    g-&gt;custom_film_emulation.parameters = dt_iop_gmic_custom_film_emulation_params_t();</a>
<a name="ln1841">  dt_bauhaus_combobox_add(g-&gt;gmic_filter, _(&quot;custom film emulation&quot;));</a>
<a name="ln1842">  g-&gt;custom_film_emulation.box = gtk_box_new(GTK_ORIENTATION_VERTICAL, DT_BAUHAUS_SPACE);</a>
<a name="ln1843">  gtk_box_pack_start(GTK_BOX(self-&gt;widget), g-&gt;custom_film_emulation.box, TRUE, TRUE, 0);</a>
<a name="ln1844"> </a>
<a name="ln1845">  if(not film_maps.empty())</a>
<a name="ln1846">  {</a>
<a name="ln1847">    g-&gt;custom_film_emulation.film = dt_bauhaus_combobox_new(self);</a>
<a name="ln1848">    for(const auto &amp;film_map : film_maps)</a>
<a name="ln1849">    {</a>
<a name="ln1850">      dt_bauhaus_combobox_add_aligned(g-&gt;custom_film_emulation.film, film_map.printable.c_str(),</a>
<a name="ln1851">                                      DT_BAUHAUS_COMBOBOX_ALIGN_LEFT);</a>
<a name="ln1852">      g-&gt;custom_film_emulation.film_list.push_back(film_map.film_type);</a>
<a name="ln1853">    }</a>
<a name="ln1854">    // dt_bauhaus_widget_set_label(g-&gt;custom_film_emulation.film, NULL, _(&quot;film type&quot;));</a>
<a name="ln1855">    gtk_widget_set_tooltip_text(g-&gt;custom_film_emulation.film, _(&quot;choose emulated film type&quot;));</a>
<a name="ln1856">    gtk_box_pack_start(GTK_BOX(g-&gt;custom_film_emulation.box), g-&gt;custom_film_emulation.film, TRUE, TRUE, 0);</a>
<a name="ln1857">    g_signal_connect(G_OBJECT(g-&gt;custom_film_emulation.film), &quot;value-changed&quot;,</a>
<a name="ln1858">                     G_CALLBACK(dt_iop_gmic_custom_film_emulation_params_t::film_callback), self);</a>
<a name="ln1859"> </a>
<a name="ln1860">    g-&gt;custom_film_emulation.strength</a>
<a name="ln1861">        = dt_bauhaus_slider_new_with_range(self, 0, 1, 0.01, g-&gt;custom_film_emulation.parameters.strength, 3);</a>
<a name="ln1862">    dt_bauhaus_widget_set_label(g-&gt;custom_film_emulation.strength, NULL, _(&quot;strength&quot;));</a>
<a name="ln1863">    gtk_widget_set_tooltip_text(g-&gt;custom_film_emulation.strength, _(&quot;strength of the film emulation effect&quot;));</a>
<a name="ln1864">    gtk_box_pack_start(GTK_BOX(g-&gt;custom_film_emulation.box), GTK_WIDGET(g-&gt;custom_film_emulation.strength), TRUE,</a>
<a name="ln1865">                       TRUE, 0);</a>
<a name="ln1866">    g_signal_connect(G_OBJECT(g-&gt;custom_film_emulation.strength), &quot;value-changed&quot;,</a>
<a name="ln1867">                     G_CALLBACK(dt_iop_gmic_custom_film_emulation_params_t::strength_callback), self);</a>
<a name="ln1868"> </a>
<a name="ln1869">    g-&gt;custom_film_emulation.brightness</a>
<a name="ln1870">        = dt_bauhaus_slider_new_with_range(self, -1, 1, 0.01, g-&gt;custom_film_emulation.parameters.brightness, 3);</a>
<a name="ln1871">    dt_bauhaus_widget_set_label(g-&gt;custom_film_emulation.brightness, NULL, _(&quot;brightness&quot;));</a>
<a name="ln1872">    gtk_widget_set_tooltip_text(g-&gt;custom_film_emulation.brightness, _(&quot;brightness of the film emulation effect&quot;));</a>
<a name="ln1873">    gtk_box_pack_start(GTK_BOX(g-&gt;custom_film_emulation.box), GTK_WIDGET(g-&gt;custom_film_emulation.brightness),</a>
<a name="ln1874">                       TRUE, TRUE, 0);</a>
<a name="ln1875">    g_signal_connect(G_OBJECT(g-&gt;custom_film_emulation.brightness), &quot;value-changed&quot;,</a>
<a name="ln1876">                     G_CALLBACK(dt_iop_gmic_custom_film_emulation_params_t::brightness_callback), self);</a>
<a name="ln1877"> </a>
<a name="ln1878">    g-&gt;custom_film_emulation.contrast</a>
<a name="ln1879">        = dt_bauhaus_slider_new_with_range(self, -1, 1, 0.01, g-&gt;custom_film_emulation.parameters.contrast, 3);</a>
<a name="ln1880">    dt_bauhaus_widget_set_label(g-&gt;custom_film_emulation.contrast, NULL, _(&quot;contrast&quot;));</a>
<a name="ln1881">    gtk_widget_set_tooltip_text(g-&gt;custom_film_emulation.contrast, _(&quot;contrast of the film emulation effect&quot;));</a>
<a name="ln1882">    gtk_box_pack_start(GTK_BOX(g-&gt;custom_film_emulation.box), GTK_WIDGET(g-&gt;custom_film_emulation.contrast), TRUE,</a>
<a name="ln1883">                       TRUE, 0);</a>
<a name="ln1884">    g_signal_connect(G_OBJECT(g-&gt;custom_film_emulation.contrast), &quot;value-changed&quot;,</a>
<a name="ln1885">                     G_CALLBACK(dt_iop_gmic_custom_film_emulation_params_t::contrast_callback), self);</a>
<a name="ln1886"> </a>
<a name="ln1887">    g-&gt;custom_film_emulation.gamma</a>
<a name="ln1888">        = dt_bauhaus_slider_new_with_range(self, -1, 1, 0.01, g-&gt;custom_film_emulation.parameters.gamma, 3);</a>
<a name="ln1889">    dt_bauhaus_widget_set_label(g-&gt;custom_film_emulation.gamma, NULL, _(&quot;gamma&quot;));</a>
<a name="ln1890">    gtk_widget_set_tooltip_text(g-&gt;custom_film_emulation.gamma, _(&quot;gamma value of the film emulation effect&quot;));</a>
<a name="ln1891">    gtk_box_pack_start(GTK_BOX(g-&gt;custom_film_emulation.box), GTK_WIDGET(g-&gt;custom_film_emulation.gamma), TRUE,</a>
<a name="ln1892">                       TRUE, 0);</a>
<a name="ln1893">    g_signal_connect(G_OBJECT(g-&gt;custom_film_emulation.gamma), &quot;value-changed&quot;,</a>
<a name="ln1894">                     G_CALLBACK(dt_iop_gmic_custom_film_emulation_params_t::gamma_callback), self);</a>
<a name="ln1895"> </a>
<a name="ln1896">    g-&gt;custom_film_emulation.hue</a>
<a name="ln1897">        = dt_bauhaus_slider_new_with_range(self, -1, 1, 0.01, g-&gt;custom_film_emulation.parameters.hue, 3);</a>
<a name="ln1898">    dt_bauhaus_widget_set_label(g-&gt;custom_film_emulation.hue, NULL, _(&quot;hue&quot;));</a>
<a name="ln1899">    gtk_widget_set_tooltip_text(g-&gt;custom_film_emulation.hue, _(&quot;hue shift of the film emulation effect&quot;));</a>
<a name="ln1900">    gtk_box_pack_start(GTK_BOX(g-&gt;custom_film_emulation.box), GTK_WIDGET(g-&gt;custom_film_emulation.hue), TRUE, TRUE,</a>
<a name="ln1901">                       0);</a>
<a name="ln1902">    g_signal_connect(G_OBJECT(g-&gt;custom_film_emulation.hue), &quot;value-changed&quot;,</a>
<a name="ln1903">                     G_CALLBACK(dt_iop_gmic_custom_film_emulation_params_t::hue_callback), self);</a>
<a name="ln1904"> </a>
<a name="ln1905">    g-&gt;custom_film_emulation.saturation</a>
<a name="ln1906">        = dt_bauhaus_slider_new_with_range(self, -1, 1, 0.01, g-&gt;custom_film_emulation.parameters.saturation, 3);</a>
<a name="ln1907">    dt_bauhaus_widget_set_label(g-&gt;custom_film_emulation.saturation, NULL, _(&quot;saturation&quot;));</a>
<a name="ln1908">    gtk_widget_set_tooltip_text(g-&gt;custom_film_emulation.saturation, _(&quot;saturation of the film emulation effect&quot;));</a>
<a name="ln1909">    gtk_box_pack_start(GTK_BOX(g-&gt;custom_film_emulation.box), GTK_WIDGET(g-&gt;custom_film_emulation.saturation),</a>
<a name="ln1910">                       TRUE, TRUE, 0);</a>
<a name="ln1911">    g_signal_connect(G_OBJECT(g-&gt;custom_film_emulation.saturation), &quot;value-changed&quot;,</a>
<a name="ln1912">                     G_CALLBACK(dt_iop_gmic_custom_film_emulation_params_t::saturation_callback), self);</a>
<a name="ln1913"> </a>
<a name="ln1914">    g-&gt;custom_film_emulation.normalize_colors = dt_bauhaus_combobox_new(self);</a>
<a name="ln1915">    dt_bauhaus_combobox_add(g-&gt;custom_film_emulation.normalize_colors, _(&quot;none&quot;));</a>
<a name="ln1916">    dt_bauhaus_combobox_add(g-&gt;custom_film_emulation.normalize_colors, _(&quot;pre-process&quot;));</a>
<a name="ln1917">    dt_bauhaus_combobox_add(g-&gt;custom_film_emulation.normalize_colors, _(&quot;post-process&quot;));</a>
<a name="ln1918">    dt_bauhaus_combobox_add(g-&gt;custom_film_emulation.normalize_colors, _(&quot;both&quot;));</a>
<a name="ln1919">    dt_bauhaus_combobox_set(g-&gt;custom_film_emulation.normalize_colors,</a>
<a name="ln1920">                            g-&gt;custom_film_emulation.parameters.normalize_colors);</a>
<a name="ln1921">    dt_bauhaus_widget_set_label(g-&gt;custom_film_emulation.normalize_colors, NULL, _(&quot;normalize colors&quot;));</a>
<a name="ln1922">    gtk_widget_set_tooltip_text(g-&gt;custom_film_emulation.normalize_colors, _(&quot;choose how to normalize colors&quot;));</a>
<a name="ln1923">    gtk_box_pack_start(GTK_BOX(g-&gt;custom_film_emulation.box), g-&gt;custom_film_emulation.normalize_colors, TRUE,</a>
<a name="ln1924">                       TRUE, 0);</a>
<a name="ln1925">    g_signal_connect(G_OBJECT(g-&gt;custom_film_emulation.normalize_colors), &quot;value-changed&quot;,</a>
<a name="ln1926">                     G_CALLBACK(dt_iop_gmic_custom_film_emulation_params_t::normalize_colors_callback), self);</a>
<a name="ln1927">  }</a>
<a name="ln1928">  gtk_widget_show_all(g-&gt;custom_film_emulation.box);</a>
<a name="ln1929">  gtk_widget_set_no_show_all(g-&gt;custom_film_emulation.box, TRUE);</a>
<a name="ln1930">  gtk_widget_set_visible(g-&gt;custom_film_emulation.box, p-&gt;filter == custom_film_emulation ? TRUE : FALSE);</a>
<a name="ln1931">}</a>
<a name="ln1932"> </a>
<a name="ln1933">void dt_iop_gmic_custom_film_emulation_params_t::gui_update(dt_iop_module_t *self) const</a>
<a name="ln1934">{</a>
<a name="ln1935">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln1936">  dt_iop_gmic_params_t *p = reinterpret_cast&lt;dt_iop_gmic_params_t *&gt;(self-&gt;params);</a>
<a name="ln1937">  gtk_widget_set_visible(g-&gt;custom_film_emulation.box, p-&gt;filter == custom_film_emulation ? TRUE : FALSE);</a>
<a name="ln1938">  if(p-&gt;filter == custom_film_emulation and (not film_maps.empty()))</a>
<a name="ln1939">  {</a>
<a name="ln1940">    g-&gt;custom_film_emulation.parameters = *p;</a>
<a name="ln1941">    auto i = std::find(g-&gt;custom_film_emulation.film_list.begin(), g-&gt;custom_film_emulation.film_list.end(),</a>
<a name="ln1942">                       g-&gt;custom_film_emulation.parameters.film);</a>
<a name="ln1943">    if(i != g-&gt;custom_film_emulation.film_list.end())</a>
<a name="ln1944">      dt_bauhaus_combobox_set(g-&gt;custom_film_emulation.film,</a>
<a name="ln1945">                              static_cast&lt;int&gt;(i - g-&gt;custom_film_emulation.film_list.begin()));</a>
<a name="ln1946">    dt_bauhaus_slider_set(g-&gt;custom_film_emulation.strength, g-&gt;custom_film_emulation.parameters.strength);</a>
<a name="ln1947">    dt_bauhaus_slider_set(g-&gt;custom_film_emulation.brightness, g-&gt;custom_film_emulation.parameters.brightness);</a>
<a name="ln1948">    dt_bauhaus_slider_set(g-&gt;custom_film_emulation.contrast, g-&gt;custom_film_emulation.parameters.contrast);</a>
<a name="ln1949">    dt_bauhaus_slider_set(g-&gt;custom_film_emulation.gamma, g-&gt;custom_film_emulation.parameters.gamma);</a>
<a name="ln1950">    dt_bauhaus_slider_set(g-&gt;custom_film_emulation.hue, g-&gt;custom_film_emulation.parameters.hue);</a>
<a name="ln1951">    dt_bauhaus_slider_set(g-&gt;custom_film_emulation.saturation, g-&gt;custom_film_emulation.parameters.saturation);</a>
<a name="ln1952">    dt_bauhaus_combobox_set(g-&gt;custom_film_emulation.normalize_colors,</a>
<a name="ln1953">                            g-&gt;custom_film_emulation.parameters.normalize_colors);</a>
<a name="ln1954">  }</a>
<a name="ln1955">}</a>
<a name="ln1956"> </a>
<a name="ln1957">void dt_iop_gmic_custom_film_emulation_params_t::gui_reset(dt_iop_module_t *self)</a>
<a name="ln1958">{</a>
<a name="ln1959">  *this = dt_iop_gmic_custom_film_emulation_params_t();</a>
<a name="ln1960">}</a>
<a name="ln1961"> </a>
<a name="ln1962">void dt_iop_gmic_custom_film_emulation_params_t::film_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln1963">{</a>
<a name="ln1964">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln1965">    std::snprintf(G-&gt;custom_film_emulation.parameters.film, sizeof(G-&gt;custom_film_emulation.parameters.film), &quot;%s&quot;,</a>
<a name="ln1966">                  film_maps[dt_bauhaus_combobox_get(W)].film_type.c_str());</a>
<a name="ln1967">    return G-&gt;custom_film_emulation.parameters.to_gmic_params();</a>
<a name="ln1968">  });</a>
<a name="ln1969">}</a>
<a name="ln1970"> </a>
<a name="ln1971">void dt_iop_gmic_custom_film_emulation_params_t::strength_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln1972">{</a>
<a name="ln1973">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln1974">    G-&gt;custom_film_emulation.parameters.strength = dt_bauhaus_slider_get(W);</a>
<a name="ln1975">    return G-&gt;custom_film_emulation.parameters.to_gmic_params();</a>
<a name="ln1976">  });</a>
<a name="ln1977">}</a>
<a name="ln1978"> </a>
<a name="ln1979">void dt_iop_gmic_custom_film_emulation_params_t::brightness_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln1980">{</a>
<a name="ln1981">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln1982">    G-&gt;custom_film_emulation.parameters.brightness = dt_bauhaus_slider_get(W);</a>
<a name="ln1983">    return G-&gt;custom_film_emulation.parameters.to_gmic_params();</a>
<a name="ln1984">  });</a>
<a name="ln1985">}</a>
<a name="ln1986"> </a>
<a name="ln1987">void dt_iop_gmic_custom_film_emulation_params_t::contrast_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln1988">{</a>
<a name="ln1989">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln1990">    G-&gt;custom_film_emulation.parameters.contrast = dt_bauhaus_slider_get(W);</a>
<a name="ln1991">    return G-&gt;custom_film_emulation.parameters.to_gmic_params();</a>
<a name="ln1992">  });</a>
<a name="ln1993">}</a>
<a name="ln1994"> </a>
<a name="ln1995">void dt_iop_gmic_custom_film_emulation_params_t::gamma_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln1996">{</a>
<a name="ln1997">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln1998">    G-&gt;custom_film_emulation.parameters.gamma = dt_bauhaus_slider_get(W);</a>
<a name="ln1999">    return G-&gt;custom_film_emulation.parameters.to_gmic_params();</a>
<a name="ln2000">  });</a>
<a name="ln2001">}</a>
<a name="ln2002"> </a>
<a name="ln2003">void dt_iop_gmic_custom_film_emulation_params_t::hue_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln2004">{</a>
<a name="ln2005">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln2006">    G-&gt;custom_film_emulation.parameters.hue = dt_bauhaus_slider_get(W);</a>
<a name="ln2007">    return G-&gt;custom_film_emulation.parameters.to_gmic_params();</a>
<a name="ln2008">  });</a>
<a name="ln2009">}</a>
<a name="ln2010"> </a>
<a name="ln2011">void dt_iop_gmic_custom_film_emulation_params_t::saturation_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln2012">{</a>
<a name="ln2013">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln2014">    G-&gt;custom_film_emulation.parameters.saturation = dt_bauhaus_slider_get(W);</a>
<a name="ln2015">    return G-&gt;custom_film_emulation.parameters.to_gmic_params();</a>
<a name="ln2016">  });</a>
<a name="ln2017">}</a>
<a name="ln2018"> </a>
<a name="ln2019">void dt_iop_gmic_custom_film_emulation_params_t::normalize_colors_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln2020">{</a>
<a name="ln2021">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln2022">    G-&gt;custom_film_emulation.parameters.normalize_colors = dt_bauhaus_combobox_get(W);</a>
<a name="ln2023">    return G-&gt;custom_film_emulation.parameters.to_gmic_params();</a>
<a name="ln2024">  });</a>
<a name="ln2025">}</a>
<a name="ln2026"> </a>
<a name="ln2027">const std::vector&lt;film_map&gt; dt_iop_gmic_custom_film_emulation_params_t::film_maps{ []() {</a>
<a name="ln2028">  std::vector&lt;film_map&gt; map;</a>
<a name="ln2029">  char p[PATH_MAX + 1];</a>
<a name="ln2030">  dt_loc_get_user_config_dir(p, sizeof(p));</a>
<a name="ln2031">  std::string path(p);</a>
<a name="ln2032">  path += &quot;/luts/&quot;;</a>
<a name="ln2033">  DIR *dirp = opendir(path.c_str());</a>
<a name="ln2034">  if(dirp != nullptr)</a>
<a name="ln2035">  {</a>
<a name="ln2036">    struct dirent *dp;</a>
<a name="ln2037">    while((dp = readdir(dirp)) != NULL)</a>
<a name="ln2038">    {</a>
<a name="ln2039">      if(dp-&gt;d_type == DT_REG)</a>
<a name="ln2040">      {</a>
<a name="ln2041">        map.push_back(film_map(path + dp-&gt;d_name, dp-&gt;d_name));</a>
<a name="ln2042">      }</a>
<a name="ln2043">    }</a>
<a name="ln2044">    closedir(dirp);</a>
<a name="ln2045">  }</a>
<a name="ln2046">  std::sort(map.begin(), map.end(), [](const film_map &amp;a, const film_map &amp;b) { return a.printable &lt; b.printable; });</a>
<a name="ln2047">  return map;</a>
<a name="ln2048">}() };</a>
<a name="ln2049"> </a>
<a name="ln2050">// --- freaky details</a>
<a name="ln2051"> </a>
<a name="ln2052">dt_iop_gmic_freaky_details_params_t::dt_iop_gmic_freaky_details_params_t(const dt_iop_gmic_params_t &amp;other)</a>
<a name="ln2053">  : dt_iop_gmic_freaky_details_params_t()</a>
<a name="ln2054">{</a>
<a name="ln2055">  dt_iop_gmic_freaky_details_params_t p;</a>
<a name="ln2056">  if(other.filter == freaky_details</a>
<a name="ln2057">     and std::sscanf(other.parameters, &quot;dt_freaky_details %d,%g,%d,%d&quot;, &amp;p.amplitude, &amp;p.scale, &amp;p.iterations,</a>
<a name="ln2058">                     &amp;p.channel)</a>
<a name="ln2059">             == 4)</a>
<a name="ln2060">  {</a>
<a name="ln2061">    p.amplitude = clamp(1, 5, p.amplitude);</a>
<a name="ln2062">    p.scale = clamp(1.f, 100.f, p.scale);</a>
<a name="ln2063">    p.iterations = clamp(1, 4, p.iterations);</a>
<a name="ln2064">    p.channel = clamp(0, static_cast&lt;int&gt;(color_channels.size() - 1), p.channel);</a>
<a name="ln2065">    *this = p;</a>
<a name="ln2066">  }</a>
<a name="ln2067">}</a>
<a name="ln2068"> </a>
<a name="ln2069">dt_iop_gmic_params_t dt_iop_gmic_freaky_details_params_t::to_gmic_params() const</a>
<a name="ln2070">{</a>
<a name="ln2071">  dt_iop_gmic_params_t ret;</a>
<a name="ln2072">  ret.filter = freaky_details;</a>
<a name="ln2073">  std::snprintf(ret.parameters, sizeof(ret.parameters), &quot;dt_freaky_details %d,%g,%d,%d&quot;, amplitude, scale,</a>
<a name="ln2074">                iterations, channel);</a>
<a name="ln2075">  return ret;</a>
<a name="ln2076">}</a>
<a name="ln2077"> </a>
<a name="ln2078">const char *dt_iop_gmic_freaky_details_params_t::get_custom_command() {</a>
<a name="ln2079">  // clang-format off</a>
<a name="ln2080">  return R&quot;raw(</a>
<a name="ln2081">_dt_freaky_details :</a>
<a name="ln2082">  repeat $! l[$&gt;]</a>
<a name="ln2083">    repeat $3</a>
<a name="ln2084">      . +-. 255 *. -1</a>
<a name="ln2085">      repeat $1 bilateral. $2,{1.5*$2} done</a>
<a name="ln2086">      blend[-2,-1] vividlight blend overlay</a>
<a name="ln2087">    done</a>
<a name="ln2088">  endl done</a>
<a name="ln2089"> </a>
<a name="ln2090">dt_freaky_details :</a>
<a name="ln2091">  ac &quot;_dt_freaky_details $1,$2,$3&quot;,$4,0</a>
<a name="ln2092">)raw&quot;;</a>
<a name="ln2093">  // clang-format on</a>
<a name="ln2094">}</a>
<a name="ln2095"> </a>
<a name="ln2096">filter_type dt_iop_gmic_freaky_details_params_t::get_filter() const</a>
<a name="ln2097">{</a>
<a name="ln2098">  return freaky_details;</a>
<a name="ln2099">}</a>
<a name="ln2100"> </a>
<a name="ln2101">void dt_iop_gmic_freaky_details_params_t::gui_init(dt_iop_module_t *self) const</a>
<a name="ln2102">{</a>
<a name="ln2103">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln2104">  dt_iop_gmic_params_t *p = reinterpret_cast&lt;dt_iop_gmic_params_t *&gt;(self-&gt;params);</a>
<a name="ln2105">  if(p-&gt;filter == freaky_details)</a>
<a name="ln2106">    g-&gt;freaky_details.parameters = *p;</a>
<a name="ln2107">  else</a>
<a name="ln2108">    g-&gt;freaky_details.parameters = dt_iop_gmic_freaky_details_params_t();</a>
<a name="ln2109">  dt_bauhaus_combobox_add(g-&gt;gmic_filter, _(&quot;freaky details&quot;));</a>
<a name="ln2110">  g-&gt;freaky_details.box = gtk_box_new(GTK_ORIENTATION_VERTICAL, DT_BAUHAUS_SPACE);</a>
<a name="ln2111">  gtk_box_pack_start(GTK_BOX(self-&gt;widget), g-&gt;freaky_details.box, TRUE, TRUE, 0);</a>
<a name="ln2112"> </a>
<a name="ln2113">  g-&gt;freaky_details.ampltude</a>
<a name="ln2114">      = dt_bauhaus_slider_new_with_range(self, 1, 5, 1, g-&gt;freaky_details.parameters.amplitude, 1);</a>
<a name="ln2115">  dt_bauhaus_widget_set_label(g-&gt;freaky_details.ampltude, NULL, _(&quot;amplitude&quot;));</a>
<a name="ln2116">  gtk_widget_set_tooltip_text(g-&gt;freaky_details.ampltude, _(&quot;amplitude of the freaky details filter&quot;));</a>
<a name="ln2117">  gtk_box_pack_start(GTK_BOX(g-&gt;freaky_details.box), GTK_WIDGET(g-&gt;freaky_details.ampltude), TRUE, TRUE, 0);</a>
<a name="ln2118">  g_signal_connect(G_OBJECT(g-&gt;freaky_details.ampltude), &quot;value-changed&quot;,</a>
<a name="ln2119">                   G_CALLBACK(dt_iop_gmic_freaky_details_params_t::amplitude_callback), self);</a>
<a name="ln2120"> </a>
<a name="ln2121">  g-&gt;freaky_details.scale</a>
<a name="ln2122">      = dt_bauhaus_slider_new_with_range(self, 0, 100, 1, g-&gt;freaky_details.parameters.scale, 1);</a>
<a name="ln2123">  dt_bauhaus_widget_set_label(g-&gt;freaky_details.scale, NULL, _(&quot;scale&quot;));</a>
<a name="ln2124">  gtk_widget_set_tooltip_text(g-&gt;freaky_details.scale, _(&quot;scale of the freaky details filter&quot;));</a>
<a name="ln2125">  gtk_box_pack_start(GTK_BOX(g-&gt;freaky_details.box), GTK_WIDGET(g-&gt;freaky_details.scale), TRUE, TRUE, 0);</a>
<a name="ln2126">  g_signal_connect(G_OBJECT(g-&gt;freaky_details.scale), &quot;value-changed&quot;,</a>
<a name="ln2127">                   G_CALLBACK(dt_iop_gmic_freaky_details_params_t::scale_callback), self);</a>
<a name="ln2128"> </a>
<a name="ln2129">  g-&gt;freaky_details.iterations</a>
<a name="ln2130">      = dt_bauhaus_slider_new_with_range(self, 1, 4, 1, g-&gt;freaky_details.parameters.iterations, 0);</a>
<a name="ln2131">  dt_bauhaus_widget_set_label(g-&gt;freaky_details.iterations, NULL, _(&quot;iterations&quot;));</a>
<a name="ln2132">  gtk_widget_set_tooltip_text(g-&gt;freaky_details.iterations, _(&quot;number of iterations&quot;));</a>
<a name="ln2133">  gtk_box_pack_start(GTK_BOX(g-&gt;freaky_details.box), GTK_WIDGET(g-&gt;freaky_details.iterations), TRUE, TRUE, 0);</a>
<a name="ln2134">  g_signal_connect(G_OBJECT(g-&gt;freaky_details.iterations), &quot;value-changed&quot;,</a>
<a name="ln2135">                   G_CALLBACK(dt_iop_gmic_freaky_details_params_t::iterations_callback), self);</a>
<a name="ln2136"> </a>
<a name="ln2137">  g-&gt;freaky_details.channel = dt_bauhaus_combobox_new(self);</a>
<a name="ln2138">  for(auto str : color_channels) dt_bauhaus_combobox_add(g-&gt;freaky_details.channel, str);</a>
<a name="ln2139">  dt_bauhaus_widget_set_label(g-&gt;freaky_details.channel, NULL, _(&quot;channel&quot;));</a>
<a name="ln2140">  gtk_widget_set_tooltip_text(g-&gt;freaky_details.channel, _(&quot;apply filter to specific color channel(s)&quot;));</a>
<a name="ln2141">  gtk_box_pack_start(GTK_BOX(g-&gt;freaky_details.box), g-&gt;freaky_details.channel, TRUE, TRUE, 0);</a>
<a name="ln2142">  g_signal_connect(G_OBJECT(g-&gt;freaky_details.channel), &quot;value-changed&quot;,</a>
<a name="ln2143">                   G_CALLBACK(dt_iop_gmic_freaky_details_params_t::channel_callback), self);</a>
<a name="ln2144"> </a>
<a name="ln2145">  gtk_widget_show_all(g-&gt;freaky_details.box);</a>
<a name="ln2146">  gtk_widget_set_no_show_all(g-&gt;freaky_details.box, TRUE);</a>
<a name="ln2147">  gtk_widget_set_visible(g-&gt;freaky_details.box, p-&gt;filter == freaky_details ? TRUE : FALSE);</a>
<a name="ln2148">}</a>
<a name="ln2149"> </a>
<a name="ln2150">void dt_iop_gmic_freaky_details_params_t::gui_update(dt_iop_module_t *self) const</a>
<a name="ln2151">{</a>
<a name="ln2152">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln2153">  dt_iop_gmic_params_t *p = reinterpret_cast&lt;dt_iop_gmic_params_t *&gt;(self-&gt;params);</a>
<a name="ln2154">  gtk_widget_set_visible(g-&gt;freaky_details.box, p-&gt;filter == freaky_details ? TRUE : FALSE);</a>
<a name="ln2155">  if(p-&gt;filter == freaky_details)</a>
<a name="ln2156">  {</a>
<a name="ln2157">    g-&gt;freaky_details.parameters = *p;</a>
<a name="ln2158">    dt_bauhaus_slider_set(g-&gt;freaky_details.ampltude, g-&gt;freaky_details.parameters.amplitude);</a>
<a name="ln2159">    dt_bauhaus_slider_set(g-&gt;freaky_details.scale, g-&gt;freaky_details.parameters.scale);</a>
<a name="ln2160">    dt_bauhaus_slider_set(g-&gt;freaky_details.iterations, g-&gt;freaky_details.parameters.iterations);</a>
<a name="ln2161">    dt_bauhaus_combobox_set(g-&gt;freaky_details.channel, g-&gt;freaky_details.parameters.channel);</a>
<a name="ln2162">  }</a>
<a name="ln2163">}</a>
<a name="ln2164"> </a>
<a name="ln2165">void dt_iop_gmic_freaky_details_params_t::gui_reset(dt_iop_module_t *self)</a>
<a name="ln2166">{</a>
<a name="ln2167">  *this = dt_iop_gmic_freaky_details_params_t();</a>
<a name="ln2168">}</a>
<a name="ln2169"> </a>
<a name="ln2170">void dt_iop_gmic_freaky_details_params_t::amplitude_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln2171">{</a>
<a name="ln2172">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln2173">    G-&gt;freaky_details.parameters.amplitude = static_cast&lt;int&gt;(std::round(dt_bauhaus_slider_get(W)));</a>
<a name="ln2174">    return G-&gt;freaky_details.parameters.to_gmic_params();</a>
<a name="ln2175">  });</a>
<a name="ln2176">}</a>
<a name="ln2177"> </a>
<a name="ln2178">void dt_iop_gmic_freaky_details_params_t::scale_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln2179">{</a>
<a name="ln2180">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln2181">    G-&gt;freaky_details.parameters.scale = dt_bauhaus_slider_get(W);</a>
<a name="ln2182">    return G-&gt;freaky_details.parameters.to_gmic_params();</a>
<a name="ln2183">  });</a>
<a name="ln2184">}</a>
<a name="ln2185"> </a>
<a name="ln2186">void dt_iop_gmic_freaky_details_params_t::iterations_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln2187">{</a>
<a name="ln2188">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln2189">    G-&gt;freaky_details.parameters.iterations = static_cast&lt;int&gt;(std::round(dt_bauhaus_slider_get(W)));</a>
<a name="ln2190">    return G-&gt;freaky_details.parameters.to_gmic_params();</a>
<a name="ln2191">  });</a>
<a name="ln2192">}</a>
<a name="ln2193"> </a>
<a name="ln2194">void dt_iop_gmic_freaky_details_params_t::channel_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln2195">{</a>
<a name="ln2196">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln2197">    G-&gt;freaky_details.parameters.channel = dt_bauhaus_combobox_get(W);</a>
<a name="ln2198">    return G-&gt;freaky_details.parameters.to_gmic_params();</a>
<a name="ln2199">  });</a>
<a name="ln2200">}</a>
<a name="ln2201"> </a>
<a name="ln2202">// --- sharpen Richardson Lucy</a>
<a name="ln2203"> </a>
<a name="ln2204">dt_iop_gmic_sharpen_Richardson_Lucy_params_t::dt_iop_gmic_sharpen_Richardson_Lucy_params_t(</a>
<a name="ln2205">    const dt_iop_gmic_params_t &amp;other)</a>
<a name="ln2206">  : dt_iop_gmic_sharpen_Richardson_Lucy_params_t()</a>
<a name="ln2207">{</a>
<a name="ln2208">  dt_iop_gmic_sharpen_Richardson_Lucy_params_t p;</a>
<a name="ln2209">  if(other.filter == sharpen_Richardson_Lucy</a>
<a name="ln2210">     and std::sscanf(other.parameters, &quot;dt_sharpen_Richardson_Lucy %g,%d,%d,%d&quot;, &amp;p.sigma, &amp;p.iterations, &amp;p.blur,</a>
<a name="ln2211">                     &amp;p.channel)</a>
<a name="ln2212">             == 4)</a>
<a name="ln2213">  {</a>
<a name="ln2214">    p.sigma = clamp(0.5f, 10.f, p.sigma);</a>
<a name="ln2215">    p.iterations = clamp(1, 100, p.iterations);</a>
<a name="ln2216">    p.blur = clamp(0, 1, p.blur);</a>
<a name="ln2217">    p.channel = clamp(0, static_cast&lt;int&gt;(color_channels.size() - 1), p.channel);</a>
<a name="ln2218">    *this = p;</a>
<a name="ln2219">  }</a>
<a name="ln2220">}</a>
<a name="ln2221"> </a>
<a name="ln2222">dt_iop_gmic_params_t dt_iop_gmic_sharpen_Richardson_Lucy_params_t::to_gmic_params() const</a>
<a name="ln2223">{</a>
<a name="ln2224">  dt_iop_gmic_params_t ret;</a>
<a name="ln2225">  ret.filter = sharpen_Richardson_Lucy;</a>
<a name="ln2226">  std::snprintf(ret.parameters, sizeof(ret.parameters), &quot;dt_sharpen_Richardson_Lucy %g,%d,%d,%d&quot;, sigma,</a>
<a name="ln2227">                iterations, blur, channel);</a>
<a name="ln2228">  return ret;</a>
<a name="ln2229">}</a>
<a name="ln2230"> </a>
<a name="ln2231">const char *dt_iop_gmic_sharpen_Richardson_Lucy_params_t::get_custom_command() {</a>
<a name="ln2232">  // clang-format off</a>
<a name="ln2233">  return R&quot;raw(</a>
<a name="ln2234">dt_sharpen_Richardson_Lucy :</a>
<a name="ln2235">  ac &quot;apply_parallel_overlap \&quot;deblur_richardsonlucy $1,$2,$3\&quot;,24,0&quot;,$4,0</a>
<a name="ln2236">)raw&quot;;</a>
<a name="ln2237">  // clang-format on</a>
<a name="ln2238">}</a>
<a name="ln2239"> </a>
<a name="ln2240">filter_type dt_iop_gmic_sharpen_Richardson_Lucy_params_t::get_filter() const</a>
<a name="ln2241">{</a>
<a name="ln2242">  return sharpen_Richardson_Lucy;</a>
<a name="ln2243">}</a>
<a name="ln2244"> </a>
<a name="ln2245">void dt_iop_gmic_sharpen_Richardson_Lucy_params_t::gui_init(dt_iop_module_t *self) const</a>
<a name="ln2246">{</a>
<a name="ln2247">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln2248">  dt_iop_gmic_params_t *p = reinterpret_cast&lt;dt_iop_gmic_params_t *&gt;(self-&gt;params);</a>
<a name="ln2249">  if(p-&gt;filter == sharpen_Richardson_Lucy)</a>
<a name="ln2250">    g-&gt;sharpen_Richardson_Lucy.parameters = *p;</a>
<a name="ln2251">  else</a>
<a name="ln2252">    g-&gt;sharpen_Richardson_Lucy.parameters = dt_iop_gmic_sharpen_Richardson_Lucy_params_t();</a>
<a name="ln2253">  dt_bauhaus_combobox_add(g-&gt;gmic_filter, _(&quot;sharpen (Richardson-Lucy)&quot;));</a>
<a name="ln2254">  g-&gt;sharpen_Richardson_Lucy.box = gtk_box_new(GTK_ORIENTATION_VERTICAL, DT_BAUHAUS_SPACE);</a>
<a name="ln2255">  gtk_box_pack_start(GTK_BOX(self-&gt;widget), g-&gt;sharpen_Richardson_Lucy.box, TRUE, TRUE, 0);</a>
<a name="ln2256"> </a>
<a name="ln2257">  g-&gt;sharpen_Richardson_Lucy.sigma</a>
<a name="ln2258">      = dt_bauhaus_slider_new_with_range(self, 0.5, 10, 0.05, g-&gt;sharpen_Richardson_Lucy.parameters.sigma, 2);</a>
<a name="ln2259">  dt_bauhaus_widget_set_label(g-&gt;sharpen_Richardson_Lucy.sigma, NULL, _(&quot;sigma&quot;));</a>
<a name="ln2260">  gtk_widget_set_tooltip_text(g-&gt;sharpen_Richardson_Lucy.sigma, _(&quot;width of the sharpening filter&quot;));</a>
<a name="ln2261">  gtk_box_pack_start(GTK_BOX(g-&gt;sharpen_Richardson_Lucy.box), GTK_WIDGET(g-&gt;sharpen_Richardson_Lucy.sigma), TRUE,</a>
<a name="ln2262">                     TRUE, 0);</a>
<a name="ln2263">  g_signal_connect(G_OBJECT(g-&gt;sharpen_Richardson_Lucy.sigma), &quot;value-changed&quot;,</a>
<a name="ln2264">                   G_CALLBACK(dt_iop_gmic_sharpen_Richardson_Lucy_params_t::sigma_callback), self);</a>
<a name="ln2265"> </a>
<a name="ln2266">  g-&gt;sharpen_Richardson_Lucy.iterations</a>
<a name="ln2267">      = dt_bauhaus_slider_new_with_range(self, 1, 100, 1, g-&gt;sharpen_Richardson_Lucy.parameters.iterations, 0);</a>
<a name="ln2268">  dt_bauhaus_widget_set_label(g-&gt;sharpen_Richardson_Lucy.iterations, NULL, _(&quot;iterations&quot;));</a>
<a name="ln2269">  gtk_widget_set_tooltip_text(g-&gt;sharpen_Richardson_Lucy.iterations, _(&quot;number of iterations&quot;));</a>
<a name="ln2270">  gtk_box_pack_start(GTK_BOX(g-&gt;sharpen_Richardson_Lucy.box), GTK_WIDGET(g-&gt;sharpen_Richardson_Lucy.iterations),</a>
<a name="ln2271">                     TRUE, TRUE, 0);</a>
<a name="ln2272">  g_signal_connect(G_OBJECT(g-&gt;sharpen_Richardson_Lucy.iterations), &quot;value-changed&quot;,</a>
<a name="ln2273">                   G_CALLBACK(dt_iop_gmic_sharpen_Richardson_Lucy_params_t::iterations_callback), self);</a>
<a name="ln2274"> </a>
<a name="ln2275">  g-&gt;sharpen_Richardson_Lucy.blur = dt_bauhaus_combobox_new(self);</a>
<a name="ln2276">  dt_bauhaus_combobox_add(g-&gt;sharpen_Richardson_Lucy.blur, _(&quot;expnential&quot;));</a>
<a name="ln2277">  dt_bauhaus_combobox_add(g-&gt;sharpen_Richardson_Lucy.blur, _(&quot;Gaussian&quot;));</a>
<a name="ln2278">  dt_bauhaus_widget_set_label(g-&gt;sharpen_Richardson_Lucy.blur, NULL, _(&quot;blur type&quot;));</a>
<a name="ln2279">  gtk_widget_set_tooltip_text(g-&gt;sharpen_Richardson_Lucy.blur, _(&quot;choose blur method&quot;));</a>
<a name="ln2280">  gtk_box_pack_start(GTK_BOX(g-&gt;sharpen_Richardson_Lucy.box), g-&gt;sharpen_Richardson_Lucy.blur, TRUE, TRUE, 0);</a>
<a name="ln2281">  g_signal_connect(G_OBJECT(g-&gt;sharpen_Richardson_Lucy.blur), &quot;value-changed&quot;,</a>
<a name="ln2282">                   G_CALLBACK(dt_iop_gmic_sharpen_Richardson_Lucy_params_t::blur_callback), self);</a>
<a name="ln2283"> </a>
<a name="ln2284">  g-&gt;sharpen_Richardson_Lucy.channel = dt_bauhaus_combobox_new(self);</a>
<a name="ln2285">  for(auto str : color_channels) dt_bauhaus_combobox_add(g-&gt;sharpen_Richardson_Lucy.channel, str);</a>
<a name="ln2286">  dt_bauhaus_widget_set_label(g-&gt;sharpen_Richardson_Lucy.channel, NULL, _(&quot;channel&quot;));</a>
<a name="ln2287">  gtk_widget_set_tooltip_text(g-&gt;sharpen_Richardson_Lucy.channel, _(&quot;apply filter to specific color channel(s)&quot;));</a>
<a name="ln2288">  gtk_box_pack_start(GTK_BOX(g-&gt;sharpen_Richardson_Lucy.box), g-&gt;sharpen_Richardson_Lucy.channel, TRUE, TRUE, 0);</a>
<a name="ln2289">  g_signal_connect(G_OBJECT(g-&gt;sharpen_Richardson_Lucy.channel), &quot;value-changed&quot;,</a>
<a name="ln2290">                   G_CALLBACK(dt_iop_gmic_sharpen_Richardson_Lucy_params_t::channel_callback), self);</a>
<a name="ln2291"> </a>
<a name="ln2292">  gtk_widget_show_all(g-&gt;sharpen_Richardson_Lucy.box);</a>
<a name="ln2293">  gtk_widget_set_no_show_all(g-&gt;sharpen_Richardson_Lucy.box, TRUE);</a>
<a name="ln2294">  gtk_widget_set_visible(g-&gt;sharpen_Richardson_Lucy.box, p-&gt;filter == sharpen_Richardson_Lucy ? TRUE : FALSE);</a>
<a name="ln2295">}</a>
<a name="ln2296"> </a>
<a name="ln2297">void dt_iop_gmic_sharpen_Richardson_Lucy_params_t::gui_update(dt_iop_module_t *self) const</a>
<a name="ln2298">{</a>
<a name="ln2299">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln2300">  dt_iop_gmic_params_t *p = reinterpret_cast&lt;dt_iop_gmic_params_t *&gt;(self-&gt;params);</a>
<a name="ln2301">  gtk_widget_set_visible(g-&gt;sharpen_Richardson_Lucy.box, p-&gt;filter == sharpen_Richardson_Lucy ? TRUE : FALSE);</a>
<a name="ln2302">  if(p-&gt;filter == sharpen_Richardson_Lucy)</a>
<a name="ln2303">  {</a>
<a name="ln2304">    g-&gt;sharpen_Richardson_Lucy.parameters = *p;</a>
<a name="ln2305">    dt_bauhaus_slider_set(g-&gt;sharpen_Richardson_Lucy.sigma, g-&gt;sharpen_Richardson_Lucy.parameters.sigma);</a>
<a name="ln2306">    dt_bauhaus_slider_set(g-&gt;sharpen_Richardson_Lucy.iterations, g-&gt;sharpen_Richardson_Lucy.parameters.iterations);</a>
<a name="ln2307">    dt_bauhaus_combobox_set(g-&gt;sharpen_Richardson_Lucy.blur, g-&gt;sharpen_Richardson_Lucy.parameters.blur);</a>
<a name="ln2308">    dt_bauhaus_combobox_set(g-&gt;sharpen_Richardson_Lucy.channel, g-&gt;sharpen_Richardson_Lucy.parameters.channel);</a>
<a name="ln2309">  }</a>
<a name="ln2310">}</a>
<a name="ln2311"> </a>
<a name="ln2312">void dt_iop_gmic_sharpen_Richardson_Lucy_params_t::gui_reset(dt_iop_module_t *self)</a>
<a name="ln2313">{</a>
<a name="ln2314">  *this = dt_iop_gmic_sharpen_Richardson_Lucy_params_t();</a>
<a name="ln2315">}</a>
<a name="ln2316"> </a>
<a name="ln2317">void dt_iop_gmic_sharpen_Richardson_Lucy_params_t::sigma_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln2318">{</a>
<a name="ln2319">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln2320">    G-&gt;sharpen_Richardson_Lucy.parameters.sigma = dt_bauhaus_slider_get(W);</a>
<a name="ln2321">    return G-&gt;sharpen_Richardson_Lucy.parameters.to_gmic_params();</a>
<a name="ln2322">  });</a>
<a name="ln2323">}</a>
<a name="ln2324"> </a>
<a name="ln2325">void dt_iop_gmic_sharpen_Richardson_Lucy_params_t::iterations_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln2326">{</a>
<a name="ln2327">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln2328">    G-&gt;sharpen_Richardson_Lucy.parameters.iterations = static_cast&lt;int&gt;(std::round(dt_bauhaus_slider_get(W)));</a>
<a name="ln2329">    return G-&gt;sharpen_Richardson_Lucy.parameters.to_gmic_params();</a>
<a name="ln2330">  });</a>
<a name="ln2331">}</a>
<a name="ln2332"> </a>
<a name="ln2333">void dt_iop_gmic_sharpen_Richardson_Lucy_params_t::blur_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln2334">{</a>
<a name="ln2335">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln2336">    G-&gt;sharpen_Richardson_Lucy.parameters.blur = dt_bauhaus_combobox_get(W);</a>
<a name="ln2337">    return G-&gt;sharpen_Richardson_Lucy.parameters.to_gmic_params();</a>
<a name="ln2338">  });</a>
<a name="ln2339">}</a>
<a name="ln2340"> </a>
<a name="ln2341">void dt_iop_gmic_sharpen_Richardson_Lucy_params_t::channel_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln2342">{</a>
<a name="ln2343">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln2344">    G-&gt;sharpen_Richardson_Lucy.parameters.channel = dt_bauhaus_combobox_get(W);</a>
<a name="ln2345">    return G-&gt;sharpen_Richardson_Lucy.parameters.to_gmic_params();</a>
<a name="ln2346">  });</a>
<a name="ln2347">}</a>
<a name="ln2348"> </a>
<a name="ln2349">// --- sharpen Gold Meinel</a>
<a name="ln2350"> </a>
<a name="ln2351">dt_iop_gmic_sharpen_Gold_Meinel_params_t::dt_iop_gmic_sharpen_Gold_Meinel_params_t(const dt_iop_gmic_params_t &amp;other)</a>
<a name="ln2352">  : dt_iop_gmic_sharpen_Gold_Meinel_params_t()</a>
<a name="ln2353">{</a>
<a name="ln2354">  dt_iop_gmic_sharpen_Gold_Meinel_params_t p;</a>
<a name="ln2355">  if(other.filter == sharpen_Gold_Meinel</a>
<a name="ln2356">     and std::sscanf(other.parameters, &quot;dt_sharpen_Gold_Meinel %g,%d,%g,%d,%d&quot;, &amp;p.sigma, &amp;p.iterations,</a>
<a name="ln2357">                     &amp;p.acceleration, &amp;p.blur, &amp;p.channel)</a>
<a name="ln2358">             == 5)</a>
<a name="ln2359">  {</a>
<a name="ln2360">    p.sigma = clamp(0.5f, 10.f, p.sigma);</a>
<a name="ln2361">    p.iterations = clamp(1, 15, p.iterations);</a>
<a name="ln2362">    p.acceleration = clamp(1.f, 3.f, p.acceleration);</a>
<a name="ln2363">    p.blur = clamp(0, 1, p.blur);</a>
<a name="ln2364">    p.channel = clamp(0, static_cast&lt;int&gt;(color_channels.size() - 1), p.channel);</a>
<a name="ln2365">    *this = p;</a>
<a name="ln2366">  }</a>
<a name="ln2367">}</a>
<a name="ln2368"> </a>
<a name="ln2369">dt_iop_gmic_params_t dt_iop_gmic_sharpen_Gold_Meinel_params_t::to_gmic_params() const</a>
<a name="ln2370">{</a>
<a name="ln2371">  dt_iop_gmic_params_t ret;</a>
<a name="ln2372">  ret.filter = sharpen_Gold_Meinel;</a>
<a name="ln2373">  std::snprintf(ret.parameters, sizeof(ret.parameters), &quot;dt_sharpen_Gold_Meinel %g,%d,%g,%d,%d&quot;, sigma, iterations,</a>
<a name="ln2374">                acceleration, blur, channel);</a>
<a name="ln2375">  return ret;</a>
<a name="ln2376">}</a>
<a name="ln2377"> </a>
<a name="ln2378">const char *dt_iop_gmic_sharpen_Gold_Meinel_params_t::get_custom_command() {</a>
<a name="ln2379">  // clang-format off</a>
<a name="ln2380">  return R&quot;raw(</a>
<a name="ln2381">dt_sharpen_Gold_Meinel :</a>
<a name="ln2382">  ac &quot;apply_parallel_overlap \&quot;deblur_richardsonlucy $1,$2,$3,$4\&quot;,24,0&quot;,$5,0</a>
<a name="ln2383">)raw&quot;;</a>
<a name="ln2384">  // clang-format on</a>
<a name="ln2385">}</a>
<a name="ln2386"> </a>
<a name="ln2387">filter_type dt_iop_gmic_sharpen_Gold_Meinel_params_t::get_filter() const</a>
<a name="ln2388">{</a>
<a name="ln2389">  return sharpen_Gold_Meinel;</a>
<a name="ln2390">}</a>
<a name="ln2391"> </a>
<a name="ln2392">void dt_iop_gmic_sharpen_Gold_Meinel_params_t::gui_init(dt_iop_module_t *self) const</a>
<a name="ln2393">{</a>
<a name="ln2394">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln2395">  dt_iop_gmic_params_t *p = reinterpret_cast&lt;dt_iop_gmic_params_t *&gt;(self-&gt;params);</a>
<a name="ln2396">  if(p-&gt;filter == sharpen_Gold_Meinel)</a>
<a name="ln2397">    g-&gt;sharpen_Gold_Meinel.parameters = *p;</a>
<a name="ln2398">  else</a>
<a name="ln2399">    g-&gt;sharpen_Gold_Meinel.parameters = dt_iop_gmic_sharpen_Gold_Meinel_params_t();</a>
<a name="ln2400">  dt_bauhaus_combobox_add(g-&gt;gmic_filter, _(&quot;sharpen (Gold-Meinel)&quot;));</a>
<a name="ln2401">  g-&gt;sharpen_Gold_Meinel.box = gtk_box_new(GTK_ORIENTATION_VERTICAL, DT_BAUHAUS_SPACE);</a>
<a name="ln2402">  gtk_box_pack_start(GTK_BOX(self-&gt;widget), g-&gt;sharpen_Gold_Meinel.box, TRUE, TRUE, 0);</a>
<a name="ln2403"> </a>
<a name="ln2404">  g-&gt;sharpen_Gold_Meinel.sigma</a>
<a name="ln2405">      = dt_bauhaus_slider_new_with_range(self, 0.5, 10, 0.05, g-&gt;sharpen_Gold_Meinel.parameters.sigma, 2);</a>
<a name="ln2406">  dt_bauhaus_widget_set_label(g-&gt;sharpen_Gold_Meinel.sigma, NULL, _(&quot;sigma&quot;));</a>
<a name="ln2407">  gtk_widget_set_tooltip_text(g-&gt;sharpen_Gold_Meinel.sigma, _(&quot;width of the sharpening filter&quot;));</a>
<a name="ln2408">  gtk_box_pack_start(GTK_BOX(g-&gt;sharpen_Gold_Meinel.box), GTK_WIDGET(g-&gt;sharpen_Gold_Meinel.sigma), TRUE, TRUE, 0);</a>
<a name="ln2409">  g_signal_connect(G_OBJECT(g-&gt;sharpen_Gold_Meinel.sigma), &quot;value-changed&quot;,</a>
<a name="ln2410">                   G_CALLBACK(dt_iop_gmic_sharpen_Gold_Meinel_params_t::sigma_callback), self);</a>
<a name="ln2411"> </a>
<a name="ln2412">  g-&gt;sharpen_Gold_Meinel.iterations</a>
<a name="ln2413">      = dt_bauhaus_slider_new_with_range(self, 1, 15, 1, g-&gt;sharpen_Gold_Meinel.parameters.iterations, 0);</a>
<a name="ln2414">  dt_bauhaus_widget_set_label(g-&gt;sharpen_Gold_Meinel.iterations, NULL, _(&quot;iterations&quot;));</a>
<a name="ln2415">  gtk_widget_set_tooltip_text(g-&gt;sharpen_Gold_Meinel.iterations, _(&quot;number of iterations&quot;));</a>
<a name="ln2416">  gtk_box_pack_start(GTK_BOX(g-&gt;sharpen_Gold_Meinel.box), GTK_WIDGET(g-&gt;sharpen_Gold_Meinel.iterations), TRUE,</a>
<a name="ln2417">                     TRUE, 0);</a>
<a name="ln2418">  g_signal_connect(G_OBJECT(g-&gt;sharpen_Gold_Meinel.iterations), &quot;value-changed&quot;,</a>
<a name="ln2419">                   G_CALLBACK(dt_iop_gmic_sharpen_Gold_Meinel_params_t::iterations_callback), self);</a>
<a name="ln2420"> </a>
<a name="ln2421">  g-&gt;sharpen_Gold_Meinel.acceleration</a>
<a name="ln2422">      = dt_bauhaus_slider_new_with_range(self, 1, 3, 0.05, g-&gt;sharpen_Gold_Meinel.parameters.acceleration, 2);</a>
<a name="ln2423">  dt_bauhaus_widget_set_label(g-&gt;sharpen_Gold_Meinel.acceleration, NULL, _(&quot;acceleration&quot;));</a>
<a name="ln2424">  gtk_widget_set_tooltip_text(g-&gt;sharpen_Gold_Meinel.acceleration, _(&quot;acceleration of the sharpening filter&quot;));</a>
<a name="ln2425">  gtk_box_pack_start(GTK_BOX(g-&gt;sharpen_Gold_Meinel.box), GTK_WIDGET(g-&gt;sharpen_Gold_Meinel.acceleration), TRUE,</a>
<a name="ln2426">                     TRUE, 0);</a>
<a name="ln2427">  g_signal_connect(G_OBJECT(g-&gt;sharpen_Gold_Meinel.acceleration), &quot;value-changed&quot;,</a>
<a name="ln2428">                   G_CALLBACK(dt_iop_gmic_sharpen_Gold_Meinel_params_t::acceleration_callback), self);</a>
<a name="ln2429"> </a>
<a name="ln2430">  g-&gt;sharpen_Gold_Meinel.blur = dt_bauhaus_combobox_new(self);</a>
<a name="ln2431">  dt_bauhaus_combobox_add(g-&gt;sharpen_Gold_Meinel.blur, _(&quot;expnential&quot;));</a>
<a name="ln2432">  dt_bauhaus_combobox_add(g-&gt;sharpen_Gold_Meinel.blur, _(&quot;Gaussian&quot;));</a>
<a name="ln2433">  dt_bauhaus_widget_set_label(g-&gt;sharpen_Gold_Meinel.blur, NULL, _(&quot;blur type&quot;));</a>
<a name="ln2434">  gtk_widget_set_tooltip_text(g-&gt;sharpen_Gold_Meinel.blur, _(&quot;choose blur method&quot;));</a>
<a name="ln2435">  gtk_box_pack_start(GTK_BOX(g-&gt;sharpen_Gold_Meinel.box), g-&gt;sharpen_Gold_Meinel.blur, TRUE, TRUE, 0);</a>
<a name="ln2436">  g_signal_connect(G_OBJECT(g-&gt;sharpen_Gold_Meinel.blur), &quot;value-changed&quot;,</a>
<a name="ln2437">                   G_CALLBACK(dt_iop_gmic_sharpen_Gold_Meinel_params_t::blur_callback), self);</a>
<a name="ln2438"> </a>
<a name="ln2439">  g-&gt;sharpen_Gold_Meinel.channel = dt_bauhaus_combobox_new(self);</a>
<a name="ln2440">  for(auto str : color_channels) dt_bauhaus_combobox_add(g-&gt;sharpen_Gold_Meinel.channel, str);</a>
<a name="ln2441">  dt_bauhaus_widget_set_label(g-&gt;sharpen_Gold_Meinel.channel, NULL, _(&quot;channel&quot;));</a>
<a name="ln2442">  gtk_widget_set_tooltip_text(g-&gt;sharpen_Gold_Meinel.channel, _(&quot;apply filter to specific color channel(s)&quot;));</a>
<a name="ln2443">  gtk_box_pack_start(GTK_BOX(g-&gt;sharpen_Gold_Meinel.box), g-&gt;sharpen_Gold_Meinel.channel, TRUE, TRUE, 0);</a>
<a name="ln2444">  g_signal_connect(G_OBJECT(g-&gt;sharpen_Gold_Meinel.channel), &quot;value-changed&quot;,</a>
<a name="ln2445">                   G_CALLBACK(dt_iop_gmic_sharpen_Gold_Meinel_params_t::channel_callback), self);</a>
<a name="ln2446"> </a>
<a name="ln2447">  gtk_widget_show_all(g-&gt;sharpen_Gold_Meinel.box);</a>
<a name="ln2448">  gtk_widget_set_no_show_all(g-&gt;sharpen_Gold_Meinel.box, TRUE);</a>
<a name="ln2449">  gtk_widget_set_visible(g-&gt;sharpen_Gold_Meinel.box, p-&gt;filter == sharpen_Gold_Meinel ? TRUE : FALSE);</a>
<a name="ln2450">}</a>
<a name="ln2451"> </a>
<a name="ln2452">void dt_iop_gmic_sharpen_Gold_Meinel_params_t::gui_update(dt_iop_module_t *self) const</a>
<a name="ln2453">{</a>
<a name="ln2454">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln2455">  dt_iop_gmic_params_t *p = reinterpret_cast&lt;dt_iop_gmic_params_t *&gt;(self-&gt;params);</a>
<a name="ln2456">  gtk_widget_set_visible(g-&gt;sharpen_Gold_Meinel.box, p-&gt;filter == sharpen_Gold_Meinel ? TRUE : FALSE);</a>
<a name="ln2457">  if(p-&gt;filter == sharpen_Gold_Meinel)</a>
<a name="ln2458">  {</a>
<a name="ln2459">    g-&gt;sharpen_Gold_Meinel.parameters = *p;</a>
<a name="ln2460">    dt_bauhaus_slider_set(g-&gt;sharpen_Gold_Meinel.sigma, g-&gt;sharpen_Gold_Meinel.parameters.sigma);</a>
<a name="ln2461">    dt_bauhaus_slider_set(g-&gt;sharpen_Gold_Meinel.iterations, g-&gt;sharpen_Gold_Meinel.parameters.iterations);</a>
<a name="ln2462">    dt_bauhaus_slider_set(g-&gt;sharpen_Gold_Meinel.acceleration, g-&gt;sharpen_Gold_Meinel.parameters.acceleration);</a>
<a name="ln2463">    dt_bauhaus_combobox_set(g-&gt;sharpen_Gold_Meinel.blur, g-&gt;sharpen_Gold_Meinel.parameters.blur);</a>
<a name="ln2464">    dt_bauhaus_combobox_set(g-&gt;sharpen_Gold_Meinel.channel, g-&gt;sharpen_Gold_Meinel.parameters.channel);</a>
<a name="ln2465">  }</a>
<a name="ln2466">}</a>
<a name="ln2467"> </a>
<a name="ln2468">void dt_iop_gmic_sharpen_Gold_Meinel_params_t::gui_reset(dt_iop_module_t *self)</a>
<a name="ln2469">{</a>
<a name="ln2470">  *this = dt_iop_gmic_sharpen_Gold_Meinel_params_t();</a>
<a name="ln2471">}</a>
<a name="ln2472"> </a>
<a name="ln2473">void dt_iop_gmic_sharpen_Gold_Meinel_params_t::sigma_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln2474">{</a>
<a name="ln2475">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln2476">    G-&gt;sharpen_Gold_Meinel.parameters.sigma = dt_bauhaus_slider_get(W);</a>
<a name="ln2477">    return G-&gt;sharpen_Gold_Meinel.parameters.to_gmic_params();</a>
<a name="ln2478">  });</a>
<a name="ln2479">}</a>
<a name="ln2480"> </a>
<a name="ln2481">void dt_iop_gmic_sharpen_Gold_Meinel_params_t::iterations_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln2482">{</a>
<a name="ln2483">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln2484">    G-&gt;sharpen_Gold_Meinel.parameters.iterations = static_cast&lt;int&gt;(std::round(dt_bauhaus_slider_get(W)));</a>
<a name="ln2485">    return G-&gt;sharpen_Gold_Meinel.parameters.to_gmic_params();</a>
<a name="ln2486">  });</a>
<a name="ln2487">}</a>
<a name="ln2488"> </a>
<a name="ln2489">void dt_iop_gmic_sharpen_Gold_Meinel_params_t::acceleration_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln2490">{</a>
<a name="ln2491">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln2492">    G-&gt;sharpen_Gold_Meinel.parameters.acceleration = static_cast&lt;int&gt;(std::round(dt_bauhaus_slider_get(W)));</a>
<a name="ln2493">    return G-&gt;sharpen_Gold_Meinel.parameters.to_gmic_params();</a>
<a name="ln2494">  });</a>
<a name="ln2495">}</a>
<a name="ln2496"> </a>
<a name="ln2497">void dt_iop_gmic_sharpen_Gold_Meinel_params_t::blur_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln2498">{</a>
<a name="ln2499">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln2500">    G-&gt;sharpen_Gold_Meinel.parameters.blur = dt_bauhaus_combobox_get(W);</a>
<a name="ln2501">    return G-&gt;sharpen_Gold_Meinel.parameters.to_gmic_params();</a>
<a name="ln2502">  });</a>
<a name="ln2503">}</a>
<a name="ln2504"> </a>
<a name="ln2505">void dt_iop_gmic_sharpen_Gold_Meinel_params_t::channel_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln2506">{</a>
<a name="ln2507">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln2508">    G-&gt;sharpen_Gold_Meinel.parameters.channel = dt_bauhaus_combobox_get(W);</a>
<a name="ln2509">    return G-&gt;sharpen_Gold_Meinel.parameters.to_gmic_params();</a>
<a name="ln2510">  });</a>
<a name="ln2511">}</a>
<a name="ln2512"> </a>
<a name="ln2513">// --- sharpen inverse diffusion</a>
<a name="ln2514"> </a>
<a name="ln2515">dt_iop_gmic_sharpen_inverse_diffusion_params_t::dt_iop_gmic_sharpen_inverse_diffusion_params_t(</a>
<a name="ln2516">    const dt_iop_gmic_params_t &amp;other)</a>
<a name="ln2517">  : dt_iop_gmic_sharpen_inverse_diffusion_params_t()</a>
<a name="ln2518">{</a>
<a name="ln2519">  dt_iop_gmic_sharpen_inverse_diffusion_params_t p;</a>
<a name="ln2520">  if(other.filter == sharpen_inverse_diffusion</a>
<a name="ln2521">     and std::sscanf(other.parameters, &quot;dt_sharpen_inverse_diffusion %g,%d,%d&quot;, &amp;p.amplitude, &amp;p.iterations,</a>
<a name="ln2522">                     &amp;p.channel)</a>
<a name="ln2523">             == 3)</a>
<a name="ln2524">  {</a>
<a name="ln2525">    p.amplitude = clamp(1.f, 300.f, p.amplitude);</a>
<a name="ln2526">    p.iterations = clamp(1, 10, p.iterations);</a>
<a name="ln2527">    p.channel = clamp(0, static_cast&lt;int&gt;(color_channels.size() - 1), p.channel);</a>
<a name="ln2528">    *this = p;</a>
<a name="ln2529">  }</a>
<a name="ln2530">}</a>
<a name="ln2531"> </a>
<a name="ln2532">dt_iop_gmic_params_t dt_iop_gmic_sharpen_inverse_diffusion_params_t::to_gmic_params() const</a>
<a name="ln2533">{</a>
<a name="ln2534">  dt_iop_gmic_params_t ret;</a>
<a name="ln2535">  ret.filter = sharpen_inverse_diffusion;</a>
<a name="ln2536">  std::snprintf(ret.parameters, sizeof(ret.parameters), &quot;dt_sharpen_inverse_diffusion %g,%d,%d&quot;, amplitude,</a>
<a name="ln2537">                iterations, channel);</a>
<a name="ln2538">  return ret;</a>
<a name="ln2539">}</a>
<a name="ln2540"> </a>
<a name="ln2541">const char *dt_iop_gmic_sharpen_inverse_diffusion_params_t::get_custom_command() {</a>
<a name="ln2542">  // clang-format off</a>
<a name="ln2543">  return R&quot;raw(</a>
<a name="ln2544">dt_sharpen_inverse_diffusion :</a>
<a name="ln2545">  ac &quot;apply_parallel_overlap \&quot;repeat $2 sharpen $1 done\&quot;,24,0&quot;,$3,0</a>
<a name="ln2546">)raw&quot;;</a>
<a name="ln2547">  // clang-format on</a>
<a name="ln2548">}</a>
<a name="ln2549"> </a>
<a name="ln2550">filter_type dt_iop_gmic_sharpen_inverse_diffusion_params_t::get_filter() const</a>
<a name="ln2551">{</a>
<a name="ln2552">  return sharpen_inverse_diffusion;</a>
<a name="ln2553">}</a>
<a name="ln2554"> </a>
<a name="ln2555">void dt_iop_gmic_sharpen_inverse_diffusion_params_t::gui_init(dt_iop_module_t *self) const</a>
<a name="ln2556">{</a>
<a name="ln2557">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln2558">  dt_iop_gmic_params_t *p = reinterpret_cast&lt;dt_iop_gmic_params_t *&gt;(self-&gt;params);</a>
<a name="ln2559">  if(p-&gt;filter == sharpen_inverse_diffusion)</a>
<a name="ln2560">    g-&gt;sharpen_inverse_diffusion.parameters = *p;</a>
<a name="ln2561">  else</a>
<a name="ln2562">    g-&gt;sharpen_inverse_diffusion.parameters = dt_iop_gmic_sharpen_inverse_diffusion_params_t();</a>
<a name="ln2563">  dt_bauhaus_combobox_add(g-&gt;gmic_filter, _(&quot;sharpen (inverse diffusion)&quot;));</a>
<a name="ln2564">  g-&gt;sharpen_inverse_diffusion.box = gtk_box_new(GTK_ORIENTATION_VERTICAL, DT_BAUHAUS_SPACE);</a>
<a name="ln2565">  gtk_box_pack_start(GTK_BOX(self-&gt;widget), g-&gt;sharpen_inverse_diffusion.box, TRUE, TRUE, 0);</a>
<a name="ln2566"> </a>
<a name="ln2567">  g-&gt;sharpen_inverse_diffusion.ampltude</a>
<a name="ln2568">      = dt_bauhaus_slider_new_with_range(self, 0, 300, 1, g-&gt;sharpen_inverse_diffusion.parameters.amplitude, 1);</a>
<a name="ln2569">  dt_bauhaus_widget_set_label(g-&gt;sharpen_inverse_diffusion.ampltude, NULL, _(&quot;amplitude&quot;));</a>
<a name="ln2570">  gtk_widget_set_tooltip_text(g-&gt;sharpen_inverse_diffusion.ampltude, _(&quot;amplitude of the sharpening filter&quot;));</a>
<a name="ln2571">  gtk_box_pack_start(GTK_BOX(g-&gt;sharpen_inverse_diffusion.box), GTK_WIDGET(g-&gt;sharpen_inverse_diffusion.ampltude),</a>
<a name="ln2572">                     TRUE, TRUE, 0);</a>
<a name="ln2573">  g_signal_connect(G_OBJECT(g-&gt;sharpen_inverse_diffusion.ampltude), &quot;value-changed&quot;,</a>
<a name="ln2574">                   G_CALLBACK(dt_iop_gmic_sharpen_inverse_diffusion_params_t::amplitude_callback), self);</a>
<a name="ln2575"> </a>
<a name="ln2576">  g-&gt;sharpen_inverse_diffusion.iterations</a>
<a name="ln2577">      = dt_bauhaus_slider_new_with_range(self, 1, 15, 1, g-&gt;sharpen_inverse_diffusion.parameters.iterations, 0);</a>
<a name="ln2578">  dt_bauhaus_widget_set_label(g-&gt;sharpen_inverse_diffusion.iterations, NULL, _(&quot;iterations&quot;));</a>
<a name="ln2579">  gtk_widget_set_tooltip_text(g-&gt;sharpen_inverse_diffusion.iterations, _(&quot;number of iterations&quot;));</a>
<a name="ln2580">  gtk_box_pack_start(GTK_BOX(g-&gt;sharpen_inverse_diffusion.box),</a>
<a name="ln2581">                     GTK_WIDGET(g-&gt;sharpen_inverse_diffusion.iterations), TRUE, TRUE, 0);</a>
<a name="ln2582">  g_signal_connect(G_OBJECT(g-&gt;sharpen_inverse_diffusion.iterations), &quot;value-changed&quot;,</a>
<a name="ln2583">                   G_CALLBACK(dt_iop_gmic_sharpen_inverse_diffusion_params_t::iterations_callback), self);</a>
<a name="ln2584"> </a>
<a name="ln2585">  g-&gt;sharpen_inverse_diffusion.channel = dt_bauhaus_combobox_new(self);</a>
<a name="ln2586">  for(auto str : color_channels) dt_bauhaus_combobox_add(g-&gt;sharpen_inverse_diffusion.channel, str);</a>
<a name="ln2587">  dt_bauhaus_widget_set_label(g-&gt;sharpen_inverse_diffusion.channel, NULL, _(&quot;channel&quot;));</a>
<a name="ln2588">  gtk_widget_set_tooltip_text(g-&gt;sharpen_inverse_diffusion.channel,</a>
<a name="ln2589">                              _(&quot;apply filter to specific color channel(s)&quot;));</a>
<a name="ln2590">  gtk_box_pack_start(GTK_BOX(g-&gt;sharpen_inverse_diffusion.box), g-&gt;sharpen_inverse_diffusion.channel, TRUE, TRUE,</a>
<a name="ln2591">                     0);</a>
<a name="ln2592">  g_signal_connect(G_OBJECT(g-&gt;sharpen_inverse_diffusion.channel), &quot;value-changed&quot;,</a>
<a name="ln2593">                   G_CALLBACK(dt_iop_gmic_sharpen_inverse_diffusion_params_t::channel_callback), self);</a>
<a name="ln2594"> </a>
<a name="ln2595">  gtk_widget_show_all(g-&gt;sharpen_inverse_diffusion.box);</a>
<a name="ln2596">  gtk_widget_set_no_show_all(g-&gt;sharpen_inverse_diffusion.box, TRUE);</a>
<a name="ln2597">  gtk_widget_set_visible(g-&gt;sharpen_inverse_diffusion.box, p-&gt;filter == sharpen_inverse_diffusion ? TRUE : FALSE);</a>
<a name="ln2598">}</a>
<a name="ln2599"> </a>
<a name="ln2600">void dt_iop_gmic_sharpen_inverse_diffusion_params_t::gui_update(dt_iop_module_t *self) const</a>
<a name="ln2601">{</a>
<a name="ln2602">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln2603">  dt_iop_gmic_params_t *p = reinterpret_cast&lt;dt_iop_gmic_params_t *&gt;(self-&gt;params);</a>
<a name="ln2604">  gtk_widget_set_visible(g-&gt;sharpen_inverse_diffusion.box, p-&gt;filter == sharpen_inverse_diffusion ? TRUE : FALSE);</a>
<a name="ln2605">  if(p-&gt;filter == sharpen_inverse_diffusion)</a>
<a name="ln2606">  {</a>
<a name="ln2607">    g-&gt;sharpen_inverse_diffusion.parameters = *p;</a>
<a name="ln2608">    dt_bauhaus_slider_set(g-&gt;sharpen_inverse_diffusion.ampltude, g-&gt;sharpen_inverse_diffusion.parameters.amplitude);</a>
<a name="ln2609">    dt_bauhaus_slider_set(g-&gt;sharpen_inverse_diffusion.iterations,</a>
<a name="ln2610">                          g-&gt;sharpen_inverse_diffusion.parameters.iterations);</a>
<a name="ln2611">    dt_bauhaus_combobox_set(g-&gt;sharpen_inverse_diffusion.channel, g-&gt;sharpen_inverse_diffusion.parameters.channel);</a>
<a name="ln2612">  }</a>
<a name="ln2613">}</a>
<a name="ln2614"> </a>
<a name="ln2615">void dt_iop_gmic_sharpen_inverse_diffusion_params_t::gui_reset(dt_iop_module_t *self)</a>
<a name="ln2616">{</a>
<a name="ln2617">  *this = dt_iop_gmic_sharpen_inverse_diffusion_params_t();</a>
<a name="ln2618">}</a>
<a name="ln2619"> </a>
<a name="ln2620">void dt_iop_gmic_sharpen_inverse_diffusion_params_t::amplitude_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln2621">{</a>
<a name="ln2622">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln2623">    G-&gt;sharpen_inverse_diffusion.parameters.amplitude = dt_bauhaus_slider_get(W);</a>
<a name="ln2624">    return G-&gt;sharpen_inverse_diffusion.parameters.to_gmic_params();</a>
<a name="ln2625">  });</a>
<a name="ln2626">}</a>
<a name="ln2627"> </a>
<a name="ln2628">void dt_iop_gmic_sharpen_inverse_diffusion_params_t::iterations_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln2629">{</a>
<a name="ln2630">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln2631">    G-&gt;sharpen_inverse_diffusion.parameters.iterations = static_cast&lt;int&gt;(std::round(dt_bauhaus_slider_get(W)));</a>
<a name="ln2632">    return G-&gt;sharpen_inverse_diffusion.parameters.to_gmic_params();</a>
<a name="ln2633">  });</a>
<a name="ln2634">}</a>
<a name="ln2635"> </a>
<a name="ln2636">void dt_iop_gmic_sharpen_inverse_diffusion_params_t::channel_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln2637">{</a>
<a name="ln2638">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln2639">    G-&gt;sharpen_inverse_diffusion.parameters.channel = dt_bauhaus_combobox_get(W);</a>
<a name="ln2640">    return G-&gt;sharpen_inverse_diffusion.parameters.to_gmic_params();</a>
<a name="ln2641">  });</a>
<a name="ln2642">}</a>
<a name="ln2643"> </a>
<a name="ln2644">// --- magic details</a>
<a name="ln2645"> </a>
<a name="ln2646">dt_iop_gmic_magic_details_params_t::dt_iop_gmic_magic_details_params_t(const dt_iop_gmic_params_t &amp;other)</a>
<a name="ln2647">  : dt_iop_gmic_magic_details_params_t()</a>
<a name="ln2648">{</a>
<a name="ln2649">  dt_iop_gmic_magic_details_params_t p;</a>
<a name="ln2650">  if(other.filter == magic_details</a>
<a name="ln2651">     and std::sscanf(other.parameters, &quot;dt_magic_details %g,%g,%g,%g,%g,%d&quot;, &amp;p.amplitude, &amp;p.spatial_scale,</a>
<a name="ln2652">                     &amp;p.value_scale, &amp;p.edges, &amp;p.smoothness, &amp;p.channel)</a>
<a name="ln2653">             == 6)</a>
<a name="ln2654">  {</a>
<a name="ln2655">    p.amplitude = clamp(0.f, 30.f, p.amplitude);</a>
<a name="ln2656">    p.spatial_scale = clamp(0.f, 10.f, p.spatial_scale);</a>
<a name="ln2657">    p.value_scale = clamp(0.f, 20.f, p.value_scale);</a>
<a name="ln2658">    p.edges = clamp(-3.0f, 3.0f, p.edges);</a>
<a name="ln2659">    p.smoothness = clamp(0.f, 20.f, p.smoothness);</a>
<a name="ln2660">    p.channel = clamp(0, static_cast&lt;int&gt;(color_channels.size() - 1), p.channel);</a>
<a name="ln2661">    *this = p;</a>
<a name="ln2662">  }</a>
<a name="ln2663">}</a>
<a name="ln2664"> </a>
<a name="ln2665">dt_iop_gmic_params_t dt_iop_gmic_magic_details_params_t::to_gmic_params() const</a>
<a name="ln2666">{</a>
<a name="ln2667">  dt_iop_gmic_params_t ret;</a>
<a name="ln2668">  ret.filter = magic_details;</a>
<a name="ln2669">  std::snprintf(ret.parameters, sizeof(ret.parameters), &quot;dt_magic_details %g,%g,%g,%g,%g,%d&quot;, amplitude,</a>
<a name="ln2670">                spatial_scale, value_scale, edges, smoothness, channel);</a>
<a name="ln2671">  return ret;</a>
<a name="ln2672">}</a>
<a name="ln2673"> </a>
<a name="ln2674">const char *dt_iop_gmic_magic_details_params_t::get_custom_command() {</a>
<a name="ln2675">  // clang-format off</a>
<a name="ln2676">  return R&quot;raw(</a>
<a name="ln2677">_dt_magic_details :</a>
<a name="ln2678">  repeat $! l[$&gt;]</a>
<a name="ln2679">    +bilateral $2,$3</a>
<a name="ln2680">    +gradient_norm.. +. 1</a>
<a name="ln2681">    pow. {$4&gt;=0?3.1-$4:-3.1-$4}</a>
<a name="ln2682">    b. $5 n. 1,{1+$1}</a>
<a name="ln2683">    -... .. *[-3,-1] + c 0,255</a>
<a name="ln2684">  endl done</a>
<a name="ln2685"> </a>
<a name="ln2686">dt_magic_details :</a>
<a name="ln2687">  ac &quot;_dt_magic_details ${1-5}&quot;,$6,0</a>
<a name="ln2688">)raw&quot;;</a>
<a name="ln2689">  // clang-format on</a>
<a name="ln2690">}</a>
<a name="ln2691"> </a>
<a name="ln2692">filter_type dt_iop_gmic_magic_details_params_t::get_filter() const</a>
<a name="ln2693">{</a>
<a name="ln2694">  return magic_details;</a>
<a name="ln2695">}</a>
<a name="ln2696"> </a>
<a name="ln2697">void dt_iop_gmic_magic_details_params_t::gui_init(dt_iop_module_t *self) const</a>
<a name="ln2698">{</a>
<a name="ln2699">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln2700">  dt_iop_gmic_params_t *p = reinterpret_cast&lt;dt_iop_gmic_params_t *&gt;(self-&gt;params);</a>
<a name="ln2701">  if(p-&gt;filter == magic_details)</a>
<a name="ln2702">    g-&gt;magic_details.parameters = *p;</a>
<a name="ln2703">  else</a>
<a name="ln2704">    g-&gt;magic_details.parameters = dt_iop_gmic_magic_details_params_t();</a>
<a name="ln2705">  dt_bauhaus_combobox_add(g-&gt;gmic_filter, _(&quot;magic details&quot;));</a>
<a name="ln2706">  g-&gt;magic_details.box = gtk_box_new(GTK_ORIENTATION_VERTICAL, DT_BAUHAUS_SPACE);</a>
<a name="ln2707">  gtk_box_pack_start(GTK_BOX(self-&gt;widget), g-&gt;magic_details.box, TRUE, TRUE, 0);</a>
<a name="ln2708"> </a>
<a name="ln2709">  g-&gt;magic_details.ampltude</a>
<a name="ln2710">      = dt_bauhaus_slider_new_with_range(self, 0, 30, 0.1, g-&gt;magic_details.parameters.amplitude, 1);</a>
<a name="ln2711">  dt_bauhaus_widget_set_label(g-&gt;magic_details.ampltude, NULL, _(&quot;amplitude&quot;));</a>
<a name="ln2712">  gtk_widget_set_tooltip_text(g-&gt;magic_details.ampltude, _(&quot;amplitude of the magic details filter&quot;));</a>
<a name="ln2713">  gtk_box_pack_start(GTK_BOX(g-&gt;magic_details.box), GTK_WIDGET(g-&gt;magic_details.ampltude), TRUE, TRUE, 0);</a>
<a name="ln2714">  g_signal_connect(G_OBJECT(g-&gt;magic_details.ampltude), &quot;value-changed&quot;,</a>
<a name="ln2715">                   G_CALLBACK(dt_iop_gmic_magic_details_params_t::amplitude_callback), self);</a>
<a name="ln2716"> </a>
<a name="ln2717">  g-&gt;magic_details.spatial_scale</a>
<a name="ln2718">      = dt_bauhaus_slider_new_with_range(self, 0, 10, 0.1, g-&gt;magic_details.parameters.spatial_scale, 1);</a>
<a name="ln2719">  dt_bauhaus_widget_set_label(g-&gt;magic_details.spatial_scale, NULL, _(&quot;spatial scale&quot;));</a>
<a name="ln2720">  gtk_widget_set_tooltip_text(g-&gt;magic_details.spatial_scale, _(&quot;spatial scale of the magic details filter&quot;));</a>
<a name="ln2721">  gtk_box_pack_start(GTK_BOX(g-&gt;magic_details.box), GTK_WIDGET(g-&gt;magic_details.spatial_scale), TRUE, TRUE, 0);</a>
<a name="ln2722">  g_signal_connect(G_OBJECT(g-&gt;magic_details.spatial_scale), &quot;value-changed&quot;,</a>
<a name="ln2723">                   G_CALLBACK(dt_iop_gmic_magic_details_params_t::spatial_scale_callback), self);</a>
<a name="ln2724"> </a>
<a name="ln2725">  g-&gt;magic_details.value_scale</a>
<a name="ln2726">      = dt_bauhaus_slider_new_with_range(self, 0, 20, 0.1, g-&gt;magic_details.parameters.value_scale, 1);</a>
<a name="ln2727">  dt_bauhaus_widget_set_label(g-&gt;magic_details.value_scale, NULL, _(&quot;value scale&quot;));</a>
<a name="ln2728">  gtk_widget_set_tooltip_text(g-&gt;magic_details.value_scale, _(&quot;value scale of the magic details filter&quot;));</a>
<a name="ln2729">  gtk_box_pack_start(GTK_BOX(g-&gt;magic_details.box), GTK_WIDGET(g-&gt;magic_details.value_scale), TRUE, TRUE, 0);</a>
<a name="ln2730">  g_signal_connect(G_OBJECT(g-&gt;magic_details.value_scale), &quot;value-changed&quot;,</a>
<a name="ln2731">                   G_CALLBACK(dt_iop_gmic_magic_details_params_t::value_scale_callback), self);</a>
<a name="ln2732"> </a>
<a name="ln2733">  g-&gt;magic_details.edges</a>
<a name="ln2734">      = dt_bauhaus_slider_new_with_range(self, -3, 3, 0.1, g-&gt;magic_details.parameters.edges, 1);</a>
<a name="ln2735">  dt_bauhaus_widget_set_label(g-&gt;magic_details.edges, NULL, _(&quot;edges&quot;));</a>
<a name="ln2736">  gtk_widget_set_tooltip_text(g-&gt;magic_details.edges, _(&quot;edges of the magic details filter&quot;));</a>
<a name="ln2737">  gtk_box_pack_start(GTK_BOX(g-&gt;magic_details.box), GTK_WIDGET(g-&gt;magic_details.edges), TRUE, TRUE, 0);</a>
<a name="ln2738">  g_signal_connect(G_OBJECT(g-&gt;magic_details.edges), &quot;value-changed&quot;,</a>
<a name="ln2739">                   G_CALLBACK(dt_iop_gmic_magic_details_params_t::edges_callback), self);</a>
<a name="ln2740"> </a>
<a name="ln2741">  g-&gt;magic_details.smoothness</a>
<a name="ln2742">      = dt_bauhaus_slider_new_with_range(self, 0, 20, 0.1, g-&gt;magic_details.parameters.smoothness, 1);</a>
<a name="ln2743">  dt_bauhaus_widget_set_label(g-&gt;magic_details.smoothness, NULL, _(&quot;smoothness&quot;));</a>
<a name="ln2744">  gtk_widget_set_tooltip_text(g-&gt;magic_details.smoothness, _(&quot;smoothness of the magic details filter&quot;));</a>
<a name="ln2745">  gtk_box_pack_start(GTK_BOX(g-&gt;magic_details.box), GTK_WIDGET(g-&gt;magic_details.smoothness), TRUE, TRUE, 0);</a>
<a name="ln2746">  g_signal_connect(G_OBJECT(g-&gt;magic_details.smoothness), &quot;value-changed&quot;,</a>
<a name="ln2747">                   G_CALLBACK(dt_iop_gmic_magic_details_params_t::smoothness_callback), self);</a>
<a name="ln2748"> </a>
<a name="ln2749">  g-&gt;magic_details.channel = dt_bauhaus_combobox_new(self);</a>
<a name="ln2750">  for(auto str : color_channels) dt_bauhaus_combobox_add(g-&gt;magic_details.channel, str);</a>
<a name="ln2751">  dt_bauhaus_widget_set_label(g-&gt;magic_details.channel, NULL, _(&quot;channel&quot;));</a>
<a name="ln2752">  gtk_widget_set_tooltip_text(g-&gt;magic_details.channel, _(&quot;apply filter to specific color channel(s)&quot;));</a>
<a name="ln2753">  gtk_box_pack_start(GTK_BOX(g-&gt;magic_details.box), g-&gt;magic_details.channel, TRUE, TRUE, 0);</a>
<a name="ln2754">  g_signal_connect(G_OBJECT(g-&gt;magic_details.channel), &quot;value-changed&quot;,</a>
<a name="ln2755">                   G_CALLBACK(dt_iop_gmic_magic_details_params_t::channel_callback), self);</a>
<a name="ln2756"> </a>
<a name="ln2757">  gtk_widget_show_all(g-&gt;magic_details.box);</a>
<a name="ln2758">  gtk_widget_set_no_show_all(g-&gt;magic_details.box, TRUE);</a>
<a name="ln2759">  gtk_widget_set_visible(g-&gt;magic_details.box, p-&gt;filter == magic_details ? TRUE : FALSE);</a>
<a name="ln2760">}</a>
<a name="ln2761"> </a>
<a name="ln2762">void dt_iop_gmic_magic_details_params_t::gui_update(dt_iop_module_t *self) const</a>
<a name="ln2763">{</a>
<a name="ln2764">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln2765">  dt_iop_gmic_params_t *p = reinterpret_cast&lt;dt_iop_gmic_params_t *&gt;(self-&gt;params);</a>
<a name="ln2766">  gtk_widget_set_visible(g-&gt;magic_details.box, p-&gt;filter == magic_details ? TRUE : FALSE);</a>
<a name="ln2767">  if(p-&gt;filter == magic_details)</a>
<a name="ln2768">  {</a>
<a name="ln2769">    g-&gt;magic_details.parameters = *p;</a>
<a name="ln2770">    dt_bauhaus_slider_set(g-&gt;magic_details.ampltude, g-&gt;magic_details.parameters.amplitude);</a>
<a name="ln2771">    dt_bauhaus_slider_set(g-&gt;magic_details.spatial_scale, g-&gt;magic_details.parameters.spatial_scale);</a>
<a name="ln2772">    dt_bauhaus_slider_set(g-&gt;magic_details.value_scale, g-&gt;magic_details.parameters.value_scale);</a>
<a name="ln2773">    dt_bauhaus_slider_set(g-&gt;magic_details.edges, g-&gt;magic_details.parameters.edges);</a>
<a name="ln2774">    dt_bauhaus_slider_set(g-&gt;magic_details.smoothness, g-&gt;magic_details.parameters.smoothness);</a>
<a name="ln2775">    dt_bauhaus_combobox_set(g-&gt;magic_details.channel, g-&gt;magic_details.parameters.channel);</a>
<a name="ln2776">  }</a>
<a name="ln2777">}</a>
<a name="ln2778"> </a>
<a name="ln2779">void dt_iop_gmic_magic_details_params_t::gui_reset(dt_iop_module_t *self)</a>
<a name="ln2780">{</a>
<a name="ln2781">  *this = dt_iop_gmic_magic_details_params_t();</a>
<a name="ln2782">}</a>
<a name="ln2783"> </a>
<a name="ln2784">void dt_iop_gmic_magic_details_params_t::amplitude_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln2785">{</a>
<a name="ln2786">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln2787">    G-&gt;magic_details.parameters.amplitude = dt_bauhaus_slider_get(W);</a>
<a name="ln2788">    return G-&gt;magic_details.parameters.to_gmic_params();</a>
<a name="ln2789">  });</a>
<a name="ln2790">}</a>
<a name="ln2791"> </a>
<a name="ln2792">void dt_iop_gmic_magic_details_params_t::spatial_scale_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln2793">{</a>
<a name="ln2794">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln2795">    G-&gt;magic_details.parameters.spatial_scale = dt_bauhaus_slider_get(W);</a>
<a name="ln2796">    return G-&gt;magic_details.parameters.to_gmic_params();</a>
<a name="ln2797">  });</a>
<a name="ln2798">}</a>
<a name="ln2799"> </a>
<a name="ln2800">void dt_iop_gmic_magic_details_params_t::value_scale_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln2801">{</a>
<a name="ln2802">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln2803">    G-&gt;magic_details.parameters.value_scale = dt_bauhaus_slider_get(W);</a>
<a name="ln2804">    return G-&gt;magic_details.parameters.to_gmic_params();</a>
<a name="ln2805">  });</a>
<a name="ln2806">}</a>
<a name="ln2807"> </a>
<a name="ln2808">void dt_iop_gmic_magic_details_params_t::edges_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln2809">{</a>
<a name="ln2810">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln2811">    G-&gt;magic_details.parameters.edges = dt_bauhaus_slider_get(W);</a>
<a name="ln2812">    return G-&gt;magic_details.parameters.to_gmic_params();</a>
<a name="ln2813">  });</a>
<a name="ln2814">}</a>
<a name="ln2815"> </a>
<a name="ln2816">void dt_iop_gmic_magic_details_params_t::smoothness_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln2817">{</a>
<a name="ln2818">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln2819">    G-&gt;magic_details.parameters.smoothness = dt_bauhaus_slider_get(W);</a>
<a name="ln2820">    return G-&gt;magic_details.parameters.to_gmic_params();</a>
<a name="ln2821">  });</a>
<a name="ln2822">}</a>
<a name="ln2823"> </a>
<a name="ln2824">void dt_iop_gmic_magic_details_params_t::channel_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln2825">{</a>
<a name="ln2826">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln2827">    G-&gt;magic_details.parameters.channel = dt_bauhaus_combobox_get(W);</a>
<a name="ln2828">    return G-&gt;magic_details.parameters.to_gmic_params();</a>
<a name="ln2829">  });</a>
<a name="ln2830">}</a>
<a name="ln2831"> </a>
<a name="ln2832">// --- basic color adjustments</a>
<a name="ln2833"> </a>
<a name="ln2834">dt_iop_gmic_basic_color_adjustments_params_t::dt_iop_gmic_basic_color_adjustments_params_t(</a>
<a name="ln2835">    const dt_iop_gmic_params_t &amp;other)</a>
<a name="ln2836">  : dt_iop_gmic_basic_color_adjustments_params_t()</a>
<a name="ln2837">{</a>
<a name="ln2838">  dt_iop_gmic_basic_color_adjustments_params_t p;</a>
<a name="ln2839">  if(other.filter == basic_color_adjustments</a>
<a name="ln2840">     and std::sscanf(other.parameters, &quot;dt_basic_color_adjustments %g,%g,%g,%g,%g&quot;, &amp;p.brightness, &amp;p.contrast,</a>
<a name="ln2841">                     &amp;p.gamma, &amp;p.hue, &amp;p.saturation)</a>
<a name="ln2842">             == 5)</a>
<a name="ln2843">  {</a>
<a name="ln2844">    p.brightness = clamp(-1.f, 1.f, p.brightness);</a>
<a name="ln2845">    p.contrast = clamp(-1.f, 1.f, p.contrast);</a>
<a name="ln2846">    p.gamma = clamp(-1.f, 1.f, p.gamma);</a>
<a name="ln2847">    p.hue = clamp(-1.f, 1.f, p.hue);</a>
<a name="ln2848">    p.saturation = clamp(-1.f, 1.f, p.saturation);</a>
<a name="ln2849">    *this = p;</a>
<a name="ln2850">  }</a>
<a name="ln2851">}</a>
<a name="ln2852"> </a>
<a name="ln2853">dt_iop_gmic_params_t dt_iop_gmic_basic_color_adjustments_params_t::to_gmic_params() const</a>
<a name="ln2854">{</a>
<a name="ln2855">  dt_iop_gmic_params_t ret;</a>
<a name="ln2856">  ret.filter = basic_color_adjustments;</a>
<a name="ln2857">  std::snprintf(ret.parameters, sizeof(ret.parameters), &quot;dt_basic_color_adjustments %g,%g,%g,%g,%g&quot;, brightness,</a>
<a name="ln2858">                contrast, gamma, hue, saturation);</a>
<a name="ln2859">  return ret;</a>
<a name="ln2860">}</a>
<a name="ln2861"> </a>
<a name="ln2862">const char *dt_iop_gmic_basic_color_adjustments_params_t::get_custom_command()</a>
<a name="ln2863">{</a>
<a name="ln2864">  // clang-format off</a>
<a name="ln2865">  return R&quot;raw(</a>
<a name="ln2866">dt_basic_color_adjustments :</a>
<a name="ln2867">  adjust_colors {100*$1},{100*$2},{100*$3},{100*$4},{100*$5},0,255</a>
<a name="ln2868">)raw&quot;;</a>
<a name="ln2869">  // clang-format on</a>
<a name="ln2870">}</a>
<a name="ln2871"> </a>
<a name="ln2872">filter_type dt_iop_gmic_basic_color_adjustments_params_t::get_filter() const</a>
<a name="ln2873">{</a>
<a name="ln2874">  return basic_color_adjustments;</a>
<a name="ln2875">}</a>
<a name="ln2876"> </a>
<a name="ln2877">void dt_iop_gmic_basic_color_adjustments_params_t::gui_init(dt_iop_module_t *self) const</a>
<a name="ln2878">{</a>
<a name="ln2879">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln2880">  dt_iop_gmic_params_t *p = reinterpret_cast&lt;dt_iop_gmic_params_t *&gt;(self-&gt;params);</a>
<a name="ln2881">  if(p-&gt;filter == basic_color_adjustments)</a>
<a name="ln2882">    g-&gt;basic_color_adjustments.parameters = *p;</a>
<a name="ln2883">  else</a>
<a name="ln2884">    g-&gt;basic_color_adjustments.parameters = dt_iop_gmic_basic_color_adjustments_params_t();</a>
<a name="ln2885">  dt_bauhaus_combobox_add(g-&gt;gmic_filter, _(&quot;basic color adjustmens&quot;));</a>
<a name="ln2886">  g-&gt;basic_color_adjustments.box = gtk_box_new(GTK_ORIENTATION_VERTICAL, DT_BAUHAUS_SPACE);</a>
<a name="ln2887">  gtk_box_pack_start(GTK_BOX(self-&gt;widget), g-&gt;basic_color_adjustments.box, TRUE, TRUE, 0);</a>
<a name="ln2888"> </a>
<a name="ln2889">  g-&gt;basic_color_adjustments.brightness</a>
<a name="ln2890">      = dt_bauhaus_slider_new_with_range(self, -1, 1, 0.01, g-&gt;basic_color_adjustments.parameters.brightness, 3);</a>
<a name="ln2891">  dt_bauhaus_widget_set_label(g-&gt;basic_color_adjustments.brightness, NULL, _(&quot;brightness&quot;));</a>
<a name="ln2892">  gtk_widget_set_tooltip_text(g-&gt;basic_color_adjustments.brightness, _(&quot;brightness adjustment&quot;));</a>
<a name="ln2893">  gtk_box_pack_start(GTK_BOX(g-&gt;basic_color_adjustments.box), GTK_WIDGET(g-&gt;basic_color_adjustments.brightness),</a>
<a name="ln2894">                     TRUE, TRUE, 0);</a>
<a name="ln2895">  g_signal_connect(G_OBJECT(g-&gt;basic_color_adjustments.brightness), &quot;value-changed&quot;,</a>
<a name="ln2896">                   G_CALLBACK(dt_iop_gmic_basic_color_adjustments_params_t::brightness_callback), self);</a>
<a name="ln2897"> </a>
<a name="ln2898">  g-&gt;basic_color_adjustments.contrast</a>
<a name="ln2899">      = dt_bauhaus_slider_new_with_range(self, -1, 1, 0.01, g-&gt;basic_color_adjustments.parameters.contrast, 3);</a>
<a name="ln2900">  dt_bauhaus_widget_set_label(g-&gt;basic_color_adjustments.contrast, NULL, _(&quot;contrast&quot;));</a>
<a name="ln2901">  gtk_widget_set_tooltip_text(g-&gt;basic_color_adjustments.contrast, _(&quot;contrast adjustment&quot;));</a>
<a name="ln2902">  gtk_box_pack_start(GTK_BOX(g-&gt;basic_color_adjustments.box), GTK_WIDGET(g-&gt;basic_color_adjustments.contrast),</a>
<a name="ln2903">                     TRUE, TRUE, 0);</a>
<a name="ln2904">  g_signal_connect(G_OBJECT(g-&gt;basic_color_adjustments.contrast), &quot;value-changed&quot;,</a>
<a name="ln2905">                   G_CALLBACK(dt_iop_gmic_basic_color_adjustments_params_t::contrast_callback), self);</a>
<a name="ln2906"> </a>
<a name="ln2907">  g-&gt;basic_color_adjustments.gamma</a>
<a name="ln2908">      = dt_bauhaus_slider_new_with_range(self, -1, 1, 0.01, g-&gt;basic_color_adjustments.parameters.gamma, 3);</a>
<a name="ln2909">  dt_bauhaus_widget_set_label(g-&gt;basic_color_adjustments.gamma, NULL, _(&quot;gamma&quot;));</a>
<a name="ln2910">  gtk_widget_set_tooltip_text(g-&gt;basic_color_adjustments.gamma, _(&quot;gamma adjustment&quot;));</a>
<a name="ln2911">  gtk_box_pack_start(GTK_BOX(g-&gt;basic_color_adjustments.box), GTK_WIDGET(g-&gt;basic_color_adjustments.gamma), TRUE,</a>
<a name="ln2912">                     TRUE, 0);</a>
<a name="ln2913">  g_signal_connect(G_OBJECT(g-&gt;basic_color_adjustments.gamma), &quot;value-changed&quot;,</a>
<a name="ln2914">                   G_CALLBACK(dt_iop_gmic_basic_color_adjustments_params_t::gamma_callback), self);</a>
<a name="ln2915"> </a>
<a name="ln2916">  g-&gt;basic_color_adjustments.hue</a>
<a name="ln2917">      = dt_bauhaus_slider_new_with_range(self, -1, 1, 0.01, g-&gt;basic_color_adjustments.parameters.hue, 3);</a>
<a name="ln2918">  dt_bauhaus_widget_set_label(g-&gt;basic_color_adjustments.hue, NULL, _(&quot;hue&quot;));</a>
<a name="ln2919">  gtk_widget_set_tooltip_text(g-&gt;basic_color_adjustments.hue, _(&quot;hue shift&quot;));</a>
<a name="ln2920">  gtk_box_pack_start(GTK_BOX(g-&gt;basic_color_adjustments.box), GTK_WIDGET(g-&gt;basic_color_adjustments.hue), TRUE,</a>
<a name="ln2921">                     TRUE, 0);</a>
<a name="ln2922">  g_signal_connect(G_OBJECT(g-&gt;basic_color_adjustments.hue), &quot;value-changed&quot;,</a>
<a name="ln2923">                   G_CALLBACK(dt_iop_gmic_basic_color_adjustments_params_t::hue_callback), self);</a>
<a name="ln2924"> </a>
<a name="ln2925">  g-&gt;basic_color_adjustments.saturation</a>
<a name="ln2926">      = dt_bauhaus_slider_new_with_range(self, -1, 1, 0.01, g-&gt;basic_color_adjustments.parameters.saturation, 3);</a>
<a name="ln2927">  dt_bauhaus_widget_set_label(g-&gt;basic_color_adjustments.saturation, NULL, _(&quot;saturation&quot;));</a>
<a name="ln2928">  gtk_widget_set_tooltip_text(g-&gt;basic_color_adjustments.saturation, _(&quot;saturation adjustment&quot;));</a>
<a name="ln2929">  gtk_box_pack_start(GTK_BOX(g-&gt;basic_color_adjustments.box), GTK_WIDGET(g-&gt;basic_color_adjustments.saturation),</a>
<a name="ln2930">                     TRUE, TRUE, 0);</a>
<a name="ln2931">  g_signal_connect(G_OBJECT(g-&gt;basic_color_adjustments.saturation), &quot;value-changed&quot;,</a>
<a name="ln2932">                   G_CALLBACK(dt_iop_gmic_basic_color_adjustments_params_t::saturation_callback), self);</a>
<a name="ln2933"> </a>
<a name="ln2934">  gtk_widget_show_all(g-&gt;basic_color_adjustments.box);</a>
<a name="ln2935">  gtk_widget_set_no_show_all(g-&gt;basic_color_adjustments.box, TRUE);</a>
<a name="ln2936">  gtk_widget_set_visible(g-&gt;basic_color_adjustments.box, p-&gt;filter == basic_color_adjustments ? TRUE : FALSE);</a>
<a name="ln2937">}</a>
<a name="ln2938"> </a>
<a name="ln2939">void dt_iop_gmic_basic_color_adjustments_params_t::gui_update(dt_iop_module_t *self) const</a>
<a name="ln2940">{</a>
<a name="ln2941">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln2942">  dt_iop_gmic_params_t *p = reinterpret_cast&lt;dt_iop_gmic_params_t *&gt;(self-&gt;params);</a>
<a name="ln2943">  gtk_widget_set_visible(g-&gt;basic_color_adjustments.box, p-&gt;filter == basic_color_adjustments ? TRUE : FALSE);</a>
<a name="ln2944">  if(p-&gt;filter == basic_color_adjustments)</a>
<a name="ln2945">  {</a>
<a name="ln2946">    g-&gt;basic_color_adjustments.parameters = *p;</a>
<a name="ln2947">    dt_bauhaus_slider_set(g-&gt;basic_color_adjustments.brightness, g-&gt;basic_color_adjustments.parameters.brightness);</a>
<a name="ln2948">    dt_bauhaus_slider_set(g-&gt;basic_color_adjustments.contrast, g-&gt;basic_color_adjustments.parameters.contrast);</a>
<a name="ln2949">    dt_bauhaus_slider_set(g-&gt;basic_color_adjustments.gamma, g-&gt;basic_color_adjustments.parameters.gamma);</a>
<a name="ln2950">    dt_bauhaus_slider_set(g-&gt;basic_color_adjustments.hue, g-&gt;basic_color_adjustments.parameters.hue);</a>
<a name="ln2951">    dt_bauhaus_slider_set(g-&gt;basic_color_adjustments.saturation, g-&gt;basic_color_adjustments.parameters.saturation);</a>
<a name="ln2952">  }</a>
<a name="ln2953">}</a>
<a name="ln2954"> </a>
<a name="ln2955">void dt_iop_gmic_basic_color_adjustments_params_t::gui_reset(dt_iop_module_t *self)</a>
<a name="ln2956">{</a>
<a name="ln2957">  *this = dt_iop_gmic_basic_color_adjustments_params_t();</a>
<a name="ln2958">}</a>
<a name="ln2959"> </a>
<a name="ln2960">void dt_iop_gmic_basic_color_adjustments_params_t::brightness_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln2961">{</a>
<a name="ln2962">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln2963">    G-&gt;basic_color_adjustments.parameters.brightness = dt_bauhaus_slider_get(W);</a>
<a name="ln2964">    return G-&gt;basic_color_adjustments.parameters.to_gmic_params();</a>
<a name="ln2965">  });</a>
<a name="ln2966">}</a>
<a name="ln2967"> </a>
<a name="ln2968">void dt_iop_gmic_basic_color_adjustments_params_t::contrast_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln2969">{</a>
<a name="ln2970">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln2971">    G-&gt;basic_color_adjustments.parameters.contrast = dt_bauhaus_slider_get(W);</a>
<a name="ln2972">    return G-&gt;basic_color_adjustments.parameters.to_gmic_params();</a>
<a name="ln2973">  });</a>
<a name="ln2974">}</a>
<a name="ln2975"> </a>
<a name="ln2976">void dt_iop_gmic_basic_color_adjustments_params_t::gamma_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln2977">{</a>
<a name="ln2978">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln2979">    G-&gt;basic_color_adjustments.parameters.gamma = dt_bauhaus_slider_get(W);</a>
<a name="ln2980">    return G-&gt;basic_color_adjustments.parameters.to_gmic_params();</a>
<a name="ln2981">  });</a>
<a name="ln2982">}</a>
<a name="ln2983"> </a>
<a name="ln2984">void dt_iop_gmic_basic_color_adjustments_params_t::hue_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln2985">{</a>
<a name="ln2986">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln2987">    G-&gt;basic_color_adjustments.parameters.hue = dt_bauhaus_slider_get(W);</a>
<a name="ln2988">    return G-&gt;basic_color_adjustments.parameters.to_gmic_params();</a>
<a name="ln2989">  });</a>
<a name="ln2990">}</a>
<a name="ln2991"> </a>
<a name="ln2992">void dt_iop_gmic_basic_color_adjustments_params_t::saturation_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln2993">{</a>
<a name="ln2994">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln2995">    G-&gt;basic_color_adjustments.parameters.saturation = dt_bauhaus_slider_get(W);</a>
<a name="ln2996">    return G-&gt;basic_color_adjustments.parameters.to_gmic_params();</a>
<a name="ln2997">  });</a>
<a name="ln2998">}</a>
<a name="ln2999"> </a>
<a name="ln3000">// --- equalize shadow</a>
<a name="ln3001"> </a>
<a name="ln3002">dt_iop_gmic_equalize_shadow_params_t::dt_iop_gmic_equalize_shadow_params_t(const dt_iop_gmic_params_t &amp;other)</a>
<a name="ln3003">  : dt_iop_gmic_equalize_shadow_params_t()</a>
<a name="ln3004">{</a>
<a name="ln3005">  dt_iop_gmic_equalize_shadow_params_t p;</a>
<a name="ln3006">  if(other.filter == equalize_shadow and std::sscanf(other.parameters, &quot;dt_equalize_shadow %g&quot;, &amp;p.amplitude) == 1)</a>
<a name="ln3007">  {</a>
<a name="ln3008">    p.amplitude = clamp(0.f, 1.f, p.amplitude);</a>
<a name="ln3009">    *this = p;</a>
<a name="ln3010">  }</a>
<a name="ln3011">}</a>
<a name="ln3012"> </a>
<a name="ln3013">dt_iop_gmic_params_t dt_iop_gmic_equalize_shadow_params_t::to_gmic_params() const</a>
<a name="ln3014">{</a>
<a name="ln3015">  dt_iop_gmic_params_t ret;</a>
<a name="ln3016">  ret.filter = equalize_shadow;</a>
<a name="ln3017">  std::snprintf(ret.parameters, sizeof(ret.parameters), &quot;dt_equalize_shadow %g&quot;, amplitude);</a>
<a name="ln3018">  return ret;</a>
<a name="ln3019">}</a>
<a name="ln3020"> </a>
<a name="ln3021">const char *dt_iop_gmic_equalize_shadow_params_t::get_custom_command()</a>
<a name="ln3022">{</a>
<a name="ln3023">  // clang-format off</a>
<a name="ln3024">  return R&quot;raw(</a>
<a name="ln3025">dt_equalize_shadow :</a>
<a name="ln3026">  +negate blend softlight,$1</a>
<a name="ln3027">)raw&quot;;</a>
<a name="ln3028">  // clang-format on</a>
<a name="ln3029">}</a>
<a name="ln3030"> </a>
<a name="ln3031">filter_type dt_iop_gmic_equalize_shadow_params_t::get_filter() const</a>
<a name="ln3032">{</a>
<a name="ln3033">  return equalize_shadow;</a>
<a name="ln3034">}</a>
<a name="ln3035"> </a>
<a name="ln3036">void dt_iop_gmic_equalize_shadow_params_t::gui_init(dt_iop_module_t *self) const</a>
<a name="ln3037">{</a>
<a name="ln3038">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln3039">  dt_iop_gmic_params_t *p = reinterpret_cast&lt;dt_iop_gmic_params_t *&gt;(self-&gt;params);</a>
<a name="ln3040">  if(p-&gt;filter == equalize_shadow)</a>
<a name="ln3041">    g-&gt;equalize_shadow.parameters = *p;</a>
<a name="ln3042">  else</a>
<a name="ln3043">    g-&gt;equalize_shadow.parameters = dt_iop_gmic_equalize_shadow_params_t();</a>
<a name="ln3044">  dt_bauhaus_combobox_add(g-&gt;gmic_filter, _(&quot;equalize shadow&quot;));</a>
<a name="ln3045">  g-&gt;equalize_shadow.box = gtk_box_new(GTK_ORIENTATION_VERTICAL, DT_BAUHAUS_SPACE);</a>
<a name="ln3046">  gtk_box_pack_start(GTK_BOX(self-&gt;widget), g-&gt;equalize_shadow.box, TRUE, TRUE, 0);</a>
<a name="ln3047"> </a>
<a name="ln3048">  g-&gt;equalize_shadow.amplitude</a>
<a name="ln3049">      = dt_bauhaus_slider_new_with_range(self, 0, 1, 0.01, g-&gt;equalize_shadow.parameters.amplitude, 3);</a>
<a name="ln3050">  dt_bauhaus_widget_set_label(g-&gt;equalize_shadow.amplitude, NULL, _(&quot;amplitude&quot;));</a>
<a name="ln3051">  gtk_widget_set_tooltip_text(g-&gt;equalize_shadow.amplitude, _(&quot;amount of shadow equalization&quot;));</a>
<a name="ln3052">  gtk_box_pack_start(GTK_BOX(g-&gt;equalize_shadow.box), GTK_WIDGET(g-&gt;equalize_shadow.amplitude), TRUE, TRUE, 0);</a>
<a name="ln3053">  g_signal_connect(G_OBJECT(g-&gt;equalize_shadow.amplitude), &quot;value-changed&quot;,</a>
<a name="ln3054">                   G_CALLBACK(dt_iop_gmic_equalize_shadow_params_t::amplitude_callback), self);</a>
<a name="ln3055"> </a>
<a name="ln3056">  gtk_widget_show_all(g-&gt;equalize_shadow.box);</a>
<a name="ln3057">  gtk_widget_set_no_show_all(g-&gt;equalize_shadow.box, TRUE);</a>
<a name="ln3058">  gtk_widget_set_visible(g-&gt;equalize_shadow.box, p-&gt;filter == equalize_shadow ? TRUE : FALSE);</a>
<a name="ln3059">}</a>
<a name="ln3060"> </a>
<a name="ln3061">void dt_iop_gmic_equalize_shadow_params_t::gui_update(dt_iop_module_t *self) const</a>
<a name="ln3062">{</a>
<a name="ln3063">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln3064">  dt_iop_gmic_params_t *p = reinterpret_cast&lt;dt_iop_gmic_params_t *&gt;(self-&gt;params);</a>
<a name="ln3065">  gtk_widget_set_visible(g-&gt;equalize_shadow.box, p-&gt;filter == equalize_shadow ? TRUE : FALSE);</a>
<a name="ln3066">  if(p-&gt;filter == equalize_shadow)</a>
<a name="ln3067">  {</a>
<a name="ln3068">    g-&gt;equalize_shadow.parameters = *p;</a>
<a name="ln3069">    dt_bauhaus_slider_set(g-&gt;equalize_shadow.amplitude, g-&gt;equalize_shadow.parameters.amplitude);</a>
<a name="ln3070">  }</a>
<a name="ln3071">}</a>
<a name="ln3072"> </a>
<a name="ln3073">void dt_iop_gmic_equalize_shadow_params_t::gui_reset(dt_iop_module_t *self)</a>
<a name="ln3074">{</a>
<a name="ln3075">  *this = dt_iop_gmic_equalize_shadow_params_t();</a>
<a name="ln3076">}</a>
<a name="ln3077"> </a>
<a name="ln3078">void dt_iop_gmic_equalize_shadow_params_t::amplitude_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln3079">{</a>
<a name="ln3080">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln3081">    G-&gt;equalize_shadow.parameters.amplitude = dt_bauhaus_slider_get(W);</a>
<a name="ln3082">    return G-&gt;equalize_shadow.parameters.to_gmic_params();</a>
<a name="ln3083">  });</a>
<a name="ln3084">}</a>
<a name="ln3085"> </a>
<a name="ln3086">// --- add grain</a>
<a name="ln3087"> </a>
<a name="ln3088">dt_iop_gmic_add_grain_params_t::dt_iop_gmic_add_grain_params_t(const dt_iop_gmic_params_t &amp;other)</a>
<a name="ln3089">  : dt_iop_gmic_add_grain_params_t()</a>
<a name="ln3090">{</a>
<a name="ln3091">  dt_iop_gmic_add_grain_params_t p;</a>
<a name="ln3092">  if(other.filter == add_grain</a>
<a name="ln3093">     and std::sscanf(other.parameters, &quot;dt_add_grain %d,%d,%g,%g,%d,%g,%g,%g,%g,%g&quot;, &amp;p.preset, &amp;p.blend_mode,</a>
<a name="ln3094">                     &amp;p.opacity, &amp;p.scale, &amp;p.color_grain, &amp;p.brightness, &amp;p.contrast, &amp;p.gamma, &amp;p.hue,</a>
<a name="ln3095">                     &amp;p.saturation)</a>
<a name="ln3096">             == 10)</a>
<a name="ln3097">  {</a>
<a name="ln3098">    p.preset = clamp(0, 4, p.preset);</a>
<a name="ln3099">    p.blend_mode = clamp(0, 5, p.blend_mode);</a>
<a name="ln3100">    p.opacity = clamp(0.f, 1.f, p.opacity);</a>
<a name="ln3101">    p.scale = clamp(30.f, 100.f, p.scale);</a>
<a name="ln3102">    p.color_grain = clamp(0, 1, p.color_grain);</a>
<a name="ln3103">    p.brightness = clamp(-1.f, 1.f, p.brightness);</a>
<a name="ln3104">    p.contrast = clamp(-1.f, 1.f, p.contrast);</a>
<a name="ln3105">    p.gamma = clamp(-1.f, 1.f, p.gamma);</a>
<a name="ln3106">    p.hue = clamp(-1.f, 1.f, p.hue);</a>
<a name="ln3107">    p.saturation = clamp(-1.f, 1.f, p.saturation);</a>
<a name="ln3108">    *this = p;</a>
<a name="ln3109">  }</a>
<a name="ln3110">}</a>
<a name="ln3111"> </a>
<a name="ln3112">dt_iop_gmic_params_t dt_iop_gmic_add_grain_params_t::to_gmic_params() const</a>
<a name="ln3113">{</a>
<a name="ln3114">  dt_iop_gmic_params_t ret;</a>
<a name="ln3115">  ret.filter = add_grain;</a>
<a name="ln3116">  std::snprintf(ret.parameters, sizeof(ret.parameters), &quot;dt_add_grain %d,%d,%g,%g,%d,%g,%g,%g,%g,%g&quot;, preset,</a>
<a name="ln3117">                blend_mode, opacity, scale, color_grain, brightness, contrast, gamma, hue, saturation);</a>
<a name="ln3118">  return ret;</a>
<a name="ln3119">}</a>
<a name="ln3120"> </a>
<a name="ln3121">const char *dt_iop_gmic_add_grain_params_t::get_custom_command()</a>
<a name="ln3122">{</a>
<a name="ln3123">  // clang-format off</a>
<a name="ln3124">  return R&quot;raw(</a>
<a name="ln3125">dt_add_grain :</a>
<a name="ln3126">  fx_emulate_grain $1,$2,$3,$4,$5,{100*$6},{100*$7},{100*$8},{100*$9},{100*$10}</a>
<a name="ln3127">)raw&quot;;</a>
<a name="ln3128">  // clang-format on</a>
<a name="ln3129">}</a>
<a name="ln3130"> </a>
<a name="ln3131">filter_type dt_iop_gmic_add_grain_params_t::get_filter() const</a>
<a name="ln3132">{</a>
<a name="ln3133">  return add_grain;</a>
<a name="ln3134">}</a>
<a name="ln3135"> </a>
<a name="ln3136">void dt_iop_gmic_add_grain_params_t::gui_init(dt_iop_module_t *self) const</a>
<a name="ln3137">{</a>
<a name="ln3138">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln3139">  dt_iop_gmic_params_t *p = reinterpret_cast&lt;dt_iop_gmic_params_t *&gt;(self-&gt;params);</a>
<a name="ln3140">  if(p-&gt;filter == add_grain)</a>
<a name="ln3141">    g-&gt;add_grain.parameters = *p;</a>
<a name="ln3142">  else</a>
<a name="ln3143">    g-&gt;add_grain.parameters = dt_iop_gmic_add_grain_params_t();</a>
<a name="ln3144">  dt_bauhaus_combobox_add(g-&gt;gmic_filter, _(&quot;add film grain&quot;));</a>
<a name="ln3145">  g-&gt;add_grain.box = gtk_box_new(GTK_ORIENTATION_VERTICAL, DT_BAUHAUS_SPACE);</a>
<a name="ln3146">  gtk_box_pack_start(GTK_BOX(self-&gt;widget), g-&gt;add_grain.box, TRUE, TRUE, 0);</a>
<a name="ln3147"> </a>
<a name="ln3148">  g-&gt;add_grain.preset = dt_bauhaus_combobox_new(self);</a>
<a name="ln3149">  for(auto i : { _(&quot;ORWO NP20&quot;), _(&quot;Kodak TMAX 400&quot;), _(&quot;Kodak TMAX 3200&quot;), _(&quot;Kodak TRI-X 1600&quot;), _(&quot;Unknown&quot;) })</a>
<a name="ln3150">    dt_bauhaus_combobox_add(g-&gt;add_grain.preset, i);</a>
<a name="ln3151">  dt_bauhaus_widget_set_label(g-&gt;add_grain.preset, NULL, _(&quot;grain preset&quot;));</a>
<a name="ln3152">  gtk_widget_set_tooltip_text(g-&gt;add_grain.preset, _(&quot;emulate grain of given film type&quot;));</a>
<a name="ln3153">  gtk_box_pack_start(GTK_BOX(g-&gt;add_grain.box), g-&gt;add_grain.preset, TRUE, TRUE, 0);</a>
<a name="ln3154">  g_signal_connect(G_OBJECT(g-&gt;add_grain.preset), &quot;value-changed&quot;,</a>
<a name="ln3155">                   G_CALLBACK(dt_iop_gmic_add_grain_params_t::preset_callback), self);</a>
<a name="ln3156"> </a>
<a name="ln3157">  g-&gt;add_grain.blend_mode = dt_bauhaus_combobox_new(self);</a>
<a name="ln3158">  for(auto i : { _(&quot;alpha&quot;), _(&quot;grain merge&quot;), _(&quot;hard light&quot;), _(&quot;overlay&quot;), _(&quot;soft light&quot;), _(&quot;grain only&quot;) })</a>
<a name="ln3159">    dt_bauhaus_combobox_add(g-&gt;add_grain.blend_mode, i);</a>
<a name="ln3160">  dt_bauhaus_widget_set_label(g-&gt;add_grain.blend_mode, NULL, _(&quot;blend mode&quot;));</a>
<a name="ln3161">  gtk_widget_set_tooltip_text(g-&gt;add_grain.blend_mode, _(&quot;how to blend grain into picture&quot;));</a>
<a name="ln3162">  gtk_box_pack_start(GTK_BOX(g-&gt;add_grain.box), g-&gt;add_grain.blend_mode, TRUE, TRUE, 0);</a>
<a name="ln3163">  g_signal_connect(G_OBJECT(g-&gt;add_grain.blend_mode), &quot;value-changed&quot;,</a>
<a name="ln3164">                   G_CALLBACK(dt_iop_gmic_add_grain_params_t::blend_mode_callback), self);</a>
<a name="ln3165"> </a>
<a name="ln3166">  g-&gt;add_grain.opacity = dt_bauhaus_slider_new_with_range(self, 0, 1, 0.01, g-&gt;add_grain.parameters.opacity, 3);</a>
<a name="ln3167">  dt_bauhaus_widget_set_label(g-&gt;add_grain.opacity, NULL, _(&quot;opacity&quot;));</a>
<a name="ln3168">  gtk_widget_set_tooltip_text(g-&gt;add_grain.opacity, _(&quot;grain opacity&quot;));</a>
<a name="ln3169">  gtk_box_pack_start(GTK_BOX(g-&gt;add_grain.box), GTK_WIDGET(g-&gt;add_grain.opacity), TRUE, TRUE, 0);</a>
<a name="ln3170">  g_signal_connect(G_OBJECT(g-&gt;add_grain.opacity), &quot;value-changed&quot;,</a>
<a name="ln3171">                   G_CALLBACK(dt_iop_gmic_add_grain_params_t::opacity_callback), self);</a>
<a name="ln3172"> </a>
<a name="ln3173">  g-&gt;add_grain.scale = dt_bauhaus_slider_new_with_range(self, 30, 200, 1, g-&gt;add_grain.parameters.scale, 1);</a>
<a name="ln3174">  dt_bauhaus_widget_set_label(g-&gt;add_grain.scale, NULL, _(&quot;scale&quot;));</a>
<a name="ln3175">  gtk_widget_set_tooltip_text(g-&gt;add_grain.scale, _(&quot;grain scale&quot;));</a>
<a name="ln3176">  gtk_box_pack_start(GTK_BOX(g-&gt;add_grain.box), GTK_WIDGET(g-&gt;add_grain.scale), TRUE, TRUE, 0);</a>
<a name="ln3177">  g_signal_connect(G_OBJECT(g-&gt;add_grain.scale), &quot;value-changed&quot;,</a>
<a name="ln3178">                   G_CALLBACK(dt_iop_gmic_add_grain_params_t::scale_callback), self);</a>
<a name="ln3179"> </a>
<a name="ln3180">  g-&gt;add_grain.color_grain = dt_bauhaus_combobox_new(self);</a>
<a name="ln3181">  for(auto i : { _(&quot;monochrome grain&quot;), _(&quot;color grain&quot;) }) dt_bauhaus_combobox_add(g-&gt;add_grain.color_grain, i);</a>
<a name="ln3182">  dt_bauhaus_widget_set_label(g-&gt;add_grain.color_grain, NULL, _(&quot;grain type&quot;));</a>
<a name="ln3183">  gtk_widget_set_tooltip_text(g-&gt;add_grain.color_grain, _(&quot;select monochromatic or color grain&quot;));</a>
<a name="ln3184">  gtk_box_pack_start(GTK_BOX(g-&gt;add_grain.box), g-&gt;add_grain.color_grain, TRUE, TRUE, 0);</a>
<a name="ln3185">  g_signal_connect(G_OBJECT(g-&gt;add_grain.color_grain), &quot;value-changed&quot;,</a>
<a name="ln3186">                   G_CALLBACK(dt_iop_gmic_add_grain_params_t::color_grain_callback), self);</a>
<a name="ln3187"> </a>
<a name="ln3188">  g-&gt;add_grain.brightness</a>
<a name="ln3189">      = dt_bauhaus_slider_new_with_range(self, -1, 1, 0.01, g-&gt;add_grain.parameters.brightness, 3);</a>
<a name="ln3190">  dt_bauhaus_widget_set_label(g-&gt;add_grain.brightness, NULL, _(&quot;brightness&quot;));</a>
<a name="ln3191">  gtk_widget_set_tooltip_text(g-&gt;add_grain.brightness, _(&quot;brightness adjustment&quot;));</a>
<a name="ln3192">  gtk_box_pack_start(GTK_BOX(g-&gt;add_grain.box), GTK_WIDGET(g-&gt;add_grain.brightness), TRUE, TRUE, 0);</a>
<a name="ln3193">  g_signal_connect(G_OBJECT(g-&gt;add_grain.brightness), &quot;value-changed&quot;,</a>
<a name="ln3194">                   G_CALLBACK(dt_iop_gmic_add_grain_params_t::brightness_callback), self);</a>
<a name="ln3195"> </a>
<a name="ln3196">  g-&gt;add_grain.contrast = dt_bauhaus_slider_new_with_range(self, -1, 1, 0.01, g-&gt;add_grain.parameters.contrast, 3);</a>
<a name="ln3197">  dt_bauhaus_widget_set_label(g-&gt;add_grain.contrast, NULL, _(&quot;contrast&quot;));</a>
<a name="ln3198">  gtk_widget_set_tooltip_text(g-&gt;add_grain.contrast, _(&quot;contrast adjustment&quot;));</a>
<a name="ln3199">  gtk_box_pack_start(GTK_BOX(g-&gt;add_grain.box), GTK_WIDGET(g-&gt;add_grain.contrast), TRUE, TRUE, 0);</a>
<a name="ln3200">  g_signal_connect(G_OBJECT(g-&gt;add_grain.contrast), &quot;value-changed&quot;,</a>
<a name="ln3201">                   G_CALLBACK(dt_iop_gmic_add_grain_params_t::contrast_callback), self);</a>
<a name="ln3202"> </a>
<a name="ln3203">  g-&gt;add_grain.gamma = dt_bauhaus_slider_new_with_range(self, -1, 1, 0.01, g-&gt;add_grain.parameters.gamma, 3);</a>
<a name="ln3204">  dt_bauhaus_widget_set_label(g-&gt;add_grain.gamma, NULL, _(&quot;gamma&quot;));</a>
<a name="ln3205">  gtk_widget_set_tooltip_text(g-&gt;add_grain.gamma, _(&quot;gamma adjustment&quot;));</a>
<a name="ln3206">  gtk_box_pack_start(GTK_BOX(g-&gt;add_grain.box), GTK_WIDGET(g-&gt;add_grain.gamma), TRUE, TRUE, 0);</a>
<a name="ln3207">  g_signal_connect(G_OBJECT(g-&gt;add_grain.gamma), &quot;value-changed&quot;,</a>
<a name="ln3208">                   G_CALLBACK(dt_iop_gmic_add_grain_params_t::gamma_callback), self);</a>
<a name="ln3209"> </a>
<a name="ln3210">  g-&gt;add_grain.hue = dt_bauhaus_slider_new_with_range(self, -1, 1, 0.01, g-&gt;add_grain.parameters.hue, 3);</a>
<a name="ln3211">  dt_bauhaus_widget_set_label(g-&gt;add_grain.hue, NULL, _(&quot;hue&quot;));</a>
<a name="ln3212">  gtk_widget_set_tooltip_text(g-&gt;add_grain.hue, _(&quot;hue shift&quot;));</a>
<a name="ln3213">  gtk_box_pack_start(GTK_BOX(g-&gt;add_grain.box), GTK_WIDGET(g-&gt;add_grain.hue), TRUE, TRUE, 0);</a>
<a name="ln3214">  g_signal_connect(G_OBJECT(g-&gt;add_grain.hue), &quot;value-changed&quot;,</a>
<a name="ln3215">                   G_CALLBACK(dt_iop_gmic_add_grain_params_t::hue_callback), self);</a>
<a name="ln3216"> </a>
<a name="ln3217">  g-&gt;add_grain.saturation</a>
<a name="ln3218">      = dt_bauhaus_slider_new_with_range(self, -1, 1, 0.01, g-&gt;add_grain.parameters.saturation, 3);</a>
<a name="ln3219">  dt_bauhaus_widget_set_label(g-&gt;add_grain.saturation, NULL, _(&quot;saturation&quot;));</a>
<a name="ln3220">  gtk_widget_set_tooltip_text(g-&gt;add_grain.saturation, _(&quot;saturation adjustment&quot;));</a>
<a name="ln3221">  gtk_box_pack_start(GTK_BOX(g-&gt;add_grain.box), GTK_WIDGET(g-&gt;add_grain.saturation), TRUE, TRUE, 0);</a>
<a name="ln3222">  g_signal_connect(G_OBJECT(g-&gt;add_grain.saturation), &quot;value-changed&quot;,</a>
<a name="ln3223">                   G_CALLBACK(dt_iop_gmic_add_grain_params_t::saturation_callback), self);</a>
<a name="ln3224"> </a>
<a name="ln3225">  gtk_widget_show_all(g-&gt;add_grain.box);</a>
<a name="ln3226">  gtk_widget_set_no_show_all(g-&gt;add_grain.box, TRUE);</a>
<a name="ln3227">  gtk_widget_set_visible(g-&gt;add_grain.box, p-&gt;filter == add_grain ? TRUE : FALSE);</a>
<a name="ln3228">};</a>
<a name="ln3229"> </a>
<a name="ln3230">void dt_iop_gmic_add_grain_params_t::gui_update(dt_iop_module_t *self) const</a>
<a name="ln3231">{</a>
<a name="ln3232">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln3233">  dt_iop_gmic_params_t *p = reinterpret_cast&lt;dt_iop_gmic_params_t *&gt;(self-&gt;params);</a>
<a name="ln3234">  gtk_widget_set_visible(g-&gt;add_grain.box, p-&gt;filter == add_grain ? TRUE : FALSE);</a>
<a name="ln3235">  if(p-&gt;filter == add_grain)</a>
<a name="ln3236">  {</a>
<a name="ln3237">    g-&gt;add_grain.parameters = *p;</a>
<a name="ln3238">    dt_bauhaus_combobox_set(g-&gt;add_grain.preset, g-&gt;add_grain.parameters.preset);</a>
<a name="ln3239">    dt_bauhaus_combobox_set(g-&gt;add_grain.blend_mode, g-&gt;add_grain.parameters.blend_mode);</a>
<a name="ln3240">    dt_bauhaus_slider_set(g-&gt;add_grain.opacity, g-&gt;add_grain.parameters.opacity);</a>
<a name="ln3241">    dt_bauhaus_slider_set(g-&gt;add_grain.scale, g-&gt;add_grain.parameters.scale);</a>
<a name="ln3242">    dt_bauhaus_combobox_set(g-&gt;add_grain.color_grain, g-&gt;add_grain.parameters.color_grain);</a>
<a name="ln3243">    dt_bauhaus_slider_set(g-&gt;add_grain.brightness, g-&gt;add_grain.parameters.brightness);</a>
<a name="ln3244">    dt_bauhaus_slider_set(g-&gt;add_grain.contrast, g-&gt;add_grain.parameters.contrast);</a>
<a name="ln3245">    dt_bauhaus_slider_set(g-&gt;add_grain.gamma, g-&gt;add_grain.parameters.gamma);</a>
<a name="ln3246">    dt_bauhaus_slider_set(g-&gt;add_grain.hue, g-&gt;add_grain.parameters.hue);</a>
<a name="ln3247">    dt_bauhaus_slider_set(g-&gt;add_grain.saturation, g-&gt;add_grain.parameters.saturation);</a>
<a name="ln3248">  }</a>
<a name="ln3249">}</a>
<a name="ln3250"> </a>
<a name="ln3251">void dt_iop_gmic_add_grain_params_t::gui_reset(dt_iop_module_t *self)</a>
<a name="ln3252">{</a>
<a name="ln3253">  *this = dt_iop_gmic_add_grain_params_t();</a>
<a name="ln3254">}</a>
<a name="ln3255"> </a>
<a name="ln3256">void dt_iop_gmic_add_grain_params_t::preset_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln3257">{</a>
<a name="ln3258">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln3259">    G-&gt;add_grain.parameters.preset = dt_bauhaus_combobox_get(W);</a>
<a name="ln3260">    return G-&gt;add_grain.parameters.to_gmic_params();</a>
<a name="ln3261">  });</a>
<a name="ln3262">}</a>
<a name="ln3263"> </a>
<a name="ln3264">void dt_iop_gmic_add_grain_params_t::blend_mode_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln3265">{</a>
<a name="ln3266">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln3267">    G-&gt;add_grain.parameters.blend_mode = dt_bauhaus_combobox_get(W);</a>
<a name="ln3268">    return G-&gt;add_grain.parameters.to_gmic_params();</a>
<a name="ln3269">  });</a>
<a name="ln3270">}</a>
<a name="ln3271"> </a>
<a name="ln3272">void dt_iop_gmic_add_grain_params_t::opacity_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln3273">{</a>
<a name="ln3274">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln3275">    G-&gt;add_grain.parameters.opacity = dt_bauhaus_slider_get(W);</a>
<a name="ln3276">    return G-&gt;add_grain.parameters.to_gmic_params();</a>
<a name="ln3277">  });</a>
<a name="ln3278">}</a>
<a name="ln3279"> </a>
<a name="ln3280">void dt_iop_gmic_add_grain_params_t::scale_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln3281">{</a>
<a name="ln3282">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln3283">    G-&gt;add_grain.parameters.scale = dt_bauhaus_slider_get(W);</a>
<a name="ln3284">    return G-&gt;add_grain.parameters.to_gmic_params();</a>
<a name="ln3285">  });</a>
<a name="ln3286">}</a>
<a name="ln3287"> </a>
<a name="ln3288">void dt_iop_gmic_add_grain_params_t::color_grain_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln3289">{</a>
<a name="ln3290">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln3291">    G-&gt;add_grain.parameters.color_grain = dt_bauhaus_combobox_get(W);</a>
<a name="ln3292">    return G-&gt;add_grain.parameters.to_gmic_params();</a>
<a name="ln3293">  });</a>
<a name="ln3294">}</a>
<a name="ln3295"> </a>
<a name="ln3296">void dt_iop_gmic_add_grain_params_t::brightness_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln3297">{</a>
<a name="ln3298">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln3299">    G-&gt;add_grain.parameters.brightness = dt_bauhaus_slider_get(W);</a>
<a name="ln3300">    return G-&gt;add_grain.parameters.to_gmic_params();</a>
<a name="ln3301">  });</a>
<a name="ln3302">}</a>
<a name="ln3303"> </a>
<a name="ln3304">void dt_iop_gmic_add_grain_params_t::contrast_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln3305">{</a>
<a name="ln3306">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln3307">    G-&gt;add_grain.parameters.contrast = dt_bauhaus_slider_get(W);</a>
<a name="ln3308">    return G-&gt;add_grain.parameters.to_gmic_params();</a>
<a name="ln3309">  });</a>
<a name="ln3310">}</a>
<a name="ln3311"> </a>
<a name="ln3312">void dt_iop_gmic_add_grain_params_t::gamma_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln3313">{</a>
<a name="ln3314">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln3315">    G-&gt;add_grain.parameters.gamma = dt_bauhaus_slider_get(W);</a>
<a name="ln3316">    return G-&gt;add_grain.parameters.to_gmic_params();</a>
<a name="ln3317">  });</a>
<a name="ln3318">}</a>
<a name="ln3319"> </a>
<a name="ln3320">void dt_iop_gmic_add_grain_params_t::hue_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln3321">{</a>
<a name="ln3322">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln3323">    G-&gt;add_grain.parameters.hue = dt_bauhaus_slider_get(W);</a>
<a name="ln3324">    return G-&gt;add_grain.parameters.to_gmic_params();</a>
<a name="ln3325">  });</a>
<a name="ln3326">}</a>
<a name="ln3327"> </a>
<a name="ln3328">void dt_iop_gmic_add_grain_params_t::saturation_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln3329">{</a>
<a name="ln3330">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln3331">    G-&gt;add_grain.parameters.saturation = dt_bauhaus_slider_get(W);</a>
<a name="ln3332">    return G-&gt;add_grain.parameters.to_gmic_params();</a>
<a name="ln3333">  });</a>
<a name="ln3334">}</a>
<a name="ln3335"> </a>
<a name="ln3336">// --- pop shadows</a>
<a name="ln3337"> </a>
<a name="ln3338">dt_iop_gmic_pop_shadows_params_t::dt_iop_gmic_pop_shadows_params_t(const dt_iop_gmic_params_t &amp;other)</a>
<a name="ln3339">  : dt_iop_gmic_pop_shadows_params_t()</a>
<a name="ln3340">{</a>
<a name="ln3341">  dt_iop_gmic_pop_shadows_params_t p;</a>
<a name="ln3342">  if(other.filter == pop_shadows</a>
<a name="ln3343">     and std::sscanf(other.parameters, &quot;dt_pop_shadows %g,%g&quot;, &amp;p.strength, &amp;p.scale) == 2)</a>
<a name="ln3344">  {</a>
<a name="ln3345">    p.strength = clamp(0.f, 1.f, p.strength);</a>
<a name="ln3346">    p.scale = clamp(0.f, 20.f, p.scale);</a>
<a name="ln3347">    *this = p;</a>
<a name="ln3348">  }</a>
<a name="ln3349">}</a>
<a name="ln3350"> </a>
<a name="ln3351">dt_iop_gmic_params_t dt_iop_gmic_pop_shadows_params_t::to_gmic_params() const</a>
<a name="ln3352">{</a>
<a name="ln3353">  dt_iop_gmic_params_t ret;</a>
<a name="ln3354">  ret.filter = pop_shadows;</a>
<a name="ln3355">  std::snprintf(ret.parameters, sizeof(ret.parameters), &quot;dt_pop_shadows %g,%g&quot;, strength, scale);</a>
<a name="ln3356">  return ret;</a>
<a name="ln3357">}</a>
<a name="ln3358"> </a>
<a name="ln3359">const char *dt_iop_gmic_pop_shadows_params_t::get_custom_command()</a>
<a name="ln3360">{</a>
<a name="ln3361">  // clang-format off</a>
<a name="ln3362">  return R&quot;raw(</a>
<a name="ln3363">dt_pop_shadows :</a>
<a name="ln3364">  split_opacity local[0]</a>
<a name="ln3365">    .x2</a>
<a name="ln3366">    luminance.. negate.. imM={-2,[im,iM]} blur.. $2% normalize.. $imM</a>
<a name="ln3367">    blend[0,1] overlay,$1</a>
<a name="ln3368">    max</a>
<a name="ln3369">  endlocal</a>
<a name="ln3370">)raw&quot;;</a>
<a name="ln3371">  // clang-format on</a>
<a name="ln3372">}</a>
<a name="ln3373"> </a>
<a name="ln3374">filter_type dt_iop_gmic_pop_shadows_params_t::get_filter() const</a>
<a name="ln3375">{</a>
<a name="ln3376">  return pop_shadows;</a>
<a name="ln3377">}</a>
<a name="ln3378"> </a>
<a name="ln3379">void dt_iop_gmic_pop_shadows_params_t::gui_init(dt_iop_module_t *self) const</a>
<a name="ln3380">{</a>
<a name="ln3381">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln3382">  dt_iop_gmic_params_t *p = reinterpret_cast&lt;dt_iop_gmic_params_t *&gt;(self-&gt;params);</a>
<a name="ln3383">  if(p-&gt;filter == pop_shadows)</a>
<a name="ln3384">    g-&gt;pop_shadows.parameters = *p;</a>
<a name="ln3385">  else</a>
<a name="ln3386">    g-&gt;pop_shadows.parameters = dt_iop_gmic_pop_shadows_params_t();</a>
<a name="ln3387">  dt_bauhaus_combobox_add(g-&gt;gmic_filter, _(&quot;pop shadows&quot;));</a>
<a name="ln3388">  g-&gt;pop_shadows.box = gtk_box_new(GTK_ORIENTATION_VERTICAL, DT_BAUHAUS_SPACE);</a>
<a name="ln3389">  gtk_box_pack_start(GTK_BOX(self-&gt;widget), g-&gt;pop_shadows.box, TRUE, TRUE, 0);</a>
<a name="ln3390"> </a>
<a name="ln3391">  g-&gt;pop_shadows.strength</a>
<a name="ln3392">      = dt_bauhaus_slider_new_with_range(self, 0, 1, 0.01, g-&gt;pop_shadows.parameters.strength, 3);</a>
<a name="ln3393">  dt_bauhaus_widget_set_label(g-&gt;pop_shadows.strength, NULL, _(&quot;strength&quot;));</a>
<a name="ln3394">  gtk_widget_set_tooltip_text(g-&gt;pop_shadows.strength, _(&quot;strength of shadow brightening&quot;));</a>
<a name="ln3395">  gtk_box_pack_start(GTK_BOX(g-&gt;pop_shadows.box), GTK_WIDGET(g-&gt;pop_shadows.strength), TRUE, TRUE, 0);</a>
<a name="ln3396">  g_signal_connect(G_OBJECT(g-&gt;pop_shadows.strength), &quot;value-changed&quot;,</a>
<a name="ln3397">                   G_CALLBACK(dt_iop_gmic_pop_shadows_params_t::strength_callback), self);</a>
<a name="ln3398"> </a>
<a name="ln3399">  g-&gt;pop_shadows.scale = dt_bauhaus_slider_new_with_range(self, 0, 20, 0.01, g-&gt;pop_shadows.parameters.scale, 3);</a>
<a name="ln3400">  dt_bauhaus_widget_set_label(g-&gt;pop_shadows.scale, NULL, _(&quot;scale&quot;));</a>
<a name="ln3401">  gtk_widget_set_tooltip_text(g-&gt;pop_shadows.scale, _(&quot;scale of blur used in shadow brightening&quot;));</a>
<a name="ln3402">  gtk_box_pack_start(GTK_BOX(g-&gt;pop_shadows.box), GTK_WIDGET(g-&gt;pop_shadows.scale), TRUE, TRUE, 0);</a>
<a name="ln3403">  g_signal_connect(G_OBJECT(g-&gt;pop_shadows.scale), &quot;value-changed&quot;,</a>
<a name="ln3404">                   G_CALLBACK(dt_iop_gmic_pop_shadows_params_t::scale_callback), self);</a>
<a name="ln3405"> </a>
<a name="ln3406">  gtk_widget_show_all(g-&gt;pop_shadows.box);</a>
<a name="ln3407">  gtk_widget_set_no_show_all(g-&gt;pop_shadows.box, TRUE);</a>
<a name="ln3408">  gtk_widget_set_visible(g-&gt;pop_shadows.box, p-&gt;filter == pop_shadows ? TRUE : FALSE);</a>
<a name="ln3409">}</a>
<a name="ln3410"> </a>
<a name="ln3411">void dt_iop_gmic_pop_shadows_params_t::gui_update(dt_iop_module_t *self) const</a>
<a name="ln3412">{</a>
<a name="ln3413">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln3414">  dt_iop_gmic_params_t *p = reinterpret_cast&lt;dt_iop_gmic_params_t *&gt;(self-&gt;params);</a>
<a name="ln3415">  gtk_widget_set_visible(g-&gt;pop_shadows.box, p-&gt;filter == pop_shadows ? TRUE : FALSE);</a>
<a name="ln3416">  if(p-&gt;filter == pop_shadows)</a>
<a name="ln3417">  {</a>
<a name="ln3418">    g-&gt;pop_shadows.parameters = *p;</a>
<a name="ln3419">    dt_bauhaus_slider_set(g-&gt;pop_shadows.strength, g-&gt;pop_shadows.parameters.strength);</a>
<a name="ln3420">    dt_bauhaus_slider_set(g-&gt;pop_shadows.scale, g-&gt;pop_shadows.parameters.scale);</a>
<a name="ln3421">  }</a>
<a name="ln3422">}</a>
<a name="ln3423"> </a>
<a name="ln3424">void dt_iop_gmic_pop_shadows_params_t::gui_reset(dt_iop_module_t *self)</a>
<a name="ln3425">{</a>
<a name="ln3426">  *this = dt_iop_gmic_pop_shadows_params_t();</a>
<a name="ln3427">}</a>
<a name="ln3428"> </a>
<a name="ln3429">void dt_iop_gmic_pop_shadows_params_t::strength_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln3430">{</a>
<a name="ln3431">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln3432">    G-&gt;pop_shadows.parameters.strength = dt_bauhaus_slider_get(W);</a>
<a name="ln3433">    return G-&gt;pop_shadows.parameters.to_gmic_params();</a>
<a name="ln3434">  });</a>
<a name="ln3435">}</a>
<a name="ln3436"> </a>
<a name="ln3437">void dt_iop_gmic_pop_shadows_params_t::scale_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln3438">{</a>
<a name="ln3439">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln3440">    G-&gt;pop_shadows.parameters.scale = dt_bauhaus_slider_get(W);</a>
<a name="ln3441">    return G-&gt;pop_shadows.parameters.to_gmic_params();</a>
<a name="ln3442">  });</a>
<a name="ln3443">}</a>
<a name="ln3444"> </a>
<a name="ln3445">// --- smooth bilateral</a>
<a name="ln3446"> </a>
<a name="ln3447">dt_iop_gmic_smooth_bilateral_params_t::dt_iop_gmic_smooth_bilateral_params_t(const dt_iop_gmic_params_t &amp;other)</a>
<a name="ln3448">  : dt_iop_gmic_smooth_bilateral_params_t()</a>
<a name="ln3449">{</a>
<a name="ln3450">  dt_iop_gmic_smooth_bilateral_params_t p;</a>
<a name="ln3451">  if(other.filter == smooth_bilateral</a>
<a name="ln3452">     and std::sscanf(other.parameters, &quot;dt_smooth_bilateral %g,%g,%d,%d&quot;, &amp;p.spatial_scale, &amp;p.value_scale,</a>
<a name="ln3453">                     &amp;p.iterations, &amp;p.channel)</a>
<a name="ln3454">             == 4)</a>
<a name="ln3455">  {</a>
<a name="ln3456">    p.spatial_scale = clamp(0.f, 100.f, p.spatial_scale);</a>
<a name="ln3457">    p.value_scale = clamp(0.f, 1.f, p.value_scale);</a>
<a name="ln3458">    p.iterations = clamp(1, 10, p.iterations);</a>
<a name="ln3459">    p.channel = clamp(0, static_cast&lt;int&gt;(color_channels.size() - 1), p.channel);</a>
<a name="ln3460">    *this = p;</a>
<a name="ln3461">  }</a>
<a name="ln3462">}</a>
<a name="ln3463"> </a>
<a name="ln3464">dt_iop_gmic_params_t dt_iop_gmic_smooth_bilateral_params_t::to_gmic_params() const</a>
<a name="ln3465">{</a>
<a name="ln3466">  dt_iop_gmic_params_t ret;</a>
<a name="ln3467">  ret.filter = smooth_bilateral;</a>
<a name="ln3468">  std::snprintf(ret.parameters, sizeof(ret.parameters), &quot;dt_smooth_bilateral %g,%g,%d,%d&quot;, spatial_scale,</a>
<a name="ln3469">                value_scale, iterations, channel);</a>
<a name="ln3470">  return ret;</a>
<a name="ln3471">}</a>
<a name="ln3472"> </a>
<a name="ln3473">const char *dt_iop_gmic_smooth_bilateral_params_t::get_custom_command() {</a>
<a name="ln3474">  // clang-format off</a>
<a name="ln3475">  return R&quot;raw(</a>
<a name="ln3476">dt_smooth_bilateral :</a>
<a name="ln3477">  apply_channels &quot;repeat $3 bilateral $1,{255*$2} done&quot;,$4</a>
<a name="ln3478">)raw&quot;;</a>
<a name="ln3479">  // clang-format on</a>
<a name="ln3480">}</a>
<a name="ln3481"> </a>
<a name="ln3482">filter_type dt_iop_gmic_smooth_bilateral_params_t::get_filter() const</a>
<a name="ln3483">{</a>
<a name="ln3484">  return smooth_bilateral;</a>
<a name="ln3485">}</a>
<a name="ln3486"> </a>
<a name="ln3487">void dt_iop_gmic_smooth_bilateral_params_t::gui_init(dt_iop_module_t *self) const</a>
<a name="ln3488">{</a>
<a name="ln3489">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln3490">  dt_iop_gmic_params_t *p = reinterpret_cast&lt;dt_iop_gmic_params_t *&gt;(self-&gt;params);</a>
<a name="ln3491">  if(p-&gt;filter == smooth_bilateral)</a>
<a name="ln3492">    g-&gt;smooth_bilateral.parameters = *p;</a>
<a name="ln3493">  else</a>
<a name="ln3494">    g-&gt;smooth_bilateral.parameters = dt_iop_gmic_smooth_bilateral_params_t();</a>
<a name="ln3495">  dt_bauhaus_combobox_add(g-&gt;gmic_filter, _(&quot;smooth bilateral&quot;));</a>
<a name="ln3496">  g-&gt;smooth_bilateral.box = gtk_box_new(GTK_ORIENTATION_VERTICAL, DT_BAUHAUS_SPACE);</a>
<a name="ln3497">  gtk_box_pack_start(GTK_BOX(self-&gt;widget), g-&gt;smooth_bilateral.box, TRUE, TRUE, 0);</a>
<a name="ln3498"> </a>
<a name="ln3499">  g-&gt;smooth_bilateral.spatial_scale</a>
<a name="ln3500">      = dt_bauhaus_slider_new_with_range(self, 0, 100, 0.5, g-&gt;smooth_bilateral.parameters.spatial_scale, 2);</a>
<a name="ln3501">  dt_bauhaus_widget_set_label(g-&gt;smooth_bilateral.spatial_scale, NULL, _(&quot;spatial scale&quot;));</a>
<a name="ln3502">  gtk_widget_set_tooltip_text(g-&gt;smooth_bilateral.spatial_scale,</a>
<a name="ln3503">                              _(&quot;spatial standard deviation of Gaussian kernel&quot;));</a>
<a name="ln3504">  gtk_box_pack_start(GTK_BOX(g-&gt;smooth_bilateral.box), GTK_WIDGET(g-&gt;smooth_bilateral.spatial_scale), TRUE, TRUE,</a>
<a name="ln3505">                     0);</a>
<a name="ln3506">  g_signal_connect(G_OBJECT(g-&gt;smooth_bilateral.spatial_scale), &quot;value-changed&quot;,</a>
<a name="ln3507">                   G_CALLBACK(dt_iop_gmic_smooth_bilateral_params_t::spatial_scale_callback), self);</a>
<a name="ln3508"> </a>
<a name="ln3509">  g-&gt;smooth_bilateral.value_scale</a>
<a name="ln3510">      = dt_bauhaus_slider_new_with_range(self, 0, 1, 0.01, g-&gt;smooth_bilateral.parameters.spatial_scale, 3);</a>
<a name="ln3511">  dt_bauhaus_widget_set_label(g-&gt;smooth_bilateral.value_scale, NULL, _(&quot;value scale&quot;));</a>
<a name="ln3512">  gtk_widget_set_tooltip_text(g-&gt;smooth_bilateral.value_scale,</a>
<a name="ln3513">                              _(&quot;color/luminance standard deviation of Gaussian kernel&quot;));</a>
<a name="ln3514">  gtk_box_pack_start(GTK_BOX(g-&gt;smooth_bilateral.box), GTK_WIDGET(g-&gt;smooth_bilateral.value_scale), TRUE, TRUE, 0);</a>
<a name="ln3515">  g_signal_connect(G_OBJECT(g-&gt;smooth_bilateral.value_scale), &quot;value-changed&quot;,</a>
<a name="ln3516">                   G_CALLBACK(dt_iop_gmic_smooth_bilateral_params_t::value_scale_callback), self);</a>
<a name="ln3517"> </a>
<a name="ln3518">  g-&gt;smooth_bilateral.iterations</a>
<a name="ln3519">      = dt_bauhaus_slider_new_with_range(self, 1, 10, 1, g-&gt;smooth_bilateral.parameters.iterations, 0);</a>
<a name="ln3520">  dt_bauhaus_widget_set_label(g-&gt;smooth_bilateral.iterations, NULL, _(&quot;iterations&quot;));</a>
<a name="ln3521">  gtk_widget_set_tooltip_text(g-&gt;smooth_bilateral.iterations, _(&quot;number of iterations&quot;));</a>
<a name="ln3522">  gtk_box_pack_start(GTK_BOX(g-&gt;smooth_bilateral.box), GTK_WIDGET(g-&gt;smooth_bilateral.iterations), TRUE, TRUE, 0);</a>
<a name="ln3523">  g_signal_connect(G_OBJECT(g-&gt;smooth_bilateral.iterations), &quot;value-changed&quot;,</a>
<a name="ln3524">                   G_CALLBACK(dt_iop_gmic_smooth_bilateral_params_t::iterations_callback), self);</a>
<a name="ln3525"> </a>
<a name="ln3526">  g-&gt;smooth_bilateral.channel = dt_bauhaus_combobox_new(self);</a>
<a name="ln3527">  for(auto str : color_channels) dt_bauhaus_combobox_add(g-&gt;smooth_bilateral.channel, str);</a>
<a name="ln3528">  dt_bauhaus_widget_set_label(g-&gt;smooth_bilateral.channel, NULL, _(&quot;channel&quot;));</a>
<a name="ln3529">  gtk_widget_set_tooltip_text(g-&gt;smooth_bilateral.channel, _(&quot;apply filter to specific color channel(s)&quot;));</a>
<a name="ln3530">  gtk_box_pack_start(GTK_BOX(g-&gt;smooth_bilateral.box), g-&gt;smooth_bilateral.channel, TRUE, TRUE, 0);</a>
<a name="ln3531">  g_signal_connect(G_OBJECT(g-&gt;smooth_bilateral.channel), &quot;value-changed&quot;,</a>
<a name="ln3532">                   G_CALLBACK(dt_iop_gmic_smooth_bilateral_params_t::channel_callback), self);</a>
<a name="ln3533"> </a>
<a name="ln3534">  gtk_widget_show_all(g-&gt;smooth_bilateral.box);</a>
<a name="ln3535">  gtk_widget_set_no_show_all(g-&gt;smooth_bilateral.box, TRUE);</a>
<a name="ln3536">  gtk_widget_set_visible(g-&gt;smooth_bilateral.box, p-&gt;filter == smooth_bilateral ? TRUE : FALSE);</a>
<a name="ln3537">}</a>
<a name="ln3538"> </a>
<a name="ln3539">void dt_iop_gmic_smooth_bilateral_params_t::gui_update(dt_iop_module_t *self) const</a>
<a name="ln3540">{</a>
<a name="ln3541">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln3542">  dt_iop_gmic_params_t *p = reinterpret_cast&lt;dt_iop_gmic_params_t *&gt;(self-&gt;params);</a>
<a name="ln3543">  gtk_widget_set_visible(g-&gt;smooth_bilateral.box, p-&gt;filter == smooth_bilateral ? TRUE : FALSE);</a>
<a name="ln3544">  if(p-&gt;filter == smooth_bilateral)</a>
<a name="ln3545">  {</a>
<a name="ln3546">    g-&gt;smooth_bilateral.parameters = *p;</a>
<a name="ln3547">    dt_bauhaus_slider_set(g-&gt;smooth_bilateral.spatial_scale, g-&gt;smooth_bilateral.parameters.spatial_scale);</a>
<a name="ln3548">    dt_bauhaus_slider_set(g-&gt;smooth_bilateral.value_scale, g-&gt;smooth_bilateral.parameters.value_scale);</a>
<a name="ln3549">    dt_bauhaus_slider_set(g-&gt;smooth_bilateral.iterations, g-&gt;smooth_bilateral.parameters.iterations);</a>
<a name="ln3550">    dt_bauhaus_combobox_set(g-&gt;smooth_bilateral.channel, g-&gt;smooth_bilateral.parameters.channel);</a>
<a name="ln3551">  }</a>
<a name="ln3552">}</a>
<a name="ln3553"> </a>
<a name="ln3554">void dt_iop_gmic_smooth_bilateral_params_t::gui_reset(dt_iop_module_t *self)</a>
<a name="ln3555">{</a>
<a name="ln3556">  *this = dt_iop_gmic_smooth_bilateral_params_t();</a>
<a name="ln3557">}</a>
<a name="ln3558"> </a>
<a name="ln3559">void dt_iop_gmic_smooth_bilateral_params_t::spatial_scale_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln3560">{</a>
<a name="ln3561">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln3562">    G-&gt;smooth_bilateral.parameters.spatial_scale = dt_bauhaus_slider_get(W);</a>
<a name="ln3563">    return G-&gt;smooth_bilateral.parameters.to_gmic_params();</a>
<a name="ln3564">  });</a>
<a name="ln3565">}</a>
<a name="ln3566"> </a>
<a name="ln3567">void dt_iop_gmic_smooth_bilateral_params_t::value_scale_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln3568">{</a>
<a name="ln3569">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln3570">    G-&gt;smooth_bilateral.parameters.value_scale = dt_bauhaus_slider_get(W);</a>
<a name="ln3571">    return G-&gt;smooth_bilateral.parameters.to_gmic_params();</a>
<a name="ln3572">  });</a>
<a name="ln3573">}</a>
<a name="ln3574"> </a>
<a name="ln3575">void dt_iop_gmic_smooth_bilateral_params_t::iterations_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln3576">{</a>
<a name="ln3577">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln3578">    G-&gt;smooth_bilateral.parameters.iterations = static_cast&lt;int&gt;(std::round(dt_bauhaus_slider_get(W)));</a>
<a name="ln3579">    return G-&gt;smooth_bilateral.parameters.to_gmic_params();</a>
<a name="ln3580">  });</a>
<a name="ln3581">}</a>
<a name="ln3582"> </a>
<a name="ln3583">void dt_iop_gmic_smooth_bilateral_params_t::channel_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln3584">{</a>
<a name="ln3585">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln3586">    G-&gt;smooth_bilateral.parameters.channel = dt_bauhaus_combobox_get(W);</a>
<a name="ln3587">    return G-&gt;smooth_bilateral.parameters.to_gmic_params();</a>
<a name="ln3588">  });</a>
<a name="ln3589">}</a>
<a name="ln3590"> </a>
<a name="ln3591">// --- smooth guided</a>
<a name="ln3592"> </a>
<a name="ln3593">dt_iop_gmic_smooth_guided_params_t::dt_iop_gmic_smooth_guided_params_t(const dt_iop_gmic_params_t &amp;other)</a>
<a name="ln3594">  : dt_iop_gmic_smooth_guided_params_t()</a>
<a name="ln3595">{</a>
<a name="ln3596">  dt_iop_gmic_smooth_guided_params_t p;</a>
<a name="ln3597">  if(other.filter == smooth_guided</a>
<a name="ln3598">     and std::sscanf(other.parameters, &quot;dt_smooth_guided %g,%g,%d,%d&quot;, &amp;p.radius, &amp;p.smoothness, &amp;p.iterations,</a>
<a name="ln3599">                     &amp;p.channel)</a>
<a name="ln3600">             == 4)</a>
<a name="ln3601">  {</a>
<a name="ln3602">    p.radius = clamp(0.f, 100.f, p.radius);</a>
<a name="ln3603">    p.smoothness = clamp(0.f, 1.f, p.smoothness);</a>
<a name="ln3604">    p.iterations = clamp(1, 10, p.iterations);</a>
<a name="ln3605">    p.channel = clamp(0, static_cast&lt;int&gt;(color_channels.size() - 1), p.channel);</a>
<a name="ln3606">    *this = p;</a>
<a name="ln3607">  }</a>
<a name="ln3608">}</a>
<a name="ln3609"> </a>
<a name="ln3610">dt_iop_gmic_params_t dt_iop_gmic_smooth_guided_params_t::to_gmic_params() const</a>
<a name="ln3611">{</a>
<a name="ln3612">  dt_iop_gmic_params_t ret;</a>
<a name="ln3613">  ret.filter = smooth_guided;</a>
<a name="ln3614">  std::snprintf(ret.parameters, sizeof(ret.parameters), &quot;dt_smooth_guided %g,%g,%d,%d&quot;, radius, smoothness,</a>
<a name="ln3615">                iterations, channel);</a>
<a name="ln3616">  return ret;</a>
<a name="ln3617">}</a>
<a name="ln3618"> </a>
<a name="ln3619">const char *dt_iop_gmic_smooth_guided_params_t::get_custom_command() {</a>
<a name="ln3620">  // clang-format off</a>
<a name="ln3621">  return R&quot;raw(</a>
<a name="ln3622">dt_smooth_guided :</a>
<a name="ln3623">  apply_channels &quot;repeat $3 guided $1,{512*$2} done&quot;,$4</a>
<a name="ln3624">)raw&quot;;</a>
<a name="ln3625">  // clang-format on</a>
<a name="ln3626">}</a>
<a name="ln3627"> </a>
<a name="ln3628">filter_type dt_iop_gmic_smooth_guided_params_t::get_filter() const</a>
<a name="ln3629">{</a>
<a name="ln3630">  return smooth_guided;</a>
<a name="ln3631">}</a>
<a name="ln3632"> </a>
<a name="ln3633">void dt_iop_gmic_smooth_guided_params_t::gui_init(dt_iop_module_t *self) const</a>
<a name="ln3634">{</a>
<a name="ln3635">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln3636">  dt_iop_gmic_params_t *p = reinterpret_cast&lt;dt_iop_gmic_params_t *&gt;(self-&gt;params);</a>
<a name="ln3637">  if(p-&gt;filter == smooth_guided)</a>
<a name="ln3638">    g-&gt;smooth_guided.parameters = *p;</a>
<a name="ln3639">  else</a>
<a name="ln3640">    g-&gt;smooth_guided.parameters = dt_iop_gmic_smooth_guided_params_t();</a>
<a name="ln3641">  dt_bauhaus_combobox_add(g-&gt;gmic_filter, _(&quot;smooth guided&quot;));</a>
<a name="ln3642">  g-&gt;smooth_guided.box = gtk_box_new(GTK_ORIENTATION_VERTICAL, DT_BAUHAUS_SPACE);</a>
<a name="ln3643">  gtk_box_pack_start(GTK_BOX(self-&gt;widget), g-&gt;smooth_guided.box, TRUE, TRUE, 0);</a>
<a name="ln3644"> </a>
<a name="ln3645">  g-&gt;smooth_guided.radius</a>
<a name="ln3646">      = dt_bauhaus_slider_new_with_range(self, 0, 100, 0.5, g-&gt;smooth_guided.parameters.radius, 2);</a>
<a name="ln3647">  dt_bauhaus_widget_set_label(g-&gt;smooth_guided.radius, NULL, _(&quot;radius&quot;));</a>
<a name="ln3648">  gtk_widget_set_tooltip_text(g-&gt;smooth_guided.radius, _(&quot;radius of the guided filer&quot;));</a>
<a name="ln3649">  gtk_box_pack_start(GTK_BOX(g-&gt;smooth_guided.box), GTK_WIDGET(g-&gt;smooth_guided.radius), TRUE, TRUE, 0);</a>
<a name="ln3650">  g_signal_connect(G_OBJECT(g-&gt;smooth_guided.radius), &quot;value-changed&quot;,</a>
<a name="ln3651">                   G_CALLBACK(dt_iop_gmic_smooth_guided_params_t::radius_callback), self);</a>
<a name="ln3652"> </a>
<a name="ln3653">  g-&gt;smooth_guided.smoothness</a>
<a name="ln3654">      = dt_bauhaus_slider_new_with_range(self, 0, 1, 0.01, g-&gt;smooth_guided.parameters.smoothness, 3);</a>
<a name="ln3655">  dt_bauhaus_widget_set_label(g-&gt;smooth_guided.smoothness, NULL, _(&quot;smoothness&quot;));</a>
<a name="ln3656">  gtk_widget_set_tooltip_text(g-&gt;smooth_guided.smoothness, _(&quot;smoothness of guided filter&quot;));</a>
<a name="ln3657">  gtk_box_pack_start(GTK_BOX(g-&gt;smooth_guided.box), GTK_WIDGET(g-&gt;smooth_guided.smoothness), TRUE, TRUE, 0);</a>
<a name="ln3658">  g_signal_connect(G_OBJECT(g-&gt;smooth_guided.smoothness), &quot;value-changed&quot;,</a>
<a name="ln3659">                   G_CALLBACK(dt_iop_gmic_smooth_guided_params_t::smoothness_callback), self);</a>
<a name="ln3660"> </a>
<a name="ln3661">  g-&gt;smooth_guided.iterations</a>
<a name="ln3662">      = dt_bauhaus_slider_new_with_range(self, 1, 10, 1, g-&gt;smooth_guided.parameters.iterations, 0);</a>
<a name="ln3663">  dt_bauhaus_widget_set_label(g-&gt;smooth_guided.iterations, NULL, _(&quot;iterations&quot;));</a>
<a name="ln3664">  gtk_widget_set_tooltip_text(g-&gt;smooth_guided.iterations, _(&quot;number of iterations&quot;));</a>
<a name="ln3665">  gtk_box_pack_start(GTK_BOX(g-&gt;smooth_guided.box), GTK_WIDGET(g-&gt;smooth_guided.iterations), TRUE, TRUE, 0);</a>
<a name="ln3666">  g_signal_connect(G_OBJECT(g-&gt;smooth_guided.iterations), &quot;value-changed&quot;,</a>
<a name="ln3667">                   G_CALLBACK(dt_iop_gmic_smooth_guided_params_t::iterations_callback), self);</a>
<a name="ln3668"> </a>
<a name="ln3669">  g-&gt;smooth_guided.channel = dt_bauhaus_combobox_new(self);</a>
<a name="ln3670">  for(auto str : color_channels) dt_bauhaus_combobox_add(g-&gt;smooth_guided.channel, str);</a>
<a name="ln3671">  dt_bauhaus_widget_set_label(g-&gt;smooth_guided.channel, NULL, _(&quot;channel&quot;));</a>
<a name="ln3672">  gtk_widget_set_tooltip_text(g-&gt;smooth_guided.channel, _(&quot;apply filter to specific color channel(s)&quot;));</a>
<a name="ln3673">  gtk_box_pack_start(GTK_BOX(g-&gt;smooth_guided.box), g-&gt;smooth_guided.channel, TRUE, TRUE, 0);</a>
<a name="ln3674">  g_signal_connect(G_OBJECT(g-&gt;smooth_guided.channel), &quot;value-changed&quot;,</a>
<a name="ln3675">                   G_CALLBACK(dt_iop_gmic_smooth_guided_params_t::channel_callback), self);</a>
<a name="ln3676"> </a>
<a name="ln3677">  gtk_widget_show_all(g-&gt;smooth_guided.box);</a>
<a name="ln3678">  gtk_widget_set_no_show_all(g-&gt;smooth_guided.box, TRUE);</a>
<a name="ln3679">  gtk_widget_set_visible(g-&gt;smooth_guided.box, p-&gt;filter == smooth_guided ? TRUE : FALSE);</a>
<a name="ln3680">}</a>
<a name="ln3681"> </a>
<a name="ln3682">void dt_iop_gmic_smooth_guided_params_t::gui_update(dt_iop_module_t *self) const</a>
<a name="ln3683">{</a>
<a name="ln3684">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln3685">  dt_iop_gmic_params_t *p = reinterpret_cast&lt;dt_iop_gmic_params_t *&gt;(self-&gt;params);</a>
<a name="ln3686">  gtk_widget_set_visible(g-&gt;smooth_guided.box, p-&gt;filter == smooth_guided ? TRUE : FALSE);</a>
<a name="ln3687">  if(p-&gt;filter == smooth_guided)</a>
<a name="ln3688">  {</a>
<a name="ln3689">    g-&gt;smooth_guided.parameters = *p;</a>
<a name="ln3690">    dt_bauhaus_slider_set(g-&gt;smooth_guided.radius, g-&gt;smooth_guided.parameters.radius);</a>
<a name="ln3691">    dt_bauhaus_slider_set(g-&gt;smooth_guided.smoothness, g-&gt;smooth_guided.parameters.smoothness);</a>
<a name="ln3692">    dt_bauhaus_slider_set(g-&gt;smooth_guided.iterations, g-&gt;smooth_guided.parameters.iterations);</a>
<a name="ln3693">    dt_bauhaus_combobox_set(g-&gt;smooth_guided.channel, g-&gt;smooth_guided.parameters.channel);</a>
<a name="ln3694">  }</a>
<a name="ln3695">}</a>
<a name="ln3696"> </a>
<a name="ln3697">void dt_iop_gmic_smooth_guided_params_t::gui_reset(dt_iop_module_t *self)</a>
<a name="ln3698">{</a>
<a name="ln3699">  *this = dt_iop_gmic_smooth_guided_params_t();</a>
<a name="ln3700">}</a>
<a name="ln3701"> </a>
<a name="ln3702">void dt_iop_gmic_smooth_guided_params_t::radius_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln3703">{</a>
<a name="ln3704">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln3705">    G-&gt;smooth_guided.parameters.radius = dt_bauhaus_slider_get(W);</a>
<a name="ln3706">    return G-&gt;smooth_guided.parameters.to_gmic_params();</a>
<a name="ln3707">  });</a>
<a name="ln3708">}</a>
<a name="ln3709"> </a>
<a name="ln3710">void dt_iop_gmic_smooth_guided_params_t::smoothness_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln3711">{</a>
<a name="ln3712">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln3713">    G-&gt;smooth_guided.parameters.smoothness = dt_bauhaus_slider_get(W);</a>
<a name="ln3714">    return G-&gt;smooth_guided.parameters.to_gmic_params();</a>
<a name="ln3715">  });</a>
<a name="ln3716">}</a>
<a name="ln3717"> </a>
<a name="ln3718">void dt_iop_gmic_smooth_guided_params_t::iterations_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln3719">{</a>
<a name="ln3720">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln3721">    G-&gt;smooth_guided.parameters.iterations = static_cast&lt;int&gt;(std::round(dt_bauhaus_slider_get(W)));</a>
<a name="ln3722">    return G-&gt;smooth_guided.parameters.to_gmic_params();</a>
<a name="ln3723">  });</a>
<a name="ln3724">}</a>
<a name="ln3725"> </a>
<a name="ln3726">void dt_iop_gmic_smooth_guided_params_t::channel_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln3727">{</a>
<a name="ln3728">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln3729">    G-&gt;smooth_guided.parameters.channel = dt_bauhaus_combobox_get(W);</a>
<a name="ln3730">    return G-&gt;smooth_guided.parameters.to_gmic_params();</a>
<a name="ln3731">  });</a>
<a name="ln3732">}</a>
<a name="ln3733"> </a>
<a name="ln3734">// --- light glow</a>
<a name="ln3735"> </a>
<a name="ln3736">dt_iop_gmic_light_glow_params_t::dt_iop_gmic_light_glow_params_t(const dt_iop_gmic_params_t &amp;other)</a>
<a name="ln3737">  : dt_iop_gmic_light_glow_params_t()</a>
<a name="ln3738">{</a>
<a name="ln3739">  dt_iop_gmic_light_glow_params_t p;</a>
<a name="ln3740">  if(other.filter == light_glow</a>
<a name="ln3741">     and std::sscanf(other.parameters, &quot;dt_light_glow %g,%g,%d,%g,%d&quot;, &amp;p.density, &amp;p.amplitude, &amp;p.blend_mode,</a>
<a name="ln3742">                     &amp;p.opacity, &amp;p.channel)</a>
<a name="ln3743">             == 5)</a>
<a name="ln3744">  {</a>
<a name="ln3745">    p.density = clamp(0.f, 1.f, p.density);</a>
<a name="ln3746">    p.amplitude = clamp(0.f, 2.f, p.amplitude);</a>
<a name="ln3747">    p.blend_mode = clamp(0, 12, p.blend_mode);</a>
<a name="ln3748">    p.opacity = clamp(0.f, 1.f, p.opacity);</a>
<a name="ln3749">    p.channel = clamp(0, static_cast&lt;int&gt;(color_channels.size() - 1), p.channel);</a>
<a name="ln3750">    *this = p;</a>
<a name="ln3751">  }</a>
<a name="ln3752">}</a>
<a name="ln3753"> </a>
<a name="ln3754">dt_iop_gmic_params_t dt_iop_gmic_light_glow_params_t::to_gmic_params() const</a>
<a name="ln3755">{</a>
<a name="ln3756">  dt_iop_gmic_params_t ret;</a>
<a name="ln3757">  ret.filter = light_glow;</a>
<a name="ln3758">  std::snprintf(ret.parameters, sizeof(ret.parameters), &quot;dt_light_glow %g,%g,%d,%g,%d&quot;, density, amplitude,</a>
<a name="ln3759">                blend_mode, opacity, channel);</a>
<a name="ln3760">  return ret;</a>
<a name="ln3761">}</a>
<a name="ln3762"> </a>
<a name="ln3763">const char *dt_iop_gmic_light_glow_params_t::get_custom_command() {</a>
<a name="ln3764">  // clang-format off</a>
<a name="ln3765">  return R&quot;raw(</a>
<a name="ln3766">_dt_light_glow :</a>
<a name="ln3767">  mode=${arg\ 1+$3,burn,dodge,freeze,grainmerge,hardlight,interpolation,lighten,multiply,overlay,reflect,softlight,stamp,value}</a>
<a name="ln3768">  repeat $!</a>
<a name="ln3769">    +gradient_norm. &gt;=. {100-$1}% distance. 1 ^. $2 *. -1 n. 0,255 blend $mode,$4</a>
<a name="ln3770">  mv. 0 done</a>
<a name="ln3771"> </a>
<a name="ln3772">dt_light_glow :</a>
<a name="ln3773">  apply_channels &quot;_dt_light_glow {100*$1},$2,$3,$4&quot;,$5</a>
<a name="ln3774">)raw&quot;;</a>
<a name="ln3775">  // clang-format on</a>
<a name="ln3776">}</a>
<a name="ln3777"> </a>
<a name="ln3778">filter_type dt_iop_gmic_light_glow_params_t::get_filter() const</a>
<a name="ln3779">{</a>
<a name="ln3780">  return light_glow;</a>
<a name="ln3781">}</a>
<a name="ln3782"> </a>
<a name="ln3783">void dt_iop_gmic_light_glow_params_t::gui_init(dt_iop_module_t *self) const</a>
<a name="ln3784">{</a>
<a name="ln3785">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln3786">  dt_iop_gmic_params_t *p = reinterpret_cast&lt;dt_iop_gmic_params_t *&gt;(self-&gt;params);</a>
<a name="ln3787">  if(p-&gt;filter == light_glow)</a>
<a name="ln3788">    g-&gt;light_glow.parameters = *p;</a>
<a name="ln3789">  else</a>
<a name="ln3790">    g-&gt;light_glow.parameters = dt_iop_gmic_light_glow_params_t();</a>
<a name="ln3791">  dt_bauhaus_combobox_add(g-&gt;gmic_filter, _(&quot;light glow&quot;));</a>
<a name="ln3792">  g-&gt;light_glow.box = gtk_box_new(GTK_ORIENTATION_VERTICAL, DT_BAUHAUS_SPACE);</a>
<a name="ln3793">  gtk_box_pack_start(GTK_BOX(self-&gt;widget), g-&gt;light_glow.box, TRUE, TRUE, 0);</a>
<a name="ln3794"> </a>
<a name="ln3795">  g-&gt;light_glow.density = dt_bauhaus_slider_new_with_range(self, 0, 1, 0.01, g-&gt;light_glow.parameters.density, 3);</a>
<a name="ln3796">  dt_bauhaus_widget_set_label(g-&gt;light_glow.density, NULL, _(&quot;density&quot;));</a>
<a name="ln3797">  gtk_widget_set_tooltip_text(g-&gt;light_glow.density, _(&quot;density of the light glow filter&quot;));</a>
<a name="ln3798">  gtk_box_pack_start(GTK_BOX(g-&gt;light_glow.box), GTK_WIDGET(g-&gt;light_glow.density), TRUE, TRUE, 0);</a>
<a name="ln3799">  g_signal_connect(G_OBJECT(g-&gt;light_glow.density), &quot;value-changed&quot;,</a>
<a name="ln3800">                   G_CALLBACK(dt_iop_gmic_light_glow_params_t::density_callback), self);</a>
<a name="ln3801"> </a>
<a name="ln3802">  g-&gt;light_glow.amplitude</a>
<a name="ln3803">      = dt_bauhaus_slider_new_with_range(self, 0, 2, 0.02, g-&gt;light_glow.parameters.amplitude, 3);</a>
<a name="ln3804">  dt_bauhaus_widget_set_label(g-&gt;light_glow.amplitude, NULL, _(&quot;amplitude&quot;));</a>
<a name="ln3805">  gtk_widget_set_tooltip_text(g-&gt;light_glow.amplitude, _(&quot;amplitude of the light glow filter&quot;));</a>
<a name="ln3806">  gtk_box_pack_start(GTK_BOX(g-&gt;light_glow.box), GTK_WIDGET(g-&gt;light_glow.amplitude), TRUE, TRUE, 0);</a>
<a name="ln3807">  g_signal_connect(G_OBJECT(g-&gt;light_glow.amplitude), &quot;value-changed&quot;,</a>
<a name="ln3808">                   G_CALLBACK(dt_iop_gmic_light_glow_params_t::amplitude_callback), self);</a>
<a name="ln3809"> </a>
<a name="ln3810">  g-&gt;light_glow.blend_mode = dt_bauhaus_combobox_new(self);</a>
<a name="ln3811">  for(auto i : { _(&quot;burn&quot;), _(&quot;dodge&quot;), _(&quot;freeze&quot;), _(&quot;grain merge&quot;), _(&quot;hard light&quot;), _(&quot;interpolation&quot;),</a>
<a name="ln3812">                 _(&quot;lighten&quot;), _(&quot;multiply&quot;), _(&quot;overlay&quot;), _(&quot;reflect&quot;), _(&quot;soft light&quot;), _(&quot;stamp&quot;), _(&quot;Value&quot;) })</a>
<a name="ln3813">    dt_bauhaus_combobox_add(g-&gt;light_glow.blend_mode, i);</a>
<a name="ln3814">  dt_bauhaus_widget_set_label(g-&gt;light_glow.blend_mode, NULL, _(&quot;blend mode&quot;));</a>
<a name="ln3815">  gtk_widget_set_tooltip_text(g-&gt;light_glow.blend_mode, _(&quot;blend mode of light glow filter&quot;));</a>
<a name="ln3816">  gtk_box_pack_start(GTK_BOX(g-&gt;light_glow.box), g-&gt;light_glow.blend_mode, TRUE, TRUE, 0);</a>
<a name="ln3817">  g_signal_connect(G_OBJECT(g-&gt;light_glow.blend_mode), &quot;value-changed&quot;,</a>
<a name="ln3818">                   G_CALLBACK(dt_iop_gmic_light_glow_params_t::blend_mode_callback), self);</a>
<a name="ln3819"> </a>
<a name="ln3820">  g-&gt;light_glow.opacity = dt_bauhaus_slider_new_with_range(self, 0, 1, 0.01, g-&gt;light_glow.parameters.opacity, 3);</a>
<a name="ln3821">  dt_bauhaus_widget_set_label(g-&gt;light_glow.opacity, NULL, _(&quot;opacity&quot;));</a>
<a name="ln3822">  gtk_widget_set_tooltip_text(g-&gt;light_glow.opacity, _(&quot;opacity of the light glow filter&quot;));</a>
<a name="ln3823">  gtk_box_pack_start(GTK_BOX(g-&gt;light_glow.box), GTK_WIDGET(g-&gt;light_glow.opacity), TRUE, TRUE, 0);</a>
<a name="ln3824">  g_signal_connect(G_OBJECT(g-&gt;light_glow.opacity), &quot;value-changed&quot;,</a>
<a name="ln3825">                   G_CALLBACK(dt_iop_gmic_light_glow_params_t::opacity_callback), self);</a>
<a name="ln3826"> </a>
<a name="ln3827">  g-&gt;light_glow.channel = dt_bauhaus_combobox_new(self);</a>
<a name="ln3828">  for(auto str : color_channels) dt_bauhaus_combobox_add(g-&gt;light_glow.channel, str);</a>
<a name="ln3829">  dt_bauhaus_widget_set_label(g-&gt;light_glow.channel, NULL, _(&quot;channel&quot;));</a>
<a name="ln3830">  gtk_widget_set_tooltip_text(g-&gt;light_glow.channel, _(&quot;apply filter to specific color channel(s)&quot;));</a>
<a name="ln3831">  gtk_box_pack_start(GTK_BOX(g-&gt;light_glow.box), g-&gt;light_glow.channel, TRUE, TRUE, 0);</a>
<a name="ln3832">  g_signal_connect(G_OBJECT(g-&gt;light_glow.channel), &quot;value-changed&quot;,</a>
<a name="ln3833">                   G_CALLBACK(dt_iop_gmic_light_glow_params_t::channel_callback), self);</a>
<a name="ln3834"> </a>
<a name="ln3835">  gtk_widget_show_all(g-&gt;light_glow.box);</a>
<a name="ln3836">  gtk_widget_set_no_show_all(g-&gt;light_glow.box, TRUE);</a>
<a name="ln3837">  gtk_widget_set_visible(g-&gt;light_glow.box, p-&gt;filter == light_glow ? TRUE : FALSE);</a>
<a name="ln3838">}</a>
<a name="ln3839"> </a>
<a name="ln3840">void dt_iop_gmic_light_glow_params_t::gui_update(dt_iop_module_t *self) const</a>
<a name="ln3841">{</a>
<a name="ln3842">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln3843">  dt_iop_gmic_params_t *p = reinterpret_cast&lt;dt_iop_gmic_params_t *&gt;(self-&gt;params);</a>
<a name="ln3844">  gtk_widget_set_visible(g-&gt;light_glow.box, p-&gt;filter == light_glow ? TRUE : FALSE);</a>
<a name="ln3845">  if(p-&gt;filter == light_glow)</a>
<a name="ln3846">  {</a>
<a name="ln3847">    g-&gt;light_glow.parameters = *p;</a>
<a name="ln3848">    dt_bauhaus_slider_set(g-&gt;light_glow.density, g-&gt;light_glow.parameters.density);</a>
<a name="ln3849">    dt_bauhaus_slider_set(g-&gt;light_glow.amplitude, g-&gt;light_glow.parameters.amplitude);</a>
<a name="ln3850">    dt_bauhaus_combobox_set(g-&gt;light_glow.blend_mode, g-&gt;light_glow.parameters.blend_mode);</a>
<a name="ln3851">    dt_bauhaus_slider_set(g-&gt;light_glow.opacity, g-&gt;light_glow.parameters.opacity);</a>
<a name="ln3852">    dt_bauhaus_combobox_set(g-&gt;light_glow.channel, g-&gt;light_glow.parameters.channel);</a>
<a name="ln3853">  }</a>
<a name="ln3854">}</a>
<a name="ln3855"> </a>
<a name="ln3856">void dt_iop_gmic_light_glow_params_t::gui_reset(dt_iop_module_t *self)</a>
<a name="ln3857">{</a>
<a name="ln3858">  *this = dt_iop_gmic_light_glow_params_t();</a>
<a name="ln3859">}</a>
<a name="ln3860"> </a>
<a name="ln3861">void dt_iop_gmic_light_glow_params_t::density_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln3862">{</a>
<a name="ln3863">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln3864">    G-&gt;light_glow.parameters.density = dt_bauhaus_slider_get(W);</a>
<a name="ln3865">    return G-&gt;light_glow.parameters.to_gmic_params();</a>
<a name="ln3866">  });</a>
<a name="ln3867">}</a>
<a name="ln3868"> </a>
<a name="ln3869">void dt_iop_gmic_light_glow_params_t::amplitude_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln3870">{</a>
<a name="ln3871">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln3872">    G-&gt;light_glow.parameters.amplitude = dt_bauhaus_slider_get(W);</a>
<a name="ln3873">    return G-&gt;light_glow.parameters.to_gmic_params();</a>
<a name="ln3874">  });</a>
<a name="ln3875">}</a>
<a name="ln3876"> </a>
<a name="ln3877">void dt_iop_gmic_light_glow_params_t::blend_mode_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln3878">{</a>
<a name="ln3879">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln3880">    G-&gt;light_glow.parameters.blend_mode = dt_bauhaus_combobox_get(W);</a>
<a name="ln3881">    return G-&gt;light_glow.parameters.to_gmic_params();</a>
<a name="ln3882">  });</a>
<a name="ln3883">}</a>
<a name="ln3884"> </a>
<a name="ln3885">void dt_iop_gmic_light_glow_params_t::opacity_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln3886">{</a>
<a name="ln3887">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln3888">    G-&gt;light_glow.parameters.opacity = dt_bauhaus_slider_get(W);</a>
<a name="ln3889">    return G-&gt;light_glow.parameters.to_gmic_params();</a>
<a name="ln3890">  });</a>
<a name="ln3891">}</a>
<a name="ln3892"> </a>
<a name="ln3893">void dt_iop_gmic_light_glow_params_t::channel_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln3894">{</a>
<a name="ln3895">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln3896">    G-&gt;freaky_details.parameters.channel = dt_bauhaus_combobox_get(W);</a>
<a name="ln3897">    return G-&gt;freaky_details.parameters.to_gmic_params();</a>
<a name="ln3898">  });</a>
<a name="ln3899">}</a>
<a name="ln3900"> </a>
<a name="ln3901">// --- lomo</a>
<a name="ln3902"> </a>
<a name="ln3903">dt_iop_gmic_lomo_params_t::dt_iop_gmic_lomo_params_t(const dt_iop_gmic_params_t &amp;other)</a>
<a name="ln3904">  : dt_iop_gmic_lomo_params_t()</a>
<a name="ln3905">{</a>
<a name="ln3906">  dt_iop_gmic_lomo_params_t p;</a>
<a name="ln3907">  if(other.filter == lomo and std::sscanf(other.parameters, &quot;dt_lomo %g&quot;, &amp;p.vignette_size) == 1)</a>
<a name="ln3908">  {</a>
<a name="ln3909">    p.vignette_size = clamp(0.f, 1.f, p.vignette_size);</a>
<a name="ln3910">    *this = p;</a>
<a name="ln3911">  }</a>
<a name="ln3912">}</a>
<a name="ln3913"> </a>
<a name="ln3914">dt_iop_gmic_params_t dt_iop_gmic_lomo_params_t::to_gmic_params() const</a>
<a name="ln3915">{</a>
<a name="ln3916">  dt_iop_gmic_params_t ret;</a>
<a name="ln3917">  ret.filter = lomo;</a>
<a name="ln3918">  std::snprintf(ret.parameters, sizeof(ret.parameters), &quot;dt_lomo %g&quot;, vignette_size);</a>
<a name="ln3919">  return ret;</a>
<a name="ln3920">}</a>
<a name="ln3921"> </a>
<a name="ln3922">const char *dt_iop_gmic_lomo_params_t::get_custom_command() {</a>
<a name="ln3923">  // clang-format off</a>
<a name="ln3924">  return R&quot;raw(</a>
<a name="ln3925">dt_lomo :</a>
<a name="ln3926">  remove_opacity repeat $! l[$&gt;] to_rgb</a>
<a name="ln3927">    +gaussian {125-125*$1+25}%,{125-125*$1+25}% n. 0,1 *</a>
<a name="ln3928">    s c</a>
<a name="ln3929">    f[0] '255*atan((i-128)/128)'</a>
<a name="ln3930">    f[1] '255*tan((i-128)/128)'</a>
<a name="ln3931">    f[2] '255*atan((i-128)/255)'</a>
<a name="ln3932">    a c</a>
<a name="ln3933">    sharpen 1</a>
<a name="ln3934">    normalize 0,255</a>
<a name="ln3935">  endl done</a>
<a name="ln3936">)raw&quot;;</a>
<a name="ln3937">  // clang-format on</a>
<a name="ln3938">}</a>
<a name="ln3939"> </a>
<a name="ln3940">filter_type dt_iop_gmic_lomo_params_t::get_filter() const</a>
<a name="ln3941">{</a>
<a name="ln3942">  return lomo;</a>
<a name="ln3943">}</a>
<a name="ln3944"> </a>
<a name="ln3945">void dt_iop_gmic_lomo_params_t::gui_init(dt_iop_module_t *self) const</a>
<a name="ln3946">{</a>
<a name="ln3947">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln3948">  dt_iop_gmic_params_t *p = reinterpret_cast&lt;dt_iop_gmic_params_t *&gt;(self-&gt;params);</a>
<a name="ln3949">  if(p-&gt;filter == lomo)</a>
<a name="ln3950">    g-&gt;lomo.parameters = *p;</a>
<a name="ln3951">  else</a>
<a name="ln3952">    g-&gt;lomo.parameters = dt_iop_gmic_lomo_params_t();</a>
<a name="ln3953">  dt_bauhaus_combobox_add(g-&gt;gmic_filter, _(&quot;lomo&quot;));</a>
<a name="ln3954">  g-&gt;lomo.box = gtk_box_new(GTK_ORIENTATION_VERTICAL, DT_BAUHAUS_SPACE);</a>
<a name="ln3955">  gtk_box_pack_start(GTK_BOX(self-&gt;widget), g-&gt;lomo.box, TRUE, TRUE, 0);</a>
<a name="ln3956"> </a>
<a name="ln3957">  g-&gt;lomo.vignette_size = dt_bauhaus_slider_new_with_range(self, 0, 1, 0.01, g-&gt;lomo.parameters.vignette_size, 3);</a>
<a name="ln3958">  dt_bauhaus_widget_set_label(g-&gt;lomo.vignette_size, NULL, _(&quot;vignette&quot;));</a>
<a name="ln3959">  gtk_widget_set_tooltip_text(g-&gt;lomo.vignette_size, _(&quot;size of vignette&quot;));</a>
<a name="ln3960">  gtk_box_pack_start(GTK_BOX(g-&gt;lomo.box), GTK_WIDGET(g-&gt;lomo.vignette_size), TRUE, TRUE, 0);</a>
<a name="ln3961">  g_signal_connect(G_OBJECT(g-&gt;lomo.vignette_size), &quot;value-changed&quot;,</a>
<a name="ln3962">                   G_CALLBACK(dt_iop_gmic_lomo_params_t::vignette_size_callback), self);</a>
<a name="ln3963"> </a>
<a name="ln3964">  gtk_widget_show_all(g-&gt;lomo.box);</a>
<a name="ln3965">  gtk_widget_set_no_show_all(g-&gt;lomo.box, TRUE);</a>
<a name="ln3966">  gtk_widget_set_visible(g-&gt;lomo.box, p-&gt;filter == lomo ? TRUE : FALSE);</a>
<a name="ln3967">}</a>
<a name="ln3968"> </a>
<a name="ln3969">void dt_iop_gmic_lomo_params_t::gui_update(dt_iop_module_t *self) const</a>
<a name="ln3970">{</a>
<a name="ln3971">  dt_iop_gmic_gui_data_t *g = reinterpret_cast&lt;dt_iop_gmic_gui_data_t *&gt;(self-&gt;gui_data);</a>
<a name="ln3972">  dt_iop_gmic_params_t *p = reinterpret_cast&lt;dt_iop_gmic_params_t *&gt;(self-&gt;params);</a>
<a name="ln3973">  gtk_widget_set_visible(g-&gt;lomo.box, p-&gt;filter == lomo ? TRUE : FALSE);</a>
<a name="ln3974">  if(p-&gt;filter == lomo)</a>
<a name="ln3975">  {</a>
<a name="ln3976">    g-&gt;lomo.parameters = *p;</a>
<a name="ln3977">    dt_bauhaus_slider_set(g-&gt;lomo.vignette_size, g-&gt;lomo.parameters.vignette_size);</a>
<a name="ln3978">  }</a>
<a name="ln3979">}</a>
<a name="ln3980"> </a>
<a name="ln3981">void dt_iop_gmic_lomo_params_t::gui_reset(dt_iop_module_t *self)</a>
<a name="ln3982">{</a>
<a name="ln3983">  *this = dt_iop_gmic_lomo_params_t();</a>
<a name="ln3984">}</a>
<a name="ln3985"> </a>
<a name="ln3986">void dt_iop_gmic_lomo_params_t::vignette_size_callback(GtkWidget *w, dt_iop_module_t *self)</a>
<a name="ln3987">{</a>
<a name="ln3988">  callback(w, self, [](dt_iop_gmic_gui_data_t *G, GtkWidget *W) {</a>
<a name="ln3989">    G-&gt;lomo.parameters.vignette_size = dt_bauhaus_slider_get(W);</a>
<a name="ln3990">    return G-&gt;lomo.parameters.to_gmic_params();</a>
<a name="ln3991">  });</a>
<a name="ln3992">}</a>
<a name="ln3993"> </a>
<a name="ln3994">// modelines: These editor modelines have been set for all relevant files by tools/update_modelines.sh</a>
<a name="ln3995">// vim: shiftwidth = 2 expandtab tabstop = 2 cindent</a>
<a name="ln3996">// kate: tab-indents: off; indent-width 2; replace-tabs on; indent-mode cstyle; remove-trailing-spaces modified;</a>

</code></pre>
<div class="balloon" rel="708"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v575/" target="_blank">V575</a> The potential null pointer is passed into 'memcpy' function. Inspect the first argument. Check lines: 708, 701.</p></div>
<div class="balloon" rel="709"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v575/" target="_blank">V575</a> The potential null pointer is passed into 'memcpy' function. Inspect the first argument. Check lines: 709, 702.</p></div>
<div class="balloon" rel="729"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="843"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1020/" target="_blank">V1020</a> The function exited without calling the 'dt_pthread_mutex_unlock' function. Check lines: 843, 803.</p></div>
<div class="balloon" rel="844"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1020/" target="_blank">V1020</a> The function exited without calling the 'dt_pthread_mutex_unlock' function. Check lines: 844, 803.</p></div>
<div class="balloon" rel="994"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="1082"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="1089"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="1096"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="1225"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="1233"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="1241"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="1249"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="1257"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="1264"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="1272"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="1284"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="1857"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="1866"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="1875"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="1884"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="1893"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="1902"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="1911"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="1925"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="2118"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="2126"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="2134"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="2142"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="2263"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="2272"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="2281"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="2289"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="2409"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="2418"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="2427"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="2436"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="2444"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="2573"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="2582"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="2592"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="2714"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="2722"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="2730"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="2738"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="2746"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="2754"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="2895"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="2904"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="2913"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="2922"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="2931"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="3053"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="3154"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="3163"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="3170"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="3177"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="3185"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="3193"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="3200"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="3207"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="3214"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="3222"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="3396"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="3403"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="3506"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="3515"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="3523"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="3531"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="3650"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="3658"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="3666"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="3674"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="3799"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="3807"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="3817"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="3824"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="3832"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="3961"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1016/" target="_blank">V1016</a> The value '0' is out of range of enum values. This causes unspecified or undefined behavior.</p></div>
<div class="balloon" rel="69"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v730/" target="_blank">V730</a> Not all members of a class are initialized inside the compiler generated constructor. Consider inspecting: filter.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
